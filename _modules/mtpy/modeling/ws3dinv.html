<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>mtpy.modeling.ws3dinv &#8212; MTpy 0.2 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="MTpy 0.2 documentation" href="../../../master_index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../master_index.html">MTpy 0.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for mtpy.modeling.ws3dinv</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">===============</span>
<span class="sd">ws3dinv</span>
<span class="sd">===============</span>

<span class="sd">    * Deals with input and output files for ws3dinv written by:</span>
<span class="sd">        Siripunvaraporn, W.; Egbert, G.; Lenbury, Y. &amp; Uyeshima, M. </span>
<span class="sd">        Three-dimensional magnetotelluric inversion: data-space method</span>
<span class="sd">        Physics of The Earth and Planetary Interiors, 2005, 150, 3-14</span>
<span class="sd">	* Dependencies: matplotlib 1.3.x, numpy 1.7.x, scipy 0.13               </span>
<span class="sd">                    and evtk if vtk files want to be written.</span>
<span class="sd">					</span>
<span class="sd">The intended use or workflow is something like this for getting started:</span>

<span class="sd">:Making input files: ::</span>

<span class="sd">    &gt;&gt;&gt; import mtpy.modeling.ws3dinv as ws</span>
<span class="sd">    &gt;&gt;&gt; import os</span>
<span class="sd">    &gt;&gt;&gt; #1) make a list of all .edi files that will be inverted for </span>
<span class="sd">    &gt;&gt;&gt; edi_path = r&quot;/home/EDI_Files&quot;</span>
<span class="sd">    &gt;&gt;&gt; edi_list = [os.path.join(edi_path, edi) for edi in edi_path </span>
<span class="sd">    &gt;&gt;&gt; ...         if edi.find(&#39;.edi&#39;) &gt; 0]</span>
<span class="sd">    &gt;&gt;&gt; #2) make a grid from the stations themselves with 200m cell spacing</span>
<span class="sd">    &gt;&gt;&gt; wsmesh = ws.WSMesh(edi_list=edi_list, cell_size_east=200, </span>
<span class="sd">    &gt;&gt;&gt; ...                cell_size_north=200)</span>
<span class="sd">    &gt;&gt;&gt; wsmesh.make_mesh()</span>
<span class="sd">    &gt;&gt;&gt; # check to see if the mesh is what you think it should be</span>
<span class="sd">    &gt;&gt;&gt; wsmesh.plot_mesh()</span>
<span class="sd">    &gt;&gt;&gt; # all is good write the mesh file</span>
<span class="sd">    &gt;&gt;&gt; wsmesh.write_initial_file(save_path=r&quot;/home/ws3dinv/Inv1&quot;)</span>
<span class="sd">    &gt;&gt;&gt; # note this will write a file with relative station locations</span>
<span class="sd">    &gt;&gt;&gt; #change the starting model to be different than a halfspace</span>
<span class="sd">    &gt;&gt;&gt; mm = ws.WS3DModelManipulator(initial_fn=wsmesh.initial_fn)</span>
<span class="sd">    &gt;&gt;&gt; # an interactive gui will pop up to change the resistivity model</span>
<span class="sd">    &gt;&gt;&gt; #once finished write a new initial file</span>
<span class="sd">    &gt;&gt;&gt; mm.rewrite_initial_file()</span>
<span class="sd">    &gt;&gt;&gt; #3) write data file</span>
<span class="sd">    &gt;&gt;&gt; wsdata = ws.WSData(edi_list=edi_list, station_fn=wsmesh.station_fn)</span>
<span class="sd">    &gt;&gt;&gt; wsdata.write_data_file()</span>
<span class="sd">    &gt;&gt;&gt; #4) plot mt response to make sure everything looks ok</span>
<span class="sd">    &gt;&gt;&gt; rp = ws.PlotResponse(data_fn=wsdata.data_fn)</span>
<span class="sd">    &gt;&gt;&gt; #5) make startup file</span>
<span class="sd">    &gt;&gt;&gt; sws = ws.WSStartup(data_fn=wsdata.data_fn, initial_fn=mm.new_initial_fn)</span>
<span class="sd">    </span>
<span class="sd">:checking the model and response: ::</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; mfn = r&quot;/home/ws3dinv/Inv1/test_model.01&quot;</span>
<span class="sd">    &gt;&gt;&gt; dfn = r&quot;/home/ws3dinv/Inv1/WSDataFile.dat&quot;</span>
<span class="sd">    &gt;&gt;&gt; rfn = r&quot;/home/ws3dinv/Inv1/test_resp.01&quot; </span>
<span class="sd">    &gt;&gt;&gt; sfn = r&quot;/home/ws3dinv/Inv1/WS_Sation_Locations.txt&quot;</span>
<span class="sd">    &gt;&gt;&gt; # plot the data vs. model response</span>
<span class="sd">    &gt;&gt;&gt; rp = ws.PlotResponse(data_fn=dfn, resp_fn=rfn, station_fn=sfn)</span>
<span class="sd">    &gt;&gt;&gt; # plot model slices where you can interactively step through</span>
<span class="sd">    &gt;&gt;&gt; ds = ws.PlotSlices(model_fn=mfn, station_fn=sfn)</span>
<span class="sd">    &gt;&gt;&gt; # plot phase tensor ellipses on top of depth slices</span>
<span class="sd">    &gt;&gt;&gt; ptm = ws.PlotPTMaps(data_fn=dfn, resp_fn=rfn, model_fn=mfn)</span>
<span class="sd">    &gt;&gt;&gt; #write files for 3D visualization in Paraview or Mayavi</span>
<span class="sd">    &gt;&gt;&gt; ws.write_vtk_files(mfn, sfn, r&quot;/home/ParaviewFiles&quot;)</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">Created on Sun Aug 25 18:41:15 2013</span>

<span class="sd">@author: jpeacock-pr</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">#==============================================================================</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="k">import</span> <span class="n">MultipleLocator</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="k">import</span> <span class="n">Ellipse</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="k">import</span> <span class="n">Normalize</span>
<span class="kn">import</span> <span class="nn">matplotlib.colorbar</span> <span class="k">as</span> <span class="nn">mcb</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">import</span> <span class="nn">mtpy.core.z</span> <span class="k">as</span> <span class="nn">mtz</span>
<span class="kn">import</span> <span class="nn">mtpy.core.mt</span> <span class="k">as</span> <span class="nn">mt</span>
<span class="kn">import</span> <span class="nn">mtpy.imaging.mtplottools</span> <span class="k">as</span> <span class="nn">mtplottools</span>
<span class="kn">import</span> <span class="nn">matplotlib.widgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">import</span> <span class="nn">mtpy.modeling.winglink</span> <span class="k">as</span> <span class="nn">wl</span>
<span class="kn">import</span> <span class="nn">mtpy.utils.exceptions</span> <span class="k">as</span> <span class="nn">mtex</span>
<span class="kn">import</span> <span class="nn">mtpy.analysis.pt</span> <span class="k">as</span> <span class="nn">mtpt</span>
<span class="kn">import</span> <span class="nn">mtpy.imaging.mtcolors</span> <span class="k">as</span> <span class="nn">mtcl</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">evtk.hl</span> <span class="k">import</span> <span class="n">gridToVTK</span><span class="p">,</span> <span class="n">pointsToVTK</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;If you want to write a vtk file for 3d viewing, you need download &#39;</span>
           <span class="s1">&#39;and install evtk from https://bitbucket.org/pauloh/pyevtk&#39;</span><span class="p">)</span>

    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Note: if you are using Windows you should build evtk first with&#39;</span>
           <span class="s1">&#39;either MinGW or cygwin using the command: </span><span class="se">\n</span><span class="s1">&#39;</span>
           <span class="s1">&#39;    python setup.py build -compiler=mingw32  or </span><span class="se">\n</span><span class="s1">&#39;</span>
           <span class="s1">&#39;    python setup.py build -compiler=cygwin&#39;</span><span class="p">)</span>

<span class="c1">#==============================================================================</span>

<span class="c1">#==============================================================================</span>
<span class="c1"># Data class</span>
<span class="c1">#==============================================================================</span>


<div class="viewcode-block" id="WSData"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSData">[docs]</a><span class="k">class</span> <span class="nc">WSData</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Includes tools for reading and writing data files intended to be used with</span>
<span class="sd">    ws3dinv.</span>

<span class="sd">    :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.ws3dinv as ws</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; edi_path = r&quot;/home/EDI_Files&quot;</span>
<span class="sd">        &gt;&gt;&gt; edi_list = [os.path.join(edi_path, edi) for edi in edi_path </span>
<span class="sd">        &gt;&gt;&gt; ...         if edi.find(&#39;.edi&#39;) &gt; 0]</span>
<span class="sd">        &gt;&gt;&gt; # create an evenly space period list in log space</span>
<span class="sd">        &gt;&gt;&gt; p_list = np.logspace(np.log10(.001), np.log10(1000), 12)</span>
<span class="sd">        &gt;&gt;&gt; wsdata = ws.WSData(edi_list=edi_list, period_list=p_list, </span>
<span class="sd">        &gt;&gt;&gt; ...                station_fn=r&quot;/home/stations.txt&quot;)</span>
<span class="sd">        &gt;&gt;&gt; wsdata.write_data_file()</span>


<span class="sd">    ====================== ====================================================</span>
<span class="sd">    Attributes              Description</span>
<span class="sd">    ====================== ====================================================</span>
<span class="sd">    data                   numpy structured array with keys:</span>
<span class="sd">                               * *station* --&gt; station name</span>
<span class="sd">                               * *east*    --&gt; relative eastern location in</span>
<span class="sd">                                               grid</span>
<span class="sd">                               * *north*   --&gt; relative northern location in </span>
<span class="sd">                                               grid</span>
<span class="sd">                               * *z_data*  --&gt; impedance tensor array with </span>
<span class="sd">                                               shape</span>
<span class="sd">                                         (n_stations, n_freq, 4, dtype=complex)</span>
<span class="sd">                               * *z_data_err--&gt; impedance tensor error without</span>
<span class="sd">                                                error map applied</span>
<span class="sd">                               * *z_err_map --&gt; error map from data file</span>
<span class="sd">    data_fn                full path to data file</span>
<span class="sd">    edi_list               list of edi files used to make data file</span>
<span class="sd">    n_z                    [ 4 | 8 ] number of impedance tensor elements</span>
<span class="sd">                           *default* is 8</span>
<span class="sd">    ncol                   number of columns in out file from winglink</span>
<span class="sd">                           *default* is 5</span>
<span class="sd">    period_list            list of periods to invert for</span>
<span class="sd">    ptol                   if periods in edi files don&#39;t match period_list</span>
<span class="sd">                           then program looks for periods within ptol</span>
<span class="sd">                           *defualt* is .15 or 15 percent</span>
<span class="sd">    rotation_angle         Angle to rotate the data relative to north.  Here </span>
<span class="sd">                           the angle is measure clockwise from North, </span>
<span class="sd">                           Assuming North is 0 and East is 90.  Rotating data,</span>
<span class="sd">                           and grid to align with regional geoelectric strike</span>
<span class="sd">                           can improve the inversion. *default* is None</span>
<span class="sd">    save_path              path to save the data file</span>
<span class="sd">    station_fn             full path to station file written by WSStation</span>
<span class="sd">    station_locations      numpy structured array for station locations keys:</span>
<span class="sd">                               * *station* --&gt; station name</span>
<span class="sd">                               * *east*    --&gt; relative eastern location in</span>
<span class="sd">                                               grid</span>
<span class="sd">                               * *north*   --&gt; relative northern location in</span>
<span class="sd">                                               grid</span>
<span class="sd">                           if input a station file is written</span>
<span class="sd">    station_east           relative locations of station in east direction</span>
<span class="sd">    station_north          relative locations of station in north direction</span>
<span class="sd">    station_names          names of stations</span>

<span class="sd">    units                  [ &#39;mv&#39; | &#39;else&#39; ] units of Z, needs to be mv for </span>
<span class="sd">                           ws3dinv. *default* is &#39;mv&#39;</span>
<span class="sd">    wl_out_fn              Winglink .out file which describes a 3D grid</span>
<span class="sd">    wl_site_fn             Wingling .sites file which gives station locations</span>
<span class="sd">    z_data                 impedance tensors of data with shape:</span>
<span class="sd">                           (n_station, n_periods, 2, 2)</span>
<span class="sd">    z_data_err             error of data impedance tensors with error map </span>
<span class="sd">                           applied, shape (n_stations, n_periods, 2, 2)</span>
<span class="sd">    z_err                  [ float | &#39;data&#39; ] </span>
<span class="sd">                           &#39;data&#39; to set errors as data errors or</span>
<span class="sd">                           give a percent error to impedance tensor elements</span>
<span class="sd">                           *default* is .05 or 5%  if given as percent, ie. 5%</span>
<span class="sd">                           then it is converted to .05.  </span>
<span class="sd">    z_err_floor            percent error floor, anything below this error will</span>
<span class="sd">                           be set to z_err_floor.  *default* is None</span>
<span class="sd">    z_err_map              [zxx, zxy, zyx, zyy] for n_z = 8</span>
<span class="sd">                           [zxy, zyx] for n_z = 4</span>
<span class="sd">                           Value in percent to multiply the error by, which </span>
<span class="sd">                           give the user power to down weight bad data, so </span>
<span class="sd">                           the resulting error will be z_err_map*z_err</span>
<span class="sd">    ====================== ====================================================</span>

<span class="sd">    ====================== ====================================================</span>
<span class="sd">    Methods                Description</span>
<span class="sd">    ====================== ====================================================</span>
<span class="sd">    build_data             builds the data from .edi files</span>
<span class="sd">    write_data_file        writes a data file from attribute data.  This way </span>
<span class="sd">                           you can read in a data file, change some parameters</span>
<span class="sd">                           and rewrite.</span>
<span class="sd">    read_data_file         reads in a ws3dinv data file</span>
<span class="sd">    ====================== ====================================================</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;save_path&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_basename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;data_basename&#39;</span><span class="p">,</span> <span class="s1">&#39;WSDataFile.dat&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncol</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ncols&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ptol</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ptol&#39;</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;z_err&#39;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_err_floor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;z_err_floor&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_err_map</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;z_err_map&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_z</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;n_z&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period_list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;period_list&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;edi_list&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_locations&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;roatation_angle&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_names</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">z_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_data_err</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wl_site_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;wl_site_fn&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wl_out_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;wl_out_fn&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;data_fn&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_fn&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># make sure the error given is a decimal percent</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_err</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span> <span class="o">/=</span> <span class="mf">100.</span>

        <span class="c1"># make sure the error floor given is a decimal percent</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err_floor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err_floor</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_err_floor</span> <span class="o">/=</span> <span class="mf">100.</span>

<div class="viewcode-block" id="WSData.build_data"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSData.build_data">[docs]</a>    <span class="k">def</span> <span class="nf">build_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds the data from .edi files to be written into a data file</span>

<span class="sd">        Need to call this if any parameters have been reset to write a </span>
<span class="sd">        correct data file.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WSInputError</span><span class="p">(</span><span class="s1">&#39;Need to input a list of .edi files to build &#39;</span>
                               <span class="s1">&#39;the data&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WSInputError</span><span class="p">(</span><span class="s1">&#39;Need to input a list of periods to extract &#39;</span>
                               <span class="s1">&#39;from the .edi files.&#39;</span><span class="p">)</span>

        <span class="c1"># get units correctly</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;mv&#39;</span><span class="p">:</span>
            <span class="n">zconv</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="mf">796.</span>

        <span class="c1"># define some lengths</span>
        <span class="n">n_stations</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">)</span>
        <span class="n">n_periods</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period_list</span><span class="p">)</span>

        <span class="c1"># make a structured array to keep things in for convenience</span>
        <span class="n">z_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_periods</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">data_dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="s1">&#39;|S10&#39;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;z_data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">,</span> <span class="n">z_shape</span><span class="p">)),</span>
                      <span class="p">(</span><span class="s1">&#39;z_data_err&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">,</span> <span class="n">z_shape</span><span class="p">)),</span>
                      <span class="p">(</span><span class="s1">&#39;z_err_map&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">,</span> <span class="n">z_shape</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_stations</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data_dtype</span><span class="p">)</span>

        <span class="c1">#------get station locations-------------------------------------------</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl_site_fn</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl_out_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Need to input an .out file to get station&#39;</span>
                              <span class="s1">&#39;locations, this should be output by Winglink&#39;</span><span class="p">)</span>

            <span class="c1"># get x and y locations on a relative grid</span>
            <span class="n">east_list</span><span class="p">,</span> <span class="n">north_list</span><span class="p">,</span> <span class="n">station_list</span> <span class="o">=</span> \
                <span class="n">wl</span><span class="o">.</span><span class="n">get_station_locations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl_site_fn</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">wl_out_fn</span><span class="p">,</span>
                                         <span class="n">ncol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ncol</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">station_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">east_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">north_list</span>

        <span class="c1"># if a station location file is input</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stations</span> <span class="o">=</span> <span class="n">WSStation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span><span class="p">)</span>
            <span class="n">stations</span><span class="o">.</span><span class="n">read_station_file</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">names</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">east</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">north</span>

        <span class="c1"># if the user made a grid in python or some other fashion</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">dd</span><span class="p">,</span> <span class="n">sd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">][</span><span class="n">dd</span><span class="p">]</span> <span class="o">=</span> <span class="n">sd</span><span class="p">[</span><span class="s1">&#39;east_c&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">][</span><span class="n">dd</span><span class="p">]</span> <span class="o">=</span> <span class="n">sd</span><span class="p">[</span><span class="s1">&#39;north_c&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">][</span><span class="n">dd</span><span class="p">]</span> <span class="o">=</span> <span class="n">sd</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span>

                    <span class="n">stations</span> <span class="o">=</span> <span class="n">WSStation</span><span class="p">()</span>
                    <span class="n">stations</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span>
                                                       <span class="s1">&#39;WS_Station_locations.txt&#39;</span><span class="p">)</span>
                    <span class="n">stations</span><span class="o">.</span><span class="n">east</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span>
                    <span class="n">stations</span><span class="o">.</span><span class="n">north</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span>
                    <span class="n">stations</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span>
                    <span class="n">stations</span><span class="o">.</span><span class="n">write_station_file</span><span class="p">()</span>

            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1">#--------find frequencies----------------------------------------------</span>
        <span class="k">for</span> <span class="n">ss</span><span class="p">,</span> <span class="n">edi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">edi</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Could not find &#39;</span> <span class="o">+</span> <span class="n">edi</span><span class="p">)</span>

            <span class="n">mt_obj</span> <span class="o">=</span> <span class="n">mt</span><span class="o">.</span><span class="n">MT</span><span class="p">(</span><span class="n">edi</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mt_obj</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span>
            <span class="nb">print</span> <span class="s1">&#39;</span><span class="si">{0}{1}{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">,</span> <span class="n">mt_obj</span><span class="o">.</span><span class="n">station</span><span class="p">)</span>

            <span class="c1"># get only those periods that are within the station data</span>
            <span class="n">interp_periods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period_list</span> <span class="o">&gt;=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">mt_obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period_list</span> <span class="o">&lt;=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">mt_obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">min</span><span class="p">()))]</span>

            <span class="c1"># interpolate over those periods</span>
            <span class="n">interp_z</span><span class="p">,</span> <span class="n">interp_t</span> <span class="o">=</span> <span class="n">mt_obj</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">interp_periods</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">interp_periods</span><span class="p">):</span>
                <span class="n">jj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period_list</span> <span class="o">==</span> <span class="n">ff</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="nb">print</span> <span class="s1">&#39;    </span><span class="si">{0:.6g}</span><span class="s1"> (s)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="s1">&#39;z_data&#39;</span><span class="p">][</span><span class="n">jj</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">interp_z</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">zconv</span>
                <span class="c1"># get errors</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="s1">&#39;z_data_err&#39;</span><span class="p">][</span>
                        <span class="n">jj</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">interp_z</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">zconv</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="s1">&#39;z_data_err&#39;</span><span class="p">][</span>
                        <span class="n">jj</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">interp_z</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err</span> <span class="o">*</span> <span class="n">zconv</span>

                <span class="c1"># if an error floor is set.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err_floor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">per_err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="s1">&#39;z_data_err&#39;</span><span class="p">][</span><span class="n">jj</span><span class="p">,</span> <span class="p">:]</span> <span class="o">/</span>\
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="s1">&#39;z_data&#39;</span><span class="p">][</span><span class="n">jj</span><span class="p">,</span> <span class="p">:]</span>
                    <span class="n">per_err</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">per_err</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_err_floor</span><span class="p">)]</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">z_err_floor</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="s1">&#39;z_data_err&#39;</span><span class="p">][</span><span class="n">jj</span><span class="p">,</span> <span class="p">:</span> <span class="p">]</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="s1">&#39;z_data&#39;</span><span class="p">][</span><span class="n">jj</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">per_err</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="s1">&#39;z_err_map&#39;</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_err_map</span><span class="p">,</span>
                                                            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span></div>
<span class="c1">#            for ff, f1 in enumerate(self.period_list):</span>
<span class="c1">#                for kk,f2 in enumerate(z1.period):</span>
<span class="c1">#                    if f2 &gt;= (1-self.ptol)*f1 and f2 &lt;= (1+self.ptol)*f1:</span>
<span class="c1">#                        self.data[ss][&#39;z_data&#39;][ff, :] = \</span>
<span class="c1">#                                                   zconv*z1.Z.z[kk]</span>
<span class="c1">#                        #get errors</span>
<span class="c1">#                        if self.z_err == &#39;data&#39;:</span>
<span class="c1">#                            self.data[ss][&#39;z_data_err&#39;][ff, :] = \</span>
<span class="c1">#                                                            zconv*z1.Z.z_err[kk]</span>
<span class="c1">#                        else:</span>
<span class="c1">#                            self.data[ss][&#39;z_data_err&#39;][ff, :] = \</span>
<span class="c1">#                                                    zconv*z1.Z.z[kk]*self.z_err</span>
<span class="c1">#                        # if an error floor is set.</span>
<span class="c1">#                        if self.z_err_floor is not None:</span>
<span class="c1">#                            per_err = self.data[ss][&#39;z_data_err&#39;][ff, :]/\</span>
<span class="c1">#                                      self.data[ss][&#39;z_data&#39;][ff, :]</span>
<span class="c1">#                            per_err[np.where(per_err &lt; self.z_err_floor)] = \</span>
<span class="c1">#                                                        self.z_err_floor</span>
<span class="c1">#                            self.data[ss][&#39;z_data_err&#39;][ff, : ] = \</span>
<span class="c1">#                                self.data[ss][&#39;z_data&#39;][ff, :] * per_err</span>
<span class="c1">#</span>
<span class="c1">#                        self.data[ss][&#39;z_err_map&#39;][ff] = \</span>
<span class="c1">#                                    np.reshape(self.z_err_map, (2,2))</span>
<span class="c1">#</span>
<span class="c1">#                        print &#39;   Matched {0:.6g} to {1:.6g}&#39;.format(f1, f2)</span>
<span class="c1">#                        break</span>

<div class="viewcode-block" id="WSData.write_data_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSData.write_data_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_data_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a data file based on the attribute data</span>

<span class="sd">        Key Word Arguments:</span>
<span class="sd">        ---------------------</span>
<span class="sd">            **data_fn** : string</span>
<span class="sd">                          full path to data file name</span>

<span class="sd">            **save_path** : string</span>
<span class="sd">                            directory path to save data file, will be written</span>
<span class="sd">                            as save_path/data_basename</span>
<span class="sd">            **data_basename** : string</span>
<span class="sd">                                basename of data file to be saved as </span>
<span class="sd">                                save_path/data_basename</span>
<span class="sd">                                *default* is WSDataFile.dat</span>

<span class="sd">        .. note:: if any of the data attributes have been reset, be sure</span>
<span class="sd">                  to call build_data() before write_data_file.  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_data</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;data_fn&#39;</span><span class="p">,</span> <span class="s1">&#39;save_path&#39;</span><span class="p">,</span> <span class="s1">&#39;data_basename&#39;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># create the output filename</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl_out_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl_site_fn</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_basename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_basename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span>

        <span class="c1">#-----Write data file--------------------------------------------------</span>
        <span class="n">n_stations</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">n_periods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;z_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ofid</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:d}</span><span class="s1"> </span><span class="si">{1:d}</span><span class="s1"> </span><span class="si">{2:d}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_stations</span><span class="p">,</span> <span class="n">n_periods</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">n_z</span><span class="p">))</span>

        <span class="c1"># write N-S locations</span>
        <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Station_Location: N-S </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_stations</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_z</span><span class="p">):</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_z</span> <span class="o">+</span> <span class="n">ll</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:+.4e}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># write E-W locations</span>
        <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Station_Location: E-W </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_stations</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_z</span><span class="p">):</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_z</span> <span class="o">+</span> <span class="n">ll</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:+.4e}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># write impedance tensor components</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">p1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period_list</span><span class="p">):</span>
            <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;DATA_Period: </span><span class="si">{0:3.6f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_stations</span><span class="p">):</span>
                <span class="n">zline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="s1">&#39;z_data&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,)</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_z</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:+.4e}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zline</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">))</span>
                    <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:+.4e}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="n">zline</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">))</span>
                <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># write error as a percentage of Z</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">p1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period_list</span><span class="p">):</span>
            <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ERROR_Period: </span><span class="si">{0:3.6f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_stations</span><span class="p">):</span>
                <span class="n">zline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="s1">&#39;z_data_err&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,)</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_z</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:+.4e}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zline</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">))</span>
                    <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:+.4e}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zline</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">))</span>
                <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># write error maps</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">p1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period_list</span><span class="p">):</span>
            <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ERMAP_Period: </span><span class="si">{0:3.6f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_stations</span><span class="p">):</span>
                <span class="n">zline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="s1">&#39;z_err_map&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,)</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_z</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:.5e}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_err_map</span><span class="p">[</span><span class="n">jj</span><span class="p">]))</span>
                    <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:.5e}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_err_map</span><span class="p">[</span><span class="n">jj</span><span class="p">]))</span>
                <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ofid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span> <span class="s1">&#39;Wrote file to: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z_data&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_data_err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z_data_err&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z_err_map&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="WSData.read_data_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSData.read_data_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wl_sites_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">station_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read in data file</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>
<span class="sd">            **data_fn** : string</span>
<span class="sd">                          full path to data file</span>
<span class="sd">            **wl_sites_fn** : string</span>
<span class="sd">                              full path to sites file output by winglink.</span>
<span class="sd">                              This is to match the station name with station</span>
<span class="sd">                              number.</span>
<span class="sd">            **station_fn** : string</span>
<span class="sd">                             full path to station location file written by </span>
<span class="sd">                             WSStation</span>

<span class="sd">        Fills Attributes:</span>
<span class="sd">        ------------------</span>
<span class="sd">            **data** : structure np.ndarray</span>
<span class="sd">                      fills the attribute WSData.data with values</span>

<span class="sd">            **period_list** : np.ndarray()</span>
<span class="sd">                             fills the period list with values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;mv&#39;</span><span class="p">:</span>
            <span class="n">zconv</span> <span class="o">=</span> <span class="mf">796.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zconv</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">data_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">data_fn</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WSInputError</span><span class="p">(</span><span class="s1">&#39;Need to input a data file&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WSInputError</span><span class="p">(</span><span class="s1">&#39;Could not find </span><span class="si">{0}</span><span class="s1">, check path&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>

        <span class="n">dfid</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">dlines</span> <span class="o">=</span> <span class="n">dfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="c1"># get size number of stations, number of frequencies,</span>
        <span class="c1"># number of Z components</span>
        <span class="n">n_stations</span><span class="p">,</span> <span class="n">n_periods</span><span class="p">,</span> <span class="n">nz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span>
                                             <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
        <span class="n">nsstart</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_z</span> <span class="o">=</span> <span class="n">nz</span>
        <span class="c1"># make a structured array to keep things in for convenience</span>
        <span class="n">z_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_periods</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">data_dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="s1">&#39;|S10&#39;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;z_data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">,</span> <span class="n">z_shape</span><span class="p">)),</span>
                      <span class="p">(</span><span class="s1">&#39;z_data_err&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">,</span> <span class="n">z_shape</span><span class="p">)),</span>
                      <span class="p">(</span><span class="s1">&#39;z_err_map&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">,</span> <span class="n">z_shape</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_stations</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data_dtype</span><span class="p">)</span>

        <span class="n">findlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">dline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">50</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Station_Location: N-S&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">findlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">dline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Station_Location: E-W&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">findlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">dline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;DATA_Period:&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">findlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>

        <span class="n">ncol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">nsstart</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

        <span class="c1"># get site names if entered a sites file</span>
        <span class="k">if</span> <span class="n">wl_sites_fn</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wl_site_fn</span> <span class="o">=</span> <span class="n">wl_sites_fn</span>
            <span class="n">slist</span><span class="p">,</span> <span class="n">station_list</span> <span class="o">=</span> <span class="n">wl</span><span class="o">.</span><span class="n">read_sites_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl_sites_fn</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">station_list</span>

        <span class="k">elif</span> <span class="n">station_fn</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">=</span> <span class="n">station_fn</span>
            <span class="n">stations</span> <span class="o">=</span> <span class="n">WSStation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span><span class="p">)</span>
            <span class="n">stations</span><span class="o">.</span><span class="n">read_station_file</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">names</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_stations</span><span class="p">)</span>

        <span class="c1"># get N-S locations</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">dline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">findlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">findlist</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">dline</span> <span class="o">=</span> <span class="n">dline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncol</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">][</span><span class="n">ii</span> <span class="o">*</span> <span class="n">ncol</span> <span class="o">+</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dline</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">break</span>

        <span class="c1"># get E-W locations</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">dline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">findlist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">findlist</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">dline</span> <span class="o">=</span> <span class="n">dline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_z</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">][</span><span class="n">ii</span> <span class="o">*</span> <span class="n">ncol</span> <span class="o">+</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dline</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="c1"># make some empty array to put stuff into</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_periods</span><span class="p">)</span>

        <span class="c1"># get data</span>
        <span class="n">per</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">error_find</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">errmap_find</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">dl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">findlist</span><span class="p">[</span><span class="mi">2</span><span class="p">]:]):</span>
            <span class="k">if</span> <span class="n">dl</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;period&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">if</span> <span class="n">dl</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dkey</span> <span class="o">=</span> <span class="s1">&#39;z_data&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">period_list</span><span class="p">[</span><span class="n">per</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>

                <span class="k">elif</span> <span class="n">dl</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dkey</span> <span class="o">=</span> <span class="s1">&#39;z_data_err&#39;</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">error_find</span><span class="p">:</span>
                        <span class="n">error_find</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">per</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">elif</span> <span class="n">dl</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ermap&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dkey</span> <span class="o">=</span> <span class="s1">&#39;z_err_map&#39;</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">errmap_find</span><span class="p">:</span>
                        <span class="n">errmap_find</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">per</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># print &#39;-&#39;*20+dkey+&#39;-&#39;*20</span>
                <span class="n">per</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dkey</span> <span class="o">==</span> <span class="s1">&#39;z_err_map&#39;</span><span class="p">:</span>
                    <span class="n">zline</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">st</span><span class="p">][</span><span class="n">dkey</span><span class="p">][</span><span class="n">per</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">zline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">zline</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                 <span class="n">zline</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">zline</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                                                                <span class="p">[</span><span class="n">zline</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">zline</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                                                                 <span class="n">zline</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">zline</span><span class="p">[</span><span class="mi">7</span><span class="p">]]])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">zline</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span>
                                     <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">zconv</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">st</span><span class="p">][</span><span class="n">dkey</span><span class="p">][</span><span class="n">per</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">zline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">zline</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                 <span class="n">zline</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">zline</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                                                                <span class="p">[</span><span class="n">zline</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">zline</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                                                                 <span class="n">zline</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">zline</span><span class="p">[</span><span class="mi">7</span><span class="p">]]])</span>
                <span class="n">st</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z_data&#39;</span><span class="p">]</span>
        <span class="c1"># need to be careful when multiplying complex numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_data_err</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z_data_err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z_err_map&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z_data_err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z_err_map&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span>

        <span class="c1"># make station_locations structure array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_east</span><span class="p">),</span>
                                          <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="s1">&#39;|S10&#39;</span><span class="p">),</span>
                                                 <span class="p">(</span><span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                                                 <span class="p">(</span><span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                                                 <span class="p">(</span><span class="s1">&#39;east_c&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                                                 <span class="p">(</span><span class="s1">&#39;north_c&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span></div></div>

<span class="c1">#==============================================================================</span>
<span class="c1"># stations</span>
<span class="c1">#==============================================================================</span>


<div class="viewcode-block" id="WSStation"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSStation">[docs]</a><span class="k">class</span> <span class="nc">WSStation</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read and write a station file where the locations are relative to the </span>
<span class="sd">    3D mesh.</span>

<span class="sd">    ==================== ======================================================</span>
<span class="sd">    Attributes           Description</span>
<span class="sd">    ==================== ======================================================</span>
<span class="sd">    east                 array of relative locations in east direction    </span>
<span class="sd">    elev                 array of elevations for each station</span>
<span class="sd">    names                array of station names</span>
<span class="sd">    north                array of relative locations in north direction  </span>
<span class="sd">    station_fn           full path to station file</span>
<span class="sd">    save_path            path to save file to</span>
<span class="sd">    ==================== ======================================================</span>

<span class="sd">    ==================== ======================================================</span>
<span class="sd">    Methods              Description </span>
<span class="sd">    ==================== ======================================================</span>
<span class="sd">    read_station_file    reads in a station file</span>
<span class="sd">    write_station_file   writes a station file  </span>
<span class="sd">    write_vtk_file       writes a vtk points file for station locations</span>
<span class="sd">    ==================== ======================================================</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">station_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">=</span> <span class="n">station_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;elev&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;save_path&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<div class="viewcode-block" id="WSStation.write_station_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSStation.write_station_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_station_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">east</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">north</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">station_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">elev</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write a station file to go with the data file.</span>

<span class="sd">        the locations are on a relative grid where (0, 0, 0) is the </span>
<span class="sd">        center of the grid.  Also, the stations are assumed to be in the center</span>
<span class="sd">        of the cell.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>
<span class="sd">            **east** : np.ndarray(n_stations)</span>
<span class="sd">                       relative station locations in east direction</span>

<span class="sd">            **north** : np.ndarray(n_stations)</span>
<span class="sd">                       relative station locations in north direction</span>

<span class="sd">            **elev** : np.ndarray(n_stations)</span>
<span class="sd">                       relative station locations in vertical direction</span>

<span class="sd">            **station_list** : list or np.ndarray(n_stations)</span>
<span class="sd">                               name of stations</span>

<span class="sd">            **save_path** : string</span>
<span class="sd">                            directory or full path to save station file to</span>
<span class="sd">                            if a directory  the file will be saved as</span>
<span class="sd">                            save_path/WS_Station_Locations.txt</span>
<span class="sd">                            if save_path is none the current working directory</span>
<span class="sd">                            is used as save_path</span>

<span class="sd">        Outputs:</span>
<span class="sd">        ---------</span>
<span class="sd">            **station_fn** : full path to station file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">east</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="o">=</span> <span class="n">east</span>
        <span class="k">if</span> <span class="n">north</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="o">=</span> <span class="n">north</span>
        <span class="k">if</span> <span class="n">station_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">station_list</span>
        <span class="k">if</span> <span class="n">elev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span> <span class="n">elev</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">save_path</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span>
                                               <span class="s1">&#39;WS_Station_Locations.txt&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">=</span> <span class="n">save_path</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span>
                                           <span class="s1">&#39;WS_Station_Locations.txt&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span>
                                           <span class="s1">&#39;WS_Station_Locations.txt&#39;</span><span class="p">)</span>

        <span class="n">sfid</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;14}{1:^14}{2:^14}{3:^14}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="s1">&#39;east&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;elev&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ee</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">):</span>
            <span class="n">ee</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:+.4e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ee</span><span class="p">)</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:+.4e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span>
            <span class="n">zz</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:+.4e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span>
            <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;14}{1:^14}{2:^14}{3:^14}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">zz</span><span class="p">))</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="nb">print</span> <span class="s1">&#39;Wrote station locations to </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span><span class="p">)</span></div>

<div class="viewcode-block" id="WSStation.read_station_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSStation.read_station_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_station_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">station_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read in station file written by write_station_file</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ----------</span>
<span class="sd">            **station_fn** : string</span>
<span class="sd">                             full path to station file</span>

<span class="sd">        Outputs:</span>
<span class="sd">        ---------</span>
<span class="sd">            **east** : np.ndarray(n_stations)</span>
<span class="sd">                       relative station locations in east direction</span>

<span class="sd">            **north** : np.ndarray(n_stations)</span>
<span class="sd">                       relative station locations in north direction</span>
<span class="sd">            **elev** : np.ndarray(n_stations)</span>
<span class="sd">                       relative station locations in vertical direction</span>

<span class="sd">            **station_list** : list or np.ndarray(n_stations)</span>
<span class="sd">                               name of stations</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">station_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">=</span> <span class="n">station_fn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                            <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="s1">&#39;|S10&#39;</span><span class="p">),</span>
                                                   <span class="p">(</span><span class="s1">&#39;east_c&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                                                   <span class="p">(</span><span class="s1">&#39;north_c&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                                                   <span class="p">(</span><span class="s1">&#39;elev&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;east_c&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;north_c&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;elev&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="WSStation.write_vtk_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSStation.write_vtk_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_vtk_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">vtk_basename</span><span class="o">=</span><span class="s1">&#39;VTKStations&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write a vtk file to plot stations</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ------------</span>
<span class="sd">            **save_path** : string</span>
<span class="sd">                            directory to save file to.  Will save as </span>
<span class="sd">                            save_path/vtk_basename</span>

<span class="sd">            **vtk_basename** : string</span>
<span class="sd">                               base file name for vtk file, extension is </span>
<span class="sd">                               automatically added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">save_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">vtk_basename</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elev</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">)</span>

        <span class="n">pointsToVTK</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elev</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">)})</span>

        <span class="k">return</span> <span class="n">save_fn</span></div>

<div class="viewcode-block" id="WSStation.from_wl_write_station_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSStation.from_wl_write_station_file">[docs]</a>    <span class="k">def</span> <span class="nf">from_wl_write_station_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sites_file</span><span class="p">,</span> <span class="n">out_file</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write a ws station file from the outputs of winglink</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>
<span class="sd">            **sites_fn** : string</span>
<span class="sd">                           full path to sites file output from winglink</span>

<span class="sd">            **out_fn** : string</span>
<span class="sd">                         full path to .out file output from winglink</span>

<span class="sd">            **ncol** : int</span>
<span class="sd">                       number of columns the data is in</span>
<span class="sd">                       *default* is 5</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">wl_east</span><span class="p">,</span> <span class="n">wl_north</span><span class="p">,</span> <span class="n">wl_station_list</span> <span class="o">=</span> <span class="n">wl</span><span class="o">.</span><span class="n">get_station_locations</span><span class="p">(</span>
            <span class="n">sites_file</span><span class="p">,</span>
            <span class="n">out_file</span><span class="p">,</span>
            <span class="n">ncol</span><span class="o">=</span><span class="n">ncol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_station_file</span><span class="p">(</span><span class="n">east</span><span class="o">=</span><span class="n">wl_east</span><span class="p">,</span> <span class="n">north</span><span class="o">=</span><span class="n">wl_north</span><span class="p">,</span>
                                <span class="n">station_list</span><span class="o">=</span><span class="n">wl_station_list</span><span class="p">)</span></div></div>

<span class="c1">#==============================================================================</span>
<span class="c1"># mesh class</span>
<span class="c1">#==============================================================================</span>


<div class="viewcode-block" id="WSMesh"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSMesh">[docs]</a><span class="k">class</span> <span class="nc">WSMesh</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    make and read a FE mesh grid</span>

<span class="sd">    The mesh assumes the coordinate system where:</span>
<span class="sd">        x == North</span>
<span class="sd">        y == East</span>
<span class="sd">        z == + down</span>

<span class="sd">    All dimensions are in meters.</span>

<span class="sd">    :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.ws3dinv as ws</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; #1) make a list of all .edi files that will be inverted for </span>
<span class="sd">        &gt;&gt;&gt; edi_path = r&quot;/home/EDI_Files&quot;</span>
<span class="sd">        &gt;&gt;&gt; edi_list = [os.path.join(edi_path, edi) for edi in edi_path </span>
<span class="sd">        &gt;&gt;&gt; ...         if edi.find(&#39;.edi&#39;) &gt; 0]</span>
<span class="sd">        &gt;&gt;&gt; #2) make a grid from the stations themselves with 200m cell spacing</span>
<span class="sd">        &gt;&gt;&gt; wsmesh = ws.WSMesh(edi_list=edi_list, cell_size_east=200, </span>
<span class="sd">        &gt;&gt;&gt; ...                cell_size_north=200)</span>
<span class="sd">        &gt;&gt;&gt; wsmesh.make_mesh()</span>
<span class="sd">        &gt;&gt;&gt; # check to see if the mesh is what you think it should be</span>
<span class="sd">        &gt;&gt;&gt; wsmesh.plot_mesh()</span>
<span class="sd">        &gt;&gt;&gt; # all is good write the mesh file</span>
<span class="sd">        &gt;&gt;&gt; wsmesh.write_initial_file(save_path=r&quot;/home/ws3dinv/Inv1&quot;)</span>

<span class="sd">    ==================== ======================================================</span>
<span class="sd">    Attributes           Description    </span>
<span class="sd">    ==================== ======================================================</span>
<span class="sd">    cell_size_east       mesh block width in east direction</span>
<span class="sd">                         *default* is 500</span>
<span class="sd">    cell_size_north      mesh block width in north direction</span>
<span class="sd">                         *default* is 500</span>
<span class="sd">    edi_list             list of .edi files to invert for</span>
<span class="sd">    grid_east            overall distance of grid nodes in east direction </span>
<span class="sd">    grid_north           overall distance of grid nodes in north direction </span>
<span class="sd">    grid_z               overall distance of grid nodes in z direction </span>
<span class="sd">    initial_fn           full path to initial file name</span>
<span class="sd">    n_layers             total number of vertical layers in model</span>
<span class="sd">    nodes_east           relative distance between nodes in east direction </span>
<span class="sd">    nodes_north          relative distance between nodes in north direction </span>
<span class="sd">    nodes_z              relative distance between nodes in east direction </span>
<span class="sd">    pad_east             number of cells for padding on E and W sides</span>
<span class="sd">                         *default* is 5</span>
<span class="sd">    pad_north            number of cells for padding on S and N sides</span>
<span class="sd">                         *default* is 5</span>
<span class="sd">    pad_root_east        padding cells E &amp; W will be pad_root_east**(x)</span>
<span class="sd">    pad_root_north       padding cells N &amp; S will be pad_root_north**(x) </span>
<span class="sd">    pad_z                number of cells for padding at bottom</span>
<span class="sd">                         *default* is 5</span>
<span class="sd">    res_list             list of resistivity values for starting model</span>
<span class="sd">    res_model            starting resistivity model</span>
<span class="sd">    rotation_angle       Angle to rotate the grid to. Angle is measured</span>
<span class="sd">                         positve clockwise assuming North is 0 and east is 90.</span>
<span class="sd">                         *default* is None</span>
<span class="sd">    save_path            path to save file to  </span>
<span class="sd">    station_fn           full path to station file</span>
<span class="sd">    station_locations    location of stations</span>
<span class="sd">    title                title in initial file</span>
<span class="sd">    z1_layer             first layer thickness</span>
<span class="sd">    z_bottom             absolute bottom of the model *default* is 300,000 </span>
<span class="sd">    z_target_depth       Depth of deepest target, *default* is 50,000</span>
<span class="sd">    ==================== ======================================================</span>

<span class="sd">    ==================== ======================================================</span>
<span class="sd">    Methods              Description</span>
<span class="sd">    ==================== ======================================================</span>
<span class="sd">    make_mesh            makes a mesh from the given specifications</span>
<span class="sd">    plot_mesh            plots mesh to make sure everything is good</span>
<span class="sd">    write_initial_file   writes an initial model file that includes the mesh</span>
<span class="sd">    ==================== ======================================================</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span> <span class="o">=</span> <span class="n">edi_list</span>

        <span class="c1"># size of cells within station area in meters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_east</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cell_size_east&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_north</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cell_size_north&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

        <span class="c1"># padding cells on either side</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pad_east</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;pad_east&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pad_north</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;pad_north&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pad_z</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;pad_z&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="c1"># root of padding cells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pad_root_east</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;pad_root_east&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pad_root_north</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;pad_root_north&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">z1_layer</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;z1_layer&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_target_depth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;z_target_depth&#39;</span><span class="p">,</span> <span class="mi">50000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_bottom</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;z_bottom&#39;</span><span class="p">,</span> <span class="mi">300000</span><span class="p">)</span>

        <span class="c1"># number of vertical layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_layers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;n_layers&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

        <span class="c1">#--&gt; attributes to be calculated</span>
        <span class="c1"># station information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_locations&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

       <span class="c1"># grid nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># grid locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># resistivity model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># rotation angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rotation_angle&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># inital file stuff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;save_path&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Inital Model File made in MTpy&#39;</span>

<div class="viewcode-block" id="WSMesh.make_mesh"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSMesh.make_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">make_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        create finite element mesh according to parameters set.</span>

<span class="sd">        The mesh is built by first finding the center of the station area.  </span>
<span class="sd">        Then cells are added in the north and east direction with width</span>
<span class="sd">        cell_size_east and cell_size_north to the extremeties of the station </span>
<span class="sd">        area.  Padding cells are then added to extend the model to reduce </span>
<span class="sd">        edge effects.  The number of cells are pad_east and pad_north and the</span>
<span class="sd">        increase in size is by pad_root_east and pad_root_north.  The station</span>
<span class="sd">        locations are then computed as the center of the nearest cell as </span>
<span class="sd">        required by the code.</span>

<span class="sd">        The vertical cells are built to increase in size exponentially with</span>
<span class="sd">        depth.  The first cell depth is first_layer_thickness and should be</span>
<span class="sd">        about 1/10th the shortest skin depth.  The layers then increase</span>
<span class="sd">        on a log scale to z_target_depth.  Then the model is</span>
<span class="sd">        padded with pad_z number of cells to extend the depth of the model.</span>

<span class="sd">        padding = np.round(cell_size_east*pad_root_east**np.arange(start=.5,</span>
<span class="sd">                           stop=3, step=3./pad_east))+west </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if station locations are not input read from the edi files</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;edi_list is None, need to input a list of &#39;</span>
                                     <span class="s1">&#39;edi files to read in.&#39;</span><span class="p">)</span>

            <span class="n">n_stations</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">)</span>

            <span class="c1"># make a structured array to put station location information into</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_stations</span><span class="p">,</span>
                                              <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="s1">&#39;|S10&#39;</span><span class="p">),</span>
                                                     <span class="p">(</span><span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                                                     <span class="p">(</span><span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                                                     <span class="p">(</span><span class="s1">&#39;east_c&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                                                     <span class="p">(</span><span class="s1">&#39;north_c&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                                                     <span class="p">(</span><span class="s1">&#39;elev&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)])</span>
            <span class="c1"># get station locations in meters</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">edi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">):</span>
                <span class="n">mt_obj</span> <span class="o">=</span> <span class="n">mt</span><span class="o">.</span><span class="n">MT</span><span class="p">(</span><span class="n">edi</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mt_obj</span><span class="o">.</span><span class="n">station</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;east&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mt_obj</span><span class="o">.</span><span class="n">east</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mt_obj</span><span class="o">.</span><span class="n">north</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;elev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mt_obj</span><span class="o">.</span><span class="n">elev</span>

            <span class="c1"># remove the average distance to get coordinates in a relative</span>
            <span class="c1"># space</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span>
                <span class="s1">&#39;east&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span>
                <span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

            <span class="c1"># translate the stations so they are relative to 0,0</span>
            <span class="n">east_center</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">north_center</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="c1"># remove the average distance to get coordinates in a relative</span>
            <span class="c1"># space</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">east_center</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">north_center</span>

        <span class="c1"># pickout the furtherst south and west locations</span>
        <span class="c1"># and put that station as the bottom left corner of the main grid</span>
        <span class="n">west</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_east</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">east</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_east</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">south</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span>
            <span class="s1">&#39;north&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_north</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">north</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span>
            <span class="s1">&#39;north&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_north</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># make sure the variable n_stations is initialized</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">n_stations</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="n">n_stations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1">#-------make a grid around the stations from the parameters above------</span>
        <span class="c1">#--&gt; make grid in east-west direction</span>
        <span class="c1"># cells within station area</span>
        <span class="n">midxgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">west</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">east</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_east</span><span class="p">,</span>
                             <span class="n">step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_size_east</span><span class="p">)</span>

        <span class="c1"># padding cells on the west side</span>
        <span class="n">pad_west</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_size_east</span> <span class="o">*</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pad_root_east</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                                          <span class="n">step</span><span class="o">=</span><span class="mf">3.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_east</span><span class="p">))</span> <span class="o">+</span> <span class="n">west</span>

        <span class="c1"># padding cells on east side</span>
        <span class="n">pad_east</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_size_east</span> <span class="o">*</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pad_root_east</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                                          <span class="n">step</span><span class="o">=</span><span class="mf">3.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_east</span><span class="p">))</span> <span class="o">+</span> <span class="n">east</span>

        <span class="c1"># make the cells going west go in reverse order and append them to the</span>
        <span class="c1"># cells going east</span>
        <span class="n">east_gridr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pad_west</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">midxgrid</span><span class="p">),</span> <span class="n">pad_east</span><span class="p">)</span>

        <span class="c1">#--&gt; make grid in north-south direction</span>
        <span class="c1"># N-S cells with in station area</span>
        <span class="n">midygrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">south</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">north</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_north</span><span class="p">,</span>
                             <span class="n">step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_size_north</span><span class="p">)</span>

        <span class="c1"># padding cells on south side</span>
        <span class="n">south_pad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_size_north</span> <span class="o">*</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">pad_root_north</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span>
                                                            <span class="n">stop</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">3.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_north</span><span class="p">))</span> <span class="o">+</span> <span class="n">south</span>

        <span class="c1"># padding cells on north side</span>
        <span class="n">north_pad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_size_north</span> <span class="o">*</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">pad_root_north</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span>
                                                            <span class="n">stop</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">3.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_north</span><span class="p">))</span> <span class="o">+</span> <span class="n">north</span>

        <span class="c1"># make the cells going west go in reverse order and append them to the</span>
        <span class="c1"># cells going east</span>
        <span class="n">north_gridr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">south_pad</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">midygrid</span><span class="p">),</span> <span class="n">north_pad</span><span class="p">)</span>

        <span class="c1">#--&gt; make depth grid</span>
        <span class="n">log_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z1_layer</span><span class="p">),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_target_depth</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z1_layer</span><span class="p">),</span>
                                                                       <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>
                                                                           <span class="bp">self</span><span class="o">.</span><span class="n">z_target_depth</span><span class="p">),</span>
                                                                       <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_layers</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span>
                            <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_layers</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_z</span><span class="p">)</span>
        <span class="n">ztarget</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">zz</span> <span class="o">-</span> <span class="n">zz</span> <span class="o">%</span> <span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">zz</span><span class="p">))</span> <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span>
                            <span class="n">log_z</span><span class="p">])</span>
        <span class="n">log_zpad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_target_depth</span><span class="p">),</span>
                               <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_bottom</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_target_depth</span><span class="p">),</span>
                                                                    <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">z_bottom</span><span class="p">),</span>
                                                                    <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_z</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span>
                               <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_z</span><span class="p">)</span>
        <span class="n">zpadding</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">zz</span> <span class="o">-</span> <span class="n">zz</span> <span class="o">%</span> <span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">zz</span><span class="p">))</span> <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span>
                             <span class="n">log_zpad</span><span class="p">])</span>

        <span class="n">z_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ztarget</span><span class="p">,</span> <span class="n">zpadding</span><span class="p">)</span>
        <span class="n">z_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z_nodes</span><span class="p">[:</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                           <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>

        <span class="c1">#---Need to make an array of the individual cell dimensions for</span>
        <span class="c1">#   wsinv3d</span>
        <span class="n">east_nodes</span> <span class="o">=</span> <span class="n">east_gridr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">nx</span> <span class="o">=</span> <span class="n">east_gridr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">east_nodes</span><span class="p">[:</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">east_gridr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">-</span> <span class="n">east_gridr</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                                        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))])</span>
        <span class="n">east_nodes</span><span class="p">[</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">east_gridr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">-</span> <span class="n">east_gridr</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                                        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span>

        <span class="n">north_nodes</span> <span class="o">=</span> <span class="n">north_gridr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ny</span> <span class="o">=</span> <span class="n">north_gridr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">north_nodes</span><span class="p">[:</span><span class="n">ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">north_gridr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">-</span> <span class="n">north_gridr</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                                         <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))])</span>
        <span class="n">north_nodes</span><span class="p">[</span><span class="n">ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">north_gridr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">-</span> <span class="n">north_gridr</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                                         <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ny</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span>

        <span class="c1">#--put the grids into coordinates relative to the center of the grid</span>
        <span class="n">east_grid</span> <span class="o">=</span> <span class="n">east_nodes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">east_grid</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">east_nodes</span><span class="p">[</span><span class="n">ii</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                                             <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))])</span>
        <span class="n">east_grid</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">east_nodes</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                                            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">nx</span><span class="p">)])</span> <span class="o">-</span>\
            <span class="n">east_nodes</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">nx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

        <span class="n">north_grid</span> <span class="o">=</span> <span class="n">north_nodes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">north_grid</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">north_nodes</span><span class="p">[</span><span class="n">ii</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                                              <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))])</span>
        <span class="n">north_grid</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">north_nodes</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                                             <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">ny</span><span class="p">)])</span> <span class="o">-</span>\
            <span class="n">north_nodes</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ny</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

        <span class="c1"># make nodes attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span> <span class="o">=</span> <span class="n">east_nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span> <span class="o">=</span> <span class="n">north_nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span> <span class="o">=</span> <span class="n">z_nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">=</span> <span class="n">east_grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">=</span> <span class="n">north_grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="n">z_grid</span>

        <span class="c1"># make sure that the stations are in the center of the cell as requested</span>
        <span class="c1"># by the code.</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_stations</span><span class="p">):</span>
            <span class="c1"># look for the closest grid line</span>
            <span class="n">xx</span> <span class="o">=</span> <span class="p">[</span><span class="n">nn</span> <span class="k">for</span> <span class="n">nn</span><span class="p">,</span> <span class="n">xf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">east_grid</span><span class="p">)</span>
                  <span class="k">if</span> <span class="n">xf</span> <span class="o">&gt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;east&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_east</span><span class="p">)</span>
                  <span class="ow">and</span> <span class="n">xf</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;east&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_east</span><span class="p">)]</span>

            <span class="c1"># shift the station to the center in the east-west direction</span>
            <span class="k">if</span> <span class="n">east_grid</span><span class="p">[</span><span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;east&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;east_c&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">east_grid</span><span class="p">[</span><span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_east</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="n">east_grid</span><span class="p">[</span><span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;east&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;east_c&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">east_grid</span><span class="p">[</span><span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_east</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="c1"># look for closest grid line</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="p">[</span><span class="n">mm</span> <span class="k">for</span> <span class="n">mm</span><span class="p">,</span> <span class="n">yf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">north_grid</span><span class="p">)</span>
                  <span class="k">if</span> <span class="n">yf</span> <span class="o">&gt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_north</span><span class="p">)</span>
                  <span class="ow">and</span> <span class="n">yf</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_north</span><span class="p">)]</span>

            <span class="c1"># shift station to center of cell in north-south direction</span>
            <span class="k">if</span> <span class="n">north_grid</span><span class="p">[</span><span class="n">yy</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;north&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;north_c&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">north_grid</span><span class="p">[</span><span class="n">yy</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_north</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="n">north_grid</span><span class="p">[</span><span class="n">yy</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;north&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;north_c&#39;</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">north_grid</span><span class="p">[</span><span class="n">yy</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_north</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1">#--&gt; print out useful information</span>
        <span class="nb">print</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">15</span>
        <span class="nb">print</span> <span class="s1">&#39;   Number of stations = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">))</span>
        <span class="nb">print</span> <span class="s1">&#39;   Dimensions: &#39;</span>
        <span class="nb">print</span> <span class="s1">&#39;      e-w = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">east_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="nb">print</span> <span class="s1">&#39;      n-s = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">north_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="nb">print</span> <span class="s1">&#39;       z  = </span><span class="si">{0}</span><span class="s1"> (without 7 air layers)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="nb">print</span> <span class="s1">&#39;   Extensions: &#39;</span>
        <span class="nb">print</span> <span class="s1">&#39;      e-w = </span><span class="si">{0:.1f}</span><span class="s1"> (m)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">east_nodes</span><span class="o">.</span><span class="n">__abs__</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        <span class="nb">print</span> <span class="s1">&#39;      n-s = </span><span class="si">{0:.1f}</span><span class="s1"> (m)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">north_nodes</span><span class="o">.</span><span class="n">__abs__</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        <span class="nb">print</span> <span class="s1">&#39;      0-z = </span><span class="si">{0:.1f}</span><span class="s1"> (m)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span><span class="o">.</span><span class="n">__abs__</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        <span class="nb">print</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">15</span>

        <span class="c1"># write a station location file for later</span>
        <span class="n">stations</span> <span class="o">=</span> <span class="n">WSStation</span><span class="p">()</span>
        <span class="n">stations</span><span class="o">.</span><span class="n">write_station_file</span><span class="p">(</span><span class="n">east</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;east_c&#39;</span><span class="p">],</span>
                                    <span class="n">north</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;north_c&#39;</span><span class="p">],</span>
                                    <span class="n">elev</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;elev&#39;</span><span class="p">],</span>
                                    <span class="n">station_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span>
                                        <span class="s1">&#39;station&#39;</span><span class="p">],</span>
                                    <span class="n">save_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">station_fn</span></div>

<div class="viewcode-block" id="WSMesh.plot_mesh"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSMesh.plot_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">plot_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">east_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">north_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ----------</span>
<span class="sd">            **east_limits** : tuple (xmin,xmax)</span>
<span class="sd">                             plot min and max distances in meters for the </span>
<span class="sd">                             E-W direction.  If None, the east_limits</span>
<span class="sd">                             will be set to furthest stations east and west.</span>
<span class="sd">                             *default* is None</span>

<span class="sd">            **north_limits** : tuple (ymin,ymax)</span>
<span class="sd">                             plot min and max distances in meters for the </span>
<span class="sd">                             N-S direction.  If None, the north_limits</span>
<span class="sd">                             will be set to furthest stations north and south.</span>
<span class="sd">                             *default* is None</span>

<span class="sd">            **z_limits** : tuple (zmin,zmax)</span>
<span class="sd">                            plot min and max distances in meters for the </span>
<span class="sd">                            vertical direction.  If None, the z_limits is</span>
<span class="sd">                            set to the number of layers.  Z is positive down</span>
<span class="sd">                            *default* is None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_size&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_dpi&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
        <span class="n">fig_num</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_num&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">station_marker</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_marker&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">)</span>
        <span class="n">marker_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_color&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">marker_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;marker_size&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">line_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;line_color&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">line_width</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;line_width&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.hspace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="mi">3</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.wspace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="mi">3</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.left&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="mi">08</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig_num</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

        <span class="c1">#---plot map view</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

        <span class="c1"># make sure the station is in the center of the cell</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;east_c&#39;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;north_c&#39;</span><span class="p">],</span>
                    <span class="n">marker</span><span class="o">=</span><span class="n">station_marker</span><span class="p">,</span>
                    <span class="n">c</span><span class="o">=</span><span class="n">marker_color</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="n">marker_size</span><span class="p">)</span>

        <span class="c1"># plot the grid if desired</span>
        <span class="n">east_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">east_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">:</span>
            <span class="n">east_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span> <span class="n">xx</span><span class="p">])</span>
            <span class="n">east_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">east_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
            <span class="n">east_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">east_line_xlist</span><span class="p">,</span>
                 <span class="n">east_line_ylist</span><span class="p">,</span>
                 <span class="n">lw</span><span class="o">=</span><span class="n">line_width</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="n">line_color</span><span class="p">)</span>

        <span class="n">north_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">north_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">:</span>
            <span class="n">north_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
            <span class="n">north_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">north_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">yy</span><span class="p">,</span> <span class="n">yy</span><span class="p">])</span>
            <span class="n">north_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">north_line_xlist</span><span class="p">,</span>
                 <span class="n">north_line_ylist</span><span class="p">,</span>
                 <span class="n">lw</span><span class="o">=</span><span class="n">line_width</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="n">line_color</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">east_limits</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span>
                         <span class="mi">10</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_east</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span>
                         <span class="mi">10</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_east</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">east_limits</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">north_limits</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span>
                         <span class="mi">10</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_north</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span>
                         <span class="mi">10</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_east</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">north_limits</span><span class="p">)</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Northing (m)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Easting (m)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

        <span class="c1"># ----plot depth view</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>

        <span class="c1"># plot the grid if desired</span>
        <span class="n">east_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">east_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">:</span>
            <span class="n">east_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span> <span class="n">xx</span><span class="p">])</span>
            <span class="n">east_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">east_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
            <span class="n">east_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">east_line_xlist</span><span class="p">,</span>
                 <span class="n">east_line_ylist</span><span class="p">,</span>
                 <span class="n">lw</span><span class="o">=</span><span class="n">line_width</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="n">line_color</span><span class="p">)</span>

        <span class="n">z_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">z_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">:</span>
            <span class="n">z_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
            <span class="n">z_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">z_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">zz</span><span class="p">,</span> <span class="n">zz</span><span class="p">])</span>
            <span class="n">z_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z_line_xlist</span><span class="p">,</span>
                 <span class="n">z_line_ylist</span><span class="p">,</span>
                 <span class="n">lw</span><span class="o">=</span><span class="n">line_width</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="n">line_color</span><span class="p">)</span>

        <span class="c1">#--&gt; plot stations</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;east_c&#39;</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">marker</span><span class="o">=</span><span class="n">station_marker</span><span class="p">,</span>
                    <span class="n">c</span><span class="o">=</span><span class="n">marker_color</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="n">marker_size</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">z_limits</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_target_depth</span><span class="p">,</span> <span class="o">-</span><span class="mi">200</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">z_limits</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">east_limits</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span>
                         <span class="mi">10</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_east</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span>
                         <span class="mi">10</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_size_east</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">east_limits</span><span class="p">)</span>

        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (m)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Easting (m)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="WSMesh.convert_model_to_int"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSMesh.convert_model_to_int">[docs]</a>    <span class="k">def</span> <span class="nf">convert_model_to_int</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        convert the resistivity model that is in ohm-m to integer values</span>
<span class="sd">        corresponding to res_list</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">)</span>
        <span class="c1"># make a dictionary of values to write to file.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">res</span><span class="p">,</span> <span class="n">ii</span><span class="p">)</span>
                              <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span>
                              <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">),</span> <span class="mi">1</span><span class="p">)])</span>

        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">):</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">==</span> <span class="n">res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_dict</span><span class="p">[</span><span class="n">res</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ii</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">&lt;=</span> <span class="n">res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_dict</span><span class="p">[</span><span class="n">res</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">ii</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">&gt;=</span> <span class="n">res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_dict</span><span class="p">[</span><span class="n">res</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">l_index</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">ii</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">h_index</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">[</span><span class="n">l_index</span><span class="p">])</span> <span class="o">&amp;</span>
                                   <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">[</span><span class="n">h_index</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_dict</span><span class="p">[</span><span class="n">res</span><span class="p">]</span>

        <span class="nb">print</span> <span class="s1">&#39;Converted resistivity model to integers.&#39;</span></div>

<div class="viewcode-block" id="WSMesh.write_initial_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSMesh.write_initial_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_initial_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        will write an initial file for wsinv3d.  </span>

<span class="sd">        Note that x is assumed to be S --&gt; N, y is assumed to be W --&gt; E and</span>
<span class="sd">        z is positive downwards.  This means that index [0, 0, 0] is the </span>
<span class="sd">        southwest corner of the first layer.  Therefore if you build a model</span>
<span class="sd">        by hand the layer block will look as it should in map view. </span>

<span class="sd">        Also, the xgrid, ygrid and zgrid are assumed to be the relative </span>
<span class="sd">        distance between neighboring nodes.  This is needed because wsinv3d </span>
<span class="sd">        builds the  model from the bottom SW corner assuming the cell width</span>
<span class="sd">        from the init file.</span>



<span class="sd">        Key Word Arguments:</span>
<span class="sd">        ----------------------</span>

<span class="sd">            **nodes_north** : np.array(nx)</span>
<span class="sd">                        block dimensions (m) in the N-S direction. </span>
<span class="sd">                        **Note** that the code reads the grid assuming that</span>
<span class="sd">                        index=0 is the southern most point.</span>

<span class="sd">            **nodes_east** : np.array(ny)</span>
<span class="sd">                        block dimensions (m) in the E-W direction.  </span>
<span class="sd">                        **Note** that the code reads in the grid assuming that</span>
<span class="sd">                        index=0 is the western most point.</span>

<span class="sd">            **nodes_z** : np.array(nz)</span>
<span class="sd">                        block dimensions (m) in the vertical direction.  </span>
<span class="sd">                        This is positive downwards.</span>

<span class="sd">            **save_path** : string</span>
<span class="sd">                          Path to where the initial file will be saved</span>
<span class="sd">                          to savepath/init3d</span>

<span class="sd">            **res_list** : float or list</span>
<span class="sd">                        The start resistivity as a float or a list of</span>
<span class="sd">                        resistivities that coorespond to the starting</span>
<span class="sd">                        resistivity model **res_model_int**.  </span>
<span class="sd">                        This must be input if you input **res_model_int**</span>
<span class="sd">                        If res_list is None, then Nr = 0 and the real </span>
<span class="sd">                        resistivity values are used from **res_model**.</span>
<span class="sd">                        *default* is 100</span>

<span class="sd">            **title** : string</span>
<span class="sd">                        Title that goes into the first line of savepath/init3d</span>

<span class="sd">            **res_model** : np.array((nx,ny,nz))</span>
<span class="sd">                        Starting resistivity model.  Each cell is allocated an</span>
<span class="sd">                        integer value that cooresponds to the index value of</span>
<span class="sd">                        **res_list**.  .. note:: again that the modeling code </span>
<span class="sd">                        assumes that the first row it reads in is the southern</span>
<span class="sd">                        most row and the first column it reads in is the </span>
<span class="sd">                        western most column.  Similarly, the first plane it </span>
<span class="sd">                        reads in is the Earth&#39;s surface.</span>

<span class="sd">            **res_model_int** : np.array((nx,ny,nz))</span>
<span class="sd">                        Starting resistivity model.  Each cell is allocated an</span>
<span class="sd">                        linear resistivity value.</span>
<span class="sd">                        .. note:: again that the modeling code </span>
<span class="sd">                        assumes that the first row it reads in is the southern</span>
<span class="sd">                        most row and the first column it reads in is the </span>
<span class="sd">                        western most column.  Similarly, the first plane it </span>
<span class="sd">                        reads in is the Earth&#39;s surface.</span>



<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nodes_east&#39;</span><span class="p">,</span> <span class="s1">&#39;nodes_north&#39;</span><span class="p">,</span> <span class="s1">&#39;nodes_z&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;res_list&#39;</span><span class="p">,</span>
                <span class="s1">&#39;res_model&#39;</span><span class="p">,</span> <span class="s1">&#39;res_model_int&#39;</span><span class="p">,</span> <span class="s1">&#39;save_path&#39;</span><span class="p">,</span> <span class="s1">&#39;initial_fn&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;WSInitialModel&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;WSInitialModel&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span>

        <span class="c1"># check to see what resistivity in input</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span> <span class="ow">and</span> \
                <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">]</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">)</span>

        <span class="c1">#--&gt; write file</span>
        <span class="n">ifid</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1"> </span><span class="si">{3}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="n">nr</span><span class="p">))</span>

        <span class="c1"># write S --&gt; N node block</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">nnode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span><span class="p">):</span>
            <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&gt;12.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">nnode</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">ii</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ii</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># write W --&gt; E node block</span>
        <span class="k">for</span> <span class="n">jj</span><span class="p">,</span> <span class="n">enode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span><span class="p">):</span>
            <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&gt;12.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">enode</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">jj</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">jj</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">jj</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># write top --&gt; bottom node block</span>
        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">zz</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span><span class="p">):</span>
            <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&gt;12.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">zz</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">kk</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">kk</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># write the resistivity list</span>
        <span class="k">if</span> <span class="n">nr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">:</span>
                <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:.1f}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ff</span><span class="p">))</span>
            <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ifid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">convert_model_to_int</span><span class="p">()</span>
                <span class="c1"># need to flip the array such that the 1st index written is the</span>
                <span class="c1"># northern most value</span>
                <span class="n">write_res_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
                <span class="c1"># get similar layers</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">write_res_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="n">l1</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">layers</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">write_res_model</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">zz</span><span class="p">]</span> <span class="o">==</span>
                        <span class="n">write_res_model</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">zz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">l1</span><span class="p">,</span> <span class="n">zz</span><span class="p">))</span>
                    <span class="n">l1</span> <span class="o">=</span> <span class="n">zz</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c1"># need to add on the bottom layers</span>
            <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">l1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

            <span class="c1"># write out the layers from resmodel</span>
            <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
                <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ll</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ll</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="k">for</span> <span class="n">ee</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">nr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&gt;3.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">write_res_model</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="n">ll</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&gt;8.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">write_res_model</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="n">ll</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
                    <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">ifid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="nb">print</span> <span class="s1">&#39;Wrote file to: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="p">)</span></div>

<div class="viewcode-block" id="WSMesh.read_initial_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSMesh.read_initial_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_initial_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_fn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read an initial file and return the pertinent information including</span>
<span class="sd">        grid positions in coordinates relative to the center point (0,0) and </span>
<span class="sd">        starting model.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ----------</span>

<span class="sd">            **initial_fn** : full path to initializing file.</span>

<span class="sd">        Outputs:</span>
<span class="sd">        --------</span>

<span class="sd">            **nodes_north** : np.array(nx)</span>
<span class="sd">                        array of nodes in S --&gt; N direction</span>

<span class="sd">            **nodes_east** : np.array(ny) </span>
<span class="sd">                        array of nodes in the W --&gt; E direction</span>

<span class="sd">            **nodes_z** : np.array(nz)</span>
<span class="sd">                        array of nodes in vertical direction positive downwards</span>

<span class="sd">            **res_model** : dictionary</span>
<span class="sd">                        dictionary of the starting model with keys as layers</span>

<span class="sd">            **res_list** : list</span>
<span class="sd">                        list of resistivity values in the model</span>

<span class="sd">            **title** : string</span>
<span class="sd">                         title string</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="o">=</span> <span class="n">initial_fn</span>
        <span class="n">ifid</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">ilines</span> <span class="o">=</span> <span class="n">ifid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">ifid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">ilines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># get size of dimensions, remembering that x is N-S, y is E-W, z is +</span>
        <span class="c1"># down</span>
        <span class="n">nsize</span> <span class="o">=</span> <span class="n">ilines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">n_north</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nsize</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">n_east</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nsize</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">n_z</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nsize</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="c1"># initialize empy arrays to put things into</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_north</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_east</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_north</span><span class="p">,</span> <span class="n">n_east</span><span class="p">,</span> <span class="n">n_z</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_north</span><span class="p">,</span> <span class="n">n_east</span><span class="p">,</span> <span class="n">n_z</span><span class="p">))</span>

        <span class="c1"># get the grid line locations</span>
        <span class="n">line_index</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># line number in file</span>
        <span class="n">count_n</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># number of north nodes found</span>
        <span class="k">while</span> <span class="n">count_n</span> <span class="o">&lt;</span> <span class="n">n_north</span><span class="p">:</span>
            <span class="n">iline</span> <span class="o">=</span> <span class="n">ilines</span><span class="p">[</span><span class="n">line_index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">north_node</span> <span class="ow">in</span> <span class="n">iline</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span><span class="p">[</span><span class="n">count_n</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">north_node</span><span class="p">)</span>
                <span class="n">count_n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">line_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">count_e</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># number of east nodes found</span>
        <span class="k">while</span> <span class="n">count_e</span> <span class="o">&lt;</span> <span class="n">n_east</span><span class="p">:</span>
            <span class="n">iline</span> <span class="o">=</span> <span class="n">ilines</span><span class="p">[</span><span class="n">line_index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">east_node</span> <span class="ow">in</span> <span class="n">iline</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span><span class="p">[</span><span class="n">count_e</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">east_node</span><span class="p">)</span>
                <span class="n">count_e</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">line_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">count_z</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># number of vertical nodes</span>
        <span class="k">while</span> <span class="n">count_z</span> <span class="o">&lt;</span> <span class="n">n_z</span><span class="p">:</span>
            <span class="n">iline</span> <span class="o">=</span> <span class="n">ilines</span><span class="p">[</span><span class="n">line_index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">z_node</span> <span class="ow">in</span> <span class="n">iline</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span><span class="p">[</span><span class="n">count_z</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">z_node</span><span class="p">)</span>
                <span class="n">count_z</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">line_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># put the grids into coordinates relative to the center of the grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">n_north</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">=</span>\
            <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span><span class="p">[</span><span class="n">ii</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">n_north</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                       <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_north</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n_north</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):]</span> <span class="o">=</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n_north</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                      <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_north</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">n_north</span><span class="p">)])</span> <span class="o">-</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n_north</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">n_east</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> \
            <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span><span class="p">[</span><span class="n">ii</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">n_east</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                       <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_east</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n_east</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):]</span> <span class="o">=</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n_east</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                      <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_east</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">n_east</span><span class="p">)])</span> <span class="o">-</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n_east</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span><span class="p">[:</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_z</span><span class="p">)])</span>

        <span class="c1"># get the resistivity values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">ilines</span><span class="p">[</span><span class="n">line_index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
        <span class="n">line_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># get model</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">iline</span> <span class="o">=</span> <span class="n">ilines</span><span class="p">[</span><span class="n">line_index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iline</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">iline</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">line_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilines</span><span class="p">):</span>
                <span class="n">iline</span> <span class="o">=</span> <span class="n">ilines</span><span class="p">[</span><span class="n">line_index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iline</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">l1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">iline</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">l2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">iline</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">l1</span> <span class="o">==</span> <span class="n">l2</span><span class="p">:</span>
                        <span class="n">l2</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">line_index</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">count_n</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">iline</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">count_e</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">while</span> <span class="n">count_e</span> <span class="o">&lt;</span> <span class="n">n_east</span><span class="p">:</span>
                        <span class="c1"># be sure the indes of res list starts at 0 not 1 as</span>
                        <span class="c1"># in ws3dinv</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[</span><span class="n">count_n</span><span class="p">,</span> <span class="n">count_e</span><span class="p">,</span> <span class="n">l1</span><span class="p">:</span><span class="n">l2</span><span class="p">]</span> <span class="o">=</span>\
                            <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">iline</span><span class="p">[</span><span class="n">count_e</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span><span class="p">[</span><span class="n">count_n</span><span class="p">,</span> <span class="n">count_e</span><span class="p">,</span> <span class="n">l1</span><span class="p">:</span><span class="n">l2</span><span class="p">]</span> <span class="o">=</span>\
                            <span class="nb">int</span><span class="p">(</span><span class="n">iline</span><span class="p">[</span><span class="n">count_e</span><span class="p">])</span>
                        <span class="n">count_e</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">count_n</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">line_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Need to be sure that the resistivity array matches</span>
            <span class="c1"># with the grids, such that the first index is the</span>
            <span class="c1"># furthest south, even though ws3dinv outputs as first</span>
            <span class="c1"># index as furthest north.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span></div></div>

<span class="c1">#==============================================================================</span>
<span class="c1"># model class</span>
<span class="c1">#==============================================================================</span>


<div class="viewcode-block" id="WSModel"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSModel">[docs]</a><span class="k">class</span> <span class="nc">WSModel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads in model file and fills necessary attributes.</span>

<span class="sd">    :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; mfn = r&quot;/home/ws3dinv/test_model.00&quot;</span>
<span class="sd">        &gt;&gt;&gt; wsmodel = ws.WSModel(mfn)</span>
<span class="sd">        &gt;&gt;&gt; wsmodel.write_vtk_file(r&quot;/home/ParaviewFiles&quot;)</span>

<span class="sd">    ======================= ===================================================</span>
<span class="sd">    Attributes              Description</span>
<span class="sd">    ======================= ===================================================</span>
<span class="sd">    grid_east               overall distance of grid nodes in east direction </span>
<span class="sd">    grid_north              overall distance of grid nodes in north direction </span>
<span class="sd">    grid_z                  overall distance of grid nodes in z direction</span>
<span class="sd">    iteration_number        iteration number of the inversion</span>
<span class="sd">    lagrange                lagrange multiplier</span>
<span class="sd">    model_fn                full path to model file</span>
<span class="sd">    nodes_east              relative distance between nodes in east direction </span>
<span class="sd">    nodes_north             relative distance between nodes in north direction </span>
<span class="sd">    nodes_z                 relative distance between nodes in east direction </span>
<span class="sd">    res_model               starting resistivity model</span>
<span class="sd">    rms                     root mean squared error of data and model</span>
<span class="sd">    ======================= ===================================================</span>


<span class="sd">    ======================= ===================================================</span>
<span class="sd">    Methods                 Description    </span>
<span class="sd">    ======================= ===================================================</span>
<span class="sd">    read_model_file         read model file and fill attributes</span>
<span class="sd">    write_vtk_file          write a vtk structured grid file for resistivity</span>
<span class="sd">                            model</span>
<span class="sd">    ======================= ===================================================</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span> <span class="n">model_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iteration_number</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rms</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lagrange</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_model_file</span><span class="p">()</span>

<div class="viewcode-block" id="WSModel.read_model_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSModel.read_model_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_model_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read in a model file as x-north, y-east, z-positive down</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mfid</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">mlines</span> <span class="o">=</span> <span class="n">mfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">mfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># get info at the beggining of file</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">mlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iteration_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rms</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lagrange</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;Did not get Lagrange Multiplier&#39;</span>

        <span class="c1"># get lengths of things</span>
        <span class="n">n_north</span><span class="p">,</span> <span class="n">n_east</span><span class="p">,</span> <span class="n">n_z</span><span class="p">,</span> <span class="n">n_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span>
                                               <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>

        <span class="c1"># make empty arrays to put stuff into</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_north</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_east</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_north</span><span class="p">,</span> <span class="n">n_east</span><span class="p">,</span> <span class="n">n_z</span><span class="p">))</span>

        <span class="c1"># get the grid line locations</span>
        <span class="n">line_index</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># line number in file</span>
        <span class="n">count_n</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># number of north nodes found</span>
        <span class="k">while</span> <span class="n">count_n</span> <span class="o">&lt;</span> <span class="n">n_north</span><span class="p">:</span>
            <span class="n">mline</span> <span class="o">=</span> <span class="n">mlines</span><span class="p">[</span><span class="n">line_index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">north_node</span> <span class="ow">in</span> <span class="n">mline</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span><span class="p">[</span><span class="n">count_n</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">north_node</span><span class="p">)</span>
                <span class="n">count_n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">line_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">count_e</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># number of east nodes found</span>
        <span class="k">while</span> <span class="n">count_e</span> <span class="o">&lt;</span> <span class="n">n_east</span><span class="p">:</span>
            <span class="n">mline</span> <span class="o">=</span> <span class="n">mlines</span><span class="p">[</span><span class="n">line_index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">east_node</span> <span class="ow">in</span> <span class="n">mline</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span><span class="p">[</span><span class="n">count_e</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">east_node</span><span class="p">)</span>
                <span class="n">count_e</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">line_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">count_z</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># number of vertical nodes</span>
        <span class="k">while</span> <span class="n">count_z</span> <span class="o">&lt;</span> <span class="n">n_z</span><span class="p">:</span>
            <span class="n">mline</span> <span class="o">=</span> <span class="n">mlines</span><span class="p">[</span><span class="n">line_index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">z_node</span> <span class="ow">in</span> <span class="n">mline</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span><span class="p">[</span><span class="n">count_z</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">z_node</span><span class="p">)</span>
                <span class="n">count_z</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">line_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># put the grids into coordinates relative to the center of the grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">n_north</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">=</span>\
            <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span><span class="p">[</span><span class="n">ii</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">n_north</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                       <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_north</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n_north</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):]</span> <span class="o">=</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n_north</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                      <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_north</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">n_north</span><span class="p">)])</span> <span class="o">-</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n_north</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">n_east</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> \
            <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span><span class="p">[</span><span class="n">ii</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">n_east</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                       <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_east</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n_east</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):]</span> <span class="o">=</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n_east</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                      <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_east</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">n_east</span><span class="p">)])</span> <span class="o">-</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n_east</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span><span class="p">[:</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_z</span><span class="p">)])</span>

        <span class="c1">#--&gt; get resistivity values</span>
        <span class="c1"># need to read in the north backwards so that the first index is</span>
        <span class="c1"># southern most point</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_z</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_east</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_north</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[(</span><span class="n">n_north</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">kk</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="nb">float</span><span class="p">(</span><span class="n">mlines</span><span class="p">[</span><span class="n">line_index</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="n">line_index</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="WSModel.write_vtk_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSModel.write_vtk_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_vtk_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_fn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">save_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="s1">&#39;VTKResistivity_Model&#39;</span><span class="p">)</span>

        <span class="n">save_fn</span> <span class="o">=</span> <span class="n">gridToVTK</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">,</span>
                            <span class="n">cellData</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;resistivity&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">})</span>

        <span class="nb">print</span> <span class="s1">&#39;Wrote vtk file to </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">save_fn</span><span class="p">)</span></div></div>


<span class="c1">#==============================================================================</span>
<span class="c1"># Manipulate the model</span>
<span class="c1">#==============================================================================</span>
<div class="viewcode-block" id="WSModelManipulator"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSModelManipulator">[docs]</a><span class="k">class</span> <span class="nc">WSModelManipulator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    will plot a model from wsinv3d or init file so the user can manipulate the </span>
<span class="sd">    resistivity values relatively easily.  At the moment only plotted</span>
<span class="sd">    in map view.</span>


<span class="sd">    :Example: ::</span>
<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.ws3dinv as ws</span>
<span class="sd">        &gt;&gt;&gt; initial_fn = r&quot;/home/MT/ws3dinv/Inv1/WSInitialFile&quot;</span>
<span class="sd">        &gt;&gt;&gt; mm = ws.WSModelManipulator(initial_fn=initial_fn)</span>

<span class="sd">    =================== =======================================================</span>
<span class="sd">    Buttons              Description    </span>
<span class="sd">    =================== =======================================================</span>
<span class="sd">    &#39;=&#39;                 increase depth to next vertical node (deeper)</span>
<span class="sd">    &#39;-&#39;                 decrease depth to next vertical node (shallower)</span>
<span class="sd">    &#39;q&#39;                 quit the plot, rewrites initial file when pressed</span>
<span class="sd">    &#39;a&#39;                 copies the above horizontal layer to the present layer</span>
<span class="sd">    &#39;b&#39;                 copies the below horizonal layer to present layer</span>
<span class="sd">    &#39;u&#39;                 undo previous change</span>
<span class="sd">    =================== =======================================================</span>


<span class="sd">    =================== =======================================================</span>
<span class="sd">    Attributes          Description</span>
<span class="sd">    =================== =======================================================</span>
<span class="sd">    ax1                 matplotlib.axes instance for mesh plot of the model </span>
<span class="sd">    ax2                 matplotlib.axes instance of colorbar</span>
<span class="sd">    cb                  matplotlib.colorbar instance for colorbar </span>
<span class="sd">    cid_depth           matplotlib.canvas.connect for depth</span>
<span class="sd">    cmap                matplotlib.colormap instance</span>
<span class="sd">    cmax                maximum value of resistivity for colorbar. (linear)</span>
<span class="sd">    cmin                minimum value of resistivity for colorbar (linear)</span>
<span class="sd">    data_fn             full path fo data file</span>
<span class="sd">    depth_index         integer value of depth slice for plotting</span>
<span class="sd">    dpi                 resolution of figure in dots-per-inch</span>
<span class="sd">    dscale              depth scaling, computed internally</span>
<span class="sd">    east_line_xlist     list of east mesh lines for faster plotting</span>
<span class="sd">    east_line_ylist     list of east mesh lines for faster plotting</span>
<span class="sd">    fdict               dictionary of font properties</span>
<span class="sd">    fig                 matplotlib.figure instance</span>
<span class="sd">    fig_num              number of figure instance</span>
<span class="sd">    fig_size             size of figure in inches</span>
<span class="sd">    font_size           size of font in points</span>
<span class="sd">    grid_east           location of east nodes in relative coordinates</span>
<span class="sd">    grid_north          location of north nodes in relative coordinates</span>
<span class="sd">    grid_z              location of vertical nodes in relative coordinates</span>
<span class="sd">    initial_fn          full path to initial file</span>
<span class="sd">    m_height            mean height of horizontal cells</span>
<span class="sd">    m_width             mean width of horizontal cells</span>
<span class="sd">    map_scale            [ &#39;m&#39; | &#39;km&#39; ] scale of map</span>
<span class="sd">    mesh_east           np.meshgrid of east, north</span>
<span class="sd">    mesh_north          np.meshgrid of east, north</span>
<span class="sd">    mesh_plot           matplotlib.axes.pcolormesh instance</span>
<span class="sd">    model_fn            full path to model file</span>
<span class="sd">    new_initial_fn      full path to new initial file</span>
<span class="sd">    nodes_east          spacing between east nodes </span>
<span class="sd">    nodes_north         spacing between north nodes </span>
<span class="sd">    nodes_z             spacing between vertical nodes</span>
<span class="sd">    north_line_xlist    list of coordinates of north nodes for faster plotting</span>
<span class="sd">    north_line_ylist    list of coordinates of north nodes for faster plotting</span>
<span class="sd">    plot_yn             [ &#39;y&#39; | &#39;n&#39; ] plot on instantiation</span>
<span class="sd">    radio_res           matplotlib.widget.radio instance for change resistivity</span>
<span class="sd">    rect_selector       matplotlib.widget.rect_selector </span>
<span class="sd">    res                 np.ndarray(nx, ny, nz) for model in linear resistivity</span>
<span class="sd">    res_copy            copy of res for undo</span>
<span class="sd">    res_dict            dictionary of segmented resistivity values </span>
<span class="sd">    res_list            list of resistivity values for model linear scale</span>
<span class="sd">    res_model           np.ndarray(nx, ny, nz) of resistivity values from </span>
<span class="sd">                        res_list (linear scale)</span>
<span class="sd">    res_model_int       np.ndarray(nx, ny, nz) of integer values corresponding</span>
<span class="sd">                        to res_list for initial model</span>
<span class="sd">    res_value           current resistivty value of radio_res</span>
<span class="sd">    save_path           path to save initial file to</span>
<span class="sd">    station_east        station locations in east direction</span>
<span class="sd">    station_north       station locations in north direction</span>
<span class="sd">    xlimits             limits of plot in e-w direction</span>
<span class="sd">    ylimits             limits of plot in n-s direction</span>
<span class="sd">    =================== =======================================================</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initial_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span> <span class="n">model_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="o">=</span> <span class="n">initial_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">data_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_initial_fn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn_basename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;initial_fn_basename&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;WSInitialModel_mm&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># grid nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># grid locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># resistivity model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># model in ints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># model in floats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># station locations in relative coordinates read from data file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#--&gt; set map scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_scale&#39;</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">m_width</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_height</span> <span class="o">=</span> <span class="mi">100</span>

        <span class="c1">#--&gt; scale the map coordinates</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">==</span> <span class="s1">&#39;km&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">=</span> <span class="mf">1000.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">=</span> <span class="mf">1.</span>

        <span class="c1"># figure attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">east_line_xlist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">east_line_ylist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">north_line_xlist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">north_line_ylist</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># make a default resistivity list to change values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res_list&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_res_list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">],</span>
                                       <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;!! Warning -- ws3dinv can only deal with 10 &#39;</span>
                           <span class="s1">&#39;resistivity values for the initial model&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_res_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">)</span>

        <span class="c1"># read in model or initial file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">()</span>

        <span class="c1"># set initial resistivity value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1">#--&gt; set map limits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlimits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xlimits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ylimits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ylimits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;font_size&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_dpi&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_num&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_size&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="n">cm</span><span class="o">.</span><span class="n">jet_r</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;depth_index&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">}</span>

        <span class="c1"># plot on initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_yn&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<div class="viewcode-block" id="WSModelManipulator.set_res_list"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSModelManipulator.set_res_list">[docs]</a>    <span class="k">def</span> <span class="nf">set_res_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        on setting res_list also set the res_dict to correspond</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span> <span class="o">=</span> <span class="n">res_list</span>
        <span class="c1"># make a dictionary of values to write to file.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">res</span><span class="p">,</span> <span class="n">ii</span><span class="p">)</span>
                              <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

    <span class="c1">#---read files-------------------------------------------------------------</span>
<div class="viewcode-block" id="WSModelManipulator.read_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSModelManipulator.read_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reads in initial file or model file and set attributes:</span>
<span class="sd">            -resmodel</span>
<span class="sd">            -northrid</span>
<span class="sd">            -eastrid</span>
<span class="sd">            -zgrid</span>
<span class="sd">            -res_list if initial file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">att_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nodes_north&#39;</span><span class="p">,</span> <span class="s1">&#39;nodes_east&#39;</span><span class="p">,</span> <span class="s1">&#39;nodes_z&#39;</span><span class="p">,</span> <span class="s1">&#39;grid_east&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;grid_north&#39;</span><span class="p">,</span> <span class="s1">&#39;grid_z&#39;</span><span class="p">,</span> <span class="s1">&#39;res_model&#39;</span><span class="p">,</span> <span class="s1">&#39;res_list&#39;</span><span class="p">]</span>

        <span class="c1">#--&gt; read model file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">wsmodel</span> <span class="o">=</span> <span class="n">WSModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>
            <span class="n">wsmodel</span><span class="o">.</span><span class="n">read_model_file</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">att_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wsmodel</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">wsmodel</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="c1">#--&gt; scale the resistivity values from the model into</span>
            <span class="c1">#    a segmented scale that cooresponds to res_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_res_to_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

        <span class="c1">#--&gt; read initial file</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wsmesh</span> <span class="o">=</span> <span class="n">WSMesh</span><span class="p">()</span>
            <span class="n">wsmesh</span><span class="o">.</span><span class="n">read_initial_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">att_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wsmesh</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">wsmesh</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span> <span class="o">=</span> <span class="n">wsmesh</span><span class="o">.</span><span class="n">res_model</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wsmesh</span><span class="o">.</span><span class="n">res_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_res_list</span><span class="p">([</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_res_list</span><span class="p">(</span><span class="n">wsmesh</span><span class="o">.</span><span class="n">res_list</span><span class="p">)</span>

            <span class="c1"># need to convert index values to resistivity values</span>
            <span class="n">rdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">ii</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>

            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span> <span class="o">==</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">rdict</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;Need to input either an initial file or model file to plot&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;Input just initial file or model file not both.&#39;</span>

        <span class="c1">#--&gt; read in data file if given</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wsdata</span> <span class="o">=</span> <span class="n">WSData</span><span class="p">()</span>
            <span class="n">wsdata</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>

            <span class="c1"># get station locations</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="o">=</span> <span class="n">wsdata</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="o">=</span> <span class="n">wsdata</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span>

        <span class="c1"># get cell block sizes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>

        <span class="c1"># make a copy of original in case there are unwanted changes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

    <span class="c1">#---plot model-------------------------------------------------------------</span>
<div class="viewcode-block" id="WSModelManipulator.plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSModelManipulator.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plots the model with:</span>
<span class="sd">            -a radio dial for depth slice </span>
<span class="sd">            -radio dial for resistivity value</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">)))</span>

        <span class="c1">#--&gt;Plot properties</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span>

        <span class="c1"># need to add an extra row and column to east and north to make sure</span>
        <span class="c1"># all is plotted see pcolor for details.</span>
        <span class="n">plot_east</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.25</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
        <span class="n">plot_north</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.25</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>

        <span class="c1"># make a mesh grid for plotting</span>
        <span class="c1"># the &#39;ij&#39; makes sure the resulting grid is in east, north</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_north</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">plot_east</span><span class="p">,</span>
                                                      <span class="n">plot_north</span><span class="p">,</span>
                                                      <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

        <span class="c1"># transpose to make x--east and y--north</span>
        <span class="n">plot_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_east</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">mesh_north</span><span class="p">,</span>
                                             <span class="n">plot_res</span><span class="p">,</span>
                                             <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span>
                                             <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmin</span><span class="p">,</span>
                                             <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmax</span><span class="p">)</span>

        <span class="c1"># on plus or minus change depth slice</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid_depth</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_plot</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">_on_key_callback</span><span class="p">)</span>

        <span class="c1"># plot the stations</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ee</span><span class="p">,</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ee</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">,</span> <span class="n">nn</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">,</span>
                              <span class="s1">&#39;*&#39;</span><span class="p">,</span>
                              <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                              <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                              <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
                                        <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

        <span class="c1"># set axis properties</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlimits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlimits</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">,</span>
                              <span class="n">xmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylimits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylimits</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">,</span>
                              <span class="n">ymax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">)</span>

        <span class="c1"># self.ax1.xaxis.set_minor_locator(MultipleLocator(100*1./dscale))</span>
        <span class="c1"># self.ax1.yaxis.set_minor_locator(MultipleLocator(100*1./dscale))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Northing (&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Easting (&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="p">)</span>

        <span class="n">depth_title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Depth = </span><span class="si">{:.3f}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">depth_title</span><span class="p">)</span> <span class="o">+</span>
                           <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span>
                           <span class="n">fontdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="p">)</span>

        <span class="c1"># plot the grid if desired</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">east_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">east_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">east_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">xx</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">,</span> <span class="n">xx</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">east_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">east_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">east_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east_line_xlist</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">east_line_ylist</span><span class="p">,</span>
                      <span class="n">lw</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">north_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">north_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">north_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">north_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">north_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">yy</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">,</span> <span class="n">yy</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">north_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">north_line_xlist</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">north_line_ylist</span><span class="p">,</span>
                      <span class="n">lw</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

        <span class="c1"># plot the colorbar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">make_axes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=.</span><span class="mi">35</span><span class="p">)</span>
        <span class="n">seg_cmap</span> <span class="o">=</span> <span class="n">cmap_discretize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">seg_cmap</span><span class="p">,</span>
                                   <span class="n">norm</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmin</span><span class="p">,</span>
                                                         <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmax</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Resistivity ($\Omega \cdot$m)&#39;</span><span class="p">,</span>
                          <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="n">mtplottools</span><span class="o">.</span><span class="n">labeldict</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span>
                                <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>

        <span class="c1"># make a resistivity radio button</span>
        <span class="n">resrb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="o">.</span><span class="mi">85</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">reslabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">{0:.4g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radio_res</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">RadioButtons</span><span class="p">(</span><span class="n">resrb</span><span class="p">,</span> <span class="n">reslabels</span><span class="p">,</span>
                                              <span class="n">active</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">res_value</span><span class="p">])</span>

        <span class="c1"># make a rectangular selector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect_selector</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">RectangleSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">rect_onselect</span><span class="p">,</span>
                                                       <span class="n">drawtype</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">,</span>
                                                       <span class="n">useblit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># needs to go after show()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radio_res</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_res_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="WSModelManipulator.redraw_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSModelManipulator.redraw_plot">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        redraws the plot</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">current_xlimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">current_ylimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>

        <span class="n">plot_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_east</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">mesh_north</span><span class="p">,</span>
                                             <span class="n">plot_res</span><span class="p">,</span>
                                             <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span>
                                             <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmin</span><span class="p">,</span>
                                             <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmax</span><span class="p">)</span>

        <span class="c1"># plot the stations</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ee</span><span class="p">,</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ee</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">,</span> <span class="n">nn</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">,</span>
                              <span class="s1">&#39;*&#39;</span><span class="p">,</span>
                              <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                              <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                              <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
                                        <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

        <span class="c1"># set axis properties</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlimits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlimits</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">current_xlimits</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylimits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylimits</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">current_ylimits</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Northing (&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Easting (&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="p">)</span>

        <span class="n">depth_title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Depth = </span><span class="si">{:.3f}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">depth_title</span><span class="p">)</span> <span class="o">+</span>
                           <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span>
                           <span class="n">fontdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="p">)</span>

        <span class="c1"># plot finite element mesh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east_line_xlist</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">east_line_ylist</span><span class="p">,</span>
                      <span class="n">lw</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">north_line_xlist</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">north_line_ylist</span><span class="p">,</span>
                      <span class="n">lw</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

        <span class="c1"># be sure to redraw the canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">set_res_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s1">&#39;set resistivity to &#39;</span><span class="p">,</span> <span class="n">label</span>
        <span class="nb">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_value</span>

    <span class="k">def</span> <span class="nf">_on_key_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        on pressing a key do something</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">event_change_depth</span> <span class="o">=</span> <span class="n">event</span>

        <span class="c1"># go down a layer on push of +/= keys</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_change_depth</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="nb">print</span> <span class="s1">&#39;already at deepest depth&#39;</span>

            <span class="nb">print</span> <span class="s1">&#39;Plotting Depth </span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">/</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">redraw_plot</span><span class="p">()</span>
        <span class="c1"># go up a layer on push of - key</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_change_depth</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="nb">print</span> <span class="s1">&#39;Plotting Depth </span><span class="si">{0:.3f}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">/</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">redraw_plot</span><span class="p">()</span>

        <span class="c1"># exit plot on press of q</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_change_depth</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event_change_depth</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cid_depth</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_change_depth</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rewrite_initial_file</span><span class="p">()</span>

        <span class="c1"># copy the layer above</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_change_depth</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="s1">&#39;No layers above&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;No layers above&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">redraw_plot</span><span class="p">()</span>

        <span class="c1"># copy the layer below</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_change_depth</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;No more layers below&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">redraw_plot</span><span class="p">()</span>

        <span class="c1"># undo</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_change_depth</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;u&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xchange</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ychange</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ychange</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xchange</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">=</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">res_copy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ychange</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xchange</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xchange</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ychange</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">res_copy</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">redraw_plot</span><span class="p">()</span>

<div class="viewcode-block" id="WSModelManipulator.change_model_res"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSModelManipulator.change_model_res">[docs]</a>    <span class="k">def</span> <span class="nf">change_model_res</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xchange</span><span class="p">,</span> <span class="n">ychange</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        change resistivity values of resistivity model</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">xchange</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">ychange</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[</span><span class="n">ychange</span><span class="p">,</span> <span class="n">xchange</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">xchange</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="n">ychange</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">redraw_plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="WSModelManipulator.rect_onselect"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSModelManipulator.rect_onselect">[docs]</a>    <span class="k">def</span> <span class="nf">rect_onselect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eclick</span><span class="p">,</span> <span class="n">erelease</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        on selecting a rectangle change the colors to the resistivity values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">eclick</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">eclick</span><span class="o">.</span><span class="n">ydata</span>
        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">erelease</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">erelease</span><span class="o">.</span><span class="n">ydata</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xchange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_east_index</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ychange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_north_index</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>

        <span class="c1"># reset values of resistivity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_model_res</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xchange</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ychange</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_east_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the index value of the points to be changed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">x1</span> <span class="o">&lt;</span> <span class="n">x2</span><span class="p">:</span>
            <span class="n">xchange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">&gt;=</span> <span class="n">x1</span><span class="p">)</span> <span class="o">&amp;</span>
                               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">&lt;=</span> <span class="n">x2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xchange</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">xchange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">&gt;=</span> <span class="n">x1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">xchange</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">x1</span> <span class="o">&gt;</span> <span class="n">x2</span><span class="p">:</span>
            <span class="n">xchange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">&lt;=</span> <span class="n">x1</span><span class="p">)</span> <span class="o">&amp;</span>
                               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">&gt;=</span> <span class="n">x2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xchange</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">xchange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">&gt;=</span> <span class="n">x2</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">xchange</span><span class="p">]</span>

        <span class="c1"># check the edges to see if the selection should include the square</span>
        <span class="n">xchange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xchange</span><span class="p">,</span> <span class="n">xchange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">xchange</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">xchange</span>

    <span class="k">def</span> <span class="nf">_get_north_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the index value of the points to be changed in north direction</span>

<span class="sd">        need to flip the index because the plot is flipped</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">y1</span> <span class="o">&lt;</span> <span class="n">y2</span><span class="p">:</span>
            <span class="n">ychange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">&gt;</span> <span class="n">y1</span><span class="p">)</span> <span class="o">&amp;</span>
                               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">&lt;</span> <span class="n">y2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ychange</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ychange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">/</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">&gt;=</span> <span class="n">y1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">ychange</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">y1</span> <span class="o">&gt;</span> <span class="n">y2</span><span class="p">:</span>
            <span class="n">ychange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">&lt;</span> <span class="n">y1</span><span class="p">)</span> <span class="o">&amp;</span>
                               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">&gt;</span> <span class="n">y2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ychange</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ychange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">/</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">&gt;=</span> <span class="n">y2</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">ychange</span><span class="p">]</span>

        <span class="n">ychange</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">ychange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ychange</span><span class="p">,</span> <span class="n">ychange</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ychange</span>

<div class="viewcode-block" id="WSModelManipulator.convert_model_to_int"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSModelManipulator.convert_model_to_int">[docs]</a>    <span class="k">def</span> <span class="nf">convert_model_to_int</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        convert the resistivity model that is in ohm-m to integer values</span>
<span class="sd">        corresponding to res_list</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">):</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">==</span> <span class="n">res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_dict</span><span class="p">[</span><span class="n">res</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ii</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">&lt;=</span> <span class="n">res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_dict</span><span class="p">[</span><span class="n">res</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">ii</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">&gt;=</span> <span class="n">res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_dict</span><span class="p">[</span><span class="n">res</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">l_index</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">ii</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">h_index</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">[</span><span class="n">l_index</span><span class="p">])</span> <span class="o">&amp;</span>
                                   <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">[</span><span class="n">h_index</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_model_int</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_dict</span><span class="p">[</span><span class="n">res</span><span class="p">]</span></div>

<div class="viewcode-block" id="WSModelManipulator.convert_res_to_model"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSModelManipulator.convert_res_to_model">[docs]</a>    <span class="k">def</span> <span class="nf">convert_res_to_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res_array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        converts an output model into an array of segmented valued according</span>
<span class="sd">        to res_list. </span>

<span class="sd">        output is an array of segemented resistivity values in ohm-m (linear)        </span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># make values in model resistivity array a value in res_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">res_array</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">):</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">res_array</span> <span class="o">==</span> <span class="n">res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>
            <span class="k">if</span> <span class="n">ii</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">res_array</span> <span class="o">&lt;=</span> <span class="n">res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>
            <span class="k">elif</span> <span class="n">ii</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">res_array</span> <span class="o">&gt;=</span> <span class="n">res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">l_index</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">ii</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">h_index</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">res_array</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">[</span><span class="n">l_index</span><span class="p">])</span> <span class="o">&amp;</span>
                                   <span class="p">(</span><span class="n">res_array</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_list</span><span class="p">[</span><span class="n">h_index</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span></div>

<div class="viewcode-block" id="WSModelManipulator.rewrite_initial_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSModelManipulator.rewrite_initial_file">[docs]</a>    <span class="k">def</span> <span class="nf">rewrite_initial_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write an initial file for wsinv3d from the model created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># need to flip the resistivity model so that the first index is the</span>
        <span class="c1"># northern most block in N-S</span>
        <span class="c1">#self.res_model = self.res_model[::-1, :, :]</span>

        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">save_path</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">new_initial_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn_basename</span><span class="p">)</span>
        <span class="n">wsmesh</span> <span class="o">=</span> <span class="n">WSMesh</span><span class="p">()</span>
        <span class="c1"># pass attribute to wsmesh</span>
        <span class="n">att_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nodes_north&#39;</span><span class="p">,</span> <span class="s1">&#39;nodes_east&#39;</span><span class="p">,</span> <span class="s1">&#39;nodes_z&#39;</span><span class="p">,</span> <span class="s1">&#39;grid_east&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;grid_north&#39;</span><span class="p">,</span> <span class="s1">&#39;grid_z&#39;</span><span class="p">,</span> <span class="s1">&#39;res_model&#39;</span><span class="p">,</span> <span class="s1">&#39;res_list&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;res_dict&#39;</span><span class="p">,</span> <span class="s1">&#39;res_model&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">att_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">wsmesh</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="n">wsmesh</span><span class="o">.</span><span class="n">write_initial_file</span><span class="p">(</span><span class="n">initial_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">new_initial_fn</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="cmap_discretize"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.cmap_discretize">[docs]</a><span class="k">def</span> <span class="nf">cmap_discretize</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a discrete colormap from the continuous colormap cmap.</span>

<span class="sd">         cmap: colormap instance, eg. cm.jet. </span>
<span class="sd">         N: number of colors.</span>

<span class="sd">     Example</span>
<span class="sd">         x = resize(arange(100), (5,100))</span>
<span class="sd">         djet = cmap_discretize(cm.jet, 5)</span>
<span class="sd">         imshow(x, cmap=djet)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">colors_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)))</span>
    <span class="n">colors_rgba</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">colors_i</span><span class="p">)</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">cdict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ki</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">)):</span>
        <span class="n">cdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">colors_rgba</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ki</span><span class="p">],</span> <span class="n">colors_rgba</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">ki</span><span class="p">])</span>
                      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="c1"># Return colormap object.</span>
    <span class="k">return</span> <span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">N</span><span class="p">,</span> <span class="n">cdict</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span></div>
<span class="c1">#==============================================================================</span>
<span class="c1"># response</span>
<span class="c1">#==============================================================================</span>


<div class="viewcode-block" id="WSResponse"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSResponse">[docs]</a><span class="k">class</span> <span class="nc">WSResponse</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    class to deal with .resp file output by ws3dinv</span>

<span class="sd">    ====================== ====================================================</span>
<span class="sd">    Attributes             Description    </span>
<span class="sd">    ====================== ====================================================</span>
<span class="sd">    n_z                    number of vertical layers             </span>
<span class="sd">    period_list            list of periods inverted for</span>
<span class="sd">    resp                   np.ndarray structured with keys:</span>
<span class="sd">                              * *station* --&gt; station name</span>
<span class="sd">                              * *east*    --&gt; relative eastern location in</span>
<span class="sd">                                               grid</span>
<span class="sd">                              * *north*   --&gt; relative northern location in </span>
<span class="sd">                                               grid</span>
<span class="sd">                              * *z_resp*  --&gt; impedance tensor array </span>
<span class="sd">                                               of response with shape</span>
<span class="sd">                                         (n_stations, n_freq, 4, dtype=complex)</span>
<span class="sd">                              * *z_resp_err--&gt; response impedance tensor error </span>
<span class="sd">    resp_fn                full path to response file</span>
<span class="sd">    station_east           location of stations in east direction</span>
<span class="sd">    station_fn             full path to station file written by WSStation</span>
<span class="sd">    station_names          names of stations</span>
<span class="sd">    station_north          location of stations in north direction </span>
<span class="sd">    units                  [ &#39;mv&#39; | &#39;other&#39; ] units of impedance tensor</span>
<span class="sd">    wl_sites_fn            full path to .sites file from Winglink</span>
<span class="sd">    z_resp                 impedance tensors of response with shape</span>
<span class="sd">                           (n_stations, n_periods, 2, 2)</span>
<span class="sd">    z_resp_err             impedance tensors errors of response with shape</span>
<span class="sd">                           (n_stations, n_periods, 2, 2) (zeros)</span>
<span class="sd">    ====================== ====================================================</span>

<span class="sd">    ====================== ====================================================</span>
<span class="sd">    Methods                Description     </span>
<span class="sd">    ====================== ====================================================</span>
<span class="sd">    read_resp_file         read response file and fill attributes </span>
<span class="sd">    ====================== ====================================================</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resp_fn</span><span class="p">,</span> <span class="n">station_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wl_station_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="o">=</span> <span class="n">resp_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">=</span> <span class="n">station_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wl_sites_fn</span> <span class="o">=</span> <span class="n">wl_station_fn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">period_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resp</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_z</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_resp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_resp_err</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;mv&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zconv</span> <span class="o">=</span> <span class="mf">796.</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_resp_file</span><span class="p">()</span>

<div class="viewcode-block" id="WSResponse.read_resp_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSResponse.read_resp_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_resp_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resp_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wl_sites_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">station_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read in data file</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>
<span class="sd">            **resp_fn** : string</span>
<span class="sd">                          full path to data file</span>
<span class="sd">            **sites_fn** : string</span>
<span class="sd">                           full path to sites file output by winglink.  This is</span>
<span class="sd">                           to match the station name with station number.</span>
<span class="sd">            **station_fn** : string</span>
<span class="sd">                             full path to station location file</span>

<span class="sd">        Outputs:</span>
<span class="sd">        --------</span>
<span class="sd">            **resp** : structure np.ndarray</span>
<span class="sd">                      fills the attribute WSData.data with values</span>

<span class="sd">            **period_list** : np.ndarray()</span>
<span class="sd">                             fills the period list with values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">resp_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="o">=</span> <span class="n">resp_fn</span>

        <span class="k">if</span> <span class="n">wl_sites_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wl_sites_fn</span> <span class="o">=</span> <span class="n">wl_sites_fn</span>
        <span class="k">if</span> <span class="n">station_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">=</span> <span class="n">station_fn</span>

        <span class="n">dfid</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">dlines</span> <span class="o">=</span> <span class="n">dfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="c1"># get size number of stations, number of frequencies,</span>
        <span class="c1"># number of Z components</span>
        <span class="n">n_stations</span><span class="p">,</span> <span class="n">n_periods</span><span class="p">,</span> <span class="n">nz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span>
                                             <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
        <span class="n">nsstart</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_z</span> <span class="o">=</span> <span class="n">nz</span>
        <span class="c1"># make a structured array to keep things in for convenience</span>
        <span class="n">z_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_periods</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">resp_dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="s1">&#39;|S10&#39;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;z_resp&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">,</span> <span class="n">z_shape</span><span class="p">)),</span>
                      <span class="p">(</span><span class="s1">&#39;z_resp_err&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">,</span> <span class="n">z_shape</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_stations</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">resp_dtype</span><span class="p">)</span>

        <span class="n">findlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">dline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">50</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Station_Location: N-S&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">findlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">dline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Station_Location: E-W&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">findlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">dline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;DATA_Period:&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">findlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>

        <span class="n">ncol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">nsstart</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

        <span class="c1"># get site names if entered a sites file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl_sites_fn</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">slist</span><span class="p">,</span> <span class="n">station_list</span> <span class="o">=</span> <span class="n">wl</span><span class="o">.</span><span class="n">read_sites_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl_sites_fn</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resp</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">station_list</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stations</span> <span class="o">=</span> <span class="n">WSStation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span><span class="p">)</span>
            <span class="n">stations</span><span class="o">.</span><span class="n">read_station_file</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resp</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">names</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resp</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_stations</span><span class="p">)</span>

        <span class="c1"># get N-S locations</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">dline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">findlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">findlist</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">dline</span> <span class="o">=</span> <span class="n">dline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncol</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resp</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">][</span><span class="n">ii</span> <span class="o">*</span> <span class="n">ncol</span> <span class="o">+</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dline</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">break</span>

        <span class="c1"># get E-W locations</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">dline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">findlist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">findlist</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">dline</span> <span class="o">=</span> <span class="n">dline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_z</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resp</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">][</span><span class="n">ii</span> <span class="o">*</span> <span class="n">ncol</span> <span class="o">+</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dline</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="c1"># make some empty array to put stuff into</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_periods</span><span class="p">)</span>

        <span class="c1"># get resp</span>
        <span class="n">per</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">dl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">findlist</span><span class="p">[</span><span class="mi">2</span><span class="p">]:]):</span>
            <span class="k">if</span> <span class="n">dl</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;period&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">dl</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dkey</span> <span class="o">=</span> <span class="s1">&#39;z_resp&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">period_list</span><span class="p">[</span><span class="n">per</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">per</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">elif</span> <span class="n">dl</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;#iteration&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zline</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span>
                                 <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zconv</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resp</span><span class="p">[</span><span class="n">st</span><span class="p">][</span><span class="n">dkey</span><span class="p">][</span><span class="n">per</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">zline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">zline</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                             <span class="n">zline</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">zline</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                                                            <span class="p">[</span><span class="n">zline</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">zline</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                                                             <span class="n">zline</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">zline</span><span class="p">[</span><span class="mi">7</span><span class="p">]]])</span>
                <span class="n">st</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp</span><span class="p">[</span><span class="s1">&#39;z_resp&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_resp_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_resp</span><span class="p">)</span></div></div>

<span class="c1">#==============================================================================</span>
<span class="c1"># WSError</span>
<span class="c1">#==============================================================================</span>


<span class="k">class</span> <span class="nc">WSInputError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1">#==============================================================================</span>
<span class="c1"># plot response</span>
<span class="c1">#==============================================================================</span>


<div class="viewcode-block" id="PlotResponse"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotResponse">[docs]</a><span class="k">class</span> <span class="nc">PlotResponse</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plot data and response</span>

<span class="sd">    :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.ws3dinv as ws</span>
<span class="sd">        &gt;&gt;&gt; dfn = r&quot;/home/MT/ws3dinv/Inv1/WSDataFile.dat&quot;</span>
<span class="sd">        &gt;&gt;&gt; rfn = r&quot;/home/MT/ws3dinv/Inv1/Test_resp.00&quot;</span>
<span class="sd">        &gt;&gt;&gt; sfn = r&quot;/home/MT/ws3dinv/Inv1/WSStationLocations.txt&quot;</span>
<span class="sd">        &gt;&gt;&gt; wsrp = ws.PlotResponse(data_fn=dfn, resp_fn=rfn, station_fn=sfn)</span>
<span class="sd">        &gt;&gt;&gt; # plot only the TE and TM modes</span>
<span class="sd">        &gt;&gt;&gt; wsrp.plot_component = 2</span>
<span class="sd">        &gt;&gt;&gt; wsrp.redraw_plot()</span>

<span class="sd">    ======================== ==================================================</span>
<span class="sd">    Attributes               Description    </span>
<span class="sd">    ======================== ==================================================</span>
<span class="sd">    color_mode               [ &#39;color&#39; | &#39;bw&#39; ] color or black and white plots</span>
<span class="sd">    cted                     color for data TE mode</span>
<span class="sd">    ctem                     color for data TM mode</span>
<span class="sd">    ctmd                     color for model TE mode</span>
<span class="sd">    ctmm                     color for model TM mode</span>
<span class="sd">    data_fn                  full path to data file</span>
<span class="sd">    data_object              WSResponse instance</span>
<span class="sd">    e_capsize                cap size of error bars in points (*default* is .5)</span>
<span class="sd">    e_capthick               cap thickness of error bars in points (*default*</span>
<span class="sd">                             is 1)</span>
<span class="sd">    fig_dpi                  resolution of figure in dots-per-inch (300)</span>
<span class="sd">    fig_list                 list of matplotlib.figure instances for plots</span>
<span class="sd">    fig_size                 size of figure in inches (*default* is [6, 6])</span>
<span class="sd">    font_size                size of font for tick labels, axes labels are</span>
<span class="sd">                             font_size+2 (*default* is 7)</span>
<span class="sd">    legend_border_axes_pad   padding between legend box and axes </span>
<span class="sd">    legend_border_pad        padding between border of legend and symbols</span>
<span class="sd">    legend_handle_text_pad   padding between text labels and symbols of legend</span>
<span class="sd">    legend_label_spacing     padding between labels</span>
<span class="sd">    legend_loc               location of legend </span>
<span class="sd">    legend_marker_scale      scale of symbols in legend</span>
<span class="sd">    lw                       line width response curves (*default* is .5)</span>
<span class="sd">    ms                       size of markers (*default* is 1.5)</span>
<span class="sd">    mted                     marker for data TE mode</span>
<span class="sd">    mtem                     marker for data TM mode</span>
<span class="sd">    mtmd                     marker for model TE mode</span>
<span class="sd">    mtmm                     marker for model TM mode </span>
<span class="sd">    phase_limits             limits of phase</span>
<span class="sd">    plot_component           [ 2 | 4 ] 2 for TE and TM or 4 for all components</span>
<span class="sd">    plot_style               [ 1 | 2 ] 1 to plot each mode in a seperate</span>
<span class="sd">                             subplot and 2 to plot xx, xy and yx, yy in same </span>
<span class="sd">                             plots</span>
<span class="sd">    plot_type                [ &#39;1&#39; | list of station name ] &#39;1&#39; to plot all </span>
<span class="sd">                             stations in data file or input a list of station</span>
<span class="sd">                             names to plot if station_fn is input, otherwise</span>
<span class="sd">                             input a list of integers associated with the </span>
<span class="sd">                             index with in the data file, ie 2 for 2nd station</span>
<span class="sd">    plot_z                   [ True | False ] *default* is True to plot </span>
<span class="sd">                             impedance, False for plotting resistivity and </span>
<span class="sd">                             phase</span>
<span class="sd">    plot_yn                  [ &#39;n&#39; | &#39;y&#39; ] to plot on instantiation</span>
<span class="sd">    res_limits               limits of resistivity in linear scale</span>
<span class="sd">    resp_fn                  full path to response file</span>
<span class="sd">    resp_object              WSResponse object for resp_fn, or list of </span>
<span class="sd">                             WSResponse objects if resp_fn is a list of</span>
<span class="sd">                             response files</span>
<span class="sd">    station_fn               full path to station file written by WSStation</span>
<span class="sd">    subplot_bottom           space between axes and bottom of figure</span>
<span class="sd">    subplot_hspace           space between subplots in vertical direction</span>
<span class="sd">    subplot_left             space between axes and left of figure</span>
<span class="sd">    subplot_right            space between axes and right of figure</span>
<span class="sd">    subplot_top              space between axes and top of figure</span>
<span class="sd">    subplot_wspace           space between subplots in horizontal direction    </span>
<span class="sd">    ======================== ==================================================</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resp_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">station_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">data_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="o">=</span> <span class="n">resp_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">=</span> <span class="n">station_fn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_object</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resp_object</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;color_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lw&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;e_capthick&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;e_capsize&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># color mode</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span>
            <span class="c1"># color for data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cted</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cted&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctmd&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mted</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mted&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtmd&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>

            <span class="c1"># color for occam2d model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctem</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctem&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">6</span><span class="p">,</span> <span class="o">.</span><span class="mi">3</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctmm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctmm&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtem</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtem&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtmm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtmm&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>

        <span class="c1"># black and white mode</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;bw&#39;</span><span class="p">:</span>
            <span class="c1"># color for data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cted</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cted&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctmd&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mted</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mted&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtmd&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">)</span>

            <span class="c1"># color for occam2d model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctem</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctem&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctmm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctmm&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtem</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtem&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtmm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtmm&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phase_limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;phase_limits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res_limits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_num&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_size&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dpi&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span> <span class="o">=</span> <span class="o">.</span><span class="mi">98</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span> <span class="o">=</span> <span class="o">.</span><span class="mi">08</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span> <span class="o">=</span> <span class="o">.</span><span class="mi">93</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">legend_loc</span> <span class="o">=</span> <span class="s1">&#39;upper left&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legend_marker_scale</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legend_border_axes_pad</span> <span class="o">=</span> <span class="o">.</span><span class="mi">01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legend_label_spacing</span> <span class="o">=</span> <span class="mf">0.07</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legend_handle_text_pad</span> <span class="o">=</span> <span class="o">.</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legend_border_pad</span> <span class="o">=</span> <span class="o">.</span><span class="mi">15</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;font_size&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_type&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_style</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_style&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_component</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_component&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_yn&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_z&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ylabel_pad</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ylabel_pad&#39;</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<div class="viewcode-block" id="PlotResponse.plot_errorbar"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotResponse.plot_errorbar">[docs]</a>    <span class="k">def</span> <span class="nf">plot_errorbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        convinience function to make an error bar instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">errorbar_object</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">,</span>
                                      <span class="n">data</span><span class="p">,</span>
                                      <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                                      <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                      <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                                      <span class="n">mec</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                      <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span>
                                      <span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>
                                      <span class="n">ecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                      <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                      <span class="n">picker</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                      <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                      <span class="n">elinewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                      <span class="n">capsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span><span class="p">,</span>
                                      <span class="n">capthick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">errorbar_object</span></div>

<div class="viewcode-block" id="PlotResponse.plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotResponse.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_object</span> <span class="o">=</span> <span class="n">WSData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_object</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">,</span>
                                        <span class="n">station_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span><span class="p">)</span>

        <span class="c1"># get shape of impedance tensors</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_object</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_object</span><span class="o">.</span><span class="n">period_list</span><span class="p">)</span>

        <span class="c1"># read in response files</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resp_object</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resp_object</span> <span class="o">=</span> <span class="p">[</span><span class="n">WSResponse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">,</span>
                                               <span class="n">station_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rfile</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resp_object</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WSResponse</span><span class="p">(</span><span class="n">rfile</span><span class="p">,</span>
                                                       <span class="n">station_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span><span class="p">))</span>

        <span class="c1"># get number of response files</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_object</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">ns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span><span class="p">)</span>

        <span class="c1">#--&gt; set default font size</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span>

        <span class="n">fontdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">h_ratio</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">h_ratio</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="n">h_ratio</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=.</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">ax_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">line_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">label_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">!=</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">pstation_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_object</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">station</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pstation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">station</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pstation</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pstation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">pstation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">station</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">pstation</span><span class="p">):</span>
                            <span class="n">pstation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pstation_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">pstation_list</span><span class="p">:</span>
            <span class="n">data_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_object</span><span class="o">.</span><span class="n">z_data</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
            <span class="n">data_z_err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_object</span><span class="o">.</span><span class="n">z_data_err</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
            <span class="n">period</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_object</span><span class="o">.</span><span class="n">period_list</span>
            <span class="n">station</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_object</span><span class="o">.</span><span class="n">station_names</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
            <span class="nb">print</span> <span class="s1">&#39;Plotting: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">station</span><span class="p">)</span>

            <span class="c1"># check for masked points</span>
            <span class="n">data_z</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data_z</span> <span class="o">==</span> <span class="mf">7.95204E5</span> <span class="o">-</span> <span class="mf">7.95204E5</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="o">+</span> <span class="mf">0.0</span><span class="n">j</span>
            <span class="n">data_z_err</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data_z_err</span> <span class="o">==</span> <span class="mf">7.95204E5</span> <span class="o">-</span> <span class="mf">7.95204E5</span><span class="n">j</span><span class="p">)]</span> <span class="o">=</span>\
                <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">1.0</span><span class="n">j</span>

            <span class="c1"># convert to apparent resistivity and phase</span>
            <span class="n">z_object</span> <span class="o">=</span> <span class="n">mtz</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="n">z_array</span><span class="o">=</span><span class="n">data_z</span><span class="p">,</span> <span class="n">z_err_array</span><span class="o">=</span><span class="n">data_z_err</span><span class="p">,</span>
                             <span class="n">freq</span><span class="o">=</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">period</span><span class="p">)</span>

            <span class="n">rp</span> <span class="o">=</span> <span class="n">mtplottools</span><span class="o">.</span><span class="n">ResPhase</span><span class="p">(</span><span class="n">z_object</span><span class="p">)</span>

            <span class="c1"># find locations where points have been masked</span>
            <span class="n">nzxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">resxx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nzxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">resxy</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nzyx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">resyx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nzyy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">resyy</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plotr</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plotr</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># make figure</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">station</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">station</span><span class="p">),</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>

            <span class="c1"># set the grid of subplots</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
                                   <span class="n">wspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span><span class="p">,</span>
                                   <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span><span class="p">,</span>
                                   <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span><span class="p">,</span>
                                   <span class="n">bottom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span><span class="p">,</span>
                                   <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span><span class="p">,</span>
                                   <span class="n">hspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span><span class="p">,</span>
                                   <span class="n">height_ratios</span><span class="o">=</span><span class="n">h_ratio</span><span class="p">)</span>
            <span class="c1">#---------plot the apparent resistivity----------------------------</span>
            <span class="c1"># plot each component in its own subplot</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_style</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_component</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">axrxy</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">axryx</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrxy</span><span class="p">)</span>

                    <span class="n">axpxy</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">axpyx</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrxy</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="c1"># plot resistivity</span>
                        <span class="n">erxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resxy_err</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">eryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axryx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resyx_err</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                        <span class="c1"># plot phase</span>
                        <span class="n">erxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phasexy_err</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">eryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpyx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phaseyx_err</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="c1"># plot real</span>
                        <span class="n">erxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">eryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axryx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                        <span class="c1"># plot phase</span>
                        <span class="n">erxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">eryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpyx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>

                    <span class="n">ax_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axrxy</span><span class="p">,</span> <span class="n">axryx</span><span class="p">,</span> <span class="n">axpxy</span><span class="p">,</span> <span class="n">axpyx</span><span class="p">]</span>
                    <span class="n">line_list</span> <span class="o">=</span> <span class="p">[[</span><span class="n">erxy</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">eryx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>
                    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;$Z_</span><span class="si">{xy}</span><span class="s1">$&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;$Z_</span><span class="si">{yx}</span><span class="s1">$&#39;</span><span class="p">]]</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_component</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">axrxx</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="n">axrxy</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrxx</span><span class="p">)</span>
                    <span class="n">axryx</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrxx</span><span class="p">)</span>
                    <span class="n">axryy</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrxx</span><span class="p">)</span>

                    <span class="n">axpxx</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="n">axpxy</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrxx</span><span class="p">)</span>
                    <span class="n">axpyx</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrxx</span><span class="p">)</span>
                    <span class="n">axpyy</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrxx</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="c1"># plot resistivity</span>
                        <span class="n">erxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resxx</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resxx_err</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">erxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resxy_err</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">eryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axryx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resyx_err</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                        <span class="n">eryy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axryy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resyy</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resyy_err</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                        <span class="c1"># plot phase</span>
                        <span class="n">erxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phasexx</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phasexx_err</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">erxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phasexy_err</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">eryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpyx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phaseyx_err</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                        <span class="n">eryy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpyy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phaseyy</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phaseyy_err</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="c1"># plot real</span>
                        <span class="n">erxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">erxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">eryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axryx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                        <span class="n">eryy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axryy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzyy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzyy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                        <span class="c1"># plot phase</span>
                        <span class="n">erxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">erxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">eryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpyx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                        <span class="n">eryy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpyy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzyy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzyy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>

                    <span class="n">ax_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axrxx</span><span class="p">,</span> <span class="n">axrxy</span><span class="p">,</span> <span class="n">axryx</span><span class="p">,</span> <span class="n">axryy</span><span class="p">,</span>
                               <span class="n">axpxx</span><span class="p">,</span> <span class="n">axpxy</span><span class="p">,</span> <span class="n">axpyx</span><span class="p">,</span> <span class="n">axpyy</span><span class="p">]</span>
                    <span class="n">line_list</span> <span class="o">=</span> <span class="p">[[</span><span class="n">erxx</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">erxy</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">eryx</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">eryy</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>
                    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;$Z_</span><span class="si">{xx}</span><span class="s1">$&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;$Z_</span><span class="si">{xy}</span><span class="s1">$&#39;</span><span class="p">],</span>
                                  <span class="p">[</span><span class="s1">&#39;$Z_</span><span class="si">{yx}</span><span class="s1">$&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;$Z_</span><span class="si">{yy}</span><span class="s1">$&#39;</span><span class="p">]]</span>

                <span class="c1"># set axis properties</span>
                <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax_list</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ylabel_pad</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">aa</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits</span><span class="p">)</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Period (s)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
                        <span class="c1"># set axes labels</span>
                        <span class="k">if</span> <span class="n">aa</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;App. Res. ($\mathbf{\Omega \cdot m}$)&#39;</span><span class="p">,</span>
                                              <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Re[Z (m/s)]&#39;</span><span class="p">,</span>
                                              <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">aa</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                                              <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Im[Z (m/s)]&#39;</span><span class="p">,</span>
                                              <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
<span class="c1">#                        else:</span>
<span class="c1">#                            plt.setp(ax.yaxis.get_ticklabels(), visible=False)</span>

                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">aa</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits</span><span class="p">)</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Period (s)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
                        <span class="c1"># set axes labels</span>
                        <span class="k">if</span> <span class="n">aa</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;App. Res. ($\mathbf{\Omega \cdot m}$)&#39;</span><span class="p">,</span>
                                              <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Re[Z (m/s)]&#39;</span><span class="p">,</span>
                                              <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">aa</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                                              <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Im[Z (m/s)]&#39;</span><span class="p">,</span>
                                              <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
<span class="c1">#                        else:</span>
<span class="c1">#                            plt.setp(ax.yaxis.get_ticklabels(), visible=False)</span>

                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span> <span class="o">*</span> <span class="mf">1.01</span><span class="p">,</span>
                                <span class="n">xmax</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span> <span class="o">*</span> <span class="o">.</span><span class="mi">99</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">)</span>

            <span class="c1"># plot xy and yx together and xx, yy together</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_style</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_component</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">axrxy</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:])</span>
                    <span class="n">axpxy</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrxy</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="c1"># plot resistivity</span>
                        <span class="n">erxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resxy_err</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">eryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resyx_err</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                        <span class="c1"># plot phase</span>
                        <span class="n">erxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phasexy_err</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">eryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phaseyx_err</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="c1"># plot real</span>
                        <span class="n">erxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">eryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzxy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzxy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                        <span class="c1"># plot phase</span>
                        <span class="n">erxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">eryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>

                    <span class="n">ax_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axrxy</span><span class="p">,</span> <span class="n">axpxy</span><span class="p">]</span>
                    <span class="n">line_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">erxy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">eryx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$Z_</span><span class="si">{xy}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;$Z_</span><span class="si">{yx}</span><span class="s1">$&#39;</span><span class="p">]</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_component</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">axrxy</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">axpxy</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrxy</span><span class="p">)</span>

                    <span class="n">axrxx</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrxy</span><span class="p">)</span>
                    <span class="n">axpxx</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrxy</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="c1"># plot resistivity</span>
                        <span class="n">erxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resxx</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resxx_err</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">erxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resxy_err</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">eryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resyx_err</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                        <span class="n">eryy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resyy</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">resyy_err</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                        <span class="c1"># plot phase</span>
                        <span class="n">erxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phasexx</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phasexx_err</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">erxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phasexy_err</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">eryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phaseyx_err</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                        <span class="n">eryy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phaseyy</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                  <span class="n">rp</span><span class="o">.</span><span class="n">phaseyy_err</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                         <span class="c1"># plot real</span>
                        <span class="n">erxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">erxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">eryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                        <span class="n">eryy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzyy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzyy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                        <span class="c1"># plot phase</span>
                        <span class="n">erxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">erxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                        <span class="n">eryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                        <span class="n">eryy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxx</span><span class="p">,</span>
                                                  <span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nzyy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="n">z_object</span><span class="o">.</span><span class="n">z_err</span><span class="p">[</span>
                                                      <span class="n">nzyy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>

                    <span class="n">ax_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axrxy</span><span class="p">,</span> <span class="n">axrxx</span><span class="p">,</span> <span class="n">axpxy</span><span class="p">,</span> <span class="n">axpxx</span><span class="p">]</span>
                    <span class="n">line_list</span> <span class="o">=</span> <span class="p">[[</span><span class="n">erxy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">eryx</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">erxx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">eryy</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>
                    <span class="n">label_list</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;$Z_</span><span class="si">{xy}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;$Z_</span><span class="si">{yx}</span><span class="s1">$&#39;</span><span class="p">],</span>
                                  <span class="p">[</span><span class="s1">&#39;$Z_</span><span class="si">{xx}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;$Z_</span><span class="si">{yy}</span><span class="s1">$&#39;</span><span class="p">]]</span>
                <span class="c1"># set axis properties</span>
                <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax_list</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ylabel_pad</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Period (s)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">aa</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;App. Res. ($\mathbf{\Omega \cdot m}$)&#39;</span><span class="p">,</span>
                                              <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Re[Impedance (m/s)]&#39;</span><span class="p">,</span>
                                              <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                                              <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Im[Impedance (m/s)]&#39;</span><span class="p">,</span>
                                              <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">aa</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits</span><span class="p">)</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Period (s)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">aa</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;App. Res. ($\mathbf{\Omega \cdot m}$)&#39;</span><span class="p">,</span>
                                              <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Re[Impedance (m/s)]&#39;</span><span class="p">,</span>
                                              <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">aa</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                                              <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Im[Impedance (m/s)]&#39;</span><span class="p">,</span>
                                              <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
<span class="c1">#                        else:</span>
<span class="c1">#                            plt.setp(ax.yaxis.get_ticklabels(), visible=False)</span>

                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span> <span class="o">*</span> <span class="mf">1.01</span><span class="p">,</span>
                                <span class="n">xmax</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span> <span class="o">*</span> <span class="o">.</span><span class="mi">99</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">plotr</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span>
                        <span class="n">cxy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">4</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">nr</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="n">cyx</span> <span class="o">=</span> <span class="p">(</span><span class="o">.</span><span class="mi">7</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">nr</span><span class="p">),</span> <span class="o">.</span><span class="mi">13</span><span class="p">,</span> <span class="o">.</span><span class="mi">63</span> <span class="o">-</span>
                               <span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">nr</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;bw&#39;</span><span class="p">:</span>
                        <span class="n">cxy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span>
                               <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">))</span>
                        <span class="n">cyx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span>
                               <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">))</span>

                    <span class="n">resp_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_object</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">.</span><span class="n">z_resp</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
                    <span class="n">resp_z_err</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_z</span> <span class="o">-</span> <span class="n">resp_z</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">data_z_err</span><span class="p">)</span>
                    <span class="n">resp_z_object</span> <span class="o">=</span> <span class="n">mtz</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="n">z_array</span><span class="o">=</span><span class="n">resp_z</span><span class="p">,</span>
                                          <span class="n">z_err_array</span><span class="o">=</span><span class="n">resp_z_err</span><span class="p">,</span>
                                          <span class="n">freq</span><span class="o">=</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">period</span><span class="p">)</span>

                    <span class="n">rrp</span> <span class="o">=</span> <span class="n">mtplottools</span><span class="o">.</span><span class="n">ResPhase</span><span class="p">(</span><span class="n">resp_z_object</span><span class="p">)</span>

                    <span class="n">rms</span> <span class="o">=</span> <span class="n">resp_z_err</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
                    <span class="n">rms_xx</span> <span class="o">=</span> <span class="n">resp_z_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
                    <span class="n">rms_xy</span> <span class="o">=</span> <span class="n">resp_z_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
                    <span class="n">rms_yx</span> <span class="o">=</span> <span class="n">resp_z_err</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
                    <span class="n">rms_yy</span> <span class="o">=</span> <span class="n">resp_z_err</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
                    <span class="nb">print</span> <span class="s1">&#39; --- response </span><span class="si">{0}</span><span class="s1"> ---&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>
                    <span class="nb">print</span> <span class="s1">&#39;  RMS = </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms</span><span class="p">)</span>
                    <span class="nb">print</span> <span class="s1">&#39;      RMS_xx = </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms_xx</span><span class="p">)</span>
                    <span class="nb">print</span> <span class="s1">&#39;      RMS_xy = </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms_xy</span><span class="p">)</span>
                    <span class="nb">print</span> <span class="s1">&#39;      RMS_yx = </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms_yx</span><span class="p">)</span>
                    <span class="nb">print</span> <span class="s1">&#39;      RMS_yy = </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms_yy</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_style</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_component</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="c1"># plot resistivity</span>
                                <span class="n">rerxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resxy_err</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">reryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axryx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resyx_err</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                                <span class="c1"># plot phase</span>
                                <span class="n">rerxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phasexy_err</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">reryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpyx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phaseyx_err</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="c1"># plot real</span>
                                <span class="n">rerxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">reryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axryx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                                <span class="c1"># plot phase</span>
                                <span class="n">rerxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">reryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpyx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>

                            <span class="n">line_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">rerxy</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="n">line_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">reryx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="n">label_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;$Z^m_</span><span class="si">{xy}</span><span class="s1">$ &#39;</span> <span class="o">+</span>
                                              <span class="s1">&#39;rms=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms_xy</span><span class="p">)]</span>
                            <span class="n">label_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;$Z^m_</span><span class="si">{yx}</span><span class="s1">$ &#39;</span> <span class="o">+</span>
                                              <span class="s1">&#39;rms=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms_yx</span><span class="p">)]</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_component</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="c1"># plot resistivity</span>
                                <span class="n">rerxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resxx</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resxx_err</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">rerxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resxy_err</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">reryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axryx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resyx_err</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                                <span class="n">reryy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axryy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resyy</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resyy_err</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                                <span class="c1"># plot phase</span>
                                <span class="n">rerxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phasexx</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phasexx_err</span><span class="p">[</span>
                                                               <span class="n">nzxx</span><span class="p">],</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">rerxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phasexy_err</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">reryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpyx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phaseyx_err</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                                <span class="n">reryy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpyy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phaseyy</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phaseyy_err</span><span class="p">[</span>
                                                               <span class="n">nzyy</span><span class="p">],</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="c1"># plot real</span>
                                <span class="n">rerxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">rerxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">reryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axryx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                                <span class="n">reryy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axryy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzyy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzyy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                                <span class="c1"># plot phase</span>
                                <span class="n">rerxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">rerxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">reryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpyx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                                <span class="n">reryy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpyy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzyy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzyy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>

                            <span class="n">line_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">rerxx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="n">line_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">rerxy</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="n">line_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">reryx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="n">line_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">reryy</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="n">label_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;$Z^m_</span><span class="si">{xx}</span><span class="s1">$ &#39;</span> <span class="o">+</span>
                                              <span class="s1">&#39;rms=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms_xx</span><span class="p">)]</span>
                            <span class="n">label_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;$Z^m_</span><span class="si">{xy}</span><span class="s1">$ &#39;</span> <span class="o">+</span>
                                              <span class="s1">&#39;rms=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms_xy</span><span class="p">)]</span>
                            <span class="n">label_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;$Z^m_</span><span class="si">{yx}</span><span class="s1">$ &#39;</span> <span class="o">+</span>
                                              <span class="s1">&#39;rms=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms_yx</span><span class="p">)]</span>
                            <span class="n">label_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;$Z^m_</span><span class="si">{yy}</span><span class="s1">$ &#39;</span> <span class="o">+</span>
                                              <span class="s1">&#39;rms=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms_yy</span><span class="p">)]</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_style</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_component</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="c1"># plot resistivity</span>
                                <span class="n">rerxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resxy_err</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">reryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resyx_err</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                                <span class="c1"># plot phase</span>
                                <span class="n">rerxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phasexy_err</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">reryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phaseyx_err</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="c1"># plot real</span>
                                <span class="n">rerxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">reryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                                <span class="c1"># plot phase</span>
                                <span class="n">rerxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">reryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                            <span class="n">line_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">rerxy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reryx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="n">label_list</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;$Z^m_</span><span class="si">{xy}</span><span class="s1">$ &#39;</span> <span class="o">+</span>
                                           <span class="s1">&#39;rms=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms_xy</span><span class="p">),</span>
                                           <span class="s1">&#39;$Z^m_</span><span class="si">{yx}</span><span class="s1">$ &#39;</span> <span class="o">+</span>
                                           <span class="s1">&#39;rms=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms_yx</span><span class="p">)]</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_component</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="c1"># plot resistivity</span>
                                <span class="n">rerxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resxx</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resxx_err</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">rerxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resxy_err</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">reryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resyx_err</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                                <span class="n">reryy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resyy</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">resyy_err</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                                <span class="c1"># plot phase</span>
                                <span class="n">rerxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phasexx</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phasexx_err</span><span class="p">[</span>
                                                               <span class="n">nzxx</span><span class="p">],</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">rerxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phasexy_err</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">reryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phaseyx_err</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                                <span class="n">reryy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phaseyy</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                           <span class="n">rrp</span><span class="o">.</span><span class="n">phaseyy_err</span><span class="p">[</span>
                                                               <span class="n">nzyy</span><span class="p">],</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="c1"># plot real</span>
                                <span class="n">rerxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">rerxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">reryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                                <span class="n">reryy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrxx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzyy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzyy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                                <span class="c1"># plot phase</span>
                                <span class="n">rerxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">rerxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">cxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">)</span>
                                <span class="n">reryx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxy</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzyx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                                <span class="n">reryy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpxx</span><span class="p">,</span>
                                                           <span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                                           <span class="n">resp_z</span><span class="p">[</span>
                                                               <span class="n">nzyy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">resp_z_err</span><span class="p">[</span>
                                                               <span class="n">nzyy</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                           <span class="n">cyx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">)</span>
                            <span class="n">line_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">rerxy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reryx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="n">line_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">rerxx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reryy</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="n">label_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;$Z^m_</span><span class="si">{xy}</span><span class="s1">$ &#39;</span> <span class="o">+</span>
                                              <span class="s1">&#39;rms=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms_xy</span><span class="p">),</span>
                                              <span class="s1">&#39;$Z^m_</span><span class="si">{yx}</span><span class="s1">$ &#39;</span> <span class="o">+</span>
                                              <span class="s1">&#39;rms=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms_yx</span><span class="p">)]</span>
                            <span class="n">label_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;$Z^m_</span><span class="si">{xx}</span><span class="s1">$ &#39;</span> <span class="o">+</span>
                                              <span class="s1">&#39;rms=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms_xx</span><span class="p">),</span>
                                              <span class="s1">&#39;$Z^m_</span><span class="si">{yy}</span><span class="s1">$ &#39;</span> <span class="o">+</span>
                                              <span class="s1">&#39;rms=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rms_yy</span><span class="p">)]</span>

                <span class="c1"># make legends</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_style</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_component</span><span class="p">]):</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">line_list</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span>
                                  <span class="n">label_list</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span>
                                  <span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_loc</span><span class="p">,</span>
                                  <span class="n">markerscale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_marker_scale</span><span class="p">,</span>
                                  <span class="n">borderaxespad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_border_axes_pad</span><span class="p">,</span>
                                  <span class="n">labelspacing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_label_spacing</span><span class="p">,</span>
                                  <span class="n">handletextpad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_handle_text_pad</span><span class="p">,</span>
                                  <span class="n">borderpad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_border_pad</span><span class="p">,</span>
                                  <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">/</span> <span class="n">nr</span><span class="p">,</span> <span class="mi">5</span><span class="p">])})</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_style</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_component</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">axrxy</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">line_list</span><span class="p">,</span>
                                     <span class="n">label_list</span><span class="p">,</span>
                                     <span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_loc</span><span class="p">,</span>
                                     <span class="n">markerscale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_marker_scale</span><span class="p">,</span>
                                     <span class="n">borderaxespad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_border_axes_pad</span><span class="p">,</span>
                                     <span class="n">labelspacing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_label_spacing</span><span class="p">,</span>
                                     <span class="n">handletextpad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_handle_text_pad</span><span class="p">,</span>
                                     <span class="n">borderpad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_border_pad</span><span class="p">,</span>
                                     <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">/</span> <span class="n">nr</span><span class="p">,</span> <span class="mi">5</span><span class="p">])})</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_component</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]):</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">line_list</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span>
                                      <span class="n">label_list</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span>
                                      <span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_loc</span><span class="p">,</span>
                                      <span class="n">markerscale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_marker_scale</span><span class="p">,</span>
                                      <span class="n">borderaxespad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_border_axes_pad</span><span class="p">,</span>
                                      <span class="n">labelspacing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_label_spacing</span><span class="p">,</span>
                                      <span class="n">handletextpad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_handle_text_pad</span><span class="p">,</span>
                                      <span class="n">borderpad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend_border_pad</span><span class="p">,</span>
                                      <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">/</span> <span class="n">nr</span><span class="p">,</span> <span class="mi">5</span><span class="p">])})</span></div>

<div class="viewcode-block" id="PlotResponse.redraw_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotResponse.redraw_plot">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        redraw plot if parameters were changed</span>

<span class="sd">        use this function if you updated some attributes and want to re-plot.</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # change the color and marker of the xy components</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(r&quot;/home/occam2d/Data.dat&quot;)</span>
<span class="sd">            &gt;&gt;&gt; p1 = ocd.plotAllResponses()</span>
<span class="sd">            &gt;&gt;&gt; #change line width</span>
<span class="sd">            &gt;&gt;&gt; p1.lw = 2</span>
<span class="sd">            &gt;&gt;&gt; p1.redraw_plot()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_list</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotResponse.save_figure"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotResponse.save_figure">[docs]</a>    <span class="k">def</span> <span class="nf">save_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_fn</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">,</span>
                    <span class="n">fig_dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">close_fig</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save_plot will save the figure to save_fn.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>

<span class="sd">            **save_fn** : string</span>
<span class="sd">                          full path to save figure to, can be input as</span>
<span class="sd">                          * directory path -&gt; the directory path to save to</span>
<span class="sd">                            in which the file will be saved as </span>
<span class="sd">                            save_fn/station_name_PhaseTensor.file_format</span>

<span class="sd">                          * full path -&gt; file will be save to the given </span>
<span class="sd">                            path.  If you use this option then the format</span>
<span class="sd">                            will be assumed to be provided by the path</span>

<span class="sd">            **file_format** : [ pdf | eps | jpg | png | svg ]</span>
<span class="sd">                              file type of saved figure pdf,svg,eps... </span>

<span class="sd">            **orientation** : [ landscape | portrait ]</span>
<span class="sd">                              orientation in which the file will be saved</span>
<span class="sd">                              *default* is portrait</span>

<span class="sd">            **fig_dpi** : int</span>
<span class="sd">                          The resolution in dots-per-inch the file will be</span>
<span class="sd">                          saved.  If None then the dpi will be that at </span>
<span class="sd">                          which the figure was made.  I don&#39;t think that </span>
<span class="sd">                          it can be larger than dpi of the figure.</span>

<span class="sd">            **close_plot** : [ y | n ]</span>
<span class="sd">                             * &#39;y&#39; will close the plot after saving.</span>
<span class="sd">                             * &#39;n&#39; will leave plot open</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # to save plot as jpg</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; dfn = r&quot;/home/occam2d/Inv1/data.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(dfn)</span>
<span class="sd">            &gt;&gt;&gt; ps1 = ocd.plotPseudoSection()</span>
<span class="sd">            &gt;&gt;&gt; ps1.save_plot(r&#39;/home/MT/figures&#39;, file_format=&#39;jpg&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">fig_dpi</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_dpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">file_format</span> <span class="o">=</span> <span class="n">save_fn</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">save_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="s1">&#39;_L2.&#39;</span> <span class="o">+</span>
                                   <span class="n">file_format</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">close_fig</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span> <span class="o">=</span> <span class="n">save_fn</span>
        <span class="nb">print</span> <span class="s1">&#39;Saved figure to: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span></div>

<div class="viewcode-block" id="PlotResponse.update_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotResponse.update_plot">[docs]</a>    <span class="k">def</span> <span class="nf">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update any parameters that where changed using the built-in draw from</span>
<span class="sd">        canvas.  </span>

<span class="sd">        Use this if you change an of the .fig or axes properties</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # to change the grid lines to only be on the major ticks</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; dfn = r&quot;/home/occam2d/Inv1/data.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(dfn)</span>
<span class="sd">            &gt;&gt;&gt; ps1 = ocd.plotAllResponses()</span>
<span class="sd">            &gt;&gt;&gt; [ax.grid(True, which=&#39;major&#39;) for ax in [ps1.axrte,ps1.axtep]]</span>
<span class="sd">            &gt;&gt;&gt; ps1.update_plot()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotResponse.__str__"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotResponse.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rewrite the string builtin to give a useful message</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;Plots data vs model response computed by WS3DINV&quot;</span><span class="p">)</span></div></div>

<span class="c1">#==============================================================================</span>
<span class="c1"># plot depth slices</span>
<span class="c1">#==============================================================================</span>


<div class="viewcode-block" id="PlotDepthSlice"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotDepthSlice">[docs]</a><span class="k">class</span> <span class="nc">PlotDepthSlice</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots depth slices of resistivity model</span>

<span class="sd">    :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.ws3dinv as ws</span>
<span class="sd">        &gt;&gt;&gt; mfn = r&quot;/home/MT/ws3dinv/Inv1/Test_model.00&quot;</span>
<span class="sd">        &gt;&gt;&gt; sfn = r&quot;/home/MT/ws3dinv/Inv1/WSStationLocations.txt&quot;</span>
<span class="sd">        &gt;&gt;&gt; # plot just first layer to check the formating        </span>
<span class="sd">        &gt;&gt;&gt; pds = ws.PlotDepthSlice(model_fn=mfn, station_fn=sfn, </span>
<span class="sd">        &gt;&gt;&gt; ...                     depth_index=0, save_plots=&#39;n&#39;)</span>
<span class="sd">        &gt;&gt;&gt; #move color bar up </span>
<span class="sd">        &gt;&gt;&gt; pds.cb_location</span>
<span class="sd">        &gt;&gt;&gt; (0.64500000000000002, 0.14999999999999997, 0.3, 0.025)</span>
<span class="sd">        &gt;&gt;&gt; pds.cb_location = (.645, .175, .3, .025)</span>
<span class="sd">        &gt;&gt;&gt; pds.redraw_plot()</span>
<span class="sd">        &gt;&gt;&gt; #looks good now plot all depth slices and save them to a folder</span>
<span class="sd">        &gt;&gt;&gt; pds.save_path = r&quot;/home/MT/ws3dinv/Inv1/DepthSlices&quot;</span>
<span class="sd">        &gt;&gt;&gt; pds.depth_index = None</span>
<span class="sd">        &gt;&gt;&gt; pds.save_plots = &#39;y&#39;</span>
<span class="sd">        &gt;&gt;&gt; pds.redraw_plot()</span>

<span class="sd">    ======================= ===================================================</span>
<span class="sd">    Attributes              Description    </span>
<span class="sd">    ======================= ===================================================</span>
<span class="sd">    cb_location             location of color bar (x, y, width, height)</span>
<span class="sd">                            *default* is None, automatically locates</span>
<span class="sd">    cb_orientation          [ &#39;vertical&#39; | &#39;horizontal&#39; ] </span>
<span class="sd">                            *default* is horizontal </span>
<span class="sd">    cb_pad                  padding between axes and colorbar</span>
<span class="sd">                            *default* is None</span>
<span class="sd">    cb_shrink               percentage to shrink colorbar by</span>
<span class="sd">                            *default* is None</span>
<span class="sd">    climits                 (min, max) of resistivity color on log scale</span>
<span class="sd">                            *default* is (0, 4)</span>
<span class="sd">    cmap                    name of color map *default* is &#39;jet_r&#39;</span>
<span class="sd">    data_fn                 full path to data file</span>
<span class="sd">    depth_index             integer value of depth slice index, shallowest</span>
<span class="sd">                            layer is 0</span>
<span class="sd">    dscale                  scaling parameter depending on map_scale </span>
<span class="sd">    ew_limits               (min, max) plot limits in e-w direction in </span>
<span class="sd">                            map_scale units. *default* is None, sets viewing</span>
<span class="sd">                            area to the station area</span>
<span class="sd">    fig_aspect              aspect ratio of plot. *default* is 1</span>
<span class="sd">    fig_dpi                 resolution of figure in dots-per-inch. *default* is</span>
<span class="sd">                            300</span>
<span class="sd">    fig_list                list of matplotlib.figure instances for each </span>
<span class="sd">                            depth slice                 </span>
<span class="sd">    fig_size                [width, height] in inches of figure size</span>
<span class="sd">                            *default* is [6, 6]</span>
<span class="sd">    font_size               size of ticklabel font in points, labels are </span>
<span class="sd">                            font_size+2. *default* is 7</span>
<span class="sd">    grid_east               relative location of grid nodes in e-w direction</span>
<span class="sd">                            in map_scale units</span>
<span class="sd">    grid_north              relative location of grid nodes in n-s direction</span>
<span class="sd">                            in map_scale units</span>
<span class="sd">    grid_z                  relative location of grid nodes in z direction</span>
<span class="sd">                            in map_scale units</span>
<span class="sd">    initial_fn              full path to initial file</span>
<span class="sd">    map_scale               [ &#39;km&#39; | &#39;m&#39; ] distance units of map. *default* is </span>
<span class="sd">                            km</span>
<span class="sd">    mesh_east               np.meshgrid(grid_east, grid_north, indexing=&#39;ij&#39;)</span>
<span class="sd">    mesh_north              np.meshgrid(grid_east, grid_north, indexing=&#39;ij&#39;)</span>
<span class="sd">    model_fn                full path to model file</span>
<span class="sd">    nodes_east              relative distance betwen nodes in e-w direction</span>
<span class="sd">                            in map_scale units</span>
<span class="sd">    nodes_north             relative distance betwen nodes in n-s direction</span>
<span class="sd">                            in map_scale units</span>
<span class="sd">    nodes_z                 relative distance betwen nodes in z direction</span>
<span class="sd">                            in map_scale units</span>
<span class="sd">    ns_limits               (min, max) plot limits in n-s direction in </span>
<span class="sd">                            map_scale units. *default* is None, sets viewing</span>
<span class="sd">                            area to the station area</span>
<span class="sd">    plot_grid               [ &#39;y&#39; | &#39;n&#39; ] &#39;y&#39; to plot mesh grid lines. </span>
<span class="sd">                            *default* is &#39;n&#39;</span>
<span class="sd">    plot_yn                 [ &#39;y&#39; | &#39;n&#39; ] &#39;y&#39; to plot on instantiation</span>
<span class="sd">    res_model               np.ndarray(n_north, n_east, n_vertical) of </span>
<span class="sd">                            model resistivity values in linear scale</span>
<span class="sd">    save_path               path to save figures to</span>
<span class="sd">    save_plots              [ &#39;y&#39; | &#39;n&#39; ] &#39;y&#39; to save depth slices to save_path</span>
<span class="sd">    station_east            location of stations in east direction in </span>
<span class="sd">                            map_scale units  </span>
<span class="sd">    station_fn              full path to station locations file</span>
<span class="sd">    station_names           station names</span>
<span class="sd">    station_north           location of station in north direction in </span>
<span class="sd">                            map_scale units</span>
<span class="sd">    subplot_bottom          distance between axes and bottom of figure window</span>
<span class="sd">    subplot_left            distance between axes and left of figure window  </span>
<span class="sd">    subplot_right           distance between axes and right of figure window</span>
<span class="sd">    subplot_top             distance between axes and top of figure window</span>
<span class="sd">    title                   titiel of plot *default* is depth of slice</span>
<span class="sd">    xminorticks             location of xminorticks</span>
<span class="sd">    yminorticks             location of yminorticks</span>
<span class="sd">    ======================= ===================================================</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">station_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">initial_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span> <span class="n">model_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">data_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">=</span> <span class="n">station_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="o">=</span> <span class="n">initial_fn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;save_path&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_plots</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;save_plots&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;depth_index&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_scale&#39;</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">)</span>
        <span class="c1"># make map scale</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">==</span> <span class="s1">&#39;km&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">=</span> <span class="mf">1000.</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ew_limits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ns_limits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_grid</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_grid&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_size&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dpi&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_aspect</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_aspect&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xminorticks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xminorticks&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yminorticks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;yminorticks&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">climits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;climits&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;jet_r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;font_size&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb_shrink</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cb_shrink&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb_pad</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cb_pad&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb_orientation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cb_orientation&#39;</span><span class="p">,</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb_location</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cb_location&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span> <span class="o">=</span> <span class="o">.</span><span class="mi">99</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span> <span class="o">=</span> <span class="o">.</span><span class="mi">085</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span> <span class="o">=</span> <span class="o">.</span><span class="mi">92</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_north</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_names</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_yn&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<div class="viewcode-block" id="PlotDepthSlice.read_files"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotDepthSlice.read_files">[docs]</a>    <span class="k">def</span> <span class="nf">read_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read in the files to get appropriate information</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#--&gt; read in model file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">wsmodel</span> <span class="o">=</span> <span class="n">WSModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">res_model</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">nodes_east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">nodes_north</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">nodes_z</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">mtex</span><span class="o">.</span><span class="n">MTpyError_file_handling</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> does not exist, check path&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">))</span>

        <span class="c1">#--&gt; read in data file to get station locations</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">wsdata</span> <span class="o">=</span> <span class="n">WSData</span><span class="p">()</span>
                <span class="n">wsdata</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="o">=</span> <span class="n">wsdata</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="o">=</span> <span class="n">wsdata</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_names</span> <span class="o">=</span> <span class="n">wsdata</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;Could not find data file </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>

        <span class="c1">#--&gt; read in station file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">wsstations</span> <span class="o">=</span> <span class="n">WSStation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span><span class="p">)</span>
                <span class="n">wsstations</span><span class="o">.</span><span class="n">read_station_file</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="o">=</span> <span class="n">wsstations</span><span class="o">.</span><span class="n">east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="o">=</span> <span class="n">wsstations</span><span class="o">.</span><span class="n">north</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_names</span> <span class="o">=</span> <span class="n">wsstations</span><span class="o">.</span><span class="n">names</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;Could not find station file </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span><span class="p">)</span>

        <span class="c1">#--&gt; read in initial file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">wsmesh</span> <span class="o">=</span> <span class="n">WSMesh</span><span class="p">()</span>
                <span class="n">wsmesh</span><span class="o">.</span><span class="n">read_initial_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">=</span> <span class="n">wsmesh</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">=</span> <span class="n">wsmesh</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="n">wsmesh</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span> <span class="o">=</span> <span class="n">wsmesh</span><span class="o">.</span><span class="n">nodes_east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span> <span class="o">=</span> <span class="n">wsmesh</span><span class="o">.</span><span class="n">nodes_north</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span> <span class="o">=</span> <span class="n">wsmesh</span><span class="o">.</span><span class="n">nodes_z</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>

                <span class="c1"># need to convert index values to resistivity values</span>
                <span class="n">rdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">ii</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
                              <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wsmesh</span><span class="o">.</span><span class="n">res_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>

                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wsmesh</span><span class="o">.</span><span class="n">res_list</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wsmesh</span><span class="o">.</span><span class="n">res_model</span> <span class="o">==</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> \
                        <span class="n">rdict</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">mtex</span><span class="o">.</span><span class="n">MTpyError_file_handling</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> does not exist, check path&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">mtex</span><span class="o">.</span><span class="n">MTpyError_inputarguments</span><span class="p">(</span><span class="s1">&#39;Need to input either a model&#39;</span>
                                                <span class="s1">&#39; file or initial file.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PlotDepthSlice.plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotDepthSlice.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot depth slices</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#--&gt; get information from files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_files</span><span class="p">()</span>

        <span class="n">fdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">}</span>

        <span class="n">cblabeldict</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;$10^{-3}$&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;$10^{-1}$&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{0}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">,</span>
                       <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{3}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{4}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{5}</span><span class="s1">$&#39;</span><span class="p">,</span>
                       <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{6}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{7}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{8}</span><span class="s1">$&#39;</span><span class="p">}</span>

        <span class="c1"># create an list of depth slices to plot</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">zrange</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">zrange</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">or</span> \
                <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">zrange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth_index</span>

        <span class="c1"># set the limits of the plot</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xlimits</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_east</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_east</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xlimits</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xlimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ylimits</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_north</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_north</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ylimits</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span>

        <span class="c1"># make a mesh grid of north and east</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_north</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">,</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">,</span>
                                                      <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span>

        <span class="c1">#--&gt; plot depths into individual figures</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">zrange</span><span class="p">:</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.3f}</span><span class="s1"> (</span><span class="si">{1}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_aspect</span><span class="p">)</span>
            <span class="n">plot_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">mesh_plot</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_east</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">mesh_north</span><span class="p">,</span>
                                       <span class="n">plot_res</span><span class="p">,</span>
                                       <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span>
                                       <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                       <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># plot the stations</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ee</span><span class="p">,</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span><span class="p">):</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ee</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
                             <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                             <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                             <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

            <span class="c1"># set axis properties</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlimits</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylimits</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span>
                <span class="n">MultipleLocator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xminorticks</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">))</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span>
                <span class="n">MultipleLocator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yminorticks</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">))</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Northing (&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">fdict</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Easting (&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">fdict</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Depth = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">depth</span><span class="p">),</span> <span class="n">fontdict</span><span class="o">=</span><span class="n">fdict</span><span class="p">)</span>

            <span class="c1"># plot the grid if desired</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_grid</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                <span class="n">east_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">east_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">:</span>
                    <span class="n">east_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span> <span class="n">xx</span><span class="p">])</span>
                    <span class="n">east_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="n">east_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
                    <span class="n">east_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">east_line_xlist</span><span class="p">,</span>
                         <span class="n">east_line_ylist</span><span class="p">,</span>
                         <span class="n">lw</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

                <span class="n">north_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">north_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">:</span>
                    <span class="n">north_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
                    <span class="n">north_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="n">north_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">yy</span><span class="p">,</span> <span class="n">yy</span><span class="p">])</span>
                    <span class="n">north_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">north_line_xlist</span><span class="p">,</span>
                         <span class="n">north_line_ylist</span><span class="p">,</span>
                         <span class="n">lw</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

            <span class="c1"># plot the colorbar</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb_location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb_orientation</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb_location</span> <span class="o">=</span> <span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">figbox</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="o">.</span><span class="mi">225</span><span class="p">,</span>
                                        <span class="n">ax1</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">figbox</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="o">.</span><span class="mi">05</span><span class="p">,</span> <span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="o">.</span><span class="mi">025</span><span class="p">)</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb_orientation</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cb_location</span> <span class="o">=</span> <span class="p">((</span><span class="n">ax1</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">figbox</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="o">.</span><span class="mi">15</span><span class="p">,</span>
                                         <span class="n">ax1</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">figbox</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="o">.</span><span class="mi">21</span><span class="p">,</span> <span class="o">.</span><span class="mi">025</span><span class="p">,</span> <span class="o">.</span><span class="mi">3</span><span class="p">))</span>

            <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb_location</span><span class="p">)</span>

            <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span>
                                  <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span>
                                  <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                 <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                  <span class="n">orientation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb_orientation</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb_orientation</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb_orientation</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="mf">1.25</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_left</span><span class="p">()</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>

            <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Resistivity ($\Omega \cdot$m)&#39;</span><span class="p">,</span>
                         <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="n">cblabeldict</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span>
                               <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

            <span class="c1">#--&gt; save plots to a common folder</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_plots</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>

                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span>
                                         <span class="s2">&quot;Depth_</span><span class="si">{}</span><span class="s2">_</span><span class="si">{:.4f}</span><span class="s2">.png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">[</span><span class="n">ii</span><span class="p">])),</span>
                            <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span></div>

<div class="viewcode-block" id="PlotDepthSlice.redraw_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotDepthSlice.redraw_plot">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        redraw plot if parameters were changed</span>

<span class="sd">        use this function if you updated some attributes and want to re-plot.</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # change the color and marker of the xy components</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(r&quot;/home/occam2d/Data.dat&quot;)</span>
<span class="sd">            &gt;&gt;&gt; p1 = ocd.plotAllResponses()</span>
<span class="sd">            &gt;&gt;&gt; #change line width</span>
<span class="sd">            &gt;&gt;&gt; p1.lw = 2</span>
<span class="sd">            &gt;&gt;&gt; p1.redraw_plot()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_list</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotDepthSlice.update_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotDepthSlice.update_plot">[docs]</a>    <span class="k">def</span> <span class="nf">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update any parameters that where changed using the built-in draw from</span>
<span class="sd">        canvas.  </span>

<span class="sd">        Use this if you change an of the .fig or axes properties</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # to change the grid lines to only be on the major ticks</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; dfn = r&quot;/home/occam2d/Inv1/data.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(dfn)</span>
<span class="sd">            &gt;&gt;&gt; ps1 = ocd.plotAllResponses()</span>
<span class="sd">            &gt;&gt;&gt; [ax.grid(True, which=&#39;major&#39;) for ax in [ps1.axrte,ps1.axtep]]</span>
<span class="sd">            &gt;&gt;&gt; ps1.update_plot()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotDepthSlice.__str__"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotDepthSlice.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rewrite the string builtin to give a useful message</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;Plots depth slices of model from WS3DINV&quot;</span><span class="p">)</span></div></div>

<span class="c1">#==============================================================================</span>
<span class="c1"># plot phase tensors</span>
<span class="c1">#==============================================================================</span>


<div class="viewcode-block" id="PlotPTMaps"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotPTMaps">[docs]</a><span class="k">class</span> <span class="nc">PlotPTMaps</span><span class="p">(</span><span class="n">mtplottools</span><span class="o">.</span><span class="n">MTEllipse</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot phase tensor maps including residual pt if response file is input.</span>

<span class="sd">    :Plot only data for one period: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.ws3dinv as ws</span>
<span class="sd">        &gt;&gt;&gt; dfn = r&quot;/home/MT/ws3dinv/Inv1/WSDataFile.dat&quot;</span>
<span class="sd">        &gt;&gt;&gt; ptm = ws.PlotPTMaps(data_fn=dfn, plot_period_list=[0])</span>

<span class="sd">    :Plot data and model response: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.ws3dinv as ws</span>
<span class="sd">        &gt;&gt;&gt; dfn = r&quot;/home/MT/ws3dinv/Inv1/WSDataFile.dat&quot;</span>
<span class="sd">        &gt;&gt;&gt; rfn = r&quot;/home/MT/ws3dinv/Inv1/Test_resp.00&quot;</span>
<span class="sd">        &gt;&gt;&gt; mfn = r&quot;/home/MT/ws3dinv/Inv1/Test_model.00&quot;</span>
<span class="sd">        &gt;&gt;&gt; ptm = ws.PlotPTMaps(data_fn=dfn, resp_fn=rfn, model_fn=mfn,</span>
<span class="sd">        &gt;&gt;&gt; ...                 plot_period_list=[0])</span>
<span class="sd">        &gt;&gt;&gt; # adjust colorbar</span>
<span class="sd">        &gt;&gt;&gt; ptm.cb_res_pad = 1.25</span>
<span class="sd">        &gt;&gt;&gt; ptm.redraw_plot()</span>


<span class="sd">    ========================== ================================================</span>
<span class="sd">    Attributes                 Description    </span>
<span class="sd">    ========================== ================================================</span>
<span class="sd">    cb_pt_pad                  percentage from top of axes to place pt </span>
<span class="sd">                               color bar. *default* is .90</span>
<span class="sd">    cb_res_pad                 percentage from bottom of axes to place</span>
<span class="sd">                               resistivity color bar. *default* is 1.2</span>
<span class="sd">    cb_residual_tick_step      tick step for residual pt. *default* is 3</span>
<span class="sd">    cb_tick_step               tick step for phase tensor color bar, </span>
<span class="sd">                               *default* is 45</span>
<span class="sd">    data                       np.ndarray(n_station, n_periods, 2, 2)</span>
<span class="sd">                               impedance tensors for station data                     </span>
<span class="sd">    data_fn                    full path to data fle               </span>
<span class="sd">    dscale                     scaling parameter depending on map_scale</span>
<span class="sd">    ellipse_cmap               color map for pt ellipses. *default* is</span>
<span class="sd">                               mt_bl2gr2rd</span>
<span class="sd">    ellipse_colorby            [ &#39;skew&#39; | &#39;skew_seg&#39; | &#39;phimin&#39; | &#39;phimax&#39;|</span>
<span class="sd">                                 &#39;phidet&#39; | &#39;ellipticity&#39; ] parameter to color</span>
<span class="sd">                                 ellipses by. *default* is &#39;phimin&#39;</span>
<span class="sd">    ellipse_range              (min, max, step) min and max of colormap, need</span>
<span class="sd">                               to input step if plotting skew_seg</span>
<span class="sd">    ellipse_size               relative size of ellipses in map_scale</span>
<span class="sd">    ew_limits                  limits of plot in e-w direction in map_scale</span>
<span class="sd">                               units.  *default* is None, scales to station </span>
<span class="sd">                               area</span>
<span class="sd">    fig_aspect                 aspect of figure. *default* is 1</span>
<span class="sd">    fig_dpi                    resolution in dots-per-inch. *default* is 300</span>
<span class="sd">    fig_list                   list of matplotlib.figure instances for each</span>
<span class="sd">                               figure plotted.</span>
<span class="sd">    fig_size                   [width, height] in inches of figure window</span>
<span class="sd">                               *default* is [6, 6]</span>
<span class="sd">    font_size                  font size of ticklabels, axes labels are </span>
<span class="sd">                               font_size+2. *default* is 7</span>
<span class="sd">    grid_east                  relative location of grid nodes in e-w direction</span>
<span class="sd">                               in map_scale units</span>
<span class="sd">    grid_north                 relative location of grid nodes in n-s direction</span>
<span class="sd">                               in map_scale units</span>
<span class="sd">    grid_z                     relative location of grid nodes in z direction</span>
<span class="sd">                               in map_scale units</span>
<span class="sd">    initial_fn                 full path to initial file</span>
<span class="sd">    map_scale                  [ &#39;km&#39; | &#39;m&#39; ] distance units of map. </span>
<span class="sd">                               *default* is km</span>
<span class="sd">    mesh_east                  np.meshgrid(grid_east, grid_north, indexing=&#39;ij&#39;)</span>
<span class="sd">    mesh_north                 np.meshgrid(grid_east, grid_north, indexing=&#39;ij&#39;)</span>
<span class="sd">    model_fn                   full path to model file</span>
<span class="sd">    nodes_east                 relative distance betwen nodes in e-w direction</span>
<span class="sd">                               in map_scale units</span>
<span class="sd">    nodes_north                relative distance betwen nodes in n-s direction</span>
<span class="sd">                               in map_scale units</span>
<span class="sd">    nodes_z                    relative distance betwen nodes in z direction</span>
<span class="sd">                               in map_scale units</span>
<span class="sd">    ns_limits                  (min, max) limits of plot in n-s direction</span>
<span class="sd">                               *default* is None, viewing area is station area</span>
<span class="sd">    pad_east                   padding from extreme stations in east direction</span>
<span class="sd">    pad_north                  padding from extreme stations in north direction</span>
<span class="sd">    period_list                list of periods from data</span>
<span class="sd">    plot_grid                  [ &#39;y&#39; | &#39;n&#39; ] &#39;y&#39; to plot grid lines</span>
<span class="sd">                               *default* is &#39;n&#39;</span>
<span class="sd">    plot_period_list           list of period index values to plot</span>
<span class="sd">                               *default* is None </span>
<span class="sd">    plot_yn                    [&#39;y&#39; | &#39;n&#39; ] &#39;y&#39; to plot on instantiation</span>
<span class="sd">                               *default* is &#39;y&#39;</span>
<span class="sd">    res_cmap                   colormap for resisitivity values. </span>
<span class="sd">                               *default* is &#39;jet_r&#39;</span>
<span class="sd">    res_limits                 (min, max) resistivity limits in log scale</span>
<span class="sd">                               *default* is (0, 4)</span>
<span class="sd">    res_model                  np.ndarray(n_north, n_east, n_vertical) of </span>
<span class="sd">                               model resistivity values in linear scale</span>
<span class="sd">    residual_cmap              color map for pt residuals. </span>
<span class="sd">                               *default* is &#39;mt_wh2or&#39; </span>
<span class="sd">    resp                       np.ndarray(n_stations, n_periods, 2, 2)</span>
<span class="sd">                               impedance tensors for model response  </span>
<span class="sd">    resp_fn                    full path to response file</span>
<span class="sd">    save_path                  directory to save figures to</span>
<span class="sd">    save_plots                 [ &#39;y&#39; | &#39;n&#39; ] &#39;y&#39; to save plots to save_path</span>
<span class="sd">    station_east               location of stations in east direction in </span>
<span class="sd">                               map_scale units  </span>
<span class="sd">    station_fn                 full path to station locations file</span>
<span class="sd">    station_names              station names</span>
<span class="sd">    station_north              location of station in north direction in </span>
<span class="sd">                               map_scale units</span>
<span class="sd">    subplot_bottom             distance between axes and bottom of figure window</span>
<span class="sd">    subplot_left               distance between axes and left of figure window  </span>
<span class="sd">    subplot_right              distance between axes and right of figure window</span>
<span class="sd">    subplot_top                distance between axes and top of figure window</span>
<span class="sd">    title                      titiel of plot *default* is depth of slice</span>
<span class="sd">    xminorticks                location of xminorticks</span>
<span class="sd">    yminorticks                location of yminorticks</span>
<span class="sd">    ========================== ================================================</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resp_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">station_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">model_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initial_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span> <span class="n">model_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">data_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">=</span> <span class="n">station_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="o">=</span> <span class="n">resp_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="o">=</span> <span class="n">initial_fn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;save_path&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_plots</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;save_plots&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_period_list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_period_list&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_scale&#39;</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">)</span>
        <span class="c1"># make map scale</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">==</span> <span class="s1">&#39;km&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">=</span> <span class="mf">1000.</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ew_limits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ns_limits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pad_east</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;pad_east&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pad_north</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;pad_north&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_grid</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_grid&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_num&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_size&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dpi&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_aspect</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_aspect&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xminorticks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xminorticks&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yminorticks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;yminorticks&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">residual_cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;residual_cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;mt_wh2or&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;font_size&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb_tick_step</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cb_tick_step&#39;</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb_residual_tick_step</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cb_residual_tick_step&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb_pt_pad</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cb_pt_pad&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">90</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb_res_pad</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cb_res_pad&#39;</span><span class="p">,</span> <span class="mf">1.22</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res_limits&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res_cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;jet_r&#39;</span><span class="p">)</span>

        <span class="c1">#--&gt; set the ellipse properties -------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ellipse_dict</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ellipse_dict&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_ellipse_dict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span> <span class="o">=</span> <span class="o">.</span><span class="mi">99</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span> <span class="o">=</span> <span class="o">.</span><span class="mi">085</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span> <span class="o">=</span> <span class="o">.</span><span class="mi">92</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">05</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_north</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_names</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period_list</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_yn&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_pt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get phase tensors</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#--&gt; read in data file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">mtex</span><span class="o">.</span><span class="n">MTpyError_inputarguments</span><span class="p">(</span><span class="s1">&#39;Need to input a data file&#39;</span><span class="p">)</span>
        <span class="n">wsdata</span> <span class="o">=</span> <span class="n">WSData</span><span class="p">()</span>
        <span class="n">wsdata</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">,</span> <span class="n">station_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">wsdata</span><span class="o">.</span><span class="n">z_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period_list</span> <span class="o">=</span> <span class="n">wsdata</span><span class="o">.</span><span class="n">period_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="o">=</span> <span class="n">wsdata</span><span class="o">.</span><span class="n">station_east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="o">=</span> <span class="n">wsdata</span><span class="o">.</span><span class="n">station_north</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_names</span> <span class="o">=</span> <span class="n">wsdata</span><span class="o">.</span><span class="n">station_names</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_period_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_period_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_period_list</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="c1"># check if entries are index values or actual periods</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_period_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_period_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">period_list</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                                             <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_period_list</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_period_list</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_period_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_period_list</span><span class="p">]</span>

        <span class="c1">#--&gt; read model file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wsmodel</span> <span class="o">=</span> <span class="n">WSModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">res_model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_north</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">,</span>
                                                          <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">,</span>
                                                          <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>

        <span class="c1">#--&gt; read response file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wsresp</span> <span class="o">=</span> <span class="n">WSResponse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resp</span> <span class="o">=</span> <span class="n">wsresp</span><span class="o">.</span><span class="n">z_resp</span>

<div class="viewcode-block" id="PlotPTMaps.plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotPTMaps.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot phase tensor maps for data and or response, each figure is of a</span>
<span class="sd">        different period.  If response is input a third column is added which is </span>
<span class="sd">        the residual phase tensor showing where the model is not fitting the data </span>
<span class="sd">        well.  The data is plotted in km in units of ohm-m.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            data_fn = full path to data file</span>
<span class="sd">            resp_fn = full path to response file, if none just plots data</span>
<span class="sd">            sites_fn = full path to sites file</span>
<span class="sd">            periodlst = indicies of periods you want to plot</span>
<span class="sd">            esize = size of ellipses as:</span>
<span class="sd">                    0 = phase tensor ellipse</span>
<span class="sd">                    1 = phase tensor residual</span>
<span class="sd">                    2 = resistivity tensor ellipse</span>
<span class="sd">                    3 = resistivity tensor residual</span>
<span class="sd">            ecolor = &#39;phimin&#39; for coloring with phimin or &#39;beta&#39; for beta coloring</span>
<span class="sd">            colormm = list of min and max coloring for plot, list as follows:</span>
<span class="sd">                    0 = phase tensor min and max for ecolor in degrees</span>
<span class="sd">                    1 = phase tensor residual min and max [0,1]</span>
<span class="sd">                    2 = resistivity tensor coloring as resistivity on log scale</span>
<span class="sd">                    3 = resistivity tensor residual coloring as resistivity on </span>
<span class="sd">                        linear scale</span>
<span class="sd">            xpad = padding of map from stations at extremities (km)</span>
<span class="sd">            units = &#39;mv&#39; to convert to Ohm-m </span>
<span class="sd">            dpi = dots per inch of figure</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_get_pt</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.left&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.right&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.top&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span>

        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span><span class="p">,</span>
                               <span class="n">wspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span><span class="p">)</span>

        <span class="n">font_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">}</span>
        <span class="n">n_stations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># set some local parameters</span>
        <span class="n">ckmin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipse_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ckmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipse_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ckstep</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipse_range</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_cmap</span> <span class="o">==</span> <span class="s1">&#39;mt_seg_bl2wh2rd&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Need to input range as (min, max, step)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ckstep</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">nseg</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="n">ckmax</span> <span class="o">-</span> <span class="n">ckmin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ckstep</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_east</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">-</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">pad_east</span><span class="p">,</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_east</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">+</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">pad_east</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_north</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">-</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">pad_north</span><span class="p">,</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_north</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">+</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">pad_north</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">ff</span><span class="p">,</span> <span class="n">per</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_period_list</span><span class="p">):</span>
            <span class="nb">print</span> <span class="s1">&#39;Plotting Period: </span><span class="si">{0:.5g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">per</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:.5g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">per</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span><span class="p">,</span>
                             <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">axd</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
                <span class="n">axm</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
                <span class="n">axr</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
                <span class="n">ax_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axd</span><span class="p">,</span> <span class="n">axm</span><span class="p">,</span> <span class="n">axr</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">axd</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
                <span class="n">ax_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axd</span><span class="p">]</span>

            <span class="c1"># plot model below the phase tensors</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">approx_depth</span><span class="p">,</span> <span class="n">d_index</span> <span class="o">=</span> <span class="n">estimate_skin_depth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">,</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">,</span>
                                                            <span class="n">per</span><span class="p">,</span>
                                                            <span class="n">dscale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">ax_list</span><span class="p">:</span>
                    <span class="n">plot_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">d_index</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_east</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">mesh_north</span><span class="p">,</span>
                                  <span class="n">plot_res</span><span class="p">,</span>
                                  <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span><span class="p">,</span>
                                  <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1">#--&gt; get phase tensors</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="n">mtpt</span><span class="o">.</span><span class="n">PhaseTensor</span><span class="p">(</span><span class="n">z_array</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">ff</span><span class="p">],</span>
                                  <span class="n">freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">per</span><span class="p">,</span> <span class="n">n_stations</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mpt</span> <span class="o">=</span> <span class="n">mtpt</span><span class="o">.</span><span class="n">PhaseTensor</span><span class="p">(</span><span class="n">z_array</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resp</span><span class="p">[:,</span> <span class="n">ff</span><span class="p">],</span>
                                       <span class="n">freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">per</span><span class="p">,</span> <span class="n">n_stations</span><span class="p">))</span>
                <span class="n">rpt</span> <span class="o">=</span> <span class="n">mtpt</span><span class="o">.</span><span class="n">ResidualPhaseTensor</span><span class="p">(</span><span class="n">pt_object1</span><span class="o">=</span><span class="n">pt</span><span class="p">,</span> <span class="n">pt_object2</span><span class="o">=</span><span class="n">mpt</span><span class="p">)</span>
                <span class="n">rpt</span> <span class="o">=</span> <span class="n">rpt</span><span class="o">.</span><span class="n">residual_pt</span>
                <span class="n">rcarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">rpt</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">rpt</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">rcmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">rcarray</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
                <span class="n">rcmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">rcarray</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

            <span class="c1">#--&gt; get color array</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_cmap</span> <span class="o">==</span> <span class="s1">&#39;mt_seg_bl2wh2rd&#39;</span><span class="p">:</span>
                <span class="n">bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ckmin</span><span class="p">,</span> <span class="n">ckmax</span> <span class="o">+</span> <span class="n">ckstep</span><span class="p">,</span> <span class="n">ckstep</span><span class="p">)</span>
                <span class="n">nseg</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="n">ckmax</span> <span class="o">-</span> <span class="n">ckmin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ckstep</span><span class="p">))</span>

            <span class="c1"># get the properties to color the ellipses by</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_colorby</span> <span class="o">==</span> <span class="s1">&#39;phiminang&#39;</span> <span class="ow">or</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_colorby</span> <span class="o">==</span> <span class="s1">&#39;phimin&#39;</span><span class="p">:</span>
                <span class="n">colorarray</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">mcarray</span> <span class="o">=</span> <span class="n">mpt</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_colorby</span> <span class="o">==</span> <span class="s1">&#39;phidet&#39;</span><span class="p">:</span>
                <span class="n">colorarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">det</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">mcarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">mpt</span><span class="o">.</span><span class="n">det</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_colorby</span> <span class="o">==</span> <span class="s1">&#39;skew&#39;</span> <span class="ow">or</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_colorby</span> <span class="o">==</span> <span class="s1">&#39;skew_seg&#39;</span><span class="p">:</span>
                <span class="n">colorarray</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">mcarray</span> <span class="o">=</span> <span class="n">mpt</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_colorby</span> <span class="o">==</span> <span class="s1">&#39;ellipticity&#39;</span><span class="p">:</span>
                <span class="n">colorarray</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">ellipticity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">mcarray</span> <span class="o">=</span> <span class="n">mpt</span><span class="o">.</span><span class="n">ellipticity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipse_colorby</span> <span class="o">+</span> <span class="s1">&#39; is not supported&#39;</span><span class="p">)</span>

            <span class="c1">#--&gt; plot phase tensor ellipses for each stations</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_stations</span><span class="p">):</span>
                <span class="c1">#-----------plot data phase tensors---------------</span>
                <span class="n">eheight</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span> <span class="o">/</span> \
                    <span class="n">pt</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_size</span>
                <span class="n">ewidth</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span> <span class="o">/</span> \
                    <span class="n">pt</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_size</span>

                <span class="n">ellipse</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">station_east</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span><span class="p">[</span><span class="n">jj</span><span class="p">]),</span>
                                  <span class="n">width</span><span class="o">=</span><span class="n">ewidth</span><span class="p">,</span>
                                  <span class="n">height</span><span class="o">=</span><span class="n">eheight</span><span class="p">,</span>
                                  <span class="n">angle</span><span class="o">=</span><span class="mi">90</span> <span class="o">-</span> <span class="n">pt</span><span class="o">.</span><span class="n">azimuth</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">jj</span><span class="p">])</span>

                <span class="c1"># get ellipse color</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_cmap</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;seg&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ellipse</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">mtcl</span><span class="o">.</span><span class="n">get_plot_color</span><span class="p">(</span><span class="n">colorarray</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span>
                                                              <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_colorby</span><span class="p">,</span>
                                                              <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_cmap</span><span class="p">,</span>
                                                              <span class="n">ckmin</span><span class="p">,</span>
                                                              <span class="n">ckmax</span><span class="p">,</span>
                                                              <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ellipse</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">mtcl</span><span class="o">.</span><span class="n">get_plot_color</span><span class="p">(</span><span class="n">colorarray</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span>
                                                              <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_colorby</span><span class="p">,</span>
                                                              <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_cmap</span><span class="p">,</span>
                                                              <span class="n">ckmin</span><span class="p">,</span>
                                                              <span class="n">ckmax</span><span class="p">))</span>

                <span class="n">axd</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1">#-----------plot response phase tensors---------------</span>
                    <span class="n">eheight</span> <span class="o">=</span> <span class="n">mpt</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span> <span class="o">/</span> <span class="n">mpt</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span>\
                        <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_size</span>
                    <span class="n">ewidth</span> <span class="o">=</span> <span class="n">mpt</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span> <span class="o">/</span> <span class="n">mpt</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span>\
                        <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_size</span>

                    <span class="n">ellipsem</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">station_east</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span><span class="p">[</span><span class="n">jj</span><span class="p">]),</span>
                                       <span class="n">width</span><span class="o">=</span><span class="n">ewidth</span><span class="p">,</span>
                                       <span class="n">height</span><span class="o">=</span><span class="n">eheight</span><span class="p">,</span>
                                       <span class="n">angle</span><span class="o">=</span><span class="mi">90</span> <span class="o">-</span> <span class="n">mpt</span><span class="o">.</span><span class="n">azimuth</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">jj</span><span class="p">])</span>

                    <span class="c1"># get ellipse color</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_cmap</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;seg&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">ellipsem</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">mtcl</span><span class="o">.</span><span class="n">get_plot_color</span><span class="p">(</span><span class="n">mcarray</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span>
                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_colorby</span><span class="p">,</span>
                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_cmap</span><span class="p">,</span>
                                                                   <span class="n">ckmin</span><span class="p">,</span>
                                                                   <span class="n">ckmax</span><span class="p">,</span>
                                                                   <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ellipsem</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">mtcl</span><span class="o">.</span><span class="n">get_plot_color</span><span class="p">(</span><span class="n">mcarray</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span>
                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_colorby</span><span class="p">,</span>
                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_cmap</span><span class="p">,</span>
                                                                   <span class="n">ckmin</span><span class="p">,</span>
                                                                   <span class="n">ckmax</span><span class="p">))</span>

                    <span class="n">axm</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">ellipsem</span><span class="p">)</span>
                    <span class="c1">#-----------plot residual phase tensors---------------</span>
                    <span class="n">eheight</span> <span class="o">=</span> <span class="n">rpt</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span> <span class="o">/</span> <span class="n">rpt</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span>\
                        <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_size</span>
                    <span class="n">ewidth</span> <span class="o">=</span> <span class="n">rpt</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span> <span class="o">/</span> <span class="n">rpt</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span>\
                        <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_size</span>

                    <span class="n">ellipser</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">station_east</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span><span class="p">[</span><span class="n">jj</span><span class="p">]),</span>
                                       <span class="n">width</span><span class="o">=</span><span class="n">ewidth</span><span class="p">,</span>
                                       <span class="n">height</span><span class="o">=</span><span class="n">eheight</span><span class="p">,</span>
                                       <span class="n">angle</span><span class="o">=</span><span class="n">rpt</span><span class="o">.</span><span class="n">azimuth</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">jj</span><span class="p">])</span>

                    <span class="c1"># get ellipse color</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_cmap</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;seg&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">ellipser</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">mtcl</span><span class="o">.</span><span class="n">get_plot_color</span><span class="p">(</span><span class="n">rcarray</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span>
                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_colorby</span><span class="p">,</span>
                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">residual_cmap</span><span class="p">,</span>
                                                                   <span class="n">rcmin</span><span class="p">,</span>
                                                                   <span class="n">rcmax</span><span class="p">,</span>
                                                                   <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ellipser</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">mtcl</span><span class="o">.</span><span class="n">get_plot_color</span><span class="p">(</span><span class="n">rcarray</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span>
                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_colorby</span><span class="p">,</span>
                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">residual_cmap</span><span class="p">,</span>
                                                                   <span class="n">rcmin</span><span class="p">,</span>
                                                                   <span class="n">rcmax</span><span class="p">))</span>

                    <span class="n">axr</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">ellipser</span><span class="p">)</span>

            <span class="c1">#--&gt; set axes properties</span>
            <span class="c1"># data</span>
            <span class="n">axd</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span><span class="p">)</span>
            <span class="n">axd</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span><span class="p">)</span>
            <span class="n">axd</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Easting (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span><span class="p">),</span>
                           <span class="n">fontdict</span><span class="o">=</span><span class="n">font_dict</span><span class="p">)</span>
            <span class="n">axd</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Northing (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span><span class="p">),</span>
                           <span class="n">fontdict</span><span class="o">=</span><span class="n">font_dict</span><span class="p">)</span>
            <span class="c1"># make a colorbar for phase tensors</span>
            <span class="c1">#bb = axd.axes.get_position().bounds</span>
            <span class="n">bb</span> <span class="o">=</span> <span class="n">axd</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="o">.</span><span class="mi">25</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">cb_location</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.35</span> <span class="o">*</span> <span class="n">bb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">y1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb_pt_pad</span><span class="p">,</span> <span class="o">.</span><span class="mi">295</span> <span class="o">*</span> <span class="n">bb</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">.</span><span class="mi">02</span><span class="p">)</span>
            <span class="n">cbaxd</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">cb_location</span><span class="p">)</span>
            <span class="n">cbd</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbaxd</span><span class="p">,</span>
                                   <span class="n">cmap</span><span class="o">=</span><span class="n">mtcl</span><span class="o">.</span><span class="n">cmapdict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipse_cmap</span><span class="p">],</span>
                                   <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">ckmin</span><span class="p">,</span>
                                                  <span class="n">vmax</span><span class="o">=</span><span class="n">ckmax</span><span class="p">),</span>
                                   <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
            <span class="n">cbd</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
            <span class="n">cbd</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">)</span>
            <span class="n">cbd</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">mtplottools</span><span class="o">.</span><span class="n">ckdict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipse_colorby</span><span class="p">])</span>
            <span class="n">cbd</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ckmin</span><span class="p">,</span> <span class="n">ckmax</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb_tick_step</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">cb_tick_step</span><span class="p">))</span>

            <span class="n">axd</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span>
                     <span class="s1">&#39;Data&#39;</span><span class="p">,</span>
                     <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                     <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
                     <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">},</span>
                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>

            <span class="c1">#Model and residual</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">axm</span><span class="p">,</span> <span class="n">axr</span><span class="p">]):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Easting (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span><span class="p">),</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="n">font_dict</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="c1"># make a colorbar ontop of axis</span>
                    <span class="n">bb</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span>
                    <span class="n">y1</span> <span class="o">=</span> <span class="o">.</span><span class="mi">25</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">cb_location</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.35</span> <span class="o">*</span> <span class="n">bb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">y1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb_pt_pad</span><span class="p">,</span> <span class="o">.</span><span class="mi">295</span> <span class="o">*</span> <span class="n">bb</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">.</span><span class="mi">02</span><span class="p">)</span>
                    <span class="n">cbax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">cb_location</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">aa</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbax</span><span class="p">,</span>
                                              <span class="n">cmap</span><span class="o">=</span><span class="n">mtcl</span><span class="o">.</span><span class="n">cmapdict</span><span class="p">[</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">ellipse_cmap</span><span class="p">],</span>
                                              <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">ckmin</span><span class="p">,</span>
                                                             <span class="n">vmax</span><span class="o">=</span><span class="n">ckmax</span><span class="p">),</span>
                                              <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">)</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">mtplottools</span><span class="o">.</span><span class="n">ckdict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ellipse_colorby</span><span class="p">])</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ckmin</span><span class="p">,</span> <span class="n">ckmax</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb_tick_step</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">cb_tick_step</span><span class="p">))</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span>
                                <span class="s1">&#39;Model&#39;</span><span class="p">,</span>
                                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
                                <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">},</span>
                                <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbax</span><span class="p">,</span>
                                              <span class="n">cmap</span><span class="o">=</span><span class="n">mtcl</span><span class="o">.</span><span class="n">cmapdict</span><span class="p">[</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">residual_cmap</span><span class="p">],</span>
                                              <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">rcmin</span><span class="p">,</span>
                                                             <span class="n">vmax</span><span class="o">=</span><span class="n">rcmax</span><span class="p">),</span>
                                              <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">)</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">r&quot;$\sqrt{\Phi_</span><span class="si">{min}</span><span class="s2"> \Phi_</span><span class="si">{max}</span><span class="s2">}$&quot;</span><span class="p">)</span>
                        <span class="n">cb_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rcmin</span><span class="p">,</span>
                                             <span class="n">rcmax</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb_residual_tick_step</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">cb_residual_tick_step</span><span class="p">)</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">cb_ticks</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span>
                                <span class="s1">&#39;Residual&#39;</span><span class="p">,</span>
                                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
                                <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">},</span>
                                <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">ax_list</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">)</span>
                    <span class="n">bb</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span>
                    <span class="n">y1</span> <span class="o">=</span> <span class="o">.</span><span class="mi">25</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">cb_position</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">bb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">y1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb_res_pad</span><span class="p">,</span> <span class="o">.</span><span class="mi">35</span> <span class="o">*</span> <span class="n">bb</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">.</span><span class="mi">02</span><span class="p">)</span>
                    <span class="n">cbax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">cb_position</span><span class="p">)</span>
                    <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbax</span><span class="p">,</span>
                                          <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span><span class="p">,</span>
                                          <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                         <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                          <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Resistivity ($\Omega \cdot$m)&#39;</span><span class="p">)</span>
                    <span class="n">cb_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                         <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">cb_ticks</span><span class="p">)</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="n">mtplottools</span><span class="o">.</span><span class="n">labeldict</span><span class="p">[</span><span class="n">ctk</span><span class="p">]</span>
                                       <span class="k">for</span> <span class="n">ctk</span> <span class="ow">in</span> <span class="n">cb_ticks</span><span class="p">])</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>

<div class="viewcode-block" id="PlotPTMaps.redraw_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotPTMaps.redraw_plot">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        redraw plot if parameters were changed</span>

<span class="sd">        use this function if you updated some attributes and want to re-plot.</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # change the color and marker of the xy components</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(r&quot;/home/occam2d/Data.dat&quot;)</span>
<span class="sd">            &gt;&gt;&gt; p1 = ocd.plotAllResponses()</span>
<span class="sd">            &gt;&gt;&gt; #change line width</span>
<span class="sd">            &gt;&gt;&gt; p1.lw = 2</span>
<span class="sd">            &gt;&gt;&gt; p1.redraw_plot()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_list</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotPTMaps.save_figure"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotPTMaps.save_figure">[docs]</a>    <span class="k">def</span> <span class="nf">save_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig_dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span>
                    <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;landscape&#39;</span><span class="p">,</span> <span class="n">close_fig</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save_figure will save the figure to save_fn.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>

<span class="sd">            **save_fn** : string</span>
<span class="sd">                          full path to save figure to, can be input as</span>
<span class="sd">                          * directory path -&gt; the directory path to save to</span>
<span class="sd">                            in which the file will be saved as </span>
<span class="sd">                            save_fn/station_name_PhaseTensor.file_format</span>

<span class="sd">                          * full path -&gt; file will be save to the given </span>
<span class="sd">                            path.  If you use this option then the format</span>
<span class="sd">                            will be assumed to be provided by the path</span>

<span class="sd">            **file_format** : [ pdf | eps | jpg | png | svg ]</span>
<span class="sd">                              file type of saved figure pdf,svg,eps... </span>

<span class="sd">            **orientation** : [ landscape | portrait ]</span>
<span class="sd">                              orientation in which the file will be saved</span>
<span class="sd">                              *default* is portrait</span>

<span class="sd">            **fig_dpi** : int</span>
<span class="sd">                          The resolution in dots-per-inch the file will be</span>
<span class="sd">                          saved.  If None then the dpi will be that at </span>
<span class="sd">                          which the figure was made.  I don&#39;t think that </span>
<span class="sd">                          it can be larger than dpi of the figure.</span>

<span class="sd">            **close_plot** : [ y | n ]</span>
<span class="sd">                             * &#39;y&#39; will close the plot after saving.</span>
<span class="sd">                             * &#39;n&#39; will leave plot open</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # to save plot as jpg</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; dfn = r&quot;/home/occam2d/Inv1/data.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(dfn)</span>
<span class="sd">            &gt;&gt;&gt; ps1 = ocd.plotPseudoSection()</span>
<span class="sd">            &gt;&gt;&gt; ps1.save_plot(r&#39;/home/MT/figures&#39;, file_format=&#39;jpg&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">fig_dpi</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_dpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Need to input a correct directory path&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_list</span><span class="p">:</span>
            <span class="n">per</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_window_title</span><span class="p">()</span>
            <span class="n">save_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s1">&#39;PT_DepthSlice_</span><span class="si">{0}</span><span class="s1">s.</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">per</span><span class="p">,</span> <span class="n">file_format</span><span class="p">))</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                        <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">close_fig</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span> <span class="o">=</span> <span class="n">save_fn</span>
            <span class="nb">print</span> <span class="s1">&#39;Saved figure to: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span></div></div>

<span class="c1">#==============================================================================</span>
<span class="c1"># ESTIMATE SKIN DEPTH FOR MODEL</span>
<span class="c1">#==============================================================================</span>


<div class="viewcode-block" id="estimate_skin_depth"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.estimate_skin_depth">[docs]</a><span class="k">def</span> <span class="nf">estimate_skin_depth</span><span class="p">(</span><span class="n">res_model</span><span class="p">,</span> <span class="n">grid_z</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">dscale</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    estimate the skin depth from the resistivity model assuming that</span>

<span class="sd">        delta_skin ~ 500 * sqrt(rho_a*T)</span>

<span class="sd">    Arguments:</span>
<span class="sd">    -----------</span>
<span class="sd">        **resmodel** : np.ndarray (n_north, n_east, n_z)</span>
<span class="sd">                       array of resistivity values for model grid</span>

<span class="sd">        **grid_z** : np.ndarray (n_z)</span>
<span class="sd">                     array of depth layers in m or km, be sure to change</span>
<span class="sd">                     dscale accordingly</span>

<span class="sd">        **period** : float</span>
<span class="sd">                     period in seconds to estimate a skin depth for</span>

<span class="sd">        **dscale** : [1000 | 1]</span>
<span class="sd">                     scaling value to scale depth estimation to meters (1) or</span>
<span class="sd">                     kilometers (1000)</span>

<span class="sd">    Outputs:</span>
<span class="sd">    ---------</span>
<span class="sd">        **depth** : float</span>
<span class="sd">                    estimated skin depth in units according to dscale</span>

<span class="sd">        **depth_index** : int</span>
<span class="sd">                          index value of grid_z that corresponds to the </span>
<span class="sd">                          estimated skin depth.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dscale</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="s1">&#39;km&#39;</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span>
    <span class="k">if</span> <span class="n">dscale</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="mf">500.</span>
    <span class="c1"># find the apparent resisitivity of each depth slice within the station</span>
    <span class="c1"># area</span>
    <span class="n">apparent_res_xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">res_model</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>

    <span class="c1"># calculate the period for each skin depth</span>
    <span class="n">skin_depth_period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">zz</span> <span class="o">/</span> <span class="n">ds</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">rho_a</span><span class="p">)</span>
                                  <span class="k">for</span> <span class="n">zz</span><span class="p">,</span> <span class="n">rho_a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">grid_z</span><span class="p">,</span> <span class="n">apparent_res_xy</span><span class="p">)])</span>

    <span class="c1"># match the period</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">period_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">skin_depth_period</span> <span class="o">&gt;=</span> <span class="n">period</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="n">period_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">skin_depth_period</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># get the depth slice</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="n">grid_z</span><span class="p">[</span><span class="n">period_index</span><span class="p">]</span>

    <span class="nb">print</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">60</span>
    <span class="nb">print</span> <span class="s1">&#39; input period                   </span><span class="si">{0:.6g}</span><span class="s1"> (s)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s1">&#39; estimated skin depth period    </span><span class="si">{0:.6g}</span><span class="s1"> (s)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">skin_depth_period</span><span class="p">[</span><span class="n">period_index</span><span class="p">])</span>
    <span class="nb">print</span> <span class="s1">&#39; estimate apparent resisitivity </span><span class="si">{0:.0f}</span><span class="s1"> (Ohm-m)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">apparent_res_xy</span><span class="p">[</span><span class="n">period_index</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="nb">print</span> <span class="s1">&#39; estimated depth                </span><span class="si">{0:.6g}</span><span class="s1"> (</span><span class="si">{1}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">ms</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s1">&#39; index                          </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period_index</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">60</span>

    <span class="k">return</span> <span class="n">depth</span><span class="p">,</span> <span class="n">period_index</span></div>


<span class="c1">#==============================================================================</span>
<span class="c1"># plot slices</span>
<span class="c1">#==============================================================================</span>
<div class="viewcode-block" id="PlotSlices"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotSlices">[docs]</a><span class="k">class</span> <span class="nc">PlotSlices</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plot all slices and be able to scroll through the model</span>

<span class="sd">    :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.ws3dinv as ws</span>
<span class="sd">        &gt;&gt;&gt; mfn = r&quot;/home/MT/ws3dinv/Inv1/Test_model.00&quot;</span>
<span class="sd">        &gt;&gt;&gt; sfn = r&quot;/home/MT/ws3dinv/Inv1/WSStationLocations.txt&quot;</span>
<span class="sd">        &gt;&gt;&gt; # plot just first layer to check the formating        </span>
<span class="sd">        &gt;&gt;&gt; pds = ws.PlotSlices(model_fn=mfn, station_fn=sfn)</span>

<span class="sd">    ======================= ===================================================</span>
<span class="sd">    Buttons                  Description    </span>
<span class="sd">    ======================= ===================================================</span>
<span class="sd">    &#39;e&#39;                     moves n-s slice east by one model block</span>
<span class="sd">    &#39;w&#39;                     moves n-s slice west by one model block</span>
<span class="sd">    &#39;n&#39;                     moves e-w slice north by one model block</span>
<span class="sd">    &#39;m&#39;                     moves e-w slice south by one model block</span>
<span class="sd">    &#39;d&#39;                     moves depth slice down by one model block</span>
<span class="sd">    &#39;u&#39;                     moves depth slice up by one model block</span>
<span class="sd">    ======================= ===================================================</span>


<span class="sd">    ======================= ===================================================</span>
<span class="sd">    Attributes              Description    </span>
<span class="sd">    ======================= ===================================================</span>
<span class="sd">    ax_en                   matplotlib.axes instance for depth slice  map view </span>
<span class="sd">    ax_ez                   matplotlib.axes instance for e-w slice</span>
<span class="sd">    ax_map                  matplotlib.axes instance for location map</span>
<span class="sd">    ax_nz                   matplotlib.axes instance for n-s slice</span>
<span class="sd">    climits                 (min , max) color limits on resistivity in log </span>
<span class="sd">                            scale. *default* is (0, 4)</span>
<span class="sd">    cmap                    name of color map for resisitiviy.</span>
<span class="sd">                            *default* is &#39;jet_r&#39;</span>
<span class="sd">    data_fn                 full path to data file name</span>
<span class="sd">    dscale                  scaling parameter depending on map_scale</span>
<span class="sd">    east_line_xlist         list of line nodes of east grid for faster plotting</span>
<span class="sd">    east_line_ylist         list of line nodes of east grid for faster plotting</span>
<span class="sd">    ew_limits               (min, max) limits of e-w in map_scale units</span>
<span class="sd">                            *default* is None and scales to station area</span>
<span class="sd">    fig                     matplotlib.figure instance for figure</span>
<span class="sd">    fig_aspect              aspect ratio of plots. *default* is 1</span>
<span class="sd">    fig_dpi                 resolution of figure in dots-per-inch</span>
<span class="sd">                            *default* is 300</span>
<span class="sd">    fig_num                 figure instance number</span>
<span class="sd">    fig_size                [width, height] of figure window. </span>
<span class="sd">                            *default* is [6,6]</span>
<span class="sd">    font_dict               dictionary of font keywords, internally created</span>
<span class="sd">    font_size               size of ticklables in points, axes labes are </span>
<span class="sd">                            font_size+2. *default* is 7</span>
<span class="sd">    grid_east               relative location of grid nodes in e-w direction</span>
<span class="sd">                            in map_scale units</span>
<span class="sd">    grid_north              relative location of grid nodes in n-s direction</span>
<span class="sd">                            in map_scale units</span>
<span class="sd">    grid_z                  relative location of grid nodes in z direction</span>
<span class="sd">                            in map_scale units</span>
<span class="sd">    index_east              index value of grid_east being plotted</span>
<span class="sd">    index_north             index value of grid_north being plotted</span>
<span class="sd">    index_vertical          index value of grid_z being plotted</span>
<span class="sd">    initial_fn              full path to initial file</span>
<span class="sd">    key_press               matplotlib.canvas.connect instance</span>
<span class="sd">    map_scale               [ &#39;m&#39; | &#39;km&#39; ] scale of map. *default* is km</span>
<span class="sd">    mesh_east               np.meshgrid(grid_east, grid_north)[0]</span>
<span class="sd">    mesh_en_east            np.meshgrid(grid_east, grid_north)[0]</span>
<span class="sd">    mesh_en_north           np.meshgrid(grid_east, grid_north)[1]</span>
<span class="sd">    mesh_ez_east            np.meshgrid(grid_east, grid_z)[0]</span>
<span class="sd">    mesh_ez_vertical        np.meshgrid(grid_east, grid_z)[1]</span>
<span class="sd">    mesh_north              np.meshgrid(grid_east, grid_north)[1]</span>
<span class="sd">    mesh_nz_north           np.meshgrid(grid_north, grid_z)[0]</span>
<span class="sd">    mesh_nz_vertical        np.meshgrid(grid_north, grid_z)[1]</span>
<span class="sd">    model_fn                full path to model file</span>
<span class="sd">    ms                      size of station markers in points. *default* is 2</span>
<span class="sd">    nodes_east              relative distance betwen nodes in e-w direction</span>
<span class="sd">                            in map_scale units</span>
<span class="sd">    nodes_north             relative distance betwen nodes in n-s direction</span>
<span class="sd">                            in map_scale units</span>
<span class="sd">    nodes_z                 relative distance betwen nodes in z direction</span>
<span class="sd">                            in map_scale units</span>
<span class="sd">    north_line_xlist        list of line nodes north grid for faster plotting  </span>
<span class="sd">    north_line_ylist        list of line nodes north grid for faster plotting</span>
<span class="sd">    ns_limits               (min, max) limits of plots in n-s direction</span>
<span class="sd">                            *default* is None, set veiwing area to station area </span>
<span class="sd">    plot_yn                 [ &#39;y&#39; | &#39;n&#39; ] &#39;y&#39; to plot on instantiation</span>
<span class="sd">                            *default* is &#39;y&#39;</span>
<span class="sd">    res_model               np.ndarray(n_north, n_east, n_vertical) of </span>
<span class="sd">                            model resistivity values in linear scale           </span>
<span class="sd">    station_color           color of station marker. *default* is black</span>
<span class="sd">    station_dict_east       location of stations for each east grid row</span>
<span class="sd">    station_dict_north      location of stations for each north grid row</span>
<span class="sd">    station_east            location of stations in east direction</span>
<span class="sd">    station_fn              full path to station file </span>
<span class="sd">    station_font_color      color of station label </span>
<span class="sd">    station_font_pad        padding between station marker and label</span>
<span class="sd">    station_font_rotation   angle of station label</span>
<span class="sd">    station_font_size       font size of station label</span>
<span class="sd">    station_font_weight     weight of font for station label</span>
<span class="sd">    station_id              [min, max] index values for station labels</span>
<span class="sd">    station_marker          station marker</span>
<span class="sd">    station_names           name of stations</span>
<span class="sd">    station_north           location of stations in north direction</span>
<span class="sd">    subplot_bottom          distance between axes and bottom of figure window</span>
<span class="sd">    subplot_hspace          distance between subplots in vertical direction</span>
<span class="sd">    subplot_left            distance between axes and left of figure window  </span>
<span class="sd">    subplot_right           distance between axes and right of figure window</span>
<span class="sd">    subplot_top             distance between axes and top of figure window</span>
<span class="sd">    subplot_wspace          distance between subplots in horizontal direction</span>
<span class="sd">    title                   title of plot </span>
<span class="sd">    z_limits                (min, max) limits in vertical direction,</span>
<span class="sd">    ======================= ===================================================</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_fn</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">station_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">initial_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span> <span class="n">model_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">data_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="o">=</span> <span class="n">station_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="o">=</span> <span class="n">initial_fn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_num&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_size&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dpi&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_aspect</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_aspect&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;font_size&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">30</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span> <span class="o">=</span> <span class="o">.</span><span class="mi">98</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span> <span class="o">=</span> <span class="o">.</span><span class="mi">08</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span> <span class="o">=</span> <span class="o">.</span><span class="mi">97</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">index_vertical</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;index_vertical&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_east</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;index_east&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_north</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;index_north&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;jet_r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">climits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;climits&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_scale&#39;</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">)</span>
        <span class="c1"># make map scale</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">==</span> <span class="s1">&#39;km&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">=</span> <span class="mf">1000.</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ew_limits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ns_limits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;z_limits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_north</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_names</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">station_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_font_size&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_font_pad</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_font_pad&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_font_weight</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_font_weight&#39;</span><span class="p">,</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_font_rotation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_font_rotation&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_font_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_font_color&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_marker</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_marker&#39;</span><span class="p">,</span>
                                         <span class="s2">r&quot;$\blacktriangledown$&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_color&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_yn&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<div class="viewcode-block" id="PlotSlices.read_files"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotSlices.read_files">[docs]</a>    <span class="k">def</span> <span class="nf">read_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read in the files to get appropriate information</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#--&gt; read in model file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">wsmodel</span> <span class="o">=</span> <span class="n">WSModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">res_model</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">nodes_east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">nodes_north</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span> <span class="o">=</span> <span class="n">wsmodel</span><span class="o">.</span><span class="n">nodes_z</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">mtex</span><span class="o">.</span><span class="n">MTpyError_file_handling</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> does not exist, check path&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">))</span>

        <span class="c1">#--&gt; read in data file to get station locations</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">wsdata</span> <span class="o">=</span> <span class="n">WSData</span><span class="p">()</span>
                <span class="n">wsdata</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="o">=</span> <span class="n">wsdata</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;east&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="o">=</span> <span class="n">wsdata</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_names</span> <span class="o">=</span> <span class="n">wsdata</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;Could not find data file </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>

        <span class="c1">#--&gt; read in station file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">wsstations</span> <span class="o">=</span> <span class="n">WSStation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span><span class="p">)</span>
                <span class="n">wsstations</span><span class="o">.</span><span class="n">read_station_file</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="o">=</span> <span class="n">wsstations</span><span class="o">.</span><span class="n">east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="o">=</span> <span class="n">wsstations</span><span class="o">.</span><span class="n">north</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_names</span> <span class="o">=</span> <span class="n">wsstations</span><span class="o">.</span><span class="n">names</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;Could not find station file </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_fn</span><span class="p">)</span>

        <span class="c1">#--&gt; read in initial file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">wsmesh</span> <span class="o">=</span> <span class="n">WSMesh</span><span class="p">()</span>
                <span class="n">wsmesh</span><span class="o">.</span><span class="n">read_initial_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">=</span> <span class="n">wsmesh</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">=</span> <span class="n">wsmesh</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="n">wsmesh</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_east</span> <span class="o">=</span> <span class="n">wsmesh</span><span class="o">.</span><span class="n">nodes_east</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_north</span> <span class="o">=</span> <span class="n">wsmesh</span><span class="o">.</span><span class="n">nodes_north</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes_z</span> <span class="o">=</span> <span class="n">wsmesh</span><span class="o">.</span><span class="n">nodes_z</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span>

                <span class="c1"># need to convert index values to resistivity values</span>
                <span class="n">rdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">ii</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
                              <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wsmesh</span><span class="o">.</span><span class="n">res_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>

                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wsmesh</span><span class="o">.</span><span class="n">res_list</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wsmesh</span><span class="o">.</span><span class="n">res_model</span> <span class="o">==</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> \
                        <span class="n">rdict</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">mtex</span><span class="o">.</span><span class="n">MTpyError_file_handling</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> does not exist, check path&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">mtex</span><span class="o">.</span><span class="n">MTpyError_inputarguments</span><span class="p">(</span><span class="s1">&#39;Need to input either a model&#39;</span>
                                                <span class="s1">&#39; file or initial file.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PlotSlices.plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotSlices.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot:</span>
<span class="sd">            east vs. vertical,</span>
<span class="sd">            north vs. vertical,</span>
<span class="sd">            east vs. north</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_files</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_station_grid_locations</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">font_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">}</span>
        <span class="c1"># set the limits of the plot</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_east</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_east</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_north</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_north</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_limits</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z_limits</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">5000</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dscale</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span><span class="p">,</span>
                              <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                               <span class="n">wspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span><span class="p">,</span>
                               <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span><span class="p">,</span>
                               <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span><span class="p">,</span>
                               <span class="n">bottom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span><span class="p">,</span>
                               <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span><span class="p">,</span>
                               <span class="n">hspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span><span class="p">)</span>

        <span class="c1"># make subplots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_ez</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_aspect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_nz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_aspect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_en</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_aspect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="c1"># make grid meshes being sure the indexing is correct</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_ez_east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_ez_vertical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">,</span>
                                                               <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">,</span>
                                                               <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_nz_north</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_nz_vertical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">,</span>
                                                                <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">,</span>
                                                                <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_en_east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_en_north</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">,</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">,</span>
                                                            <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>

        <span class="c1">#--&gt; plot east vs vertical</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_ax_ez</span><span class="p">()</span>

        <span class="c1">#--&gt; plot north vs vertical</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_ax_nz</span><span class="p">()</span>

        <span class="c1">#--&gt; plot east vs north</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_ax_en</span><span class="p">()</span>

        <span class="c1">#--&gt; plot the grid as a map view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_map</span><span class="p">()</span>

        <span class="c1"># plot color bar</span>
        <span class="n">cbx</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">make_axes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_map</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=.</span><span class="mi">75</span><span class="p">,</span> <span class="n">pad</span><span class="o">=.</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span>
                              <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                             <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="mf">1.25</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_left</span><span class="p">()</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>

        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Resistivity ($\Omega \cdot$m)&#39;</span><span class="p">,</span>
                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>

        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                               <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="n">cblabeldict</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;$10^{-3}$&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;$10^{-1}$&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{0}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">,</span>
                       <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{3}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{4}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{5}</span><span class="s1">$&#39;</span><span class="p">,</span>
                       <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{6}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{7}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="s1">&#39;$10^</span><span class="si">{8}</span><span class="s1">$&#39;</span><span class="p">}</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="n">cblabeldict</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span>
                           <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                               <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))])</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">key_press</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">on_key_press</span><span class="p">)</span></div>

<div class="viewcode-block" id="PlotSlices.on_key_press"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotSlices.on_key_press">[docs]</a>    <span class="k">def</span> <span class="nf">on_key_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        on a key press change the slices</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">key_press</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span>

        <span class="k">if</span> <span class="n">key_press</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_north</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="nb">print</span> <span class="s1">&#39;Already at northern most grid cell&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">index_north</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_north</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">index_north</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ax_ez</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_map</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">key_press</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_north</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;Already at southern most grid cell&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">index_north</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_north</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">index_north</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ax_ez</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_map</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">key_press</span> <span class="o">==</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_east</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="nb">print</span> <span class="s1">&#39;Already at eastern most grid cell&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">index_east</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_east</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">index_east</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ax_nz</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_map</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">key_press</span> <span class="o">==</span> <span class="s1">&#39;w&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_east</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;Already at western most grid cell&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">index_east</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_east</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">index_east</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ax_nz</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_map</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">key_press</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_vertical</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="nb">print</span> <span class="s1">&#39;Already at deepest grid cell&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">index_vertical</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_vertical</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">index_vertical</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ax_en</span><span class="p">()</span>
            <span class="nb">print</span> <span class="s1">&#39;Depth = </span><span class="si">{0:.5g}</span><span class="s1"> (</span><span class="si">{1}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_vertical</span><span class="p">],</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key_press</span> <span class="o">==</span> <span class="s1">&#39;u&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_vertical</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;Already at surface grid cell&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">index_vertical</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_vertical</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">index_vertical</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ax_en</span><span class="p">()</span>
            <span class="nb">print</span> <span class="s1">&#39;Depth = {0:.5gf} (</span><span class="si">{1}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_vertical</span><span class="p">],</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_update_ax_ez</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update east vs vertical plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_ez</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
        <span class="n">plot_ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_north</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_ez</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_ez_east</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">mesh_ez_vertical</span><span class="p">,</span>
                              <span class="n">plot_ez</span><span class="p">,</span>
                              <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span>
                              <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># plot stations</span>
        <span class="k">for</span> <span class="n">sx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_dict_north</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_north</span><span class="p">]]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax_ez</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span>
                            <span class="mi">0</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">station_marker</span><span class="p">,</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;baseline&#39;</span><span class="p">,</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                      <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_color</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax_ez</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_ez</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_ez</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span><span class="p">),</span>
                              <span class="n">fontdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_ez</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Easting (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span><span class="p">),</span>
                              <span class="n">fontdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_map</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_ax_nz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update east vs vertical plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_nz</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
        <span class="n">plot_nz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_east</span><span class="p">,</span> <span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_nz</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_nz_north</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">mesh_nz_vertical</span><span class="p">,</span>
                              <span class="n">plot_nz</span><span class="p">,</span>
                              <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span>
                              <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># plot stations</span>
        <span class="k">for</span> <span class="n">sy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_dict_east</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_east</span><span class="p">]]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax_nz</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">sy</span><span class="p">,</span>
                            <span class="mi">0</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">station_marker</span><span class="p">,</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;baseline&#39;</span><span class="p">,</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                      <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_color</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_nz</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_nz</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_nz</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Northing (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span><span class="p">),</span>
                              <span class="n">fontdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_nz</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span><span class="p">),</span>
                              <span class="n">fontdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_map</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_ax_en</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update east vs vertical plot</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax_en</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
        <span class="n">plot_en</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_vertical</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_en</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_en_east</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">mesh_en_north</span><span class="p">,</span>
                              <span class="n">plot_en</span><span class="p">,</span>
                              <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span>
                              <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_en</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_en</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_en</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Northing (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span><span class="p">),</span>
                              <span class="n">fontdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_en</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Easting (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span><span class="p">),</span>
                              <span class="n">fontdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font_dict</span><span class="p">)</span>
        <span class="c1">#--&gt; plot the stations</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ee</span><span class="p">,</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax_en</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ee</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
                                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_map</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_map</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">east_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">east_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">east_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span> <span class="n">xx</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">east_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">east_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">east_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_map</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east_line_xlist</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">east_line_ylist</span><span class="p">,</span>
                         <span class="n">lw</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">north_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">north_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">north_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">north_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">north_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">yy</span><span class="p">,</span> <span class="n">yy</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">north_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_map</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">north_line_xlist</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">north_line_ylist</span><span class="p">,</span>
                         <span class="n">lw</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="c1">#--&gt; e-w indication line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_map</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
                         <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_north</span><span class="p">],</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_north</span><span class="p">]],</span>
                         <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>

        <span class="c1">#--&gt; e-w indication line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_map</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_east</span><span class="p">],</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_east</span><span class="p">]],</span>
                         <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
                         <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="c1">#--&gt; plot the stations</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ee</span><span class="p">,</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_north</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax_map</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ee</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
                                 <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                 <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                 <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax_map</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_map</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_map</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Northing (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span><span class="p">),</span>
                               <span class="n">fontdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_map</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Easting (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span><span class="p">),</span>
                               <span class="n">fontdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font_dict</span><span class="p">)</span>

        <span class="c1"># plot stations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_map</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ew_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="o">.</span><span class="mi">95</span><span class="p">,</span>
                         <span class="s1">&#39;</span><span class="si">{0:.5g}</span><span class="s1"> (</span><span class="si">{1}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_vertical</span><span class="p">],</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">map_scale</span><span class="p">),</span>
                         <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                         <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
                         <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">},</span>
                         <span class="n">fontdict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font_dict</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

<div class="viewcode-block" id="PlotSlices.get_station_grid_locations"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotSlices.get_station_grid_locations">[docs]</a>    <span class="k">def</span> <span class="nf">get_station_grid_locations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the grid line on which a station resides for plotting</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_dict_east</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">gx</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">gx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_dict_north</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">gy</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">gy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_east</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ss</span><span class="p">,</span> <span class="n">sx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_east</span><span class="p">):</span>
                <span class="n">gx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span> <span class="o">&lt;=</span> <span class="n">sx</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_dict_east</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_east</span><span class="p">[</span>
                    <span class="n">gx</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_north</span><span class="p">[</span><span class="n">ss</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">ss</span><span class="p">,</span> <span class="n">sy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_north</span><span class="p">):</span>
                <span class="n">gy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span> <span class="o">&lt;=</span> <span class="n">sy</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">station_dict_north</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_north</span><span class="p">[</span>
                    <span class="n">gy</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_east</span><span class="p">[</span><span class="n">ss</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span></div>

<div class="viewcode-block" id="PlotSlices.redraw_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotSlices.redraw_plot">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        redraw plot if parameters were changed</span>

<span class="sd">        use this function if you updated some attributes and want to re-plot.</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # change the color and marker of the xy components</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(r&quot;/home/occam2d/Data.dat&quot;)</span>
<span class="sd">            &gt;&gt;&gt; p1 = ocd.plotAllResponses()</span>
<span class="sd">            &gt;&gt;&gt; #change line width</span>
<span class="sd">            &gt;&gt;&gt; p1.lw = 2</span>
<span class="sd">            &gt;&gt;&gt; p1.redraw_plot()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotSlices.save_figure"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.PlotSlices.save_figure">[docs]</a>    <span class="k">def</span> <span class="nf">save_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig_dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span>
                    <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;landscape&#39;</span><span class="p">,</span> <span class="n">close_fig</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save_figure will save the figure to save_fn.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>

<span class="sd">            **save_fn** : string</span>
<span class="sd">                          full path to save figure to, can be input as</span>
<span class="sd">                          * directory path -&gt; the directory path to save to</span>
<span class="sd">                            in which the file will be saved as </span>
<span class="sd">                            save_fn/station_name_PhaseTensor.file_format</span>

<span class="sd">                          * full path -&gt; file will be save to the given </span>
<span class="sd">                            path.  If you use this option then the format</span>
<span class="sd">                            will be assumed to be provided by the path</span>

<span class="sd">            **file_format** : [ pdf | eps | jpg | png | svg ]</span>
<span class="sd">                              file type of saved figure pdf,svg,eps... </span>

<span class="sd">            **orientation** : [ landscape | portrait ]</span>
<span class="sd">                              orientation in which the file will be saved</span>
<span class="sd">                              *default* is portrait</span>

<span class="sd">            **fig_dpi** : int</span>
<span class="sd">                          The resolution in dots-per-inch the file will be</span>
<span class="sd">                          saved.  If None then the dpi will be that at </span>
<span class="sd">                          which the figure was made.  I don&#39;t think that </span>
<span class="sd">                          it can be larger than dpi of the figure.</span>

<span class="sd">            **close_plot** : [ y | n ]</span>
<span class="sd">                             * &#39;y&#39; will close the plot after saving.</span>
<span class="sd">                             * &#39;n&#39; will leave plot open</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # to save plot as jpg</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; dfn = r&quot;/home/occam2d/Inv1/data.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(dfn)</span>
<span class="sd">            &gt;&gt;&gt; ps1 = ocd.plotPseudoSection()</span>
<span class="sd">            &gt;&gt;&gt; ps1.save_plot(r&#39;/home/MT/figures&#39;, file_format=&#39;jpg&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">fig_dpi</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_dpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">file_format</span> <span class="o">=</span> <span class="n">save_fn</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">save_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="s1">&#39;_E</span><span class="si">{0}</span><span class="s1">_N</span><span class="si">{1}</span><span class="s1">_Z</span><span class="si">{2}</span><span class="s1">.</span><span class="si">{3}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">index_east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_north</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">index_vertical</span><span class="p">,</span> <span class="n">file_format</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">close_fig</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span> <span class="o">=</span> <span class="n">save_fn</span>
        <span class="nb">print</span> <span class="s1">&#39;Saved figure to: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span></div></div>

<span class="c1">#==============================================================================</span>
<span class="c1"># STARTUP FILES</span>
<span class="c1">#==============================================================================</span>


<div class="viewcode-block" id="WSStartup"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSStartup">[docs]</a><span class="k">class</span> <span class="nc">WSStartup</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read and write startup files</span>

<span class="sd">    :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.ws3dinv as ws</span>
<span class="sd">        &gt;&gt;&gt; dfn = r&quot;/home/MT/ws3dinv/Inv1/WSDataFile.dat&quot;</span>
<span class="sd">        &gt;&gt;&gt; ifn = r&quot;/home/MT/ws3dinv/Inv1/init3d&quot;</span>
<span class="sd">        &gt;&gt;&gt; sws = ws.WSStartup(data_fn=dfn, initial_fn=ifn)</span>


<span class="sd">    =================== =======================================================</span>
<span class="sd">    Attributes          Description    </span>
<span class="sd">    =================== =======================================================</span>
<span class="sd">    apriori_fn          full path to *a priori* model file</span>
<span class="sd">                        *default* is &#39;default&#39;</span>
<span class="sd">    control_fn          full path to model index control file</span>
<span class="sd">                        *default* is &#39;default&#39;</span>
<span class="sd">    data_fn             full path to data file</span>
<span class="sd">    error_tol           error tolerance level</span>
<span class="sd">                        *default* is &#39;default&#39;</span>
<span class="sd">    initial_fn          full path to initial model file</span>
<span class="sd">    lagrange            starting lagrange multiplier</span>
<span class="sd">                        *default* is &#39;default&#39;</span>
<span class="sd">    max_iter            max number of iterations</span>
<span class="sd">                        *default* is 10</span>
<span class="sd">    model_ls            model length scale</span>
<span class="sd">                        *default* is 5 0.3 0.3 0.3</span>
<span class="sd">    output_stem         output file name stem</span>
<span class="sd">                        *default* is &#39;ws3dinv&#39;</span>
<span class="sd">    save_path           directory to save file to</span>
<span class="sd">    startup_fn          full path to startup file</span>
<span class="sd">    static_fn           full path to statics file</span>
<span class="sd">                        *default* is &#39;default&#39;</span>
<span class="sd">    target_rms          target rms</span>
<span class="sd">                        *default* is 1.0</span>
<span class="sd">    =================== =======================================================</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initial_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">data_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="o">=</span> <span class="n">initial_fn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_stem</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;output_stem&#39;</span><span class="p">,</span> <span class="s1">&#39;ws3dinv&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apriori_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;apriori_fn&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_ls</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;model_ls&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_rms</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;target_rms&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;control_fn&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;max_iter&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_tol</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;error_tol&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">static_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;static_fn&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lagrange</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lagrange&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;save_path&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;startup_fn&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_startup_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;data_file&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;output_file&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;initial_model_file&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;prior_model_file&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;control_model_index&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;target_rms&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;max_no_iteration&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;model_length_scale&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;lagrange_info&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;error_tol_level&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;static_file&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="WSStartup.write_startup_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSStartup.write_startup_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_startup_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        makes a startup file for WSINV3D.  </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Need to input data file name&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Need to input initial model file name&#39;</span><span class="p">)</span>

        <span class="c1"># create the output filename</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">),</span>
                                           <span class="s1">&#39;startup&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="s1">&#39;startup&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span>

        <span class="n">slines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">)</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">):</span>
            <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;DATA_FILE&#39;</span><span class="p">,</span>
                                                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">70</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;Data file is too long, going to get an error at runtime&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;DATA_FILE&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">70</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;Data file is too long, going to get an error at runtime&#39;</span>

        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;OUTPUT_FILE&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_stem</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">)</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="p">):</span>
            <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;INITIAL_MODEL_FILE&#39;</span><span class="p">,</span>
                                                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;INITIAL_MODEL_FILE&#39;</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;PRIOR_MODEL_FILE&#39;</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">apriori_fn</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;CONTROL_MODEL_INDEX &#39;</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">control_fn</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;TARGET_RMS&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_rms</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;MAX_NO_ITERATION&#39;</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1:.0f}</span><span class="s1"> </span><span class="si">{2:.1f}</span><span class="s1"> </span><span class="si">{3:.1f}</span><span class="s1"> </span><span class="si">{4:.1f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;MODEL_LENGTH_SCALE&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_ls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_ls</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_ls</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_ls</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;LAGRANGE_INFO&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lagrange</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ERROR_TOL_LEVEL&#39;</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">error_tol</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;STATIC_FILE&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_fn</span><span class="p">))</span>

        <span class="n">sfid</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">slines</span><span class="p">))</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="nb">print</span> <span class="s1">&#39;Wrote startup file to: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">)</span></div>

<div class="viewcode-block" id="WSStartup.read_startup_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.WSStartup.read_startup_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_startup_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startup_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read startup file fills attributes</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">startup_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span> <span class="o">=</span> <span class="n">startup_fn</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Need to input startup file name&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">)</span>

        <span class="n">sfid</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">slines</span> <span class="o">=</span> <span class="n">sfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">slines</span> <span class="o">=</span> <span class="p">[</span><span class="n">ss</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">slines</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">slines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_stem</span> <span class="o">=</span> <span class="n">slines</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="o">=</span> <span class="n">slines</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_fn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apriori_fn</span> <span class="o">=</span> <span class="n">slines</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_fn</span> <span class="o">=</span> <span class="n">slines</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_rms</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">slines</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">slines</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_ls</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">slines</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">slines</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                             <span class="nb">float</span><span class="p">(</span><span class="n">slines</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">slines</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">3</span><span class="p">])]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_ls</span> <span class="o">=</span> <span class="n">slines</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lagrange</span> <span class="o">=</span> <span class="n">slines</span><span class="p">[</span><span class="mi">8</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_tol</span> <span class="o">=</span> <span class="n">slines</span><span class="p">[</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">static_fn</span> <span class="o">=</span> <span class="n">slines</span><span class="p">[</span><span class="mi">10</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;Did not find static_fn&#39;</span></div></div>

<span class="c1"># ==============================================================================</span>
<span class="c1"># WRITE A VTK FILE TO IMAGE IN PARAVIEW OR MAYAVI</span>
<span class="c1"># ==============================================================================</span>


<div class="viewcode-block" id="write_vtk_res_model"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.write_vtk_res_model">[docs]</a><span class="k">def</span> <span class="nf">write_vtk_res_model</span><span class="p">(</span><span class="n">res_model</span><span class="p">,</span> <span class="n">grid_north</span><span class="p">,</span> <span class="n">grid_east</span><span class="p">,</span> <span class="n">grid_z</span><span class="p">,</span> <span class="n">save_fn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write a vtk file for resistivity as a structured grid </span>
<span class="sd">    to be read into paraview or mayavi</span>

<span class="sd">    **Doesn&#39;t work properly under windows**</span>

<span class="sd">    adds extension automatically</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">save_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="s1">&#39;VTKResistivity_Model&#39;</span><span class="p">)</span>

    <span class="n">save_fn</span> <span class="o">=</span> <span class="n">gridToVTK</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">grid_north</span><span class="p">,</span> <span class="n">grid_east</span><span class="p">,</span> <span class="n">grid_z</span><span class="p">,</span>
                        <span class="n">cellData</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;resistivity&#39;</span><span class="p">:</span> <span class="n">res_model</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">save_fn</span></div>


<div class="viewcode-block" id="write_vtk_stations"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.write_vtk_stations">[docs]</a><span class="k">def</span> <span class="nf">write_vtk_stations</span><span class="p">(</span><span class="n">station_north</span><span class="p">,</span> <span class="n">station_east</span><span class="p">,</span> <span class="n">save_fn</span><span class="p">,</span> <span class="n">station_z</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write a vtk file as points to be read into paraview or mayavi</span>

<span class="sd">    **Doesn&#39;t work properly under windows**</span>

<span class="sd">    adds extension automatically</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">save_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="s1">&#39;VTKStations&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">station_z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">station_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">station_north</span><span class="p">)</span>

    <span class="n">pointsToVTK</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">station_north</span><span class="p">,</span> <span class="n">station_east</span><span class="p">,</span> <span class="n">station_z</span><span class="p">,</span>
                <span class="n">cellData</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">station_north</span><span class="p">)})</span>

    <span class="k">return</span> <span class="n">save_fn</span></div>


<div class="viewcode-block" id="write_vtk_files"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.write_vtk_files">[docs]</a><span class="k">def</span> <span class="nf">write_vtk_files</span><span class="p">(</span><span class="n">model_fn</span><span class="p">,</span> <span class="n">station_fn</span><span class="p">,</span> <span class="n">save_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes vtk files</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">wsstation</span> <span class="o">=</span> <span class="n">WSStation</span><span class="p">(</span><span class="n">station_fn</span><span class="o">=</span><span class="n">station_fn</span><span class="p">)</span>
    <span class="n">wsstation</span><span class="o">.</span><span class="n">read_station_file</span><span class="p">()</span>
    <span class="n">wsstation</span><span class="o">.</span><span class="n">write_vtk_file</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>

    <span class="n">wsmodel</span> <span class="o">=</span> <span class="n">WSModel</span><span class="p">(</span><span class="n">model_fn</span><span class="p">)</span>
    <span class="n">wsmodel</span><span class="o">.</span><span class="n">write_vtk_file</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="computeMemoryUsage"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.ws3dinv.computeMemoryUsage">[docs]</a><span class="k">def</span> <span class="nf">computeMemoryUsage</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nz</span><span class="p">,</span> <span class="n">n_stations</span><span class="p">,</span> <span class="n">n_zelements</span><span class="p">,</span> <span class="n">n_period</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    compute the memory usage of a model</span>

<span class="sd">    Arguments:</span>
<span class="sd">    ----------</span>
<span class="sd">        **nx** : int</span>
<span class="sd">                 number of cells in N-S direction</span>

<span class="sd">        **ny** : int</span>
<span class="sd">                 number of cells in E-W direction</span>

<span class="sd">        **nz** : int</span>
<span class="sd">                 number of cells in vertical direction including air layers (7)</span>

<span class="sd">        **n_stations** : int</span>
<span class="sd">                         number of stations</span>

<span class="sd">        **n_zelements** : int</span>
<span class="sd">                          number of impedence tensor elements either 4 or 8</span>

<span class="sd">        **n_period** : int</span>
<span class="sd">                       number of periods to invert for</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">        **mem_req** : float</span>
<span class="sd">                      approximate memory useage in GB</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mem_req</span> <span class="o">=</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_stations</span> <span class="o">*</span> <span class="n">n_period</span> <span class="o">*</span> <span class="n">n_zelements</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                     <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">nx</span> <span class="o">*</span> <span class="n">ny</span> <span class="o">*</span> <span class="n">nz</span> <span class="o">*</span> <span class="n">n_stations</span> <span class="o">*</span> <span class="n">n_period</span> <span class="o">*</span> <span class="n">n_zelements</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">mem_req</span> <span class="o">*</span> <span class="mi">1</span><span class="n">E</span><span class="o">-</span><span class="mi">9</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../master_index.html">MTpy 0.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, J. Peacock, L. Krieger.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.6.
    </div>
  </body>
</html>