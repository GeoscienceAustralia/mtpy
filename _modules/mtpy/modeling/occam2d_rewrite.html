<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>mtpy.modeling.occam2d_rewrite &#8212; MTpy 0.2 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="MTpy 0.2 documentation" href="../../../master_index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../master_index.html">MTpy 0.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for mtpy.modeling.occam2d_rewrite</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Spin-off from &#39;occamtools&#39;</span>
<span class="sd">(Created August 2011, re-written August 2013)</span>

<span class="sd">Tools for Occam2D</span>

<span class="sd">authors: JP/LK</span>


<span class="sd">Classes:</span>
<span class="sd">    - Data</span>
<span class="sd">    - Model</span>
<span class="sd">    - Setup</span>
<span class="sd">    - Run</span>
<span class="sd">    - Plot</span>
<span class="sd">    - Mask</span>


<span class="sd">Functions:</span>
<span class="sd">    - getdatetime</span>
<span class="sd">    - makestartfiles</span>
<span class="sd">    - writemeshfile</span>
<span class="sd">    - writemodelfile</span>
<span class="sd">    - writestartupfile</span>
<span class="sd">    - read_datafile</span>
<span class="sd">    - get_model_setup</span>
<span class="sd">    - blocks_elements_setup</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># ==============================================================================</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span> <span class="k">as</span> <span class="nn">op</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">matplotlib.colorbar</span> <span class="k">as</span> <span class="nn">mcb</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="k">as</span> <span class="nn">spi</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="k">import</span> <span class="n">Normalize</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="k">import</span> <span class="n">MultipleLocator</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">mode</span>

<span class="kn">import</span> <span class="nn">mtpy.analysis.geometry</span> <span class="k">as</span> <span class="nn">MTgy</span>
<span class="kn">import</span> <span class="nn">mtpy.core.mt</span> <span class="k">as</span> <span class="nn">mt</span>
<span class="kn">import</span> <span class="nn">mtpy.modeling.winglinktools</span> <span class="k">as</span> <span class="nn">MTwl</span>
<span class="kn">from</span> <span class="nn">mtpy.imaging.mtplottools</span> <span class="k">import</span> <span class="n">plot_errorbar</span>


<span class="c1"># ==============================================================================</span>

<div class="viewcode-block" id="Mesh"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Mesh">[docs]</a><span class="k">class</span> <span class="nc">Mesh</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    deals only with the finite element mesh.  Builds a finite element mesh </span>
<span class="sd">    based on given parameters defined below.  The mesh reads in the station </span>
<span class="sd">    locations, finds the center and makes the relative location of the </span>
<span class="sd">    furthest left hand station 0.  The mesh increases in depth logarithmically</span>
<span class="sd">    as required by the physics of MT.  Also, the model extends horizontally</span>
<span class="sd">    and vertically with padding cells in order to fullfill the assumption of </span>
<span class="sd">    the forward operator that at the edges the structure is 1D.  Stations are</span>
<span class="sd">    place on the horizontal nodes as required by Wannamaker&#39;s forward </span>
<span class="sd">    operator.</span>

<span class="sd">    Mesh has the ability to create a mesh that incorporates topography given</span>
<span class="sd">    a elevation profile.  It adds more cells to the mesh with thickness </span>
<span class="sd">    z1_layer.  It then sets the values of the triangular elements according to </span>
<span class="sd">    the elevation value at that location.  If the elevation covers less than </span>
<span class="sd">    50% of the triangular cell, then the cell value is set to that of air</span>

<span class="sd">    .. note:: Mesh is inhereted by Regularization, so the mesh can also be </span>
<span class="sd">              be built from there, same as the example below.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    -----------</span>

<span class="sd">    ======================= ===================================================</span>
<span class="sd">    Key Words/Attributes    Description    </span>
<span class="sd">    ======================= ===================================================</span>
<span class="sd">    air_key                 letter associated with the value of air </span>
<span class="sd">                            *default* is 0</span>
<span class="sd">    air_value               value given to an air cell, *default* is 1E13</span>
<span class="sd">    cell_width              width of cells with in station area in meters</span>
<span class="sd">                            *default* is 100</span>
<span class="sd">    elevation_profile       elevation profile along the profile line.</span>
<span class="sd">                            given as np.ndarray(nx, 2), where the elements</span>
<span class="sd">                            are x_location, elevation.  If elevation profile</span>
<span class="sd">                            is given add_elevation is called automatically.</span>
<span class="sd">                            *default* is None</span>
<span class="sd">    mesh_fn                 full path to mesh file.</span>
<span class="sd">    mesh_values             letter values of each triangular mesh element</span>
<span class="sd">                            if the cell is free value is ?</span>
<span class="sd">    n_layers                number of vertical layers in mesh</span>
<span class="sd">                            *default* is 90 </span>
<span class="sd">    num_x_pad_cells         number of horizontal padding cells outside the</span>
<span class="sd">                            the station area that will increase in size</span>
<span class="sd">                            by x_pad_multiplier. *default* is 7</span>
<span class="sd">    num_x_pad_small_cells   number of horizonal padding cells just outside </span>
<span class="sd">                            the station area with width cell_width.  This is </span>
<span class="sd">                            to extend the station area if needed.  </span>
<span class="sd">                            *default* is 2 </span>
<span class="sd">    num_z_pad_cells         number of vertical padding cells below </span>
<span class="sd">                            z_target_depth down to z_bottom. *default* is 5</span>
<span class="sd">    rel_station_locations   relative station locations within the mesh.  The</span>
<span class="sd">                            locations are relative to the center of the station</span>
<span class="sd">                            area.  *default* is None, filled later</span>
<span class="sd">    save_path               full path to save mesh file to. </span>
<span class="sd">                            *default* is current working directory.</span>
<span class="sd">    station_locations       location of stations in meters, can be on a </span>
<span class="sd">                            relative grid or in UTM.</span>
<span class="sd">    x_grid                  location of horizontal grid nodes in meters</span>
<span class="sd">    x_nodes                 relative spacing between grid nodes</span>
<span class="sd">    x_pad_multiplier        horizontal padding cells will increase by this</span>
<span class="sd">                            multiple out to the edge of the grid.</span>
<span class="sd">                            *default* is 1.5</span>
<span class="sd">    z1_layer                thickness of the first layer in the model.</span>
<span class="sd">                            Should be at least 1/4 of the first skin depth</span>
<span class="sd">                            *default* is 10</span>
<span class="sd">    z_bottom                bottom depth of the model (m).  Needs to be large </span>
<span class="sd">                            enough to be 1D at the edge. </span>
<span class="sd">                            *default* is 200000.0 </span>
<span class="sd">    z_grid                  location of vertical nodes in meters</span>
<span class="sd">    z_nodes                 relative distance between vertical nodes in meters</span>
<span class="sd">    z_target_depth          depth to deepest target of interest.  Below this</span>
<span class="sd">                            depth cells will be padded to z_bottom</span>
<span class="sd">    ======================= ===================================================</span>

<span class="sd">    ======================= ===================================================</span>
<span class="sd">    Methods                 Description</span>
<span class="sd">    ======================= ===================================================</span>
<span class="sd">    add_elevation           adds elevation to the mesh given elevation</span>
<span class="sd">                            profile.  </span>
<span class="sd">    build_mesh              builds the mesh given the attributes of Mesh.  If</span>
<span class="sd">                            elevation_profile is not None, add_elevation is</span>
<span class="sd">                            called inside build_mesh</span>
<span class="sd">    plot_mesh               plots the built mesh with station location.  </span>
<span class="sd">    read_mesh_file          reads in an existing mesh file and populates the </span>
<span class="sd">                            appropriate attributes.</span>
<span class="sd">    write_mesh_file         writes a mesh file to save_path</span>
<span class="sd">    ======================= ===================================================</span>


<span class="sd">    :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.occam2d as occcam2d</span>
<span class="sd">        &gt;&gt;&gt; edipath = r&quot;/home/mt/edi_files&quot;</span>
<span class="sd">        &gt;&gt;&gt; slist = [&#39;mt{0:03}&#39;.format(ss) for ss in range(20)]</span>
<span class="sd">        &gt;&gt;&gt; ocd = occam2d.Data(edi_path=edipath, station_list=slist)</span>
<span class="sd">        &gt;&gt;&gt; ocd.save_path = r&quot;/home/occam/Line1/Inv1&quot;</span>
<span class="sd">        &gt;&gt;&gt; ocd.write_data_file()</span>
<span class="sd">        &gt;&gt;&gt; ocm = occam2d.Mesh(ocd.station_locations)</span>
<span class="sd">        &gt;&gt;&gt; # add in elevation</span>
<span class="sd">        &gt;&gt;&gt; ocm.elevation_profile = ocd.elevation_profile</span>
<span class="sd">        &gt;&gt;&gt; # change number of layers        </span>
<span class="sd">        &gt;&gt;&gt; ocm.n_layers = 110</span>
<span class="sd">        &gt;&gt;&gt; # change cell width in station area</span>
<span class="sd">        &gt;&gt;&gt; ocm.cell_width = 200</span>
<span class="sd">        &gt;&gt;&gt; ocm.build_mesh()</span>
<span class="sd">        &gt;&gt;&gt; ocm.plot_mesh()</span>
<span class="sd">        &gt;&gt;&gt; ocm.save_path = ocd.save_path</span>
<span class="sd">        &gt;&gt;&gt; ocm.write_mesh_file()</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">station_locations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span> <span class="o">=</span> <span class="n">station_locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rel_station_locations</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_layers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;n_layers&#39;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_width</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cell_width&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_x_pad_cells</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;num_x_pad_cells&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_z_pad_cells</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;num_z_pad_cells&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_pad_multiplier</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;x_pad_multiplier&#39;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z1_layer</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;z1_layer&#39;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_bottom</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;z_bottom&#39;</span><span class="p">,</span> <span class="mf">200000.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_target_depth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;z_target_depth&#39;</span><span class="p">,</span> <span class="mf">50000.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_x_pad_small_cells</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;num_x_pad_small_cells&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;save_path&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mesh_fn&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elevation_profile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;elevation_profile&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">air_value</span> <span class="o">=</span> <span class="mi">1</span><span class="n">e13</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">air_key</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>

<div class="viewcode-block" id="Mesh.build_mesh"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Mesh.build_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">build_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the finite element mesh given the parameters defined by the </span>
<span class="sd">        attributes of Mesh.  Computes relative station locations by finding </span>
<span class="sd">        the center of the station area and setting the middle to 0.  Mesh </span>
<span class="sd">        blocks are built by calculating the distance between stations and </span>
<span class="sd">        putting evenly spaced blocks between the stations being close to </span>
<span class="sd">        cell_width.  This places a horizontal node at the station location.</span>
<span class="sd">        If the spacing between stations is smaller than </span>
<span class="sd">        cell_width, a horizontal node is placed between the stations to be </span>
<span class="sd">        sure the model has room to change between the station.</span>

<span class="sd">        If elevation_profile is given, add_elevation is called to add </span>
<span class="sd">        topography into the mesh.</span>

<span class="sd">        Populates attributes:</span>
<span class="sd">            * mesh_values</span>
<span class="sd">            * rel_station_locations</span>
<span class="sd">            * x_grid</span>
<span class="sd">            * x_nodes</span>
<span class="sd">            * z_grid</span>
<span class="sd">            * z_nodes</span>

<span class="sd">        :Example: ::</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occcam2d</span>
<span class="sd">            &gt;&gt;&gt; edipath = r&quot;/home/mt/edi_files&quot;</span>
<span class="sd">            &gt;&gt;&gt; slist = [&#39;mt{0:03}&#39;.format(ss) for ss in range(20)]</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Data(edi_path=edipath, station_list=slist)</span>
<span class="sd">            &gt;&gt;&gt; ocd.save_path = r&quot;/home/occam/Line1/Inv1&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd.write_data_file()</span>
<span class="sd">            &gt;&gt;&gt; ocm = occam2d.Mesh(ocd.station_locations)</span>
<span class="sd">            &gt;&gt;&gt; # add in elevation</span>
<span class="sd">            &gt;&gt;&gt; ocm.elevation_profile = ocd.elevation_profile</span>
<span class="sd">            &gt;&gt;&gt; # change number of layers        </span>
<span class="sd">            &gt;&gt;&gt; ocm.n_layers = 110</span>
<span class="sd">            &gt;&gt;&gt; # change cell width in station area</span>
<span class="sd">            &gt;&gt;&gt; ocm.cell_width = 200</span>
<span class="sd">            &gt;&gt;&gt; ocm.build_mesh()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OccamInputError</span><span class="p">(</span><span class="s1">&#39;Need to input station locations to define &#39;</span>
                                  <span class="s1">&#39;a finite element mesh&#39;</span><span class="p">)</span>

        <span class="c1"># be sure the station locations are sorted from left to right</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rel_station_locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">)</span>

        <span class="c1"># center the stations around 0 like the mesh will be</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rel_station_locations</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_station_locations</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="c1"># 1) make horizontal nodes at station locations and fill in the cells</span>
        <span class="c1">#   around that area with cell width. This will put the station</span>
        <span class="c1">#   in the center of the regularization block as prescribed for occam</span>
        <span class="c1"># the first cell of the station area will be outside of the furthest</span>
        <span class="c1"># right hand station to reduce the effect of a large neighboring cell.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">rel_station_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_width</span> <span class="o">*</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">x_pad_multiplier</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rel_station_locations</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_station_locations</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">offset</span>
            <span class="n">num_cells</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dx</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_width</span><span class="p">))</span>
            <span class="c1"># if the spacing between stations is smaller than mesh set cell</span>
            <span class="c1"># size to mid point between stations</span>
            <span class="k">if</span> <span class="n">num_cells</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cell_width</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">/</span> <span class="mf">2.</span>
                <span class="n">num_cells</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c1"># calculate cell spacing so that they are equal between neighboring</span>
            <span class="c1"># stations</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cell_width</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">num_cells</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">offset</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cells</span><span class="p">):</span>
                <span class="n">new_cell</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="p">(</span><span class="n">dd</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">cell_width</span>
                <span class="c1"># make sure cells aren&#39;t too close together</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rel_station_locations</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">new_cell</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">cell_width</span> <span class="o">*</span> <span class="o">.</span><span class="mi">9</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">,</span> <span class="n">new_cell</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_station_locations</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># add a cell on the right hand side of the station area to reduce</span>
        <span class="c1"># effect of a large cell next to it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">rel_station_locations</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_width</span> <span class="o">*</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">x_pad_multiplier</span><span class="p">)</span>

        <span class="c1"># --&gt; pad the mesh with exponentially increasing horizontal cells</span>
        <span class="c1">#    such that the edge of the mesh can be estimated with a 1D model</span>

        <span class="n">x_left</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">x_right</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">x_pad_cell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">x_left</span><span class="p">,</span> <span class="n">x_right</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_x_pad_cells</span><span class="p">):</span>
            <span class="n">left_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">right_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">pad_cell</span> <span class="o">=</span> <span class="n">x_pad_cell</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_pad_multiplier</span> <span class="o">**</span> <span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">left_cell</span> <span class="o">-</span> <span class="n">pad_cell</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">,</span> <span class="n">right_cell</span> <span class="o">+</span> <span class="n">pad_cell</span><span class="p">)</span>

        <span class="c1"># --&gt; compute relative positions for the grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">xx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># 2) make vertical nodes so that they increase with depth</span>
        <span class="c1"># --&gt; make depth grid</span>
        <span class="n">log_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z1_layer</span><span class="p">),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_target_depth</span> <span class="o">-</span>
                                     <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z1_layer</span><span class="p">),</span>
                                                 <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_target_depth</span><span class="p">),</span>
                                                 <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_layers</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span>
                            <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_layers</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_z_pad_cells</span><span class="p">)</span>

        <span class="c1"># round the layers to be whole numbers</span>
        <span class="n">ztarget</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">zz</span> <span class="o">-</span> <span class="n">zz</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">zz</span><span class="p">))</span> <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span>
                            <span class="n">log_z</span><span class="p">])</span>

        <span class="c1"># --&gt; create padding cells past target depth</span>
        <span class="n">log_zpad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_target_depth</span><span class="p">),</span>
                               <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_bottom</span> <span class="o">-</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_target_depth</span><span class="p">),</span>
                                                    <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_bottom</span><span class="p">),</span>
                                                    <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_z_pad_cells</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span>
                               <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_z_pad_cells</span><span class="p">)</span>
        <span class="c1"># round the layers to be whole numbers</span>
        <span class="n">zpadding</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">zz</span> <span class="o">-</span> <span class="n">zz</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">zz</span><span class="p">))</span> <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span>
                             <span class="n">log_zpad</span><span class="p">])</span>
        <span class="n">zpadding</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="c1"># create the vertical nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ztarget</span><span class="p">,</span> <span class="n">zpadding</span><span class="p">)</span>

        <span class="c1"># calculate actual distances of depth layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">[:</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>

        <span class="c1"># get elevation if elevation_profile is given</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elevation_profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_elevation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elevation_profile</span><span class="p">)</span>

        <span class="nb">print</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">55</span>
        <span class="nb">print</span> <span class="s1">&#39;</span><span class="si">{0:^55}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;mesh parameters&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="nb">print</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">55</span>
        <span class="nb">print</span> <span class="s1">&#39;  number of horizontal nodes = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="nb">print</span> <span class="s1">&#39;  number of vertical nodes   = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="nb">print</span> <span class="s1">&#39;  Total Horizontal Distance  = </span><span class="si">{0:2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        <span class="nb">print</span> <span class="s1">&#39;  Total Vertical Distance    = </span><span class="si">{0:2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        <span class="nb">print</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">55</span></div>

<div class="viewcode-block" id="Mesh.add_elevation"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Mesh.add_elevation">[docs]</a>    <span class="k">def</span> <span class="nf">add_elevation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elevation_profile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the elevation model needs to be in relative coordinates and be a </span>
<span class="sd">        numpy.ndarray(2, num_elevation_points) where the first column is</span>
<span class="sd">        the horizontal location and the second column is the elevation at </span>
<span class="sd">        that location.</span>

<span class="sd">        If you have a elevation model use Profile to project the elevation</span>
<span class="sd">        information onto the profile line</span>

<span class="sd">        To build the elevation I&#39;m going to add the elevation to the top </span>
<span class="sd">        of the model which will add cells to the mesh. there might be a better</span>
<span class="sd">        way to do this, but this is the first attempt. So I&#39;m going to assume</span>
<span class="sd">        that the first layer of the mesh without elevation is the minimum</span>
<span class="sd">        elevation and blocks will be added to max elevation at an increment</span>
<span class="sd">        according to z1_layer</span>

<span class="sd">        .. note:: the elevation model should be symmetrical ie, starting </span>
<span class="sd">                  at the first station and ending on the last station, so for</span>
<span class="sd">                  now any elevation outside the station area will be ignored </span>
<span class="sd">                  and set to the elevation of the station at the extremities.</span>
<span class="sd">                  This is not ideal but works for now.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>
<span class="sd">            **elevation_profile** : np.ndarray(2, num_elev_points)</span>
<span class="sd">                                    - 1st row is for profile location</span>
<span class="sd">                                    - 2nd row is for elevation values</span>

<span class="sd">        Computes:</span>
<span class="sd">        ---------</span>
<span class="sd">            **mesh_values** : mesh values, setting anything above topography</span>
<span class="sd">                              to the key for air, which for Occam is &#39;0&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">elevation_profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elevation_profile</span> <span class="o">=</span> <span class="n">elevation_profile</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elevation_profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OccamInputError</span><span class="p">(</span><span class="s1">&#39;Need to input an elevation profile to &#39;</span>
                                  <span class="s1">&#39;add elevation into the mesh.&#39;</span><span class="p">)</span>

        <span class="n">elev_diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">elevation_profile</span><span class="p">[</span>
                        <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">elevation_profile</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="n">num_elev_layers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">elev_diff</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">z1_layer</span><span class="p">)</span>

        <span class="c1"># add vertical nodes and values to mesh_values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">z1_layer</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_elev_layers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">[:</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
        <span class="c1"># this assumes that mesh_values have not been changed yet and are all ?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>

        <span class="c1"># --&gt; need to interpolate the elevation values onto the mesh nodes</span>
        <span class="c1"># first center the locations about 0, this needs to be the same</span>
        <span class="c1"># center as the station locations.</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">elevation_profile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">elevation_profile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">elev</span> <span class="o">=</span> <span class="n">elevation_profile</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">elevation_profile</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="n">func_elev</span> <span class="o">=</span> <span class="n">spi</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">elev</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

        <span class="c1"># need to figure out which cells and triangular cells need to be air</span>
        <span class="n">xpad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_x_pad_cells</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">xg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="n">xpad</span><span class="p">:</span><span class="o">-</span><span class="n">xpad</span><span class="p">],</span> <span class="n">xpad</span><span class="p">):</span>
            <span class="c1"># get the index value for z_grid by calculating the elevation</span>
            <span class="c1"># difference relative to the top of the model</span>
            <span class="n">dz</span> <span class="o">=</span> <span class="n">elev</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">func_elev</span><span class="p">(</span><span class="n">xg</span><span class="p">)</span>
            <span class="c1"># index of ground in the model for that x location</span>
            <span class="n">zz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">dz</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">z1_layer</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">zz</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># --&gt; need to figure out the triangular elements</span>
                <span class="c1"># top triangle</span>
                <span class="n">zlayer</span> <span class="o">=</span> <span class="n">elev</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span><span class="p">[</span><span class="n">zz</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">xtop</span> <span class="o">=</span> <span class="n">xg</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">ytop</span> <span class="o">=</span> <span class="n">zlayer</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> \
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span><span class="p">[</span><span class="n">zz</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span><span class="p">[</span><span class="n">zz</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">4</span>
                    <span class="n">elev_top</span> <span class="o">=</span> <span class="n">func_elev</span><span class="p">(</span><span class="n">xtop</span><span class="p">)</span>
                    <span class="c1"># print xg, xtop, ytop, elev_top, zz</span>
                    <span class="k">if</span> <span class="n">elev_top</span> <span class="o">&gt;</span> <span class="n">ytop</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">zz</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">air_key</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">zz</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">air_key</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="c1"># left triangle</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">xleft</span> <span class="o">=</span> <span class="n">xg</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xg</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.</span>
                    <span class="n">yleft</span> <span class="o">=</span> <span class="n">zlayer</span> <span class="o">+</span> \
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span><span class="p">[</span><span class="n">zz</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span><span class="p">[</span><span class="n">zz</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span>
                    <span class="n">elev_left</span> <span class="o">=</span> <span class="n">func_elev</span><span class="p">(</span><span class="n">xleft</span><span class="p">)</span>
                    <span class="c1"># print xg, xleft, yleft, elev_left, zz</span>
                    <span class="k">if</span> <span class="n">elev_left</span> <span class="o">&gt;</span> <span class="n">yleft</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">zz</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">air_key</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="c1"># bottom triangle</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">xbottom</span> <span class="o">=</span> <span class="n">xg</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">ybottom</span> <span class="o">=</span> <span class="n">zlayer</span> <span class="o">+</span> \
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span><span class="p">[</span><span class="n">zz</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span><span class="p">[</span><span class="n">zz</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">4</span>
                    <span class="n">elev_bottom</span> <span class="o">=</span> <span class="n">func_elev</span><span class="p">(</span><span class="n">xbottom</span><span class="p">)</span>
                    <span class="c1"># print xg, xbottom, ybottom, elev_bottom, zz</span>
                    <span class="k">if</span> <span class="n">elev_bottom</span> <span class="o">&gt;</span> <span class="n">ybottom</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">zz</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">air_key</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="c1"># right triangle</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">xright</span> <span class="o">=</span> <span class="n">xg</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span>
                    <span class="n">yright</span> <span class="o">=</span> <span class="n">zlayer</span> <span class="o">+</span> \
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span><span class="p">[</span><span class="n">zz</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span><span class="p">[</span><span class="n">zz</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">elev_right</span> <span class="o">=</span> <span class="n">func_elev</span><span class="p">(</span><span class="n">xright</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">elev_right</span> <span class="o">&gt;</span> <span class="n">yright</span> <span class="o">*</span> <span class="o">.</span><span class="mi">95</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">zz</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">air_key</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="c1"># --&gt; need to fill out the padding cells so they have the same elevation</span>
        <span class="c1">#    as the extremity stations.</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xpad</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="p">[</span><span class="n">xpad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xpad</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">:,</span>
                             <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="p">[</span><span class="o">-</span><span class="n">xpad</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

        <span class="nb">print</span> <span class="s1">&#39;</span><span class="si">{0:^55}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;--- Added Elevation to Mesh --&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mesh.plot_mesh"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Mesh.plot_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">plot_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot built mesh with station locations.</span>

<span class="sd">        =================== ===================================================</span>
<span class="sd">        Key Words           Description        </span>
<span class="sd">        =================== ===================================================</span>
<span class="sd">        depth_scale         [ &#39;km&#39; | &#39;m&#39; ] scale of mesh plot. </span>
<span class="sd">                            *default* is &#39;km&#39;</span>
<span class="sd">        fig_dpi             dots-per-inch resolution of the figure</span>
<span class="sd">                            *default* is 300</span>
<span class="sd">        fig_num             number of the figure instance</span>
<span class="sd">                            *default* is &#39;Mesh&#39;</span>
<span class="sd">        fig_size            size of figure in inches (width, height)</span>
<span class="sd">                            *default* is [5, 5]</span>
<span class="sd">        fs                  size of font of axis tick labels, axis labels are</span>
<span class="sd">                            fs+2. *default* is 6 </span>
<span class="sd">        ls                  [ &#39;-&#39; | &#39;.&#39; | &#39;:&#39; ] line style of mesh lines</span>
<span class="sd">                            *default* is &#39;-&#39;</span>
<span class="sd">        marker              marker of stations </span>
<span class="sd">                            *default* is r&quot;$\blacktriangledown$&quot;</span>
<span class="sd">        ms                  size of marker in points. *default* is 5</span>
<span class="sd">        plot_triangles      [ &#39;y&#39; | &#39;n&#39; ] to plot mesh triangles.</span>
<span class="sd">                            *default* is &#39;n&#39;</span>
<span class="sd">        =================== ===================================================</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_num</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_num&#39;</span><span class="p">,</span> <span class="s1">&#39;Mesh&#39;</span><span class="p">)</span>
        <span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_size&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
        <span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_dpi&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;marker&#39;</span><span class="p">,</span> <span class="s2">r&quot;$\blacktriangledown$&quot;</span><span class="p">)</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mc&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">lw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ls&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">35</span><span class="p">)</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">plot_triangles</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_triangles&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>

        <span class="n">depth_scale</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;depth_scale&#39;</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">)</span>

        <span class="c1"># set the scale of the plot</span>
        <span class="k">if</span> <span class="n">depth_scale</span> <span class="o">==</span> <span class="s1">&#39;km&#39;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="mf">1000.</span>
        <span class="k">elif</span> <span class="n">depth_scale</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="mf">1000.</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.left&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="mi">12</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.right&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="mi">98</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_mesh</span><span class="p">()</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig_num</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

        <span class="c1"># plot the station marker</span>
        <span class="c1"># plots a V for the station cause when you use scatter the spacing</span>
        <span class="c1"># is variable if you change the limits of the y axis, this way it</span>
        <span class="c1"># always plots at the surface.</span>
        <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_station_locations</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="n">marker</span><span class="p">,</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;baseline&#39;</span><span class="p">,</span>
                    <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">ms</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">mc</span><span class="p">})</span>

        <span class="c1"># --&gt; make list of column lines</span>
        <span class="n">row_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">row_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span> <span class="o">/</span> <span class="n">df</span><span class="p">:</span>
            <span class="n">row_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span> <span class="n">xx</span><span class="p">])</span>
            <span class="n">row_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">row_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">])</span>
            <span class="n">row_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># plot column lines (variables are a little bit of a misnomer)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">row_line_xlist</span><span class="p">,</span>
                <span class="n">row_line_ylist</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>

        <span class="c1"># --&gt; make list of row lines</span>
        <span class="n">col_line_xlist</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">]</span>
        <span class="n">col_line_ylist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span> <span class="o">/</span> <span class="n">df</span><span class="p">:</span>
            <span class="n">col_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">])</span>
            <span class="n">col_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">col_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">yy</span><span class="p">,</span> <span class="n">yy</span><span class="p">])</span>
            <span class="n">col_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># plot row lines (variables are a little bit of a misnomer)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col_line_xlist</span><span class="p">,</span>
                <span class="n">col_line_ylist</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot_triangles</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">row_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">row_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span> <span class="o">/</span> <span class="n">df</span><span class="p">:</span>
                <span class="n">row_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span> <span class="n">xx</span><span class="p">])</span>
                <span class="n">row_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">row_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">])</span>
                <span class="n">row_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="c1"># plot columns</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">row_line_xlist</span><span class="p">,</span>
                    <span class="n">row_line_ylist</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                    <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>

            <span class="n">col_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">col_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span> <span class="o">/</span> <span class="n">df</span><span class="p">:</span>
                <span class="n">col_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">])</span>
                <span class="n">col_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">col_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">yy</span><span class="p">,</span> <span class="n">yy</span><span class="p">])</span>
                <span class="n">col_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="c1"># plot rows</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col_line_xlist</span><span class="p">,</span>
                    <span class="n">col_line_ylist</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                    <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>

            <span class="n">diag_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">diag_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">xi</span><span class="p">,</span> <span class="n">xx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">yi</span><span class="p">,</span> <span class="n">yy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">):</span>
                    <span class="n">diag_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="n">xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">])</span>
                    <span class="n">diag_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="n">diag_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="n">xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">])</span>
                    <span class="n">diag_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

                    <span class="n">diag_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">yy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span><span class="p">[</span><span class="n">yi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">])</span>
                    <span class="n">diag_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="n">diag_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span><span class="p">[</span><span class="n">yi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span> <span class="n">yy</span><span class="p">])</span>
                    <span class="n">diag_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="c1"># plot diagonal lines.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">diag_line_xlist</span><span class="p">,</span>
                    <span class="n">diag_line_ylist</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                    <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>

        <span class="c1"># --&gt; set axes properties</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_target_depth</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span> <span class="o">-</span><span class="mi">2000</span> <span class="o">/</span> <span class="n">df</span><span class="p">)</span>
        <span class="n">xpad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_x_pad_cells</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="n">xpad</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="n">xpad</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Easting (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">depth_scale</span><span class="p">),</span>
                      <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">fs</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">depth_scale</span><span class="p">),</span>
                      <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">fs</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Mesh.write_mesh_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Mesh.write_mesh_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_mesh_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">basename</span><span class="o">=</span><span class="s1">&#39;Occam2DMesh&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a finite element mesh file.</span>

<span class="sd">        Calls build_mesh if it already has not been called.        </span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>
<span class="sd">            **save_path** : string</span>
<span class="sd">                            directory path or full path to save file</span>

<span class="sd">            **basename** : string</span>
<span class="sd">                           basename of mesh file. *default* is &#39;Occam2DMesh&#39; </span>
<span class="sd">        Returns:</span>
<span class="sd">        ----------</span>
<span class="sd">            **mesh_fn** : string</span>
<span class="sd">                          full path to mesh file</span>

<span class="sd">        :example: ::</span>

<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; edi_path = r&quot;/home/mt/edi_files&quot;</span>
<span class="sd">            &gt;&gt;&gt; profile = occam2d.Profile(edi_path)</span>
<span class="sd">            &gt;&gt;&gt; profile.plot_profile()</span>
<span class="sd">            &gt;&gt;&gt; mesh = occam2d.Mesh(profile.station_locations)</span>
<span class="sd">            &gt;&gt;&gt; mesh.build_mesh()</span>
<span class="sd">            &gt;&gt;&gt; mesh.write_mesh_file(save_path=r&quot;/home/occam2d/Inv1&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">save_path</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="n">basename</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_mesh</span><span class="p">()</span>

        <span class="n">mesh_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mesh_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;MESH FILE Created by mtpy.modeling.occam2d</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">mesh_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;   </span><span class="si">{0}</span><span class="s2">  </span><span class="si">{1}</span><span class="s2">  </span><span class="si">{2}</span><span class="s2">  </span><span class="si">{0}</span><span class="s2">  </span><span class="si">{0}</span><span class="s2">  </span><span class="si">{3}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                                                     <span class="n">nz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="c1"># --&gt; write horizontal nodes</span>
        <span class="n">node_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">xnode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="p">):</span>
            <span class="n">node_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{0:&gt;9.1f}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xnode</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">node_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">mesh_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_str</span><span class="p">)</span>
                <span class="n">node_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">node_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">mesh_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_str</span><span class="p">)</span>

        <span class="c1"># --&gt; write vertical nodes</span>
        <span class="n">node_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">znode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">):</span>
            <span class="n">node_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{0:&gt;9.1f}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">znode</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">node_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">mesh_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_str</span><span class="p">)</span>
                <span class="n">node_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">node_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">mesh_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_str</span><span class="p">)</span>

        <span class="c1"># --&gt; need a 0 after the nodes</span>
        <span class="n">mesh_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;    0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># --&gt; write triangular mesh block values as ?</span>
        <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">mesh_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="p">[:,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">tt</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">mfid</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">mfid</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">mesh_lines</span><span class="p">)</span>
        <span class="n">mfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="nb">print</span> <span class="s1">&#39;Wrote Mesh file to </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mesh.read_mesh_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Mesh.read_mesh_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_mesh_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh_fn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reads an occam2d 2D mesh file</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ----------</span>
<span class="sd">            **mesh_fn** : string </span>
<span class="sd">                          full path to mesh file</span>

<span class="sd">        Populates:</span>
<span class="sd">        -----------</span>
<span class="sd">            **x_grid** : array of horizontal locations of nodes (m)</span>

<span class="sd">            **x_nodes**: array of horizontal node relative distances </span>
<span class="sd">                        (column locations (m))</span>

<span class="sd">            **z_grid** : array of vertical node locations (m)</span>

<span class="sd">            **z_nodes** : array of vertical nodes </span>
<span class="sd">                          (row locations(m))</span>

<span class="sd">            **mesh_values** : np.array of free parameters</span>

<span class="sd">        To do:</span>
<span class="sd">        ------</span>
<span class="sd">            incorporate fixed values</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d </span>
<span class="sd">            &gt;&gt;&gt; mg = occam2d.Mesh()</span>
<span class="sd">            &gt;&gt;&gt; mg.mesh_fn = r&quot;/home/mt/occam/line1/Occam2Dmesh&quot;</span>
<span class="sd">            &gt;&gt;&gt; mg.read_mesh_file()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span> <span class="o">=</span> <span class="n">mesh_fn</span>

        <span class="n">mfid</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

        <span class="n">mlines</span> <span class="o">=</span> <span class="n">mfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="n">nh</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">nv</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nh</span><span class="p">,</span> <span class="n">nv</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

        <span class="c1"># get horizontal nodes</span>
        <span class="n">h_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">v_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">m_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">line_count</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="c1"># --&gt; fill horizontal nodes</span>
        <span class="k">for</span> <span class="n">mline</span> <span class="ow">in</span> <span class="n">mlines</span><span class="p">[</span><span class="n">line_count</span><span class="p">:]:</span>
            <span class="n">mline</span> <span class="o">=</span> <span class="n">mline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">m_value</span> <span class="ow">in</span> <span class="n">mline</span><span class="p">:</span>
                <span class="nb">print</span> <span class="n">m_value</span><span class="p">,</span> <span class="n">h_index</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">h_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">m_value</span><span class="p">)</span>
                <span class="n">h_index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">h_index</span> <span class="o">==</span> <span class="n">nh</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="n">line_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">h_index</span> <span class="o">==</span> <span class="n">nh</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">break</span>

                <span class="c1"># --&gt; fill vertical nodes</span>
        <span class="k">for</span> <span class="n">mline</span> <span class="ow">in</span> <span class="n">mlines</span><span class="p">[</span><span class="n">line_count</span><span class="p">:]:</span>
            <span class="n">mline</span> <span class="o">=</span> <span class="n">mline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">m_value</span> <span class="ow">in</span> <span class="n">mline</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">[</span><span class="n">v_index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">m_value</span><span class="p">)</span>
                <span class="n">v_index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">v_index</span> <span class="o">==</span> <span class="n">nv</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="n">line_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">v_index</span> <span class="o">==</span> <span class="n">nv</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">line_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># --&gt; fill model values</span>
        <span class="k">for</span> <span class="n">ll</span><span class="p">,</span> <span class="n">mline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mlines</span><span class="p">[</span><span class="n">line_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">line_count</span><span class="p">):</span>
            <span class="n">mline</span> <span class="o">=</span> <span class="n">mline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">m_index</span> <span class="o">==</span> <span class="n">nv</span> <span class="ow">or</span> <span class="n">mline</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;exception&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mline</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mlist</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nh</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="s1">&#39;--- Line </span><span class="si">{0}</span><span class="s1"> in </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span><span class="p">)</span>
                    <span class="nb">print</span> <span class="s1">&#39;Check mesh file too many columns&#39;</span>
                    <span class="nb">print</span> <span class="s1">&#39;Should be </span><span class="si">{0}</span><span class="s1">, has </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nh</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mlist</span><span class="p">))</span>
                    <span class="n">mlist</span> <span class="o">=</span> <span class="n">mlist</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nh</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">jj</span><span class="p">,</span> <span class="n">mvalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">mlist</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span> <span class="n">m_index</span><span class="p">,</span> <span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">mline</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
                <span class="n">m_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># sometimes it seems that the number of nodes is not the same as the</span>
        <span class="c1"># header would suggest so need to remove the zeros</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">nh</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">new_nh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="nb">print</span> <span class="s1">&#39;The header number </span><span class="si">{0}</span><span class="s1"> should read </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nh</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">new_nh</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">new_nh</span><span class="p">,</span> <span class="n">nv</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_nh</span> <span class="o">=</span> <span class="n">nh</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">nv</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">new_nv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="nb">print</span> <span class="s1">&#39;The header number </span><span class="si">{0}</span><span class="s1"> should read </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nv</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">new_nv</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">new_nh</span><span class="p">,</span> <span class="n">nv</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="c1"># make x_grid and z_grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[:</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">[:</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span></div></div>


<div class="viewcode-block" id="Profile"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Profile">[docs]</a><span class="k">class</span> <span class="nc">Profile</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes data from .edi files to create a profile line for 2D modeling.</span>
<span class="sd">    Can project the stations onto a profile that is perpendicular to strike</span>
<span class="sd">    or a given profile direction.</span>

<span class="sd">    If _rotate_to_strike is True, the impedance tensor and tipper are rotated</span>
<span class="sd">    to align with the geoelectric strike angle.</span>

<span class="sd">    If _rotate_to_strike is True and geoelectric_strike is not given, </span>
<span class="sd">    then it is calculated using the phase tensor.  First, 2D sections are</span>
<span class="sd">    estimated from the impedance tensor then the strike is estimated from the</span>
<span class="sd">    phase tensor azimuth + skew.  This angle is then used to project the </span>
<span class="sd">    stations perpendicular to the strike angle.</span>

<span class="sd">    If you want to project onto an angle not perpendicular to strike, give</span>
<span class="sd">    profile_angle and set _rotate_to_strike to False.  This will project</span>
<span class="sd">    the impedance tensor and tipper to be perpendicular with the </span>
<span class="sd">    profile_angle.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    -----------</span>

<span class="sd">        **edi_path** : string</span>
<span class="sd">                       full path to edi files</span>

<span class="sd">        **station_list** : list of stations to create profile for if None is</span>
<span class="sd">                           given all .edi files in edi_path will be used.</span>
<span class="sd">                           .. note:: that algorithm assumes .edi files are </span>
<span class="sd">                                     named by station and it only looks for </span>
<span class="sd">                                     the station within the .edi file name</span>
<span class="sd">                                     it does not match exactly, so if you have</span>
<span class="sd">                                     .edi files with similar names there</span>
<span class="sd">                                     might be some problems.</span>

<span class="sd">        **geoelectric_strike** : float</span>
<span class="sd">                                 geoelectric strike direction in degrees </span>
<span class="sd">                                 assuming 0 is North and East is 90</span>

<span class="sd">        **profile_angle** : float</span>
<span class="sd">                            angle to project the stations onto a profile line</span>
<span class="sd">                            .. note:: the geoelectric strike angle and </span>
<span class="sd">                                      profile angle should be orthogonal for</span>
<span class="sd">                                      best results from 2D modeling.</span>


<span class="sd">    ======================= ===================================================</span>
<span class="sd">    **Attributes**          Description    </span>
<span class="sd">    ======================= ===================================================</span>
<span class="sd">    edi_list                list of mtpy.core.mt.MT instances for each .edi</span>
<span class="sd">                            file found in edi_path </span>
<span class="sd">    elevation_model         numpy.ndarray(3, num_elevation_points) elevation</span>
<span class="sd">                            values for the profile line (east, north, elev)</span>
<span class="sd">    geoelectric_strike      geoelectric strike direction assuming N == 0</span>
<span class="sd">    profile_angle           angle of profile line assuming N == 0</span>
<span class="sd">    profile_line            (slope, N-intercept) of profile line</span>
<span class="sd">    _profile_generated      [ True | False ] True if profile has already been </span>
<span class="sd">                            generated</span>
<span class="sd">    edi_path                path to find .edi files</span>
<span class="sd">    station_list            list of stations to extract from edi_path</span>
<span class="sd">    num_edi                 number of edi files to create a profile for</span>
<span class="sd">    _rotate_to_strike       [ True | False] True to project the stations onto</span>
<span class="sd">                            a line that is perpendicular to geoelectric strike</span>
<span class="sd">                            also Z and Tipper are rotated to strike direction.</span>
<span class="sd">    ======================= ===================================================</span>

<span class="sd">    .. note:: change _rotate_to_strike to False if you want to project the </span>
<span class="sd">              stations onto a given profile direction.  This will rotate</span>
<span class="sd">              Z and Tipper to be orthogonal to this direction</span>

<span class="sd">    ======================= ===================================================</span>
<span class="sd">    Methods                 Description</span>
<span class="sd">    ======================= ===================================================</span>
<span class="sd">    generate_profile        generates a profile for the given stations</span>
<span class="sd">    plot_profile            plots the profile line along with original station</span>
<span class="sd">                            locations to compare.  </span>
<span class="sd">    ======================= ===================================================</span>

<span class="sd">    :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.occam2d as occam</span>
<span class="sd">        &gt;&gt;&gt; edi_path = r&quot;/home/mt/edi_files&quot;</span>
<span class="sd">        &gt;&gt;&gt; station_list = [&#39;mt{0:03}&#39;.format(ss) for ss in range(0, 15)]</span>
<span class="sd">        &gt;&gt;&gt; prof_line = occam.Profile(edi_path, station_list=station_list)</span>
<span class="sd">        &gt;&gt;&gt; prof_line.plot_profile()</span>
<span class="sd">        &gt;&gt;&gt; #if you want to project to a given strike</span>
<span class="sd">        &gt;&gt;&gt; prof_line.geoelectric_strike = 36.7</span>
<span class="sd">        &gt;&gt;&gt; prof_line.generate_profile()</span>
<span class="sd">        &gt;&gt;&gt; prof_line.plot_profile()</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edi_path</span> <span class="o">=</span> <span class="n">edi_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_list&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;geoelectric_strike&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;profile_angle&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_to_strike</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_edi</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profile_generated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_line</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elevation_model</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;elevation_model&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elevation_profile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimate_elevation</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_get_edi_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get a list of edi files that coorespond to the station list</span>

<span class="sd">        each element of the list is a mtpy.core.mt.MT object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_path</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">edi</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">station</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">edi</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;edi&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mt</span><span class="o">.</span><span class="n">MT</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_path</span><span class="p">,</span>
                                                                <span class="n">edi</span><span class="p">)))</span>
                        <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">mt</span><span class="o">.</span><span class="n">MT</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_path</span><span class="p">,</span> <span class="n">edi</span><span class="p">))</span> <span class="k">for</span>
                             <span class="n">edi</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_path</span><span class="p">)</span>
                             <span class="k">if</span> <span class="n">edi</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;edi&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_edi</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">edi</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">edi</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">edi</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">)</span>

<div class="viewcode-block" id="Profile.generate_profile"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Profile.generate_profile">[docs]</a>    <span class="k">def</span> <span class="nf">generate_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate linear profile by regression of station locations.</span>

<span class="sd">        If profile_angle is not None, then station are projected onto that </span>
<span class="sd">        line.  Else, the a geoelectric strike is calculated from the data</span>
<span class="sd">        and the stations are projected onto an angle perpendicular to the</span>
<span class="sd">        estimated strike direction.  If _rotate_to_strike is True, the </span>
<span class="sd">        impedance tensor and Tipper data are rotated to align with strike.</span>
<span class="sd">        Else, data is not rotated to strike.</span>

<span class="sd">        To project stations onto a given line, set profile_angle and </span>
<span class="sd">        _rotate_to_strike to False.  This will project the stations onto </span>
<span class="sd">        profile_angle and rotate the impedance tensor and tipper to be </span>
<span class="sd">        perpendicular to the profile_angle.  </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_get_edi_list</span><span class="p">()</span>

        <span class="n">strike_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_edi</span><span class="p">)</span>

        <span class="n">easts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_edi</span><span class="p">)</span>
        <span class="n">norths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_edi</span><span class="p">)</span>
        <span class="n">utm_zones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_edi</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">edi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">):</span>
            <span class="c1"># find strike angles for each station if a strike angle is not</span>
            <span class="c1"># given</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># check dimensionality to be sure strike is estimate for 2D</span>
                    <span class="n">dim</span> <span class="o">=</span> <span class="n">MTgy</span><span class="o">.</span><span class="n">dimensionality</span><span class="p">(</span><span class="n">z_object</span><span class="o">=</span><span class="n">edi</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
                    <span class="c1"># get strike for only those periods</span>
                    <span class="n">gstrike</span> <span class="o">=</span> <span class="n">MTgy</span><span class="o">.</span><span class="n">strike_angle</span><span class="p">(</span>
                        <span class="n">edi</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)])[:,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">strike_angles</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">gstrike</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="n">easts</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">edi</span><span class="o">.</span><span class="n">east</span>
            <span class="n">norths</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">edi</span><span class="o">.</span><span class="n">north</span>
            <span class="n">utm_zones</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">edi</span><span class="o">.</span><span class="n">utm_zone</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span>
                <span class="s1">&#39;Could not find and .edi file in </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_path</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># might try mode here instead of mean</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span>
                    <span class="n">strike_angles</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">strike_angles</span><span class="p">)])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># empty list or so....</span>
                <span class="c1"># can happen, if everyhing is just 1D</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="c1"># need to check the zones of the stations</span>
        <span class="n">main_utmzone</span> <span class="o">=</span> <span class="n">mode</span><span class="p">(</span><span class="n">utm_zones</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">zone</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">utm_zones</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">zone</span> <span class="o">==</span> <span class="n">main_utmzone</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;station </span><span class="si">{0}</span><span class="s1"> is out of main utm zone&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">station</span><span class="p">)</span> <span class="o">+</span>
                       <span class="s1">&#39; will not be included in profile&#39;</span><span class="p">)</span>

        <span class="c1"># check regression for 2 profile orientations:</span>
        <span class="c1"># horizontal (N=N(E)) or vertical(E=E(N))</span>
        <span class="c1"># use the one with the lower standard deviation</span>
        <span class="n">profile1</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">easts</span><span class="p">,</span> <span class="n">norths</span><span class="p">)</span>
        <span class="n">profile2</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">norths</span><span class="p">,</span> <span class="n">easts</span><span class="p">)</span>
        <span class="n">profile_line</span> <span class="o">=</span> <span class="n">profile1</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1"># if the profile is rather E=E(N), the parameters have to converted</span>
        <span class="c1"># into N=N(E) form:</span>
        <span class="k">if</span> <span class="n">profile2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">profile1</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
            <span class="n">profile_line</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">profile2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">profile2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">profile2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_line</span> <span class="o">=</span> <span class="n">profile_line</span>
        <span class="c1"># profile_line = sp.polyfit(lo_easts, lo_norths, 1)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">=</span> <span class="p">(</span>
                <span class="mi">90</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">profile_line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">%</span> <span class="mi">180</span>
        <span class="c1"># rotate Z according to strike angle,</span>

        <span class="c1"># if strike was explicitely given, use that value!</span>

        <span class="c1"># otherwise:</span>
        <span class="c1"># have 90 degree ambiguity in strike determination</span>
        <span class="c1"># choose strike which offers larger angle with profile</span>
        <span class="c1"># if profile azimuth is in [0,90].</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_to_strike</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">&lt;</span> <span class="mi">90</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">45</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">+=</span> <span class="mi">90</span>
            <span class="k">elif</span> <span class="mi">90</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">&lt;</span> <span class="mi">135</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">&lt;</span> <span class="mi">45</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">-=</span> <span class="mi">90</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">&gt;=</span> <span class="mi">135</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">+=</span> <span class="mi">90</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">%</span> <span class="mi">180</span>

        <span class="c1"># rotate components of Z and Tipper to align with geoelectric strike</span>
        <span class="c1"># which should now be perpendicular to the profile strike</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_to_strike</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">+</span> <span class="mi">90</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">90</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span><span class="p">))</span>
            <span class="c1"># need to project the y-intercept to the new angle</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">)</span> <span class="o">*</span> <span class="n">easts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile_line</span> <span class="o">=</span> <span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">:</span>
                <span class="n">edi</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">-</span> <span class="n">edi</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">)</span>
                <span class="c1"># rotate tipper to profile azimuth, not strike.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">edi</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span> <span class="o">%</span> <span class="mi">180</span> <span class="o">-</span>
                                      <span class="n">edi</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotation_angle</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">edi</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span> <span class="o">%</span> <span class="mi">180</span> <span class="o">-</span>
                                      <span class="n">edi</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">)</span>

            <span class="nb">print</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">72</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Rotated Z and Tipper to align with &#39;</span>
                   <span class="s1">&#39;</span><span class="si">{0:+.2f}</span><span class="s1"> degrees E of N&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span><span class="p">))</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Profile angle is &#39;</span>
                   <span class="s1">&#39;</span><span class="si">{0:+.2f}</span><span class="s1"> degrees E of N&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span><span class="p">))</span>
            <span class="nb">print</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">72</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">:</span>
                <span class="n">edi</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">rotate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span> <span class="o">%</span>
                             <span class="mi">180</span> <span class="o">-</span> <span class="n">edi</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">)</span>
                <span class="c1"># rotate tipper to profile azimuth, not strike.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">edi</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span> <span class="o">%</span> <span class="mi">180</span> <span class="o">-</span>
                                      <span class="n">edi</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotation_angle</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">edi</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span> <span class="o">%</span> <span class="mi">180</span> <span class="o">-</span>
                                      <span class="n">edi</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">)</span>

            <span class="nb">print</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">72</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Rotated Z and Tipper to be perpendicular  with &#39;</span>
                   <span class="s1">&#39;</span><span class="si">{0:+.2f}</span><span class="s1"> profile angle&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span> <span class="o">%</span> <span class="mi">180</span><span class="p">))</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Profile angle is &#39;</span>
                   <span class="s1">&#39;</span><span class="si">{0:+.2f}</span><span class="s1"> degrees E of N&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span><span class="p">))</span>
            <span class="nb">print</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">72</span>

        <span class="c1"># --&gt; project stations onto profile line</span>
        <span class="n">projected_stations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_edi</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_edi</span><span class="p">)</span>

        <span class="c1"># create profile vector</span>
        <span class="n">profile_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="c1"># be sure the amplitude is 1 for a unit vector</span>
        <span class="n">profile_vector</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">profile_vector</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">edi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">):</span>
            <span class="n">station_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="n">easts</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">norths</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">profile_vector</span><span class="p">,</span> <span class="n">station_vector</span><span class="p">)</span> <span class="o">*</span> <span class="n">profile_vector</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
            <span class="n">edi</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
            <span class="n">edi</span><span class="o">.</span><span class="n">projected_east</span> <span class="o">=</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">edi</span><span class="o">.</span><span class="n">projected_north</span> <span class="o">=</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">projected_stations</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                      <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="c1"># set the first station to 0</span>
        <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">:</span>
            <span class="n">edi</span><span class="o">.</span><span class="n">offset</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="c1"># Sort from West to East:</span>
        <span class="n">index_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Exception: sort from North to South</span>
            <span class="n">index_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">norths</span><span class="p">)</span>

        <span class="c1"># sorting along the profile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">index_sort</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                                           <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">index_sort</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_elevation</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project_elevation</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_profile_generated</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Profile.project_elevation"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Profile.project_elevation">[docs]</a>    <span class="k">def</span> <span class="nf">project_elevation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elevation_model</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        projects elevation data into the profile</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -------------</span>
<span class="sd">            **elevation_model** : np.ndarray(3, num_elevation_points)</span>
<span class="sd">                                  (east, north, elevation)</span>
<span class="sd">                                  for now needs to be in utm coordinates</span>
<span class="sd">                                  if None then elevation is taken from edi_list</span>

<span class="sd">        Returns:</span>
<span class="sd">        ----------</span>
<span class="sd">            **elevation_profile** : </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elevation_model</span> <span class="o">=</span> <span class="n">elevation_model</span>

        <span class="c1"># --&gt; get an elevation model for the mesh</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elevation_model</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elevation_profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elevation_profile</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ss</span>
                                                     <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elevation_profile</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">edi</span><span class="o">.</span><span class="n">elev</span>
                                                     <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">])</span>

        <span class="c1"># --&gt; project known elevations onto the profile line</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elevation_profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elevation_model</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="c1"># create profile vector</span>
            <span class="n">profile_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="c1"># be sure the amplitude is 1 for a unit vector</span>
            <span class="n">profile_vector</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">profile_vector</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elevation_model</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">east</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elevation_model</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span>
                <span class="n">north</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elevation_model</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span>
                <span class="n">elev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elevation_model</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span>
                <span class="n">elev_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">east</span><span class="p">,</span> <span class="n">north</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">profile_vector</span><span class="p">,</span> <span class="n">elev_vector</span><span class="p">)</span> <span class="o">*</span> <span class="n">profile_vector</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">elevation_profile</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">elevation_profile</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">elev</span></div>

<div class="viewcode-block" id="Profile.plot_profile"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Profile.plot_profile">[docs]</a>    <span class="k">def</span> <span class="nf">plot_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the projected profile line along with original station locations</span>
<span class="sd">        to make sure the line projected is correct.</span>

<span class="sd">        ===================== =================================================</span>
<span class="sd">        Key Words             Description          </span>
<span class="sd">        ===================== =================================================</span>
<span class="sd">        fig_dpi               dots-per-inch resolution of figure</span>
<span class="sd">                              *default* is 300</span>
<span class="sd">        fig_num               number if figure instance</span>
<span class="sd">                              *default* is &#39;Projected Profile&#39;</span>
<span class="sd">        fig_size              size of figure in inches (width, height)</span>
<span class="sd">                              *default* is [5, 5]</span>
<span class="sd">        fs                    [ float ] font size in points of axes tick labels</span>
<span class="sd">                              axes labels are fs+2</span>
<span class="sd">                              *default* is 6</span>
<span class="sd">        lc                    [ string | (r, g, b) ]color of profile line </span>
<span class="sd">                              (see matplotlib.line for options)</span>
<span class="sd">                              *default* is &#39;b&#39; -- blue</span>
<span class="sd">        lw                    float, width of profile line in points</span>
<span class="sd">                              *default* is 1</span>
<span class="sd">        marker                [ string ] marker for stations </span>
<span class="sd">                              (see matplotlib.pyplot.plot) for options  </span>
<span class="sd">        mc                    [ string | (r, g, b) ] color of projected </span>
<span class="sd">                              stations.  *default* is &#39;k&#39; -- black</span>
<span class="sd">        ms                    [ float ] size of station marker</span>
<span class="sd">                              *default* is 5</span>
<span class="sd">        station_id            [min, max] index values for station labels</span>
<span class="sd">                              *default* is None</span>
<span class="sd">        ===================== =================================================</span>

<span class="sd">        :Example: ::</span>
<span class="sd">            &gt;&gt;&gt; edipath = r&quot;/home/mt/edi_files&quot;</span>
<span class="sd">            &gt;&gt;&gt; pr = occam2d.Profile(edi_path=edipath)</span>
<span class="sd">            &gt;&gt;&gt; pr.generate_profile()</span>
<span class="sd">            &gt;&gt;&gt; # set station labels to only be from 1st to 4th index </span>
<span class="sd">            &gt;&gt;&gt; # of station name</span>
<span class="sd">            &gt;&gt;&gt; pr.plot_profile(station_id=[0,4])</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig_num</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_num&#39;</span><span class="p">,</span> <span class="s1">&#39;Projected Profile&#39;</span><span class="p">)</span>
        <span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_size&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
        <span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_dpi&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;marker&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">)</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mc&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">lc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lc&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">lw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ls&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">station_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.left&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="mi">12</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.right&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="mi">98</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile_generated</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_profile</span><span class="p">()</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig_num</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">:</span>
            <span class="n">m1</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edi</span><span class="o">.</span><span class="n">projected_east</span><span class="p">,</span> <span class="n">edi</span><span class="o">.</span><span class="n">projected_north</span><span class="p">,</span>
                          <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="n">mc</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="n">mc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">lc</span><span class="p">)</span>

            <span class="n">m2</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edi</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="n">edi</span><span class="o">.</span><span class="n">north</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                          <span class="n">ms</span><span class="o">=.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">ms</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span> <span class="o">.</span><span class="mi">6</span><span class="p">,</span> <span class="o">.</span><span class="mi">6</span><span class="p">),</span> <span class="n">mec</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span> <span class="o">.</span><span class="mi">6</span><span class="p">,</span> <span class="o">.</span><span class="mi">6</span><span class="p">),</span>
                          <span class="n">color</span><span class="o">=</span><span class="n">lc</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">station_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">edi</span><span class="o">.</span><span class="n">projected_east</span><span class="p">,</span> <span class="n">edi</span><span class="o">.</span><span class="n">projected_north</span> <span class="o">*</span> <span class="mf">1.00025</span><span class="p">,</span>
                        <span class="n">edi</span><span class="o">.</span><span class="n">station</span><span class="p">,</span>
                        <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;baseline&#39;</span><span class="p">,</span>
                        <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">fs</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">edi</span><span class="o">.</span><span class="n">projected_east</span><span class="p">,</span> <span class="n">edi</span><span class="o">.</span><span class="n">projected_north</span> <span class="o">*</span> <span class="mf">1.00025</span><span class="p">,</span>
                        <span class="n">edi</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="n">station_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">station_id</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                        <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;baseline&#39;</span><span class="p">,</span>
                        <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">fs</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

        <span class="n">peasts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">edi</span><span class="o">.</span><span class="n">projected_east</span> <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">])</span>
        <span class="n">pnorths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">edi</span><span class="o">.</span><span class="n">projected_north</span> <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">])</span>
        <span class="n">easts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">edi</span><span class="o">.</span><span class="n">east</span> <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">])</span>
        <span class="n">norths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">edi</span><span class="o">.</span><span class="n">north</span> <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">])</span>

        <span class="n">ploty</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_line</span><span class="p">,</span> <span class="n">easts</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">easts</span><span class="p">,</span> <span class="n">ploty</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">lc</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original/Projected Stations&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="nb">min</span><span class="p">([</span><span class="n">norths</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">pnorths</span><span class="o">.</span><span class="n">min</span><span class="p">()])</span> <span class="o">*</span> <span class="o">.</span><span class="mi">999</span><span class="p">,</span>
                     <span class="nb">max</span><span class="p">([</span><span class="n">norths</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">pnorths</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span> <span class="o">*</span> <span class="mf">1.001</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="nb">min</span><span class="p">([</span><span class="n">easts</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">peasts</span><span class="o">.</span><span class="n">min</span><span class="p">()])</span> <span class="o">*</span> <span class="o">.</span><span class="mi">98</span><span class="p">,</span>
                     <span class="nb">max</span><span class="p">([</span><span class="n">easts</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">peasts</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span> <span class="o">*</span> <span class="mf">1.02</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Easting (m)&#39;</span><span class="p">,</span>
                      <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">fs</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Northing (m)&#39;</span><span class="p">,</span>
                      <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">fs</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Projected&#39;</span><span class="p">,</span> <span class="s1">&#39;Original&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span>
                  <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">fs</span><span class="p">})</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="Regularization"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Regularization">[docs]</a><span class="k">class</span> <span class="nc">Regularization</span><span class="p">(</span><span class="n">Mesh</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a regularization grid based on Mesh.  Note that Mesh is inherited</span>
<span class="sd">    by Regularization, therefore the intended use is to build a mesh with </span>
<span class="sd">    the Regularization class.</span>

<span class="sd">    The regularization grid is what Occam calculates the inverse model on.</span>
<span class="sd">    Setup is tricky and can be painful, as you can see it is not quite fully</span>
<span class="sd">    functional yet, as it cannot incorporate topography yet.  It seems like </span>
<span class="sd">    you&#39;d like to have the regularization setup so that your target depth is </span>
<span class="sd">    covered well, in that the regularization blocks to this depth are </span>
<span class="sd">    sufficiently small to resolve resistivity structure at that depth.  </span>
<span class="sd">    Finally, you want the regularization to go to a half space at the bottom, </span>
<span class="sd">    basically one giant block.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    -----------</span>
<span class="sd">        **station_locations** : np.ndarray(n_stations)</span>
<span class="sd">                                array of station locations along a profile</span>
<span class="sd">                                line in meters.</span>

<span class="sd">    ======================= ===================================================</span>
<span class="sd">    Key Words/Attributes    Description    </span>
<span class="sd">    ======================= ===================================================</span>
<span class="sd">    air_key                 letter associated with the value of air </span>
<span class="sd">                            *default* is 0</span>
<span class="sd">    air_value               value given to an air cell, *default* is 1E13</span>
<span class="sd">    binding_offset          offset from the right side of the furthest left</span>
<span class="sd">                            hand model block in meters.  The regularization</span>
<span class="sd">                            grid is setup such that this should be 0.</span>
<span class="sd">    cell_width              width of cells with in station area in meters</span>
<span class="sd">                            *default* is 100</span>
<span class="sd">    description             description of the model for the model file.</span>
<span class="sd">                            *default* is &#39;simple inversion&#39;</span>
<span class="sd">    elevation_profile       elevation profile along the profile line.</span>
<span class="sd">                            given as np.ndarray(nx, 2), where the elements</span>
<span class="sd">                            are x_location, elevation.  If elevation profile</span>
<span class="sd">                            is given add_elevation is called automatically.</span>
<span class="sd">                            *default* is None</span>
<span class="sd">    mesh_fn                 full path to mesh file.</span>
<span class="sd">    mesh_values             letter values of each triangular mesh element</span>
<span class="sd">                            if the cell is free value is ?</span>
<span class="sd">    model_columns</span>
<span class="sd">    model_name</span>
<span class="sd">    model_rows</span>

<span class="sd">    min_block_width         [ float ] minimum model block width in meters, </span>
<span class="sd">                            *default* is 2*cell_width</span>
<span class="sd">    n_layers                number of vertical layers in mesh</span>
<span class="sd">                            *default* is 90 </span>
<span class="sd">    num_free_param          [ int ] number of free parameters in the model.</span>
<span class="sd">                            this is a tricky number to estimate apparently. </span>
<span class="sd">    num_layers              [ int ] number of regularization layers.</span>
<span class="sd">    num_x_pad_cells         number of horizontal padding cells outside the</span>
<span class="sd">                            the station area that will increase in size</span>
<span class="sd">                            by x_pad_multiplier. *default* is 7</span>
<span class="sd">    num_x_pad_small_cells   number of horizonal padding cells just outside </span>
<span class="sd">                            the station area with width cell_width.  This is </span>
<span class="sd">                            to extend the station area if needed.  </span>
<span class="sd">                            *default* is 2 </span>
<span class="sd">    num_z_pad_cells         number of vertical padding cells below </span>
<span class="sd">                            z_target_depth down to z_bottom. *default* is 5</span>
<span class="sd">    prejudice_fn            full path to prejudice file </span>
<span class="sd">                            *default* is &#39;none&#39;</span>
<span class="sd">    reg_basename            basename of regularization file (model file)</span>
<span class="sd">                            *default* is &#39;Occam2DModel&#39;</span>
<span class="sd">    reg_fn                  full path to regularization file (model file)</span>
<span class="sd">                            *default* is save_path/reg_basename</span>
<span class="sd">    rel_station_locations   relative station locations within the mesh.  The</span>
<span class="sd">                            locations are relative to the center of the station</span>
<span class="sd">                            area.  *default* is None, filled later</span>
<span class="sd">    save_path               full path to save mesh and model file to. </span>
<span class="sd">                            *default* is current working directory.</span>
<span class="sd">    statics_fn              full path to static shift file</span>
<span class="sd">                            Static shifts in occam may not work.</span>
<span class="sd">                            *default* is &#39;none&#39;</span>
<span class="sd">    station_locations       location of stations in meters, can be on a </span>
<span class="sd">                            relative grid or in UTM.</span>
<span class="sd">    trigger                 [ float ] multiplier to merge model blocks at </span>
<span class="sd">                            depth.  A higher number increases the number of</span>
<span class="sd">                            model blocks at depth.  *default* is .65</span>
<span class="sd">    x_grid                  location of horizontal grid nodes in meters</span>
<span class="sd">    x_nodes                 relative spacing between grid nodes</span>
<span class="sd">    x_pad_multiplier        horizontal padding cells will increase by this</span>
<span class="sd">                            multiple out to the edge of the grid.</span>
<span class="sd">                            *default* is 1.5</span>
<span class="sd">    z1_layer                thickness of the first layer in the model.</span>
<span class="sd">                            Should be at least 1/4 of the first skin depth</span>
<span class="sd">                            *default* is 10</span>
<span class="sd">    z_bottom                bottom depth of the model (m).  Needs to be large </span>
<span class="sd">                            enough to be 1D at the edge. </span>
<span class="sd">                            *default* is 200000.0 </span>
<span class="sd">    z_grid                  location of vertical nodes in meters</span>
<span class="sd">    z_nodes                 relative distance between vertical nodes in meters</span>
<span class="sd">    z_target_depth          depth to deepest target of interest.  Below this</span>
<span class="sd">                            depth cells will be padded to z_bottom</span>
<span class="sd">    ======================= ===================================================</span>

<span class="sd">    .. note:: regularization does not work with topography yet.  Having </span>
<span class="sd">              problems calculating the number of free parameters.</span>

<span class="sd">    ========================= =================================================</span>
<span class="sd">    Methods                   Description</span>
<span class="sd">    ========================= =================================================</span>
<span class="sd">    add_elevation             adds elevation to the mesh given elevation</span>
<span class="sd">                              profile.  </span>
<span class="sd">    build_mesh                builds the mesh given the attributes of Mesh.  If</span>
<span class="sd">                              elevation_profile is not None, add_elevation is</span>
<span class="sd">                              called inside build_mesh</span>
<span class="sd">    build_regularization      builds the regularization grid from the build mesh</span>
<span class="sd">                              be sure to plot the grids before starting the</span>
<span class="sd">                              inversion to make sure coverage is appropriate.</span>
<span class="sd">    get_num_free_param        estimate the number of free parameters.  </span>
<span class="sd">                              **This is a work in progress**</span>
<span class="sd">    plot_mesh                 plots the built mesh with station location.  </span>
<span class="sd">    read_mesh_file            reads in an existing mesh file and populates the </span>
<span class="sd">                              appropriate attributes.</span>
<span class="sd">    read_regularization_file  read in existing regularization file, populates</span>
<span class="sd">                              apporopriate attributes  </span>
<span class="sd">    write_mesh_file           writes a mesh file to save_path</span>
<span class="sd">    write_regularization_file writes a regularization file</span>
<span class="sd">    ======================= ===================================================</span>

<span class="sd">    :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; edipath = r&quot;/home/mt/edi_files&quot;</span>
<span class="sd">        &gt;&gt;&gt; profile = occam2d.Profile(edi_path=edi_path)</span>
<span class="sd">        &gt;&gt;&gt; profile.generate_profile()</span>
<span class="sd">        &gt;&gt;&gt; reg = occam2d.Regularization(profile.station_locations)</span>
<span class="sd">        &gt;&gt;&gt; reg.build_mesh()</span>
<span class="sd">        &gt;&gt;&gt; reg.build_regularization()</span>
<span class="sd">        &gt;&gt;&gt; reg.save_path = r&quot;/home/occam2d/Line1/Inv1&quot;</span>
<span class="sd">        &gt;&gt;&gt; reg.write_regularization_file()</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">station_locations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Be sure to initialize Mesh</span>
        <span class="n">Mesh</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">station_locations</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">min_block_width</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;min_block_width&#39;</span><span class="p">,</span>
                                          <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_width</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;trigger&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">75</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_columns</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binding_offset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg_fn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg_basename</span> <span class="o">=</span> <span class="s1">&#39;Occam2DModel&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;model made by mtpy.modeling.occam2d&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;simple Inversion&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_param</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_free_param</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statics_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;statics_fn&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prejudice_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prejudice_fn&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;num_layers&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># --&gt; build mesh</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_mesh</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_regularization</span><span class="p">()</span>

<div class="viewcode-block" id="Regularization.build_regularization"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Regularization.build_regularization">[docs]</a>    <span class="k">def</span> <span class="nf">build_regularization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds larger boxes around existing mesh blocks for the regularization.</span>
<span class="sd">        As the model deepens the regularization boxes get larger.  </span>

<span class="sd">        The regularization boxes are merged mesh cells as prescribed by the</span>
<span class="sd">        Occam method.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># list of the mesh columns to combine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># list of mesh rows to combine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># At the top of the mesh model blocks will be 2 combined mesh blocks</span>
        <span class="c1"># Note that the padding cells are combined into one model block</span>
        <span class="n">station_col</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">num_x_pad_cells</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">model_cols</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_x_pad_cells</span><span class="p">]</span> <span class="o">+</span> \
            <span class="n">station_col</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_x_pad_cells</span><span class="p">]</span>
        <span class="n">station_widths</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span>
                          <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_x_pad_cells</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_x_pad_cells</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>

        <span class="n">pad_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_x_pad_cells</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">model_widths</span> <span class="o">=</span> <span class="p">[</span><span class="n">pad_width</span><span class="p">]</span> <span class="o">+</span> <span class="n">station_widths</span> <span class="o">+</span> <span class="p">[</span><span class="n">pad_width</span><span class="p">]</span>
        <span class="n">num_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_cols</span><span class="p">)</span>

        <span class="n">model_thickness</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">num_z_pad_cells</span><span class="p">],</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">num_z_pad_cells</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_param</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># --&gt; now need to calulate model blocks to the bottom of the model</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">model_cols</span><span class="p">)</span>
        <span class="n">widths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">model_widths</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">zz</span><span class="p">,</span> <span class="n">thickness</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_thickness</span><span class="p">):</span>
            <span class="c1"># index for model column blocks from first_row, start at 1 because</span>
            <span class="c1"># 0 is for padding cells</span>
            <span class="n">block_index</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">num_rows</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">zz</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">num_rows</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">zz</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_thickness</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">num_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_z_pad_cells</span>
            <span class="k">while</span> <span class="n">block_index</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">num_cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># check to see if horizontally merged mesh cells are not larger</span>
                <span class="c1"># than the thickness times trigger</span>
                <span class="k">if</span> <span class="n">thickness</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger</span> <span class="o">*</span> <span class="p">(</span><span class="n">widths</span><span class="p">[</span><span class="n">block_index</span><span class="p">]</span> <span class="o">+</span>
                                               <span class="n">widths</span><span class="p">[</span><span class="n">block_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]):</span>
                    <span class="n">block_index</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="c1"># merge 2 neighboring cells to avoid vertical exaggerations</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">widths</span><span class="p">[</span><span class="n">block_index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">widths</span><span class="p">[</span><span class="n">block_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">columns</span><span class="p">[</span><span class="n">block_index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">columns</span><span class="p">[</span><span class="n">block_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="c1"># remove one of the merged cells</span>
                    <span class="n">widths</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">block_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">columns</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">block_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="n">num_cols</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_param</span> <span class="o">+=</span> <span class="n">num_cols</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">model_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">columns</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">])</span>

        <span class="c1"># calculate the distance from the right side of the furthest left</span>
        <span class="c1"># model block to the furthest left station which is half the distance</span>
        <span class="c1"># from the center of the mesh grid.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binding_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_x_pad_cells</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_num_free_params</span><span class="p">()</span>

        <span class="nb">print</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">55</span>
        <span class="nb">print</span> <span class="s1">&#39;</span><span class="si">{0:^55}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;regularization parameters&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="nb">print</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">55</span>
        <span class="nb">print</span> <span class="s1">&#39;   binding offset       = </span><span class="si">{0:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binding_offset</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s1">&#39;   number layers        = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_columns</span><span class="p">))</span>
        <span class="nb">print</span> <span class="s1">&#39;   number of parameters = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_param</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s1">&#39;   number of free param = </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_free_param</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">55</span></div>

<div class="viewcode-block" id="Regularization.get_num_free_params"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Regularization.get_num_free_params">[docs]</a>    <span class="k">def</span> <span class="nf">get_num_free_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        estimate the number of free parameters in model mesh.</span>

<span class="sd">        I&#39;m assuming that if there are any fixed parameters in the block, then</span>
<span class="sd">        that model block is assumed to be fixed. Not sure if this is right</span>
<span class="sd">        cause there is no documentation.</span>

<span class="sd">        **DOES NOT WORK YET**</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_free_param</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">row_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># loop over columns and rows of regularization grid</span>
        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="p">):</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">col_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">cc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
                <span class="c1"># make a model block from the index values of the regularization</span>
                <span class="c1"># grid</span>
                <span class="n">model_block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="p">[</span><span class="n">row_count</span><span class="p">:</span><span class="n">row_count</span> <span class="o">+</span> <span class="n">rr</span><span class="p">,</span>
                                               <span class="n">col_count</span><span class="p">:</span><span class="n">col_count</span> <span class="o">+</span> <span class="n">cc</span><span class="p">,</span> <span class="p">:]</span>

                <span class="c1"># find all the free triangular blocks within that model block</span>
                <span class="n">find_free</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">model_block</span> <span class="o">==</span> <span class="s1">&#39;?&#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># test to see if the number of free parameters is equal</span>
                    <span class="c1"># to the number of triangular elements with in the model</span>
                    <span class="c1"># block, if there is the model block is assumed to be free.</span>
                    <span class="k">if</span> <span class="n">find_free</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">model_block</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">num_free_param</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">col_count</span> <span class="o">+=</span> <span class="n">cc</span>
            <span class="n">row_count</span> <span class="o">+=</span> <span class="n">rr</span></div>

<div class="viewcode-block" id="Regularization.write_regularization_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Regularization.write_regularization_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_regularization_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reg_basename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">statics_fn</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">prejudice_fn</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                  <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a regularization file for input into occam.</span>

<span class="sd">        Calls build_regularization if build_regularization has not already</span>
<span class="sd">        been called.</span>

<span class="sd">        if reg_fn is None, then file is written to save_path/reg_basename</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ----------</span>
<span class="sd">            **reg_fn** : string</span>
<span class="sd">                         full path to regularization file. *default* is None</span>
<span class="sd">                         and file will be written to save_path/reg_basename</span>

<span class="sd">            **reg_basename** : string</span>
<span class="sd">                               basename of regularization file</span>

<span class="sd">            **statics_fn** : string</span>
<span class="sd">                             full path to static shift file</span>
<span class="sd">                             .. note:: static shift does not always work in</span>
<span class="sd">                                       occam2d.exe</span>
<span class="sd">            **prejudice_fn** : string</span>
<span class="sd">                               full path to prejudice file</span>

<span class="sd">            **save_path** : string</span>
<span class="sd">                            path to save regularization file.</span>
<span class="sd">                            *default* is current working directory</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">save_path</span>
        <span class="k">if</span> <span class="n">reg_basename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reg_basename</span> <span class="o">=</span> <span class="n">reg_basename</span>
        <span class="k">if</span> <span class="n">reg_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reg_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reg_basename</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statics_fn</span> <span class="o">=</span> <span class="n">statics_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prejudice_fn</span> <span class="o">=</span> <span class="n">prejudice_fn</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">binding_offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">build_mesh</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_regularization</span><span class="p">()</span>

        <span class="n">reg_lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># --&gt; write out header information</span>
        <span class="n">reg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;18}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Format:&#39;</span><span class="p">,</span>
                                               <span class="s1">&#39;occam2mtmod_1.0&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">reg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;18}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Model Name:&#39;</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">reg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;18}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Description:&#39;</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">:</span>
            <span class="n">reg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;18}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Mesh File:&#39;</span><span class="p">,</span>
                                                   <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;18}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Mesh File:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span><span class="p">))</span>
        <span class="n">reg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;18}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Mesh Type:&#39;</span><span class="p">,</span>
                                               <span class="s1">&#39;pw2d&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statics_fn</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">:</span>
            <span class="n">reg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;18}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Statics File:&#39;</span><span class="p">,</span>
                                                   <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statics_fn</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;18}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Statics File:&#39;</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">statics_fn</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prejudice_fn</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">:</span>
            <span class="n">reg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;18}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Prejudice File:&#39;</span><span class="p">,</span>
                                                   <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prejudice_fn</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;18}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Prejudice File:&#39;</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">prejudice_fn</span><span class="p">))</span>
        <span class="n">reg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1: .1f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Binding Offset:&#39;</span><span class="p">,</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">binding_offset</span><span class="p">))</span>
        <span class="n">reg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Num Layers:&#39;</span><span class="p">,</span>
                                               <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_columns</span><span class="p">)))</span>

        <span class="c1"># --&gt; write rows and columns of regularization grid</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_columns</span><span class="p">):</span>
            <span class="n">reg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; </span><span class="si">{0:&gt;5}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">row</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">reg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{0:&gt;5}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">col</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">reg_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;18}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;NO. EXCEPTIONS:&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">))</span>
        <span class="n">rfid</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reg_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">rfid</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">reg_lines</span><span class="p">)</span>
        <span class="n">rfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="nb">print</span> <span class="s1">&#39;Wrote Regularization file to </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reg_fn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Regularization.read_regularization_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Regularization.read_regularization_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_regularization_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reg_fn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in a regularization file and populate attributes:</span>
<span class="sd">            * binding_offset            </span>
<span class="sd">            * mesh_fn    </span>
<span class="sd">            * model_columns</span>
<span class="sd">            * model_rows</span>
<span class="sd">            * prejudice_fn</span>
<span class="sd">            * statics_fn</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg_fn</span> <span class="o">=</span> <span class="n">reg_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">reg_fn</span><span class="p">)</span>

        <span class="n">rfid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reg_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">rlines</span> <span class="o">=</span> <span class="n">rfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rlines</span><span class="p">):</span>
            <span class="c1"># read header information</span>
            <span class="k">if</span> <span class="n">iline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">iline</span> <span class="o">=</span> <span class="n">iline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">iline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;fn&#39;</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">iline</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

                <span class="c1"># append the last line</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;exception&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ncols</span><span class="p">)</span>

            <span class="c1"># get mesh values</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">iline</span> <span class="o">=</span> <span class="n">iline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">iline</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">iline</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iline</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ncols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">model_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ncols</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iline</span><span class="p">)</span>
                    <span class="n">ncols</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">iline</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">ncols</span> <span class="o">=</span> <span class="n">ncols</span> <span class="o">+</span> <span class="n">iline</span>

        <span class="c1"># set mesh file name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span><span class="p">)</span>

        <span class="c1"># set statics file name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statics_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">statics_fn</span><span class="p">)</span>

        <span class="c1"># set prejudice file name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prejudice_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prejudice_fn</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Startup"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Startup">[docs]</a><span class="k">class</span> <span class="nc">Startup</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads and writes the startup file for Occam2D.</span>

<span class="sd">    .. note:: Be sure to look at the Occam 2D documentation for description</span>
<span class="sd">              of all parameters</span>

<span class="sd">    ========================= =================================================</span>
<span class="sd">    Key Words/Attributes      Description</span>
<span class="sd">    ========================= =================================================</span>
<span class="sd">    data_fn                   full path to data file</span>
<span class="sd">    date_time                 date and time the startup file was written</span>
<span class="sd">    debug_level               [ 0 | 1 | 2 ] see occam documentation</span>
<span class="sd">                              *default* is 1</span>
<span class="sd">    description               brief description of inversion run</span>
<span class="sd">                              *default* is &#39;startup created by mtpy&#39;  </span>
<span class="sd">    diagonal_penalties        penalties on diagonal terms</span>
<span class="sd">                              *default* is 0</span>
<span class="sd">    format                    Occam file format</span>
<span class="sd">                              *default* is &#39;OCCAMITER_FLEX&#39;</span>
<span class="sd">    iteration                 current iteration number</span>
<span class="sd">                              *default* is 0</span>
<span class="sd">    iterations_to_run         maximum number of iterations to run</span>
<span class="sd">                              *default* is 20</span>
<span class="sd">    lagrange_value            starting lagrange value</span>
<span class="sd">                              *default* is 5</span>
<span class="sd">    misfit_reached            [ 0 | 1 ] 0 if misfit has been reached, 1 if it</span>
<span class="sd">                              has.  *default* is 0</span>
<span class="sd">    misfit_value              current misfit value.  *default* is 1000</span>
<span class="sd">    model_fn                  full path to model file</span>
<span class="sd">    model_limits              limits on model resistivity values</span>
<span class="sd">                              *default* is None</span>
<span class="sd">    model_value_steps         limits on the step size of model values</span>
<span class="sd">                              *default* is None</span>
<span class="sd">    model_values              np.ndarray(num_free_params) of model values</span>
<span class="sd">    param_count               number of free parameters in model</span>
<span class="sd">    resistivity_start         starting resistivity value.  If model_values is</span>
<span class="sd">                              not given, then all values with in model_values</span>
<span class="sd">                              array will be set to resistivity_start</span>
<span class="sd">    roughness_type            [ 0 | 1 | 2 ] type of roughness</span>
<span class="sd">                              *default* is 1</span>
<span class="sd">    roughness_value           current roughness value.  </span>
<span class="sd">                              *default* is 1E10</span>
<span class="sd">    save_path                 directory path to save startup file to</span>
<span class="sd">                              *default* is current working directory  </span>
<span class="sd">    startup_basename          basename of startup file name. </span>
<span class="sd">                              *default* is Occam2DStartup</span>
<span class="sd">    startup_fn                full path to startup file.</span>
<span class="sd">                              *default* is save_path/startup_basename  </span>
<span class="sd">    stepsize_count            max number of iterations per step</span>
<span class="sd">                              *default* is 8</span>
<span class="sd">    target_misfit             target misfit value.</span>
<span class="sd">                              *default* is 1.</span>
<span class="sd">    ========================= =================================================</span>

<span class="sd">    :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; startup = occam2d.Startup()</span>
<span class="sd">        &gt;&gt;&gt; startup.data_fn = ocd.data_fn</span>
<span class="sd">        &gt;&gt;&gt; startup.model_fn = profile.reg_fn</span>
<span class="sd">        &gt;&gt;&gt; startup.param_count = profile.num_free_params</span>
<span class="sd">        &gt;&gt;&gt; startup.save_path = r&quot;/home/occam2d/Line1/Inv1&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;save_path&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_basename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
            <span class="s1">&#39;startup_basename&#39;</span><span class="p">,</span> <span class="s1">&#39;Occam2DStartup&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;startup_fn&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;model_fn&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;data_fn&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="s1">&#39;OCCAMITER_FLEX&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_time</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;date_time&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;startup created by mtpy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterations_to_run</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;iterations_to_run&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roughness_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;roughness_type&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_misfit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;target_misfit&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagonal_penalties</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;diagonal_penalties&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepsize_count</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;stepsize_count&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;model_limits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_value_steps</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;model_value_steps&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_level</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;debug_level&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;iteration&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lagrange_value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lagrange_value&#39;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roughness_value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;roughness_value&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="n">e10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;misfit_value&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_reached</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;misfit_reached&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_count</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;param_count&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resistivity_start</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;resistivity_start&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_values</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;model_values&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<div class="viewcode-block" id="Startup.write_startup_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Startup.write_startup_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_startup_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startup_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">startup_basename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a startup file based on the parameters of startup class.  </span>
<span class="sd">        Default file name is save_path/startup_basename</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>
<span class="sd">            **startup_fn** : string</span>
<span class="sd">                             full path to startup file. *default* is None</span>

<span class="sd">            **save_path** : string</span>
<span class="sd">                            directory to save startup file. *default* is None</span>

<span class="sd">            **startup_basename** : string</span>
<span class="sd">                                   basename of starup file. *default* is None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">save_path</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">startup_basename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startup_basename</span> <span class="o">=</span> <span class="n">startup_basename</span>

        <span class="k">if</span> <span class="n">startup_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">startup_basename</span><span class="p">)</span>

        <span class="c1"># --&gt; check to make sure all the important input are given</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OccamInputError</span><span class="p">(</span><span class="s1">&#39;Need to input data file name&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OccamInputError</span><span class="p">(</span>
                <span class="s1">&#39;Need to input model/regularization file name&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OccamInputError</span><span class="p">(</span><span class="s1">&#39;Need to input number of model parameters&#39;</span><span class="p">)</span>

        <span class="n">slines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Format:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Description:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">:</span>
            <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Model File:&#39;</span><span class="p">,</span>
                                                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Model File:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">:</span>
            <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Data File:&#39;</span><span class="p">,</span>
                                                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Data File:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Date/Time:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_time</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Iterations to run:&#39;</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">iterations_to_run</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Target Misfit:&#39;</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">target_misfit</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Roughness Type:&#39;</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">roughness_type</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Diagonal Penalties:&#39;</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">diagonal_penalties</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Stepsize Cut Count:&#39;</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">stepsize_count</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;!Model Limits:&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="s1">,</span><span class="si">{2}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Model Limits:&#39;</span><span class="p">,</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">model_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">model_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_value_steps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;!Model Value Steps:&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Model Value Steps:&#39;</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">model_value_steps</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Debug Level:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_level</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Iteration:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Lagrange Value:&#39;</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">lagrange_value</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Roughness Value:&#39;</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">roughness_value</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;Misfit Value:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">misfit_value</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Misfit Reached:&#39;</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">misfit_reached</span><span class="p">))</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;20}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Param Count:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_count</span><span class="p">))</span>

        <span class="c1"># make an array of starting values if not are given</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_count</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_values</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resistivity_start</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_count</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OccamInputError</span><span class="p">(</span><span class="s1">&#39;length of model vaues array is not equal &#39;</span>
                                  <span class="s1">&#39;to param count </span><span class="si">{0}</span><span class="s1"> != </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">model_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_count</span><span class="p">))</span>

        <span class="c1"># write out starting resistivity values</span>
        <span class="n">sline</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">mv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_values</span><span class="p">):</span>
            <span class="n">sline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:^10.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mv</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sline</span><span class="p">)))</span>
                <span class="n">sline</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">slines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sline</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">])))</span>
        <span class="c1"># --&gt; write file</span>
        <span class="n">sfid</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">slines</span><span class="p">)</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="nb">print</span> <span class="s1">&#39;Wrote Occam2D startup file to </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">)</span></div></div>


<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Data"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Data">[docs]</a><span class="k">class</span> <span class="nc">Data</span><span class="p">(</span><span class="n">Profile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads and writes data files and more.  </span>

<span class="sd">    Inherets Profile, so the intended use is to use Data to project stations </span>
<span class="sd">    onto a profile, then write the data file.  </span>

<span class="sd">    ===================== =====================================================</span>
<span class="sd">    Model Modes           Description                     </span>
<span class="sd">    ===================== =====================================================</span>
<span class="sd">    1 or log_all          Log resistivity of TE and TM plus Tipper</span>
<span class="sd">    2 or log_te_tip       Log resistivity of TE plus Tipper</span>
<span class="sd">    3 or log_tm_tip       Log resistivity of TM plus Tipper</span>
<span class="sd">    4 or log_te_tm        Log resistivity of TE and TM</span>
<span class="sd">    5 or log_te           Log resistivity of TE</span>
<span class="sd">    6 or log_tm           Log resistivity of TM</span>
<span class="sd">    7 or all              TE, TM and Tipper</span>
<span class="sd">    8 or te_tip           TE plus Tipper</span>
<span class="sd">    9 or tm_tip           TM plus Tipper</span>
<span class="sd">    10 or te_tm           TE and TM mode</span>
<span class="sd">    11 or te              TE mode</span>
<span class="sd">    12 or tm              TM mode</span>
<span class="sd">    13 or tip             Only Tipper</span>
<span class="sd">    ===================== =====================================================</span>


<span class="sd">    **data** : is a list of dictioinaries containing the data for each station.</span>
<span class="sd">               keys include:</span>
<span class="sd">                   * &#39;station&#39; -- name of station</span>
<span class="sd">                   * &#39;offset&#39; -- profile line offset</span>
<span class="sd">                   * &#39;te_res&#39; -- TE resisitivity in linear scale</span>
<span class="sd">                   * &#39;tm_res&#39; -- TM resistivity in linear scale</span>
<span class="sd">                   * &#39;te_phase&#39; -- TE phase in degrees</span>
<span class="sd">                   * &#39;tm_phase&#39; --  TM phase in degrees in first quadrant</span>
<span class="sd">                   * &#39;re_tip&#39; -- real part of tipper along profile</span>
<span class="sd">                   * &#39;im_tip&#39; -- imaginary part of tipper along profile</span>

<span class="sd">               each key is a np.ndarray(2, num_freq)</span>
<span class="sd">               index 0 is for data</span>
<span class="sd">               index 1 is for error</span>

<span class="sd">    ===================== =====================================================</span>
<span class="sd">    Key Words/Attributes  Desctription</span>
<span class="sd">    ===================== =====================================================</span>
<span class="sd">    _data_header          header line in data file</span>
<span class="sd">    _data_string          full data string</span>
<span class="sd">    _profile_generated    [ True | False ] True if profile has already been</span>
<span class="sd">                          generated.</span>
<span class="sd">    _rotate_to_strike     [ True | False ] True to rotate data to strike</span>
<span class="sd">                          angle.  *default* is True</span>
<span class="sd">    data                  list of dictionaries of data for each station.</span>
<span class="sd">                          see above</span>
<span class="sd">    data_fn               full path to data file</span>
<span class="sd">    data_list             list of lines to write to data file</span>
<span class="sd">    edi_list              list of mtpy.core.mt instances for each .edi file</span>
<span class="sd">                          read</span>
<span class="sd">    edi_path              directory path where .edi files are</span>
<span class="sd">    edi_type              [ &#39;z&#39; | &#39;spectra&#39; ] for .edi format  </span>
<span class="sd">    elevation_model       model elevation np.ndarray(east, north, elevation) </span>
<span class="sd">                          in meters</span>
<span class="sd">    elevation_profile     elevation along profile np.ndarray (x, elev) (m)</span>
<span class="sd">    fn_basename           data file basename *default* is OccamDataFile.dat</span>
<span class="sd">    freq                  list of frequencies to use for the inversion</span>
<span class="sd">    freq_max              max frequency to use in inversion. *default* is None</span>
<span class="sd">    freq_min              min frequency to use in inversion. *default* is None</span>
<span class="sd">    freq_num              number of frequencies to use in inversion</span>
<span class="sd">    geoelectric_strike    geoelectric strike angle assuming N = 0, E = 90</span>
<span class="sd">    masked_data           similar to data, but any masked points are now 0</span>
<span class="sd">    mode_dict             dictionary of model modes to chose from</span>
<span class="sd">    model_mode            model mode to use for inversion, see above</span>
<span class="sd">    num_edi               number of stations to invert for</span>
<span class="sd">    occam_dict            dictionary of occam parameters to use internally</span>
<span class="sd">    occam_format          occam format of data file.  </span>
<span class="sd">                          *default* is OCCAM2MTDATA_1.0</span>
<span class="sd">    phase_te_err          percent error in phase for TE mode. *default* is 5</span>
<span class="sd">    phase_tm_err          percent error in phase for TM mode. *default* is 5 </span>
<span class="sd">    profile_angle         angle of profile line realtive to N = 0, E = 90</span>
<span class="sd">    profile_line          m, b coefficients for mx+b definition of profile line</span>
<span class="sd">    res_te_err            percent error in resistivity for TE mode. </span>
<span class="sd">                          *default* is 10</span>
<span class="sd">    res_tm_err            percent error in resistivity for TM mode.</span>
<span class="sd">                          *default* is 10</span>
<span class="sd">    error_type            &#39;floor&#39; or &#39;absolute&#39; - option to set error as floor</span>
<span class="sd">                          (i.e. maximum of the data error and a specified value)</span>
<span class="sd">                          or a straight value</span>
<span class="sd">    save_path             directory to save files to</span>
<span class="sd">    station_list          list of station for inversion</span>
<span class="sd">    station_locations     station locations along profile line</span>
<span class="sd">    tipper_err            percent error in tipper. *default* is 5</span>
<span class="sd">    title                 title in data file.  </span>
<span class="sd">    ===================== =====================================================</span>

<span class="sd">    =========================== ===============================================</span>
<span class="sd">    Methods                     Description</span>
<span class="sd">    =========================== ===============================================</span>
<span class="sd">    _fill_data                  fills the data array that is described above    </span>
<span class="sd">    _get_data_list              gets the lines to write to data file</span>
<span class="sd">    _get_frequencies            gets frequency list to invert for </span>
<span class="sd">    get_profile_origin          get profile origin in UTM coordinates</span>
<span class="sd">    mask_points                 masks points in data picked from </span>
<span class="sd">                                plot_mask_points  </span>
<span class="sd">    plot_mask_points            plots data responses to interactively mask</span>
<span class="sd">                                data points.</span>
<span class="sd">    plot_resonse                plots data/model responses, returns </span>
<span class="sd">                                PlotResponse data type.</span>
<span class="sd">    read_data_file              read in existing data file and fill appropriate</span>
<span class="sd">                                attributes.</span>
<span class="sd">    write_data_file             write a data file according to Data attributes</span>
<span class="sd">    =========================== ===============================================</span>

<span class="sd">    :Example Write Data File: ::</span>
<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">        &gt;&gt;&gt; edipath = r&quot;/home/mt/edi_files&quot;</span>
<span class="sd">        &gt;&gt;&gt; slst = [&#39;mt{0:03}&#39;.format(ss) for ss in range(1, 20)]</span>
<span class="sd">        &gt;&gt;&gt; ocd = occam2d.Data(edi_path=edipath, station_list=slst)</span>
<span class="sd">        &gt;&gt;&gt; # model just the tm mode and tipper</span>
<span class="sd">        &gt;&gt;&gt; ocd.model_mode = 3</span>
<span class="sd">        &gt;&gt;&gt; ocd.save_path = r&quot;/home/occam/Line1/Inv1&quot;</span>
<span class="sd">        &gt;&gt;&gt; ocd.write_data_file()</span>
<span class="sd">        &gt;&gt;&gt; # mask points</span>
<span class="sd">        &gt;&gt;&gt; ocd.plot_mask_points()</span>
<span class="sd">        &gt;&gt;&gt; ocd.mask_points()</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Profile</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;data_fn&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn_basename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fn_basename&#39;</span><span class="p">,</span> <span class="s1">&#39;OccamDataFile.dat&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;save_path&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolate_freq</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;interpolate_freq&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;model_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">res_te_err</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res_te_err&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_tm_err</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res_tm_err&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_te_err</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;phase_te_err&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_tm_err</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;phase_tm_err&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tipper_err&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_type</span> <span class="o">=</span> <span class="s1">&#39;floor&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">freq_min</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;freq_min&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_max</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;freq_max&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_num</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;freq_num&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_tol</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;freq_tol&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">occam_format</span> <span class="o">=</span> <span class="s1">&#39;OCCAM2MTDATA_1.0&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;MTpy-OccamDatafile&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edi_type</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">masked_data</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">occam_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="s1">&#39;log_te_res&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="s1">&#39;te_phase&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;3&#39;</span><span class="p">:</span> <span class="s1">&#39;re_tip&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="s1">&#39;im_tip&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;5&#39;</span><span class="p">:</span> <span class="s1">&#39;log_tm_res&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;6&#39;</span><span class="p">:</span> <span class="s1">&#39;tm_phase&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;9&#39;</span><span class="p">:</span> <span class="s1">&#39;te_res&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;10&#39;</span><span class="p">:</span> <span class="s1">&#39;tm_res&#39;</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mode_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;log_all&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                          <span class="s1">&#39;log_te_tip&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                          <span class="s1">&#39;log_tm_tip&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                          <span class="s1">&#39;log_te_tm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                          <span class="s1">&#39;log_te&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                          <span class="s1">&#39;log_tm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                          <span class="s1">&#39;all&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                          <span class="s1">&#39;te_tip&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                          <span class="s1">&#39;tm_tip&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                          <span class="s1">&#39;te_tm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                          <span class="s1">&#39;te&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                          <span class="s1">&#39;tm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                          <span class="s1">&#39;tip&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                          <span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                          <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                          <span class="s1">&#39;3&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                          <span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                          <span class="s1">&#39;5&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                          <span class="s1">&#39;6&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                          <span class="s1">&#39;7&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                          <span class="s1">&#39;8&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                          <span class="s1">&#39;9&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                          <span class="s1">&#39;10&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                          <span class="s1">&#39;11&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                          <span class="s1">&#39;12&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                          <span class="s1">&#39;13&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:^6}{1:^6}{2:^6}</span><span class="s1"> </span><span class="si">{3: &gt;8}</span><span class="s1"> </span><span class="si">{4: &gt;8}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_header</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:&lt;6}{1:&lt;6}{2:&lt;6}</span><span class="s1"> </span><span class="si">{3:&lt;8}</span><span class="s1"> </span><span class="si">{4:&lt;8}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;SITE&#39;</span><span class="p">,</span> <span class="s1">&#39;FREQ&#39;</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DATUM&#39;</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Data.read_data_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Data.read_data_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in an existing data file and populate appropriate attributes</span>
<span class="sd">            * data</span>
<span class="sd">            * data_list</span>
<span class="sd">            * freq</span>
<span class="sd">            * station_list</span>
<span class="sd">            * station_locations</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>
<span class="sd">            **data_fn** : string</span>
<span class="sd">                          full path to data file</span>
<span class="sd">                          *default* is None and set to save_path/fn_basename</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Data()</span>
<span class="sd">            &gt;&gt;&gt; ocd.read_data_file(r&quot;/home/Occam2D/Line1/Inv1/Data.dat&quot;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">data_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">data_fn</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OccamInputError</span><span class="p">(</span><span class="s1">&#39;Could not find </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OccamInputError</span><span class="p">(</span><span class="s1">&#39;data_fn is None, input filename&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>

        <span class="nb">print</span> <span class="s1">&#39;Reading from </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>

        <span class="n">dfid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

        <span class="n">dlines</span> <span class="o">=</span> <span class="n">dfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="c1"># get format of input data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occam_format</span> <span class="o">=</span> <span class="n">dlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># get title</span>
        <span class="n">title_str</span> <span class="o">=</span> <span class="n">dlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="n">title_list</span> <span class="o">=</span> <span class="n">title_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># get strike angle and profile angle</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">title_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t_str</span> <span class="ow">in</span> <span class="n">title_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">t_list</span> <span class="o">=</span> <span class="n">t_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">t_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;profile&#39;</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;profile_angle&#39;</span>
                    <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;strike&#39;</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;geoelectric_strike&#39;</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">t_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;deg&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="nb">print</span> <span class="s1">&#39;    </span><span class="si">{0}</span><span class="s1"> = </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># get number of sites</span>
        <span class="n">nsites</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="nb">print</span> <span class="s1">&#39;    </span><span class="si">{0}</span><span class="s1"> = </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;number of sites&#39;</span><span class="p">,</span> <span class="n">nsites</span><span class="p">)</span>

        <span class="c1"># get station names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dlines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                                      <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">nsites</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)])</span>

        <span class="c1"># get offsets in meters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                                           <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span> <span class="o">+</span> <span class="n">nsites</span><span class="p">,</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nsites</span><span class="p">)])</span>

        <span class="c1"># get number of frequencies</span>
        <span class="n">nfreq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nsites</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="nb">print</span> <span class="s1">&#39;    </span><span class="si">{0}</span><span class="s1"> = </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;number of frequencies&#39;</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">)</span>

        <span class="c1"># get frequencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                              <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nsites</span><span class="p">,</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nsites</span> <span class="o">+</span> <span class="n">nfreq</span><span class="p">)])</span>

        <span class="c1"># get periods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span>

        <span class="c1"># -----------get data-------------------</span>
        <span class="c1"># set zero array size the first row will be the data and second the</span>
        <span class="c1"># error</span>
        <span class="n">asize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># make a list of dictionaries for each station.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;station&#39;</span><span class="p">:</span> <span class="n">station</span><span class="p">,</span>
                      <span class="s1">&#39;offset&#39;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                      <span class="s1">&#39;te_phase&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                      <span class="s1">&#39;tm_phase&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                      <span class="s1">&#39;re_tip&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                      <span class="s1">&#39;im_tip&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                      <span class="s1">&#39;te_res&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                      <span class="s1">&#39;tm_res&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">)}</span>
                     <span class="k">for</span> <span class="n">station</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_list</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="o">=</span> <span class="n">dlines</span><span class="p">[</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nsites</span> <span class="o">+</span> <span class="n">nfreq</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">station</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">odata</span><span class="p">,</span> <span class="n">oerr</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="c1"># station index -1 cause python starts at 0</span>
                <span class="n">ss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">station</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="c1"># frequency index -1 cause python starts at 0</span>
                <span class="n">ff</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="c1"># data key</span>
                <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">occam_dict</span><span class="p">[</span><span class="n">comp</span><span class="p">]</span>

                <span class="c1"># put into array</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">key</span><span class="p">[</span><span class="mi">4</span><span class="p">:]][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="nb">float</span><span class="p">(</span><span class="n">odata</span><span class="p">)</span>
                    <span class="c1"># error</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">key</span><span class="p">[</span><span class="mi">4</span><span class="p">:]][</span><span class="mi">1</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">oerr</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">odata</span><span class="p">)</span>
                    <span class="c1"># error</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">oerr</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;Could not read line </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_frequencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        from the list of edi&#39;s get a frequency list to invert for.</span>

<span class="sd">        Uses Attributes:</span>
<span class="sd">        ------------</span>
<span class="sd">            **freq_min** : float (Hz)</span>
<span class="sd">                           minimum frequency to invert for.</span>
<span class="sd">                           *default* is None and will use the data to find min</span>

<span class="sd">            **freq_max** : float (Hz)</span>
<span class="sd">                           maximum frequency to invert for</span>
<span class="sd">                           *default* is None and will use the data to find max</span>

<span class="sd">            **freq_num** : int</span>
<span class="sd">                           number of frequencies to invert for</span>
<span class="sd">                           *default* is None and will use the data to find num</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolate_freq</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># get all frequencies from all edi files</span>
        <span class="n">lo_all_freqs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">:</span>
            <span class="n">lo_all_freqs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">edi</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">freq</span><span class="p">))</span>

        <span class="c1"># sort all frequencies so that they are in descending order,</span>
        <span class="c1"># use set to remove repeats and make an array</span>
        <span class="n">all_freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lo_all_freqs</span><span class="p">)),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="c1"># --&gt; get min and max values if none are given</span>
        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_min</span> <span class="o">&lt;</span> <span class="n">all_freqs</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_min</span> <span class="o">&gt;</span> <span class="n">all_freqs</span><span class="o">.</span><span class="n">max</span><span class="p">())):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freq_min</span> <span class="o">=</span> <span class="n">all_freqs</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_max</span> <span class="o">&gt;</span> <span class="n">all_freqs</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_max</span> <span class="o">&lt;</span> <span class="n">all_freqs</span><span class="o">.</span><span class="n">min</span><span class="p">())):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freq_max</span> <span class="o">=</span> <span class="n">all_freqs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="c1"># --&gt; get all frequencies within the given range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">all_freqs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">all_freqs</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_min</span><span class="p">)</span> <span class="o">&amp;</span>
                                       <span class="p">(</span><span class="n">all_freqs</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_max</span><span class="p">))]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OccamInputError</span><span class="p">(</span><span class="s1">&#39;No frequencies in user-defined interval &#39;</span>
                                  <span class="s1">&#39;[</span><span class="si">{0}</span><span class="s1">, </span><span class="si">{1}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_max</span><span class="p">))</span>

        <span class="c1"># check, if frequency list is longer than given max value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_num</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Number of frequencies exceeds freq_num &#39;</span>
                       <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> &gt; </span><span class="si">{1}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_num</span><span class="p">)</span> <span class="o">+</span>
                       <span class="s1">&#39;Trimming frequencies to </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_num</span><span class="p">))</span>

                <span class="n">excess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_num</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">excess</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stepsize</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_num</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="n">stepsize</span> <span class="o">/</span> <span class="mf">2.</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span>
                                                             <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">offset</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">freq_num</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">indices</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_fill_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read all Edi files. </span>
<span class="sd">        Create a profile</span>
<span class="sd">        rotate impedance and tipper</span>
<span class="sd">        Extract frequencies. </span>

<span class="sd">        Collect all information sorted according to occam specifications.</span>

<span class="sd">        Data of Z given in muV/m/nT = km/s</span>
<span class="sd">        Error is assumed to be 1 stddev.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># create a profile line, this sorts the stations by offset and rotates</span>
        <span class="c1"># data.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_profile</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_profile</span><span class="p">()</span>

        <span class="c1"># --&gt; get frequencies to invert for</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_frequencies</span><span class="p">()</span>

        <span class="c1"># set zero array size the first row will be the data and second the</span>
        <span class="c1"># error</span>
        <span class="n">asize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># make a list of dictionaries for each station.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;station&#39;</span><span class="p">:</span> <span class="n">station</span><span class="p">,</span>
                      <span class="s1">&#39;offset&#39;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                      <span class="s1">&#39;te_phase&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                      <span class="s1">&#39;tm_phase&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                      <span class="s1">&#39;re_tip&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                      <span class="s1">&#39;im_tip&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                      <span class="s1">&#39;te_res&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                      <span class="s1">&#39;tm_res&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">)}</span>
                     <span class="k">for</span> <span class="n">station</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_list</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">)]</span>

        <span class="c1"># loop over mt object in edi_list and use a counter starting at 1</span>
        <span class="c1"># because that is what occam starts at.</span>
        <span class="k">for</span> <span class="n">s_index</span><span class="p">,</span> <span class="n">edi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_list</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolate_freq</span><span class="p">:</span>
                <span class="n">station_freq</span> <span class="o">=</span> <span class="n">edi</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">freq</span>
                <span class="n">interp_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">&gt;=</span> <span class="n">station_freq</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">&amp;</span>
                                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">&lt;=</span> <span class="n">station_freq</span><span class="o">.</span><span class="n">max</span><span class="p">()))]</span>
                <span class="c1"># interpolate data onto given frequency list</span>
                <span class="n">z_interp</span><span class="p">,</span> <span class="n">t_interp</span> <span class="o">=</span> <span class="n">edi</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">interp_freq</span><span class="p">)</span>
                <span class="n">z_interp</span><span class="o">.</span><span class="n">_compute_res_phase</span><span class="p">()</span>

                <span class="n">rho</span> <span class="o">=</span> <span class="n">z_interp</span><span class="o">.</span><span class="n">resistivity</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="n">z_interp</span><span class="o">.</span><span class="n">phase</span>
                <span class="n">rho_err</span> <span class="o">=</span> <span class="n">z_interp</span><span class="o">.</span><span class="n">resistivity_err</span>
                <span class="k">if</span> <span class="n">t_interp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tipper</span> <span class="o">=</span> <span class="n">t_interp</span><span class="o">.</span><span class="n">tipper</span>
                    <span class="n">tipper_err</span> <span class="o">=</span> <span class="n">t_interp</span><span class="o">.</span><span class="n">tipper_err</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tipper</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">tipper_err</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="c1"># update station freq, as we&#39;ve now interpolated new z values</span>
                <span class="c1"># for the station</span>
                <span class="n">station_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">&gt;=</span> <span class="n">station_freq</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">&amp;</span>
                                                  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">&lt;=</span> <span class="n">station_freq</span><span class="o">.</span><span class="n">max</span><span class="p">()))]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">station_freq</span> <span class="o">=</span> <span class="n">edi</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">freq</span>
                <span class="n">rho</span> <span class="o">=</span> <span class="n">edi</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">resistivity</span>
                <span class="n">rho_err</span> <span class="o">=</span> <span class="n">edi</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">resistivity_err</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="n">edi</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">phase</span>
                <span class="n">tipper</span> <span class="o">=</span> <span class="n">edi</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">tipper</span>
                <span class="n">tipper_err</span> <span class="o">=</span> <span class="n">edi</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">tipper_err</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edi</span><span class="o">.</span><span class="n">station</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;offset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edi</span><span class="o">.</span><span class="n">offset</span>

            <span class="k">for</span> <span class="n">freq_num</span><span class="p">,</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_tol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">f_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">station_freq</span> <span class="o">&gt;=</span> <span class="n">frequency</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_tol</span><span class="p">))</span> <span class="o">&amp;</span>
                                           <span class="p">(</span><span class="n">station_freq</span> <span class="o">&lt;=</span> <span class="n">frequency</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_tol</span><span class="p">)))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">f_index</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># skip, if the listed frequency is not available for the</span>
                    <span class="c1"># station</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">frequency</span> <span class="ow">in</span> <span class="n">station_freq</span><span class="p">):</span>
                        <span class="c1"># find the respective frequency index for the station</span>
                        <span class="n">f_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">station_freq</span> <span class="o">-</span> <span class="n">frequency</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">f_index</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">f_index</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># --&gt; get te resistivity</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="c1"># compute error</span>
                <span class="k">if</span> <span class="n">rho</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="c1"># --&gt; get error from data</span>
                    <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">res_te_err</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_type</span> <span class="o">==</span> <span class="s1">&#39;floor&#39;</span><span class="p">)):</span>
                        <span class="n">error_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rho_err</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">error_val</span> <span class="o">&gt;</span> <span class="n">rho</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
                            <span class="n">error_val</span> <span class="o">=</span> <span class="n">rho</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                            <span class="c1"># set error floor if desired</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_type</span> <span class="o">==</span> <span class="s1">&#39;floor&#39;</span><span class="p">:</span>
                            <span class="n">error_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                                <span class="n">error_val</span><span class="p">,</span> <span class="n">rho</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_te_err</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_val</span>
                        <span class="c1"># --&gt; set generic error</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">res_te</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_te_err</span> <span class="o">/</span> <span class="mf">100.</span>

                <span class="c1"># --&gt; get tm resistivity</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="c1"># compute error</span>
                <span class="k">if</span> <span class="n">rho</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="c1"># --&gt; get error from data</span>
                    <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">res_tm_err</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_type</span> <span class="o">==</span> <span class="s1">&#39;floor&#39;</span><span class="p">)):</span>
                        <span class="n">error_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rho_err</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">error_val</span> <span class="o">&gt;</span> <span class="n">rho</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
                            <span class="n">error_val</span> <span class="o">=</span> <span class="n">rho</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_type</span> <span class="o">==</span> <span class="s1">&#39;floor&#39;</span><span class="p">:</span>
                            <span class="n">error_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                                <span class="n">error_val</span><span class="p">,</span> <span class="n">rho</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_tm_err</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_val</span>
                    <span class="c1"># --&gt; set generic error</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">res_tm</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_tm_err</span> <span class="o">/</span> <span class="mf">100.</span>

                <span class="c1"># --&gt; get te phase</span>
                <span class="c1"># be sure the phase is positive and in the first quadrant</span>
                <span class="n">phase_te</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="mi">180</span>

                <span class="k">if</span> <span class="p">((</span><span class="n">phase_te</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">phase_te</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">)):</span>
                    <span class="n">phase_te</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># compute error</span>
                <span class="c1"># if phi[f_index, 0, 1] != 0.0:</span>
                <span class="c1"># --&gt; get error from data</span>
                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_te_err</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_type</span> <span class="o">==</span> <span class="s1">&#39;floor&#39;</span><span class="p">)):</span>
                    <span class="n">error_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">rho_err</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">rho</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mf">1.</span><span class="p">)))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_type</span> <span class="o">==</span> <span class="s1">&#39;floor&#39;</span><span class="p">:</span>
                        <span class="n">error_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                            <span class="n">error_val</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_te_err</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">*</span> <span class="mf">57.</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;te_phase&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_val</span>
                <span class="c1"># --&gt; set generic error floor</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;te_phase&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_te_err</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">*</span> <span class="mf">57.</span> <span class="o">/</span> <span class="mf">2.</span>

                <span class="c1"># --&gt; get tm phase and be sure it&#39;s positive and in the first quadrant</span>
                <span class="n">phase_tm</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">180</span>

                <span class="k">if</span> <span class="p">((</span><span class="n">phase_tm</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">phase_tm</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">)):</span>
                    <span class="n">phase_tm</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># compute error</span>
                <span class="c1"># if phi[f_index, 1, 0] != 0.0:</span>
                <span class="c1"># --&gt; get error from data</span>
                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_tm_err</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_type</span> <span class="o">==</span> <span class="s1">&#39;floor&#39;</span><span class="p">)):</span>
                    <span class="n">error_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">rho_err</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">rho</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mf">1.</span><span class="p">)))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_type</span> <span class="o">==</span> <span class="s1">&#39;floor&#39;</span><span class="p">:</span>
                        <span class="n">error_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                            <span class="n">error_val</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_tm_err</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">*</span> <span class="mf">57.</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;tm_phase&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_val</span>
                <span class="c1"># --&gt; set generic error floor</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;tm_phase&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_tm_err</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">*</span> <span class="mf">57.</span> <span class="o">/</span> <span class="mf">2.</span>

                <span class="c1"># --&gt; get Tipper</span>
                <span class="k">if</span> <span class="n">tipper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;re_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="n">tipper</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;im_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="n">tipper</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span>

                    <span class="c1"># get error</span>
                    <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_type</span> <span class="o">==</span> <span class="s1">&#39;floor&#39;</span><span class="p">)):</span>
                        <span class="n">error_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipper_err</span> <span class="o">/</span> <span class="mf">100.</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_type</span> <span class="o">==</span> <span class="s1">&#39;floor&#39;</span><span class="p">:</span>
                            <span class="n">error_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                                <span class="n">error_val</span><span class="p">,</span> <span class="n">tipper_err</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;re_tip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_val</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;im_tip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_val</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;re_tip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">tipper</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="o">/</span> \
                            <span class="n">tipper_err</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">s_index</span><span class="p">][</span><span class="s1">&#39;im_tip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">tipper</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span> <span class="o">/</span> \
                            <span class="n">tipper_err</span><span class="p">[</span><span class="n">f_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_data_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all the data needed to write a data file.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ss</span><span class="p">,</span> <span class="n">sdict</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">mmode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model_mode</span><span class="p">]:</span>
                    <span class="c1"># log(te_res)</span>
                    <span class="k">if</span> <span class="n">mmode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">dvalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">])</span>
                            <span class="n">derror</span> <span class="o">=</span> <span class="p">(</span><span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">/</span>
                                      <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">10.</span><span class="p">)</span>
                            <span class="n">dstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dvalue</span><span class="p">)</span>
                            <span class="n">derrstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">derror</span><span class="p">)</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">ff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mmode</span><span class="p">,</span>
                                                            <span class="n">dstr</span><span class="p">,</span> <span class="n">derrstr</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                    <span class="c1"># te_res</span>
                    <span class="k">if</span> <span class="n">mmode</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">dvalue</span> <span class="o">=</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span>
                            <span class="n">derror</span> <span class="o">=</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span>
                            <span class="n">dstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dvalue</span><span class="p">)</span>
                            <span class="n">derrstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">derror</span><span class="p">)</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">ff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mmode</span><span class="p">,</span>
                                                            <span class="n">dstr</span><span class="p">,</span> <span class="n">derrstr</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                    <span class="c1"># te_phase</span>
                    <span class="k">if</span> <span class="n">mmode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;te_phase&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">dvalue</span> <span class="o">=</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;te_phase&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span>
                            <span class="n">derror</span> <span class="o">=</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;te_phase&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span>
                            <span class="n">dstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dvalue</span><span class="p">)</span>
                            <span class="n">derrstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">derror</span><span class="p">)</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">ff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mmode</span><span class="p">,</span>
                                                            <span class="n">dstr</span><span class="p">,</span> <span class="n">derrstr</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                            <span class="c1"># log(tm_res)</span>
                    <span class="k">if</span> <span class="n">mmode</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">dvalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">])</span>
                            <span class="p">(</span><span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">/</span>
                             <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                            <span class="n">dstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dvalue</span><span class="p">)</span>
                            <span class="n">derrstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">derror</span><span class="p">)</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">ff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mmode</span><span class="p">,</span>
                                                            <span class="n">dstr</span><span class="p">,</span> <span class="n">derrstr</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                    <span class="c1"># tm_res</span>
                    <span class="k">if</span> <span class="n">mmode</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">dvalue</span> <span class="o">=</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span>
                            <span class="n">derror</span> <span class="o">=</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span>
                            <span class="n">dstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dvalue</span><span class="p">)</span>
                            <span class="n">derrstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">derror</span><span class="p">)</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">ff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mmode</span><span class="p">,</span>
                                                            <span class="n">dstr</span><span class="p">,</span> <span class="n">derrstr</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                    <span class="c1"># tm_phase</span>
                    <span class="k">if</span> <span class="n">mmode</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;tm_phase&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">dvalue</span> <span class="o">=</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;tm_phase&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span>
                            <span class="n">derror</span> <span class="o">=</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;tm_phase&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span>
                            <span class="n">dstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dvalue</span><span class="p">)</span>
                            <span class="n">derrstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">derror</span><span class="p">)</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">ff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mmode</span><span class="p">,</span>
                                                            <span class="n">dstr</span><span class="p">,</span> <span class="n">derrstr</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                    <span class="c1"># Re_tip</span>
                    <span class="k">if</span> <span class="n">mmode</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;re_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">dvalue</span> <span class="o">=</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;re_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span>
                            <span class="n">derror</span> <span class="o">=</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;re_tip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span>
                            <span class="n">dstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dvalue</span><span class="p">)</span>
                            <span class="n">derrstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">derror</span><span class="p">)</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">ff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mmode</span><span class="p">,</span>
                                                            <span class="n">dstr</span><span class="p">,</span> <span class="n">derrstr</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                    <span class="c1"># Im_tip</span>
                    <span class="k">if</span> <span class="n">mmode</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;im_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">dvalue</span> <span class="o">=</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;im_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span>
                            <span class="n">derror</span> <span class="o">=</span> <span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;im_tip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span>
                            <span class="n">dstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dvalue</span><span class="p">)</span>
                            <span class="n">derrstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">derror</span><span class="p">)</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">ff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mmode</span><span class="p">,</span>
                                                            <span class="n">dstr</span><span class="p">,</span> <span class="n">derrstr</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<div class="viewcode-block" id="Data.mask_from_datafile"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Data.mask_from_datafile">[docs]</a>    <span class="k">def</span> <span class="nf">mask_from_datafile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask_datafn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reads a separate data file and applies mask from this data file.</span>
<span class="sd">        mask_datafn needs to have exactly the same frequencies, and station names </span>
<span class="sd">        must match exactly.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ocdm</span> <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
        <span class="n">ocdm</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="n">mask_datafn</span><span class="p">)</span>
        <span class="c1"># list of stations, in order, for the mask_datafn and the input data</span>
        <span class="c1"># file</span>
        <span class="n">ocdm_stlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">ocdm</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ocdm</span><span class="o">.</span><span class="n">data</span><span class="p">))]</span>
        <span class="n">ocd_stlist</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))]</span>

        <span class="k">for</span> <span class="n">i_ocd</span><span class="p">,</span> <span class="n">stn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ocd_stlist</span><span class="p">):</span>
            <span class="n">i_ocdm</span> <span class="o">=</span> <span class="n">ocdm_stlist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">stn</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">dmode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;te_res&#39;</span><span class="p">,</span> <span class="s1">&#39;tm_res&#39;</span><span class="p">,</span> <span class="s1">&#39;te_phase&#39;</span><span class="p">,</span> <span class="s1">&#39;tm_phase&#39;</span><span class="p">,</span> <span class="s1">&#39;im_tip&#39;</span><span class="p">,</span> <span class="s1">&#39;re_tip&#39;</span><span class="p">]:</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i_ocdm</span><span class="p">][</span><span class="n">dmode</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i_ocd</span><span class="p">][</span><span class="n">dmode</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn_basename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn_basename</span><span class="p">[</span>
            <span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;Masked&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn_basename</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_data_file</span><span class="p">()</span></div>

<div class="viewcode-block" id="Data.write_data_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Data.write_data_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_data_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a data file.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>
<span class="sd">            **data_fn** : string</span>
<span class="sd">                          full path to data file. </span>
<span class="sd">                          *default* is save_path/fn_basename</span>

<span class="sd">        If there data is None, then _fill_data is called to create a profile, </span>
<span class="sd">        rotate data and get all the necessary data.  This way you can use </span>
<span class="sd">        write_data_file directly without going through the steps of projecting</span>
<span class="sd">        the stations, etc.</span>

<span class="sd">        :Example: ::</span>
<span class="sd">            &gt;&gt;&gt; edipath = r&quot;/home/mt/edi_files&quot;</span>
<span class="sd">            &gt;&gt;&gt; slst = [&#39;mt{0:03}&#39;.format(ss) for ss in range(1, 20)]</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Data(edi_path=edipath, station_list=slst)</span>
<span class="sd">            &gt;&gt;&gt; ocd.save_path = r&quot;/home/occam/line1/inv1&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd.write_data_file()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fill_data</span><span class="p">()</span>

        <span class="c1"># get the appropriate data to write to file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_list</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">data_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">data_fn</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn_basename</span><span class="p">)</span>

        <span class="n">data_lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># --&gt; header line</span>
        <span class="n">data_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;18}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;FORMAT:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">occam_format</span><span class="p">))</span>

        <span class="c1"># --&gt; title line</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">t_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">, Profile=</span><span class="si">{1:.1f}</span><span class="s1"> deg, Strike=</span><span class="si">{2:.1f}</span><span class="s1"> deg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span><span class="p">)</span>
        <span class="n">data_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;18}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;TITLE:&#39;</span><span class="p">,</span> <span class="n">t_str</span><span class="p">))</span>

        <span class="c1"># --&gt; sites</span>
        <span class="n">data_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;18}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;SITES:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">sdict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">data_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;   </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]))</span>

        <span class="c1"># --&gt; offsets</span>
        <span class="n">data_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;18}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;OFFSETS (M):&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">sdict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">data_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;   </span><span class="si">{0:.1f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sdict</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">]))</span>
        <span class="c1"># --&gt; frequencies</span>
        <span class="n">data_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;18}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;FREQUENCIES:&#39;</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">:</span>
            <span class="n">data_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;   </span><span class="si">{0:&lt;10.6e}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ff</span><span class="p">))</span>

        <span class="c1"># --&gt; data</span>
        <span class="n">data_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;18}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;DATA BLOCKS:&#39;</span><span class="p">,</span>
                                                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">)))</span>
        <span class="n">data_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_header</span><span class="p">)</span>
        <span class="n">data_lines</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span>

        <span class="n">dfid</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">dfid</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">data_lines</span><span class="p">)</span>
        <span class="n">dfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="nb">print</span> <span class="s1">&#39;Wrote Occam2D data file to </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Data.get_profile_origin"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Data.get_profile_origin">[docs]</a>    <span class="k">def</span> <span class="nf">get_profile_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the origin of the profile in real world coordinates</span>

<span class="sd">        Author: Alison Kirkby (2013)</span>

<span class="sd">        NEED TO ADAPT THIS TO THE CURRENT SETUP.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">easts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">norths</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">c1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">c1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">m</span><span class="p">))</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">c1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_origin</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Data.plot_response"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Data.plot_response">[docs]</a>    <span class="k">def</span> <span class="nf">plot_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot data and model responses as apparent resistivity, phase and</span>
<span class="sd">        tipper.  See PlotResponse for key words.</span>

<span class="sd">        Returns:</span>
<span class="sd">        ---------</span>
<span class="sd">            **pr_obj** : PlotResponse object </span>

<span class="sd">        :Example: ::</span>
<span class="sd">            &gt;&gt;&gt; pr_obj = ocd.plot_response()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pr_obj</span> <span class="o">=</span> <span class="n">PlotResponse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pr_obj</span></div>

<div class="viewcode-block" id="Data.plot_mask_points"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Data.plot_mask_points">[docs]</a>    <span class="k">def</span> <span class="nf">plot_mask_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">res_err_inc</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                         <span class="n">phase_err_inc</span><span class="o">=.</span><span class="mi">05</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An interactive plotting tool to mask points an add errorbars</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ----------</span>
<span class="sd">            **res_err_inc** : float</span>
<span class="sd">                            amount to increase the error bars. Input as a </span>
<span class="sd">                            decimal percentage.  0.3 for 30 percent</span>
<span class="sd">                            *Default* is 0.2 (20 percent)</span>

<span class="sd">            **phase_err_inc** : float</span>
<span class="sd">                              amount to increase the error bars. Input as a </span>
<span class="sd">                              decimal percentage.  0.3 for 30 percent</span>
<span class="sd">                              *Default* is 0.05 (5 percent)</span>

<span class="sd">            **marker** : string</span>
<span class="sd">                         marker that the masked points will be</span>
<span class="sd">                         *Default* is &#39;h&#39; for hexagon</span>


<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Data()</span>
<span class="sd">            &gt;&gt;&gt; ocd.data_fn = r&quot;/home/Occam2D/Line1/Inv1/Data.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd.plot_mask_points()                   </span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">data_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">data_fn</span>

        <span class="n">pr_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_response</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># make points an attribute of self which is a data type</span>
        <span class="c1"># OccamPointPicker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">masked_data</span> <span class="o">=</span> <span class="n">OccamPointPicker</span><span class="p">(</span><span class="n">pr_obj</span><span class="o">.</span><span class="n">ax_list</span><span class="p">,</span>
                                            <span class="n">pr_obj</span><span class="o">.</span><span class="n">line_list</span><span class="p">,</span>
                                            <span class="n">pr_obj</span><span class="o">.</span><span class="n">err_list</span><span class="p">,</span>
                                            <span class="n">phase_err_inc</span><span class="o">=</span><span class="n">phase_err_inc</span><span class="p">,</span>
                                            <span class="n">res_err_inc</span><span class="o">=</span><span class="n">res_err_inc</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Data.mask_points"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Data.mask_points">[docs]</a>    <span class="k">def</span> <span class="nf">mask_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maskpoints_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        mask points and rewrite the data file</span>

<span class="sd">        NEED TO REDO THIS TO FIT THE CURRENT SETUP</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mp_obj</span> <span class="o">=</span> <span class="n">maskpoints_obj</span>
        <span class="n">m_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># rewrite the data file</span>
        <span class="c1"># make a reverse dictionary for locating the masked points in the data</span>
        <span class="c1"># file</span>
        <span class="n">rploc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mp_obj</span><span class="o">.</span><span class="n">fndict</span><span class="p">[</span><span class="n">key</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mp_obj</span><span class="o">.</span><span class="n">fndict</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>

        <span class="c1"># make a period dictionary to locate points changed</span>
        <span class="n">frpdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s1">&#39;</span><span class="si">{0:.5g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fr</span><span class="p">),</span> <span class="n">ff</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">ff</span><span class="p">,</span> <span class="n">fr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)])</span>

        <span class="c1"># loop over the data list</span>
        <span class="k">for</span> <span class="n">dd</span><span class="p">,</span> <span class="n">dat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mp_obj</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
            <span class="n">derror</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">error</span><span class="p">[</span><span class="n">dd</span><span class="p">]</span>
            <span class="c1"># loop over the 4 main entrie</span>
            <span class="k">for</span> <span class="n">ss</span><span class="p">,</span> <span class="n">skey</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;resxy&#39;</span><span class="p">,</span> <span class="s1">&#39;resyx&#39;</span><span class="p">,</span> <span class="s1">&#39;phasexy&#39;</span><span class="p">,</span> <span class="s1">&#39;phaseyx&#39;</span><span class="p">]):</span>
                <span class="c1"># rewrite any coinciding points</span>
                <span class="k">for</span> <span class="n">frpkey</span> <span class="ow">in</span> <span class="n">frpdict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ff</span> <span class="o">=</span> <span class="n">frpdict</span><span class="p">[</span><span class="n">frpkey</span><span class="p">]</span>
                        <span class="n">floc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">fdict</span><span class="p">[</span><span class="n">dd</span><span class="p">][</span><span class="n">ss</span><span class="p">][</span><span class="n">frpkey</span><span class="p">]</span>

                        <span class="c1"># CHANGE APPARENT RESISTIVITY</span>
                        <span class="k">if</span> <span class="n">ss</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ss</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="c1"># change the apparent resistivity value</span>
                            <span class="k">if</span> <span class="n">m_data</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span> <span class="o">!=</span> \
                                    <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]):</span>
                                <span class="k">if</span> <span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">m_data</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">m_data</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span> <span class="o">=</span> \
                                        <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">])</span>

                            <span class="c1"># change the apparent resistivity error value</span>
                            <span class="k">if</span> <span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">rerr</span> <span class="o">=</span> <span class="mf">0.0</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">rerr</span> <span class="o">=</span> <span class="n">derror</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]</span> <span class="o">/</span> \
                                    <span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">m_data</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span> <span class="o">!=</span> <span class="n">rerr</span><span class="p">:</span>
                                <span class="n">m_data</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span> <span class="o">=</span> <span class="n">rerr</span>

                        <span class="c1"># DHANGE PHASE</span>
                        <span class="k">elif</span> <span class="n">ss</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">ss</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="c1"># change the phase value</span>
                            <span class="k">if</span> <span class="n">m_data</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span> <span class="o">!=</span> \
                                    <span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]:</span>
                                <span class="k">if</span> <span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">m_data</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">m_data</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span> <span class="o">=</span> \
                                        <span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]</span>

                            <span class="c1"># change the apparent resistivity error value</span>
                            <span class="k">if</span> <span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">rerr</span> <span class="o">=</span> <span class="mf">0.0</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">rerr</span> <span class="o">=</span> <span class="n">derror</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">m_data</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span> <span class="o">!=</span> <span class="n">rerr</span><span class="p">:</span>
                                <span class="n">m_data</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span> <span class="o">=</span> <span class="n">rerr</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="Response"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Response">[docs]</a><span class="k">class</span> <span class="nc">Response</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads .resp file output by Occam.  Similar structure to Data.data.</span>

<span class="sd">    If resp_fn is given in the initialization of Response, read_response_file</span>
<span class="sd">    is called.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    ------------</span>
<span class="sd">        **resp_fn** : string</span>
<span class="sd">                      full path to .resp file</span>

<span class="sd">    Attributes:</span>
<span class="sd">    -------------</span>
<span class="sd">        **resp** : is a list of dictioinaries containing the data for each</span>
<span class="sd">                   station.  keys include:</span>

<span class="sd">                   * &#39;te_res&#39; -- TE resisitivity in linear scale</span>
<span class="sd">                   * &#39;tm_res&#39; -- TM resistivity in linear scale</span>
<span class="sd">                   * &#39;te_phase&#39; -- TE phase in degrees</span>
<span class="sd">                   * &#39;tm_phase&#39; --  TM phase in degrees in first quadrant</span>
<span class="sd">                   * &#39;re_tip&#39; -- real part of tipper along profile</span>
<span class="sd">                   * &#39;im_tip&#39; -- imaginary part of tipper along profile</span>

<span class="sd">               each key is a np.ndarray(2, num_freq)</span>
<span class="sd">               index 0 is for model response</span>
<span class="sd">               index 1 is for normalized misfit</span>

<span class="sd">    :Example: ::</span>
<span class="sd">        &gt;&gt;&gt; resp_obj = occam2d.Response(r&quot;/home/occam/line1/inv1/test_01.resp&quot;)</span>



<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resp_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="o">=</span> <span class="n">resp_fn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occam_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="s1">&#39;log_te_res&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="s1">&#39;te_phase&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;3&#39;</span><span class="p">:</span> <span class="s1">&#39;re_tip&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="s1">&#39;im_tip&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;5&#39;</span><span class="p">:</span> <span class="s1">&#39;log_tm_res&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;6&#39;</span><span class="p">:</span> <span class="s1">&#39;tm_phase&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;9&#39;</span><span class="p">:</span> <span class="s1">&#39;te_res&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;10&#39;</span><span class="p">:</span> <span class="s1">&#39;tm_res&#39;</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">resp_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_response_file</span><span class="p">()</span>

<div class="viewcode-block" id="Response.read_response_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Response.read_response_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_response_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resp_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read in response file and put into a list of dictionaries similar </span>
<span class="sd">        to Data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">resp_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="o">=</span> <span class="n">resp_fn</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OccamInputError</span><span class="p">(</span>
                <span class="s1">&#39;resp_fn is None, please input response file&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OccamInputError</span><span class="p">(</span><span class="s1">&#39;Could not find </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">))</span>

        <span class="n">r_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">),</span>
                                                <span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">),</span>
                                                <span class="p">(</span><span class="s1">&#39;comp&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">),</span>
                                                <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">),</span>
                                                <span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                                                <span class="p">(</span><span class="s1">&#39;resp&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
                                                <span class="p">(</span><span class="s1">&#39;err&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)])</span>

        <span class="n">num_stat</span> <span class="o">=</span> <span class="n">r_arr</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">num_freq</span> <span class="o">=</span> <span class="n">r_arr</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="c1"># set zero array size the first row will be the data and second the</span>
        <span class="c1"># error</span>
        <span class="n">asize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_freq</span><span class="p">)</span>

        <span class="c1"># make a list of dictionaries for each station.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resp</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;te_phase&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                      <span class="s1">&#39;tm_phase&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                      <span class="s1">&#39;re_tip&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                      <span class="s1">&#39;im_tip&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                      <span class="s1">&#39;te_res&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                      <span class="s1">&#39;tm_res&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">)}</span>
                     <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_stat</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">r_arr</span><span class="p">:</span>
            <span class="c1"># station index -1 cause python starts at 0</span>
            <span class="n">ss</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="c1"># frequency index -1 cause python starts at 0</span>
            <span class="n">ff</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="c1"># data key</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">occam_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;comp&#39;</span><span class="p">])]</span>
            <span class="c1"># put into array</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;comp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;comp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resp</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">key</span><span class="p">[</span><span class="mi">4</span><span class="p">:]][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;resp&#39;</span><span class="p">]</span>
                <span class="c1"># error</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resp</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">key</span><span class="p">[</span><span class="mi">4</span><span class="p">:]][</span><span class="mi">1</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resp</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;resp&#39;</span><span class="p">]</span>
                <span class="c1"># error</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resp</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">ff</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="Model"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Model">[docs]</a><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">Startup</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read .iter file output by Occam2d.  Builds the resistivity model from </span>
<span class="sd">    mesh and regularization files found from the .iter file.  The resistivity</span>
<span class="sd">    model is an array(x_nodes, z_nodes) set on a regular grid, and the values </span>
<span class="sd">    of the model response are filled in according to the regularization grid.</span>
<span class="sd">    This allows for faster plotting.  </span>

<span class="sd">    Inherets Startup because they are basically the same object.</span>

<span class="sd">    Argument:</span>
<span class="sd">    ----------</span>
<span class="sd">        **iter_fn** : string</span>
<span class="sd">                      full path to .iter file to read. *default* is None.</span>

<span class="sd">        **model_fn** : string</span>
<span class="sd">                       full path to regularization file. *default* is None</span>
<span class="sd">                       and found directly from the .iter file.  Only input</span>
<span class="sd">                       if the regularization is different from the file that</span>
<span class="sd">                       is in the .iter file.</span>

<span class="sd">        **mesh_fn** : string</span>
<span class="sd">                      full path to mesh file. *default* is None</span>
<span class="sd">                      Found directly from the model_fn file.  Only input</span>
<span class="sd">                      if the mesh is different from the file that</span>
<span class="sd">                      is in the model file.</span>

<span class="sd">    ===================== =====================================================</span>
<span class="sd">    Key Words/Attributes  Description    </span>
<span class="sd">    ===================== =====================================================</span>
<span class="sd">    data_fn               full path to data file</span>
<span class="sd">    iter_fn               full path to .iter file</span>
<span class="sd">    mesh_fn               full path to mesh file</span>
<span class="sd">    mesh_x                np.ndarray(x_nodes, z_nodes) mesh grid for plotting</span>
<span class="sd">    mesh_z                np.ndarray(x_nodes, z_nodes) mesh grid for plotting</span>
<span class="sd">    model_values          model values from startup file</span>
<span class="sd">    plot_x                nodes of mesh in horizontal direction</span>
<span class="sd">    plot_z                nodes of mesh in vertical direction</span>
<span class="sd">    res_model             np.ndarray(x_nodes, z_nodes) resistivity model </span>
<span class="sd">                          values in linear scale</span>
<span class="sd">    ===================== =====================================================</span>


<span class="sd">    ===================== =====================================================</span>
<span class="sd">    Methods               Description     </span>
<span class="sd">    ===================== =====================================================</span>
<span class="sd">    build_model           get the resistivity model from the .iter file</span>
<span class="sd">                          in a regular grid according to the mesh file</span>
<span class="sd">                          with resistivity values according to the model file</span>
<span class="sd">    read_iter_file        read .iter file and fill appropriate attributes</span>
<span class="sd">    write_iter_file       write an .iter file incase you want to set it as the</span>
<span class="sd">                          starting model or a priori model</span>
<span class="sd">    ===================== =====================================================</span>

<span class="sd">    :Example: ::</span>
<span class="sd">        &gt;&gt;&gt; model = occam2D.Model(r&quot;/home/occam/line1/inv1/test_01.iter&quot;)</span>
<span class="sd">        &gt;&gt;&gt; model.build_model()</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iter_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mesh_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Startup</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span> <span class="o">=</span> <span class="n">iter_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span> <span class="n">model_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span> <span class="o">=</span> <span class="n">mesh_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;data_fn&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_values</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;model_values&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_x</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_z</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Model.read_iter_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Model.read_iter_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_iter_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iter_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read an iteration file.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ----------</span>
<span class="sd">            **iter_fn** : string</span>
<span class="sd">                        full path to iteration file if iterpath=None.  If </span>
<span class="sd">                        iterpath is input then iterfn is just the name</span>
<span class="sd">                        of the file without the full path.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; itfn = r&quot;/home/Occam2D/Line1/Inv1/Test_15.iter&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocm = occam2d.Model(itfn)</span>
<span class="sd">            &gt;&gt;&gt; ocm.read_iter_file()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">iter_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span> <span class="o">=</span> <span class="n">iter_fn</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OccamInputError</span><span class="p">(</span><span class="s1">&#39;iter_fn is None, input iteration file&#39;</span><span class="p">)</span>

        <span class="c1"># check to see if the file exists</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OccamInputError</span><span class="p">(</span><span class="s1">&#39;Can not find </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span><span class="p">)</span>

        <span class="c1"># open file, read lines, close file</span>
        <span class="n">ifid</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">ilines</span> <span class="o">=</span> <span class="n">ifid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">ifid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># put header info into dictionary with similar keys</span>
        <span class="k">while</span> <span class="n">ilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;param&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">iline</span> <span class="o">=</span> <span class="n">ilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">iline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;fn&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">iline</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">ii</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># get number of parameters</span>
        <span class="n">iline</span> <span class="o">=</span> <span class="n">ilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">iline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">iline</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_count</span><span class="p">)</span>
        <span class="n">kk</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">jj</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">mv_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">jj</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">ilines</span><span class="p">)</span> <span class="o">-</span> <span class="n">kk</span><span class="p">:</span>
            <span class="n">iline</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ilines</span><span class="p">[</span><span class="n">jj</span> <span class="o">+</span> <span class="n">kk</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_values</span><span class="p">[</span><span class="n">mv_index</span><span class="p">:</span><span class="n">mv_index</span> <span class="o">+</span> <span class="n">iline</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">iline</span>
            <span class="n">jj</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">mv_index</span> <span class="o">+=</span> <span class="n">iline</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># make sure data file is full path</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>

        <span class="c1"># make sure model file is full path</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.write_iter_file"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Model.write_iter_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_iter_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iter_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write an iteration file if you need to for some reason, same as </span>
<span class="sd">        startup file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">iter_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span> <span class="o">=</span> <span class="n">iter_fn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_startup_file</span><span class="p">(</span><span class="n">iter_fn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Model.build_model"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Model.build_model">[docs]</a>    <span class="k">def</span> <span class="nf">build_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        build the model from the mesh, regularization grid and model file</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># first read in the iteration file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_iter_file</span><span class="p">()</span>

        <span class="c1"># read in the regulariztion file</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">Regularization</span><span class="p">()</span>
        <span class="n">r1</span><span class="o">.</span><span class="n">read_regularization_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span>
        <span class="n">r1</span><span class="o">.</span><span class="n">model_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">model_rows</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">model_rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_columns</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">model_columns</span>

        <span class="c1"># read in mesh file</span>
        <span class="n">r1</span><span class="o">.</span><span class="n">read_mesh_file</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">mesh_fn</span><span class="p">)</span>

        <span class="c1"># get the binding offset which is the right side of the furthest left</span>
        <span class="c1"># block, this helps locate the model in relative space</span>
        <span class="n">bndgoff</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">binding_offset</span>

        <span class="c1"># make sure that the number of rows and number of columns are the same</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">model_rows</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">model_columns</span><span class="p">)</span>

        <span class="c1"># initiate the resistivity model to the shape of the FE mesh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">r1</span><span class="o">.</span><span class="n">z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r1</span><span class="o">.</span><span class="n">x_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="c1"># read in the model and set the regularization block values to map onto</span>
        <span class="c1"># the FE mesh so that the model can be plotted as an image or regular</span>
        <span class="c1"># mesh.</span>
        <span class="n">mm</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">model_rows</span><span class="p">)):</span>
            <span class="c1"># get the number of layers to combine</span>
            <span class="c1"># this index will be the first index in the vertical direction</span>
            <span class="n">ny1</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">model_rows</span><span class="p">[:</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="c1"># the second index  in the vertical direction</span>
            <span class="n">ny2</span> <span class="o">=</span> <span class="n">ny1</span> <span class="o">+</span> <span class="n">r1</span><span class="o">.</span><span class="n">model_rows</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># make the list of amalgamated columns an array for ease</span>
            <span class="n">lc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">model_columns</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="c1"># loop over the number of amalgamated blocks</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">model_columns</span><span class="p">[</span><span class="n">ii</span><span class="p">])):</span>
                <span class="c1"># get first in index in the horizontal direction</span>
                <span class="n">nx1</span> <span class="o">=</span> <span class="n">lc</span><span class="p">[:</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="c1"># get second index in horizontal direction</span>
                <span class="n">nx2</span> <span class="o">=</span> <span class="n">nx1</span> <span class="o">+</span> <span class="n">lc</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
                <span class="c1"># put the apporpriate resistivity value into all the amalgamated</span>
                <span class="c1"># model blocks of the regularization grid into the forward model</span>
                <span class="c1"># grid</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">[</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span> <span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_values</span><span class="p">[</span><span class="n">mm</span><span class="p">]</span>
                <span class="n">mm</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># make some arrays for plotting the model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r1</span><span class="o">.</span><span class="n">x_nodes</span><span class="p">[:</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">x_nodes</span><span class="p">))])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r1</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">[:</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">z_nodes</span><span class="p">))])</span>

        <span class="c1"># center the grid onto the station coordinates</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">bndgoff</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span><span class="p">[</span><span class="n">r1</span><span class="o">.</span><span class="n">model_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span> <span class="o">+=</span> <span class="n">x0</span>

        <span class="c1"># flip the arrays around for plotting purposes</span>
        <span class="c1"># plotx = plotx[::-1] and make the first layer start at zero</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># make a mesh grid to plot in the model coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span><span class="p">)</span>

        <span class="c1"># flip the resmodel upside down so that the top is the stations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">)</span></div></div>


<span class="c1"># ==============================================================================</span>
<span class="c1"># plot the MT and model responses</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="PlotResponse"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotResponse">[docs]</a><span class="k">class</span> <span class="nc">PlotResponse</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper class to deal with plotting the MT response and occam2d model.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    -------------</span>
<span class="sd">        **data_fn** : string</span>
<span class="sd">                      full path to data file</span>

<span class="sd">        **resp_fn** : string or list</span>
<span class="sd">                      full path(s) to response file(s)   </span>


<span class="sd">    ==================== ======================================================</span>
<span class="sd">    Attributes/key words            description</span>
<span class="sd">    ==================== ======================================================</span>
<span class="sd">    ax_list              list of matplotlib.axes instances for use with</span>
<span class="sd">                         OccamPointPicker    </span>
<span class="sd">    color_mode           [ &#39;color&#39; | &#39;bw&#39; ] plot figures in color or </span>
<span class="sd">                         black and white (&#39;bw&#39;)</span>
<span class="sd">    cted                 color of Data TE marker and line</span>
<span class="sd">    ctem                 color of Model TE marker and line</span>
<span class="sd">    ctewl                color of Winglink Model TE marker and line</span>
<span class="sd">    ctmd                 color of Data TM marker and line</span>
<span class="sd">    ctmm                 color of Model TM marker and line</span>
<span class="sd">    ctmwl                color of Winglink Model TM marker and line</span>
<span class="sd">    e_capsize            size of error bar caps in points</span>
<span class="sd">    e_capthick           line thickness of error bar caps in points</span>
<span class="sd">    err_list             list of line properties of error bars for use with</span>
<span class="sd">                         OccamPointPicker</span>
<span class="sd">    fig_dpi              figure resolution in dots-per-inch </span>
<span class="sd">    fig_list             list of dictionaries with key words</span>
<span class="sd">                         station --&gt; station name</span>
<span class="sd">                         fig --&gt; matplotlib.figure instance</span>
<span class="sd">                         axrte --&gt; matplotlib.axes instance for TE app.res</span>
<span class="sd">                         axrtm --&gt; matplotlib.axes instance for TM app.res</span>
<span class="sd">                         axpte --&gt; matplotlib.axes instance for TE phase</span>
<span class="sd">                         axptm --&gt; matplotlib.axes instance for TM phase</span>

<span class="sd">    fig_num              starting number of figure</span>
<span class="sd">    fig_size             size of figure in inches (width, height)</span>
<span class="sd">    font_size            size of axes ticklabel font in points</span>
<span class="sd">    line_list            list of matplotlib.Line instances for use with </span>
<span class="sd">                         OccamPointPicker</span>
<span class="sd">    lw                   line width of lines in points</span>
<span class="sd">    ms                   marker size in points</span>
<span class="sd">    mted                 marker for Data TE mode</span>
<span class="sd">    mtem                 marker for Model TE mode</span>
<span class="sd">    mtewl                marker for Winglink Model TE</span>
<span class="sd">    mtmd                 marker for Data TM mode</span>
<span class="sd">    mtmm                 marker for Model TM mode</span>
<span class="sd">    mtmwl                marker for Winglink TM mode</span>
<span class="sd">    period               np.ndarray of periods to plot </span>
<span class="sd">    phase_limits         limits on phase plots in degrees (min, max)</span>
<span class="sd">    plot_num             [ 1 | 2 ] </span>
<span class="sd">                         1 to plot both modes in a single plot</span>
<span class="sd">                         2 to plot modes in separate plots (default)</span>
<span class="sd">    plot_tipper          [ &#39;y&#39; | &#39;n&#39; ] plot tipper data if desired</span>
<span class="sd">    plot_type            [ &#39;1&#39; | station_list]</span>
<span class="sd">                         &#39;1&#39; --&gt; to plot all stations in different figures</span>
<span class="sd">                         station_list --&gt; to plot a few stations, give names</span>
<span class="sd">                         of stations ex. [&#39;mt01&#39;, &#39;mt07&#39;]</span>
<span class="sd">    plot_yn              [ &#39;y&#39; | &#39;n&#39;]</span>
<span class="sd">                         &#39;y&#39; --&gt; to plot on instantiation</span>
<span class="sd">                         &#39;n&#39; --&gt; to not plot on instantiation</span>
<span class="sd">    res_limits           limits on resistivity plot in log scale (min, max)</span>
<span class="sd">    rp_list               list of dictionaries from read2Ddata</span>
<span class="sd">    station_list          station_list list of stations in rp_list</span>
<span class="sd">    subplot_bottom       subplot spacing from bottom (relative coordinates) </span>
<span class="sd">    subplot_hspace       vertical spacing between subplots</span>
<span class="sd">    subplot_left         subplot spacing from left  </span>
<span class="sd">    subplot_right        subplot spacing from right</span>
<span class="sd">    subplot_top          subplot spacing from top</span>
<span class="sd">    subplot_wspace       horizontal spacing between subplots</span>
<span class="sd">    wl_fn                Winglink file name (full path)</span>
<span class="sd">    ==================== ======================================================</span>

<span class="sd">    =================== =======================================================</span>
<span class="sd">    Methods             Description</span>
<span class="sd">    =================== =======================================================</span>
<span class="sd">    plot                plots the apparent resistiviy and phase of data and</span>
<span class="sd">                        model if given.  called on instantiation if plot_yn</span>
<span class="sd">                        is &#39;y&#39;.</span>
<span class="sd">    redraw_plot         call redraw_plot to redraw the figures, </span>
<span class="sd">                        if one of the attributes has been changed</span>
<span class="sd">    save_figures        save all the matplotlib.figure instances in fig_list</span>
<span class="sd">    =================== =======================================================</span>


<span class="sd">    :Example: ::</span>
<span class="sd">        &gt;&gt;&gt; data_fn = r&quot;/home/occam/line1/inv1/OccamDataFile.dat&quot;</span>
<span class="sd">        &gt;&gt;&gt; resp_list = [r&quot;/home/occam/line1/inv1/test_{0:02}&quot;.format(ii) </span>
<span class="sd">                         for ii in range(2, 8, 2)]</span>
<span class="sd">        &gt;&gt;&gt; pr_obj = occam2d.PlotResponse(data_fn, resp_list, plot_tipper=&#39;y&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span><span class="p">,</span> <span class="n">resp_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">data_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="o">=</span> <span class="n">resp_fn</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wl_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;wl_fn&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;color_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lw&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;e_capthick&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;e_capsize&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">err_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># color mode</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span>
            <span class="c1"># color for data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cted</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cted&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctmd&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mted</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mted&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtmd&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>

            <span class="c1"># color for occam2d model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctem</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctem&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">6</span><span class="p">,</span> <span class="o">.</span><span class="mi">3</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctmm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctmm&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtem</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtem&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtmm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtmm&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>

            <span class="c1"># color for Winglink model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctewl</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctewl&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">6</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctmwl</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctmwl&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtewl</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtewl&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtmwl</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtmwl&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>

            <span class="c1"># color of tipper</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctipr</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctipr&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctipi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctipi&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">)</span>

        <span class="c1"># black and white mode</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;bw&#39;</span><span class="p">:</span>
            <span class="c1"># color for data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cted</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cted&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctmd&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mted</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mted&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtmd&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">)</span>

            <span class="c1"># color for occam2d model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctem</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctem&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctmm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctmm&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtem</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtem&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtmm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtmm&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>

            <span class="c1"># color for Winglink model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctewl</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctewl&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctmwl</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctmwl&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtewl</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtewl&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mtmwl</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mtmwl&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ctipr</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctipr&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctipi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ctipi&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phase_limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;phase_limits&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">95</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res_limits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip_limits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tip_limits&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_num&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_size&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dpi&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">15</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span> <span class="o">=</span> <span class="o">.</span><span class="mi">98</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span> <span class="o">=</span> <span class="o">.</span><span class="mi">085</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span> <span class="o">=</span> <span class="o">.</span><span class="mi">93</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;font_size&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_type&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_num</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_num&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_tipper</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_tipper&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_model_error</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_model_err&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_yn&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ylabel_coord</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ylabel_coords&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-.</span><span class="mi">055</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_num</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ylabel_coord</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ylabel_coords&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-.</span><span class="mi">12</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<div class="viewcode-block" id="PlotResponse.plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotResponse.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot the data and model response, if given, in individual plots.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data_obj</span> <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
        <span class="n">data_obj</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>

        <span class="n">rp_list</span> <span class="o">=</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">data</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rp_list</span><span class="p">)</span>

        <span class="c1"># create station list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">rp</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">rp</span> <span class="ow">in</span> <span class="n">rp_list</span><span class="p">]</span>

        <span class="c1"># boolean for adding winglink output to the plots 0 for no, 1 for yes</span>
        <span class="n">addwl</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># read in winglink data file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl_fn</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">addwl</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span> <span class="o">+</span> <span class="o">.</span><span class="mi">1</span>
            <span class="n">wld</span><span class="p">,</span> <span class="n">wlrp_list</span><span class="p">,</span> <span class="n">wlplist</span><span class="p">,</span> <span class="n">wlslist</span><span class="p">,</span> <span class="n">wltlist</span> <span class="o">=</span> <span class="n">MTwl</span><span class="o">.</span><span class="n">readOutputFile</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wl_fn</span><span class="p">)</span>
            <span class="n">sdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">ostation</span><span class="p">,</span> <span class="n">wlistation</span><span class="p">)</span> <span class="k">for</span> <span class="n">wlistation</span> <span class="ow">in</span> <span class="n">wlslist</span>
                          <span class="k">for</span> <span class="n">ostation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_list</span>
                          <span class="k">if</span> <span class="n">wlistation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">ostation</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">])</span>

        <span class="c1"># set a local parameter period for less typing</span>
        <span class="n">period</span> <span class="o">=</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">period</span>

        <span class="c1"># ---------------plot each respones in a different figure--------------</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">pstation_list</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_list</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span><span class="p">]</span>

            <span class="n">pstation_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">pstation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">station</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">pstation</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">pstation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>

                        <span class="c1"># set the grid of subplots</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tipper</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                                   <span class="n">wspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span><span class="p">,</span>
                                   <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span><span class="p">,</span>
                                   <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span><span class="p">,</span>
                                   <span class="n">bottom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span><span class="p">,</span>
                                   <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span><span class="p">,</span>
                                   <span class="n">hspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span><span class="p">,</span>
                                   <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                                   <span class="n">wspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span><span class="p">,</span>
                                   <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span><span class="p">,</span>
                                   <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span><span class="p">,</span>
                                   <span class="n">bottom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span><span class="p">,</span>
                                   <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span><span class="p">,</span>
                                   <span class="n">hspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span><span class="p">,</span>
                                   <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>

        <span class="c1"># --&gt; set default font size</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span>

        <span class="c1"># loop over each station to plot</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pstation_list</span><span class="p">):</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_list</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

            <span class="c1"># --&gt; set subplot instances</span>
            <span class="c1"># ---plot both TE and TM in same subplot---</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">axrte</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
                <span class="n">axrtm</span> <span class="o">=</span> <span class="n">axrte</span>
                <span class="n">axpte</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrte</span><span class="p">)</span>
                <span class="n">axptm</span> <span class="o">=</span> <span class="n">axpte</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tipper</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                    <span class="n">axtipre</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrte</span><span class="p">)</span>
                    <span class="n">axtipim</span> <span class="o">=</span> <span class="n">axtipre</span>

            <span class="c1"># ---plot TE and TM in separate subplots---</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_num</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">axrte</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">axrtm</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">axpte</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrte</span><span class="p">)</span>
                <span class="n">axptm</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrtm</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tipper</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                    <span class="n">axtipre</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrte</span><span class="p">)</span>
                    <span class="n">axtipim</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">axrtm</span><span class="p">)</span>

            <span class="c1"># plot the data, it should be the same for all response files</span>
            <span class="c1"># empty lists for legend marker and label</span>
            <span class="n">rlistte</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">llistte</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">rlisttm</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">llisttm</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># ------------Plot Resistivity----------------------------------</span>
            <span class="c1"># cut out missing data points first</span>
            <span class="c1"># --&gt; data</span>
            <span class="n">rxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ryx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># --&gt; TE mode Data</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rxy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rte_err</span> <span class="o">=</span> <span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">rxy</span><span class="p">]</span> <span class="o">*</span> \
                    <span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">rxy</span><span class="p">]</span>
                <span class="n">rte</span> <span class="o">=</span> <span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrte</span><span class="p">,</span>
                                    <span class="n">period</span><span class="p">[</span><span class="n">rxy</span><span class="p">],</span>
                                    <span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">rxy</span><span class="p">],</span>
                                    <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">,</span>
                                    <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span>
                                    <span class="n">y_error</span><span class="o">=</span><span class="n">rte_err</span><span class="p">,</span>
                                    <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                    <span class="n">e_capsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span><span class="p">,</span>
                                    <span class="n">e_capthick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span><span class="p">)</span>

                <span class="n">rlistte</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rte</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">llistte</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$Obs_</span><span class="si">{TE}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rte</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span>

                <span class="c1"># --&gt; TM mode data</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ryx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rtm_err</span> <span class="o">=</span> <span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">ryx</span><span class="p">]</span> <span class="o">*</span> \
                    <span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ryx</span><span class="p">]</span>
                <span class="n">rtm</span> <span class="o">=</span> <span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrtm</span><span class="p">,</span>
                                    <span class="n">period</span><span class="p">[</span><span class="n">ryx</span><span class="p">],</span>
                                    <span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">ryx</span><span class="p">],</span>
                                    <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">,</span>
                                    <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span>
                                    <span class="n">y_error</span><span class="o">=</span><span class="n">rtm_err</span><span class="p">,</span>
                                    <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                    <span class="n">e_capsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span><span class="p">,</span>
                                    <span class="n">e_capthick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span><span class="p">)</span>

                <span class="n">rlisttm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rtm</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">llisttm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$Obs_</span><span class="si">{TM}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rtm</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span>
            <span class="c1"># --------------------plot phase--------------------------------</span>
            <span class="c1"># cut out missing data points first</span>
            <span class="c1"># --&gt; data</span>
            <span class="n">pxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;te_phase&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pyx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;tm_phase&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># --&gt; TE mode data</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pxy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pte</span> <span class="o">=</span> <span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpte</span><span class="p">,</span>
                                    <span class="n">period</span><span class="p">[</span><span class="n">pxy</span><span class="p">],</span>
                                    <span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;te_phase&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">pxy</span><span class="p">],</span>
                                    <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mted</span><span class="p">,</span>
                                    <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cted</span><span class="p">,</span>
                                    <span class="n">y_error</span><span class="o">=</span><span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;te_phase&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">pxy</span><span class="p">],</span>
                                    <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                    <span class="n">e_capsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span><span class="p">,</span>
                                    <span class="n">e_capthick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">pte</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span>

            <span class="c1"># --&gt; TM mode data</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pyx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ptm</span> <span class="o">=</span> <span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axptm</span><span class="p">,</span>
                                    <span class="n">period</span><span class="p">[</span><span class="n">pyx</span><span class="p">],</span>
                                    <span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;tm_phase&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">pyx</span><span class="p">],</span>
                                    <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mtmd</span><span class="p">,</span>
                                    <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctmd</span><span class="p">,</span>
                                    <span class="n">y_error</span><span class="o">=</span><span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;tm_phase&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">pyx</span><span class="p">],</span>
                                    <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                    <span class="n">e_capsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span><span class="p">,</span>
                                    <span class="n">e_capthick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">ptm</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span>

            <span class="c1"># append axis properties to lists that can be used by</span>
            <span class="c1"># OccamPointPicker</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">axrte</span><span class="p">,</span> <span class="n">axrtm</span><span class="p">,</span> <span class="n">axpte</span><span class="p">,</span> <span class="n">axptm</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rte</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rtm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pte</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ptm</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">err_list</span><span class="o">.</span><span class="n">append</span><span class="p">([[</span><span class="n">rte</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">rte</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">rte</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                  <span class="p">[</span><span class="n">rtm</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">rtm</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">rtm</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                  <span class="p">[</span><span class="n">pte</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pte</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">pte</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                  <span class="p">[</span><span class="n">ptm</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ptm</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ptm</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]]])</span>

            <span class="c1"># ---------------------plot tipper---------------------------------</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tipper</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                <span class="n">t_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">t_label</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">txy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;re_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">tyx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;im_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># --&gt; real tipper  data</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">txy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">per_list_p</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">tpr_list_p</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">per_list_n</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">tpr_list_n</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">per</span><span class="p">,</span> <span class="n">tpr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">txy</span><span class="p">],</span>
                                        <span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;re_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">txy</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">tpr</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">per_list_p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">per</span><span class="p">)</span>
                            <span class="n">tpr_list_p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tpr</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">per_list_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">per</span><span class="p">)</span>
                            <span class="n">tpr_list_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tpr</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">per_list_p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">m_line</span><span class="p">,</span> <span class="n">s_line</span><span class="p">,</span> <span class="n">b_line</span> <span class="o">=</span> <span class="n">axtipre</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">per_list_p</span><span class="p">,</span>
                                                              <span class="n">tpr_list_p</span><span class="p">,</span>
                                                              <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span>
                                                              <span class="n">basefmt</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markerfacecolor&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctipr</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markeredgecolor&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctipr</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markersize&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">s_line</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">s_line</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctipr</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b_line</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">)</span>
                        <span class="n">t_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_line</span><span class="p">)</span>
                        <span class="n">t_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">per_list_n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">m_line</span><span class="p">,</span> <span class="n">s_line</span><span class="p">,</span> <span class="n">b_line</span> <span class="o">=</span> <span class="n">axtipre</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">per_list_n</span><span class="p">,</span>
                                                              <span class="n">tpr_list_n</span><span class="p">,</span>
                                                              <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span>
                                                              <span class="n">basefmt</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markerfacecolor&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctipr</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markeredgecolor&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctipr</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markersize&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">s_line</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">s_line</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctipr</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b_line</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">t_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_line</span><span class="p">)</span>
                            <span class="n">t_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tyx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">per_list_p</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">tpi_list_p</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">per_list_n</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">tpi_list_n</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">per</span><span class="p">,</span> <span class="n">tpi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">tyx</span><span class="p">],</span>
                                        <span class="n">rp_list</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;im_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">tyx</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">tpi</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">per_list_p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">per</span><span class="p">)</span>
                            <span class="n">tpi_list_p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tpi</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">per_list_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">per</span><span class="p">)</span>
                            <span class="n">tpi_list_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tpi</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">per_list_p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">m_line</span><span class="p">,</span> <span class="n">s_line</span><span class="p">,</span> <span class="n">b_line</span> <span class="o">=</span> <span class="n">axtipim</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">per_list_p</span><span class="p">,</span>
                                                              <span class="n">tpi_list_p</span><span class="p">,</span>
                                                              <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span>
                                                              <span class="n">basefmt</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markerfacecolor&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctipi</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markeredgecolor&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctipi</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markersize&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">s_line</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">s_line</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctipi</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b_line</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">)</span>
                        <span class="n">t_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_line</span><span class="p">)</span>
                        <span class="n">t_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Imag&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">per_list_n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">m_line</span><span class="p">,</span> <span class="n">s_line</span><span class="p">,</span> <span class="n">b_line</span> <span class="o">=</span> <span class="n">axtipim</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">per_list_n</span><span class="p">,</span>
                                                              <span class="n">tpi_list_n</span><span class="p">,</span>
                                                              <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span>
                                                              <span class="n">basefmt</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markerfacecolor&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctipi</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markeredgecolor&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctipi</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markersize&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">s_line</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">s_line</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctipi</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b_line</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_list</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">t_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_line</span><span class="p">)</span>
                            <span class="n">t_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Imag&#39;</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="c1"># ------------------- plot model response -------------------------</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">num_resp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">rr</span><span class="p">,</span> <span class="n">rfn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">):</span>
                    <span class="n">resp_obj</span> <span class="o">=</span> <span class="n">Response</span><span class="p">()</span>
                    <span class="n">resp_obj</span><span class="o">.</span><span class="n">read_response_file</span><span class="p">(</span><span class="n">rfn</span><span class="p">)</span>

                    <span class="n">rp</span> <span class="o">=</span> <span class="n">resp_obj</span><span class="o">.</span><span class="n">resp</span>
                    <span class="c1"># create colors for different responses</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span>
                        <span class="n">cxy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                               <span class="o">.</span><span class="mi">4</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">num_resp</span><span class="p">),</span>
                               <span class="mi">0</span><span class="p">)</span>
                        <span class="n">cyx</span> <span class="o">=</span> <span class="p">(</span><span class="o">.</span><span class="mi">7</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">num_resp</span><span class="p">),</span>
                               <span class="o">.</span><span class="mi">13</span><span class="p">,</span>
                               <span class="o">.</span><span class="mi">63</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">num_resp</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">==</span> <span class="s1">&#39;bw&#39;</span><span class="p">:</span>
                        <span class="n">cxy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span>
                               <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">))</span>
                        <span class="n">cyx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span>
                               <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">),</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="p">(</span><span class="n">rr</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">))</span>

                    <span class="c1"># calculate rms&#39;s</span>
                    <span class="n">rmslistte</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">rp</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                           <span class="n">rp</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;te_phase&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">rmslisttm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">rp</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                           <span class="n">rp</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;tm_phase&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">rmste</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">rms</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">rms</span> <span class="ow">in</span> <span class="n">rmslistte</span><span class="p">])</span> <span class="o">/</span>
                                    <span class="nb">len</span><span class="p">(</span><span class="n">rmslistte</span><span class="p">))</span>
                    <span class="n">rmstm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">rms</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">rms</span> <span class="ow">in</span> <span class="n">rmslisttm</span><span class="p">])</span> <span class="o">/</span>
                                    <span class="nb">len</span><span class="p">(</span><span class="n">rmslisttm</span><span class="p">))</span>

                    <span class="c1"># ------------Plot Resistivity-----------------------------</span>
                    <span class="c1"># cut out missing data points first</span>
                    <span class="c1"># --&gt; response</span>
                    <span class="n">mrxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">mryx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="c1"># --&gt; TE mode Model Response</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mrxy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">r3</span> <span class="o">=</span> <span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrte</span><span class="p">,</span>
                                           <span class="n">period</span><span class="p">[</span><span class="n">mrxy</span><span class="p">],</span>
                                           <span class="n">rp</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">mrxy</span><span class="p">],</span>
                                           <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                           <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mtem</span><span class="p">,</span>
                                           <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                           <span class="n">color</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span>
                                           <span class="n">y_error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                           <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                           <span class="n">e_capsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span><span class="p">,</span>
                                           <span class="n">e_capthick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span><span class="p">)</span>

                        <span class="n">rlistte</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r3</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">llistte</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$Mod_</span><span class="si">{TE}</span><span class="s1">$ &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmste</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>

                    <span class="c1"># --&gt; TM mode model response</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mryx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">r4</span> <span class="o">=</span> <span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axrtm</span><span class="p">,</span>
                                           <span class="n">period</span><span class="p">[</span><span class="n">mryx</span><span class="p">],</span>
                                           <span class="n">rp</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">mryx</span><span class="p">],</span>
                                           <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                           <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mtmm</span><span class="p">,</span>
                                           <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                           <span class="n">color</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span>
                                           <span class="n">y_error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                           <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                           <span class="n">e_capsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span><span class="p">,</span>
                                           <span class="n">e_capthick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span><span class="p">)</span>
                        <span class="n">rlisttm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r4</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">llisttm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$Mod_</span><span class="si">{TM}</span><span class="s1">$ &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmstm</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>

                    <span class="c1"># --------------------plot phase---------------------------</span>
                    <span class="c1"># cut out missing data points first</span>
                    <span class="c1"># --&gt; reponse</span>
                    <span class="n">mpxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;te_phase&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">mpyx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;tm_phase&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="c1"># --&gt; TE mode response</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mpxy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">p3</span> <span class="o">=</span> <span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axpte</span><span class="p">,</span>
                                           <span class="n">period</span><span class="p">[</span><span class="n">mpxy</span><span class="p">],</span>
                                           <span class="n">rp</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;te_phase&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">mpxy</span><span class="p">],</span>
                                           <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                           <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                           <span class="n">color</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span>
                                           <span class="n">y_error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                           <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                           <span class="n">e_capsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span><span class="p">,</span>
                                           <span class="n">e_capthick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>

                    <span class="c1"># --&gt; TM mode response</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mpyx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">p4</span> <span class="o">=</span> <span class="n">plot_errorbar</span><span class="p">(</span><span class="n">axptm</span><span class="p">,</span>
                                           <span class="n">period</span><span class="p">[</span><span class="n">mpyx</span><span class="p">],</span>
                                           <span class="n">rp</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;tm_phase&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">mpyx</span><span class="p">],</span>
                                           <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                                           <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mtmm</span><span class="p">,</span>
                                           <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                           <span class="n">color</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span>
                                           <span class="n">y_error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                           <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">,</span>
                                           <span class="n">e_capsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capsize</span><span class="p">,</span>
                                           <span class="n">e_capthick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">e_capthick</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>

                    <span class="c1"># ---------------------plot tipper-------------------------</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tipper</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                        <span class="n">txy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;re_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">tyx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;im_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="c1"># --&gt; real tipper  data</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">txy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">per_list_p</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">tpr_list_p</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">per_list_n</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">tpr_list_n</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">per</span><span class="p">,</span> <span class="n">tpr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">txy</span><span class="p">],</span>
                                                <span class="n">rp</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;re_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">txy</span><span class="p">]):</span>
                                <span class="k">if</span> <span class="n">tpr</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">per_list_p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">per</span><span class="p">)</span>
                                    <span class="n">tpr_list_p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tpr</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">per_list_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">per</span><span class="p">)</span>
                                    <span class="n">tpr_list_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tpr</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">per_list_p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">m_line</span><span class="p">,</span> <span class="n">s_line</span><span class="p">,</span> <span class="n">b_line</span> <span class="o">=</span> <span class="n">axtipre</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">per_list_p</span><span class="p">,</span>
                                                                      <span class="n">tpr_list_p</span><span class="p">,</span>
                                                                      <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span>
                                                                      <span class="n">basefmt</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markerfacecolor&#39;</span><span class="p">,</span> <span class="n">cxy</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markeredgecolor&#39;</span><span class="p">,</span> <span class="n">cxy</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markersize&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">s_line</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">s_line</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">cxy</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b_line</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">per_list_n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">m_line</span><span class="p">,</span> <span class="n">s_line</span><span class="p">,</span> <span class="n">b_line</span> <span class="o">=</span> <span class="n">axtipre</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">per_list_n</span><span class="p">,</span>
                                                                      <span class="n">tpr_list_n</span><span class="p">,</span>
                                                                      <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span>
                                                                      <span class="n">basefmt</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markerfacecolor&#39;</span><span class="p">,</span> <span class="n">cxy</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markeredgecolor&#39;</span><span class="p">,</span> <span class="n">cxy</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markersize&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">s_line</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">s_line</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">cxy</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b_line</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">)</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tyx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">per_list_p</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">tpi_list_p</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">per_list_n</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">tpi_list_n</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">per</span><span class="p">,</span> <span class="n">tpi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">tyx</span><span class="p">],</span>
                                                <span class="n">rp</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;im_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">tyx</span><span class="p">]):</span>
                                <span class="k">if</span> <span class="n">tpi</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">per_list_p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">per</span><span class="p">)</span>
                                    <span class="n">tpi_list_p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tpi</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">per_list_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">per</span><span class="p">)</span>
                                    <span class="n">tpi_list_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tpi</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">per_list_p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">m_line</span><span class="p">,</span> <span class="n">s_line</span><span class="p">,</span> <span class="n">b_line</span> <span class="o">=</span> <span class="n">axtipim</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">per_list_p</span><span class="p">,</span>
                                                                      <span class="n">tpi_list_p</span><span class="p">,</span>
                                                                      <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span>
                                                                      <span class="n">basefmt</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markerfacecolor&#39;</span><span class="p">,</span> <span class="n">cyx</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markeredgecolor&#39;</span><span class="p">,</span> <span class="n">cyx</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markersize&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">s_line</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">s_line</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">cyx</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b_line</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">per_list_n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">m_line</span><span class="p">,</span> <span class="n">s_line</span><span class="p">,</span> <span class="n">b_line</span> <span class="o">=</span> <span class="n">axtipim</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">per_list_n</span><span class="p">,</span>
                                                                      <span class="n">tpi_list_n</span><span class="p">,</span>
                                                                      <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span>
                                                                      <span class="n">basefmt</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markerfacecolor&#39;</span><span class="p">,</span> <span class="n">cyx</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markeredgecolor&#39;</span><span class="p">,</span> <span class="n">cyx</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">m_line</span><span class="p">,</span> <span class="s1">&#39;markersize&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">s_line</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">s_line</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">cyx</span><span class="p">)</span>
                                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b_line</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">)</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>
            <span class="c1"># --------------add in winglink responses------------------------</span>
            <span class="k">if</span> <span class="n">addwl</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">wlrms</span> <span class="o">=</span> <span class="n">wld</span><span class="p">[</span><span class="n">sdict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">station_list</span><span class="p">[</span><span class="n">jj</span><span class="p">]]][</span><span class="s1">&#39;rms&#39;</span><span class="p">]</span>
                    <span class="n">axrte</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_list</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="o">+</span>
                                    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> rms_occ_TE=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmste</span><span class="p">)</span> <span class="o">+</span>
                                    <span class="s1">&#39;rms_occ_TM=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmstm</span><span class="p">)</span> <span class="o">+</span>
                                    <span class="s1">&#39;rms_wl=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wlrms</span><span class="p">),</span>
                                    <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span>
                                              <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
                    <span class="k">for</span> <span class="n">ww</span><span class="p">,</span> <span class="n">wlistation</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wlslist</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">wlistation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_list</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="nb">print</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> was Found </span><span class="si">{0}</span><span class="s1"> in winglink file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">station_list</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">wlistation</span><span class="p">)</span>
                            <span class="n">wlrpdict</span> <span class="o">=</span> <span class="n">wlrp_list</span><span class="p">[</span><span class="n">ww</span><span class="p">]</span>

                    <span class="n">zrxy</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">zryx</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>

                    <span class="c1"># plot winglink resistivity</span>
                    <span class="n">r5</span> <span class="o">=</span> <span class="n">axrte</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">wlplist</span><span class="p">[</span><span class="n">zrxy</span><span class="p">],</span>
                                      <span class="n">wlrpdict</span><span class="p">[</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zrxy</span><span class="p">],</span>
                                      <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
                                      <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mtewl</span><span class="p">,</span>
                                      <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                      <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctewl</span><span class="p">,</span>
                                      <span class="n">mfc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctewl</span><span class="p">,</span>
                                      <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>
                    <span class="n">r6</span> <span class="o">=</span> <span class="n">axrtm</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">wlplist</span><span class="p">[</span><span class="n">zryx</span><span class="p">],</span>
                                      <span class="n">wlrpdict</span><span class="p">[</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zryx</span><span class="p">],</span>
                                      <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
                                      <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mtmwl</span><span class="p">,</span>
                                      <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                      <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctmwl</span><span class="p">,</span>
                                      <span class="n">mfc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctmwl</span><span class="p">,</span>
                                      <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>

                    <span class="c1"># plot winglink phase</span>
                    <span class="n">axpte</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">wlplist</span><span class="p">[</span><span class="n">zrxy</span><span class="p">],</span>
                                   <span class="n">wlrpdict</span><span class="p">[</span><span class="s1">&#39;te_phase&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zrxy</span><span class="p">],</span>
                                   <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
                                   <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mtewl</span><span class="p">,</span>
                                   <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                   <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctewl</span><span class="p">,</span>
                                   <span class="n">mfc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctewl</span><span class="p">,</span>
                                   <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>

                    <span class="n">axptm</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">wlplist</span><span class="p">[</span><span class="n">zryx</span><span class="p">],</span>
                                   <span class="n">wlrpdict</span><span class="p">[</span><span class="s1">&#39;tm_phase&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zryx</span><span class="p">],</span>
                                   <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
                                   <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mtmwl</span><span class="p">,</span>
                                   <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span>
                                   <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctmwl</span><span class="p">,</span>
                                   <span class="n">mfc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctmwl</span><span class="p">,</span>
                                   <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>

                    <span class="n">rlistte</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r5</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">rlisttm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r6</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">llistte</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$WLMod_</span><span class="si">{TE}</span><span class="s1">$ &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wlrms</span><span class="p">))</span>
                    <span class="n">llisttm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$WLMod_</span><span class="si">{TM}</span><span class="s1">$ &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wlrms</span><span class="p">))</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
                    <span class="nb">print</span> <span class="s1">&#39;Station not present&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">axrte</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_list</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span>
                                    <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                              <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_num</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_list</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span>
                                 <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                           <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

            <span class="c1"># set the axis properties</span>
            <span class="n">ax_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axrte</span><span class="p">,</span> <span class="n">axrtm</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">axr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax_list</span><span class="p">):</span>
                <span class="c1"># set both axes to logarithmic scale</span>
                <span class="n">axr</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="c1"># put on a grid</span>
                <span class="n">axr</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=.</span><span class="mi">5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>
                <span class="n">axr</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylabel_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">ylabel_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="c1"># set resistivity limits if desired</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="mi">10</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="c1"># set the tick labels to invisible</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axr</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">aa</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;App. Res. ($\Omega \cdot m$)&#39;</span><span class="p">,</span>
                                   <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                             <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

                <span class="c1"># set legend based on the plot type</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">aa</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">rlistte</span> <span class="o">+</span> <span class="n">rlisttm</span><span class="p">,</span> <span class="n">llistte</span> <span class="o">+</span> <span class="n">llisttm</span><span class="p">,</span>
                                   <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">borderaxespad</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span>
                                   <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                                   <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span>
                                   <span class="n">borderpad</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span>
                                   <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_num</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">aa</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">rlistte</span><span class="p">,</span>
                                   <span class="n">llistte</span><span class="p">,</span>
                                   <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">borderaxespad</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span>
                                   <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                                   <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span>
                                   <span class="n">borderpad</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span>
                                   <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>

                    <span class="k">if</span> <span class="n">aa</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">rlisttm</span><span class="p">,</span>
                                   <span class="n">llisttm</span><span class="p">,</span>
                                   <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">borderaxespad</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span>
                                   <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                                   <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span>
                                   <span class="n">borderpad</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span>
                                   <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>

            <span class="c1"># set Properties for the phase axes</span>
            <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">axp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">axpte</span><span class="p">,</span> <span class="n">axptm</span><span class="p">]):</span>
                <span class="c1"># set the x-axis to log scale</span>
                <span class="n">axp</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

                <span class="c1"># set the phase limits</span>
                <span class="n">axp</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits</span><span class="p">)</span>

                <span class="c1"># put a grid on the subplot</span>
                <span class="n">axp</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=.</span><span class="mi">5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>

                <span class="c1"># set the tick locations</span>
                <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
                <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

                <span class="c1"># set the x axis label</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tipper</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axp</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Period (s)&#39;</span><span class="p">,</span>
                                   <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                             <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

                <span class="c1"># put the y label on the far left plot</span>
                <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylabel_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">ylabel_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">aa</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                                   <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                             <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

            <span class="c1"># set axes properties of tipper axis</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tipper</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">axt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">axtipre</span><span class="p">,</span> <span class="n">axtipim</span><span class="p">]):</span>
                    <span class="n">axt</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

                    <span class="c1"># set tipper limits</span>
                    <span class="n">axt</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits</span><span class="p">)</span>

                    <span class="c1"># put a grid on the subplot</span>
                    <span class="n">axt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=.</span><span class="mi">5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lw</span><span class="p">)</span>

                    <span class="c1"># set the tick locations</span>
                    <span class="n">axt</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">))</span>
                    <span class="n">axt</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">))</span>

                    <span class="c1"># set the x axis label</span>
                    <span class="n">axt</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Period (s)&#39;</span><span class="p">,</span>
                                   <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                             <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

                    <span class="n">axt</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">data_obj</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">min</span><span class="p">())),</span>
                                 <span class="mi">10</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">data_obj</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">max</span><span class="p">())))</span>

                    <span class="c1"># put the y label on the far left plot</span>
                    <span class="n">axt</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylabel_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">ylabel_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">aa</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">axt</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Tipper&#39;</span><span class="p">,</span>
                                       <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                                 <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_num</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">axt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">axt</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.25</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">tip_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span>
                                     <span class="s1">&#39;Real&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                     <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
                                     <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">},</span>
                                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">axt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">t_list</span><span class="p">,</span> <span class="n">t_label</span><span class="p">,</span>
                                       <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                       <span class="n">borderaxespad</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span>
                                       <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                                       <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span>
                                       <span class="n">borderpad</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span>
                                       <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>
                    <span class="k">if</span> <span class="n">aa</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_num</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">axt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">axt</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.25</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">tip_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span>
                                     <span class="s1">&#39;Imag&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                     <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
                                     <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">},</span>
                                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>

            <span class="c1"># make sure the axis and figure are accessible to the user</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;station&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_list</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span>
                                  <span class="s1">&#39;fig&#39;</span><span class="p">:</span> <span class="n">fig</span><span class="p">,</span> <span class="s1">&#39;axrte&#39;</span><span class="p">:</span> <span class="n">axrte</span><span class="p">,</span> <span class="s1">&#39;axrtm&#39;</span><span class="p">:</span> <span class="n">axrtm</span><span class="p">,</span>
                                  <span class="s1">&#39;axpte&#39;</span><span class="p">:</span> <span class="n">axpte</span><span class="p">,</span> <span class="s1">&#39;axptm&#39;</span><span class="p">:</span> <span class="n">axptm</span><span class="p">})</span>

        <span class="c1"># set the plot to be full screen well at least try</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotResponse.redraw_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotResponse.redraw_plot">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        redraw plot if parameters were changed</span>

<span class="sd">        use this function if you updated some attributes and want to re-plot.</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # change the color and marker of the xy components</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(r&quot;/home/occam2d/Data.dat&quot;)</span>
<span class="sd">            &gt;&gt;&gt; p1 = ocd.plot2DResponses()</span>
<span class="sd">            &gt;&gt;&gt; #change color of te markers to a gray-blue</span>
<span class="sd">            &gt;&gt;&gt; p1.cted = (.5, .5, .7)</span>
<span class="sd">            &gt;&gt;&gt; p1.redraw_plot()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotResponse.save_figures"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotResponse.save_figures">[docs]</a>    <span class="k">def</span> <span class="nf">save_figures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">fig_fmt</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">fig_dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">close_fig</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save all the figure that are in self.fig_list</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # change the color and marker of the xy components</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(r&quot;/home/occam2d/Data.dat&quot;)</span>
<span class="sd">            &gt;&gt;&gt; p1 = ocd.plot2DResponses()</span>
<span class="sd">            &gt;&gt;&gt; p1.save_figures(r&quot;/home/occam2d/Figures&quot;, fig_fmt=&#39;jpg&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">fdict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_list</span><span class="p">:</span>
            <span class="n">svfn</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_resp.</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fdict</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">],</span> <span class="n">fig_fmt</span><span class="p">)</span>
            <span class="n">fdict</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">svfn</span><span class="p">),</span>
                                 <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">close_fig</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fdict</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">])</span>

            <span class="nb">print</span> <span class="s2">&quot;saved figure to </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">svfn</span><span class="p">))</span></div></div>

            <span class="c1"># ==============================================================================</span>


<span class="c1"># plot model</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="PlotModel"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotModel">[docs]</a><span class="k">class</span> <span class="nc">PlotModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plot the 2D model found by Occam2D.  The model is displayed as a meshgrid</span>
<span class="sd">    instead of model bricks.  This speeds things up considerably.  </span>

<span class="sd">    Inherets the Model class to take advantage of the attributes and methods</span>
<span class="sd">    already coded.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    -----------</span>
<span class="sd">        **iter_fn** : string</span>
<span class="sd">                      full path to iteration file.  From here all the </span>
<span class="sd">                      necessary files can be found assuming they are in the </span>
<span class="sd">                      same directory.  If they are not then need to input</span>
<span class="sd">                      manually.</span>


<span class="sd">    ======================= ===============================================</span>
<span class="sd">    keywords                description</span>
<span class="sd">    ======================= ===============================================</span>
<span class="sd">    block_font_size         font size of block number is blocknum == &#39;on&#39;</span>
<span class="sd">    blocknum                [ &#39;on&#39; | &#39;off&#39; ] to plot regulariztion block </span>
<span class="sd">                            numbers.</span>
<span class="sd">    cb_pad                  padding between axes edge and color bar </span>
<span class="sd">    cb_shrink               percentage to shrink the color bar</span>
<span class="sd">    climits                 limits of the color scale for resistivity</span>
<span class="sd">                            in log scale (min, max)</span>
<span class="sd">    cmap                    name of color map for resistivity values</span>
<span class="sd">    femesh                  plot the finite element mesh</span>
<span class="sd">    femesh_triangles        plot the finite element mesh with each block</span>
<span class="sd">                            divided into four triangles</span>
<span class="sd">    fig_aspect              aspect ratio between width and height of </span>
<span class="sd">                            resistivity image. 1 for equal axes</span>
<span class="sd">    fig_dpi                 resolution of figure in dots-per-inch</span>
<span class="sd">    fig_num                 number of figure instance</span>
<span class="sd">    fig_size                size of figure in inches (width, height)</span>
<span class="sd">    font_size               size of axes tick labels, axes labels is +2</span>
<span class="sd">    grid                    [ &#39;both&#39; | &#39;major&#39; |&#39;minor&#39; | None ] string </span>
<span class="sd">                            to tell the program to make a grid on the </span>
<span class="sd">                            specified axes.</span>
<span class="sd">    meshnum                 [ &#39;on&#39; | &#39;off&#39; ] &#39;on&#39; will plot finite element</span>
<span class="sd">                            mesh numbers</span>
<span class="sd">    meshnum_font_size       font size of mesh numbers if meshnum == &#39;on&#39;</span>
<span class="sd">    ms                      size of station marker </span>
<span class="sd">    plot_yn                 [ &#39;y&#39; | &#39;n&#39;]</span>
<span class="sd">                            &#39;y&#39; --&gt; to plot on instantiation</span>
<span class="sd">                            &#39;n&#39; --&gt; to not plot on instantiation</span>
<span class="sd">    regmesh                 [ &#39;on&#39; | &#39;off&#39; ] plot the regularization mesh</span>
<span class="sd">                            plots as blue lines</span>
<span class="sd">    station_color           color of station marker</span>
<span class="sd">    station_font_color      color station label</span>
<span class="sd">    station_font_pad        padding between station label and marker</span>
<span class="sd">    station_font_rotation   angle of station label in degrees 0 is </span>
<span class="sd">                            horizontal</span>
<span class="sd">    station_font_size       font size of station label</span>
<span class="sd">    station_font_weight     font weight of station label</span>
<span class="sd">    station_id              index to take station label from station name</span>
<span class="sd">    station_marker          station marker.  if inputing a LaTex marker</span>
<span class="sd">                            be sure to input as r&quot;LaTexMarker&quot; otherwise</span>
<span class="sd">                            might not plot properly</span>
<span class="sd">    subplot_bottom          subplot spacing from bottom  </span>
<span class="sd">    subplot_left            subplot spacing from left  </span>
<span class="sd">    subplot_right           subplot spacing from right</span>
<span class="sd">    subplot_top             subplot spacing from top</span>
<span class="sd">    title                   title of plot.  If None then the name of the</span>
<span class="sd">                            iteration file and containing folder will be</span>
<span class="sd">                            the title with RMS and Roughness.</span>
<span class="sd">    xlimits                 limits of plot in x-direction in (km) </span>
<span class="sd">    xminorticks             increment of minor ticks in x direction</span>
<span class="sd">    xpad                    padding in x-direction in km</span>
<span class="sd">    ylimits                 depth limits of plot positive down (km)</span>
<span class="sd">    yminorticks             increment of minor ticks in y-direction</span>
<span class="sd">    ypad                    padding in negative y-direction (km)</span>
<span class="sd">    yscale                  [ &#39;km&#39; | &#39;m&#39; ] scale of plot, if &#39;m&#39; everything</span>
<span class="sd">                            will be scaled accordingly.</span>
<span class="sd">    ======================= ===============================================</span>

<span class="sd">    =================== =======================================================</span>
<span class="sd">    Methods             Description</span>
<span class="sd">    =================== =======================================================</span>
<span class="sd">    plot                plots resistivity model.  </span>
<span class="sd">    redraw_plot         call redraw_plot to redraw the figures, </span>
<span class="sd">                        if one of the attributes has been changed</span>
<span class="sd">    save_figure         saves the matplotlib.figure instance to desired </span>
<span class="sd">                        location and format</span>
<span class="sd">    =================== ====================================================</span>

<span class="sd">    :Example: </span>
<span class="sd">    ---------------</span>
<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">        &gt;&gt;&gt; model_plot = occam2d.PlotModel(r&quot;/home/occam/Inv1/mt_01.iter&quot;)</span>
<span class="sd">        &gt;&gt;&gt; # change the color limits</span>
<span class="sd">        &gt;&gt;&gt; model_plot.climits = (1, 4)</span>
<span class="sd">        &gt;&gt;&gt; model_plot.redraw_plot()</span>
<span class="sd">        &gt;&gt;&gt; #change len of station name</span>
<span class="sd">        &gt;&gt;&gt; model_plot.station_id = [2, 5]</span>
<span class="sd">        &gt;&gt;&gt; model_plot.redraw_plot()</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iter_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Model</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iter_fn</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">yscale</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;yscale&#39;</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_num&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_size&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dpi&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_aspect</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_aspect&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xpad</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xpad&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ypad</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ypad&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_font_size&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_font_pad</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_font_pad&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_font_weight</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_font_weight&#39;</span><span class="p">,</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_font_rotation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_font_rotation&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_font_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_font_color&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_marker</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_marker&#39;</span><span class="p">,</span>
                                         <span class="s2">r&quot;$\blacktriangledown$&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_color&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ylimits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ylimits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xlimits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xlimits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xminorticks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xminorticks&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yminorticks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;yminorticks&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">climits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;climits&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;jet_r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;font_size&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">femesh</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;femesh&#39;</span><span class="p">,</span> <span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">femesh_triangles</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;femesh_triangles&#39;</span><span class="p">,</span> <span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">femesh_lw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;femesh_lw&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">femesh_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;femesh_color&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meshnum</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;meshnum&#39;</span><span class="p">,</span> <span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meshnum_font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;meshnum_font_size&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">regmesh</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;regmesh&#39;</span><span class="p">,</span> <span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regmesh_lw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;regmesh_lw&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regmesh_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;regmesh_color&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocknum</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;blocknum&#39;</span><span class="p">,</span> <span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;block_font_size&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb_shrink</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cb_shrink&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb_pad</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cb_pad&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span> <span class="o">=</span> <span class="o">.</span><span class="mi">99</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span> <span class="o">=</span> <span class="o">.</span><span class="mi">085</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span> <span class="o">=</span> <span class="o">.</span><span class="mi">92</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_yn&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<div class="viewcode-block" id="PlotModel.plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotModel.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plotModel will plot the model output by occam2d in the iteration file.</span>


<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; itfn = r&quot;/home/Occam2D/Line1/Inv1/Test_15.iter&quot;</span>
<span class="sd">            &gt;&gt;&gt; model_plot = occam2d.PlotModel(itfn)</span>
<span class="sd">            &gt;&gt;&gt; model_plot.ms = 20</span>
<span class="sd">            &gt;&gt;&gt; model_plot.ylimits = (0,.350)</span>
<span class="sd">            &gt;&gt;&gt; model_plot.yscale = &#39;m&#39;</span>
<span class="sd">            &gt;&gt;&gt; model_plot.spad = .10</span>
<span class="sd">            &gt;&gt;&gt; model_plot.ypad = .125</span>
<span class="sd">            &gt;&gt;&gt; model_plot.xpad = .025</span>
<span class="sd">            &gt;&gt;&gt; model_plot.climits = (0,2.5)</span>
<span class="sd">            &gt;&gt;&gt; model_plot.aspect = &#39;equal&#39;</span>
<span class="sd">            &gt;&gt;&gt; model_plot.redraw_plot()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># --&gt; read in iteration file and build the model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_iter_file</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_model</span><span class="p">()</span>

        <span class="c1"># --&gt; get station locations and names from data file</span>
        <span class="n">d_object</span> <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
        <span class="n">d_object</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;station_locations&#39;</span><span class="p">,</span> <span class="n">d_object</span><span class="o">.</span><span class="n">station_locations</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;station_list&#39;</span><span class="p">,</span> <span class="n">d_object</span><span class="o">.</span><span class="n">station_list</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

        <span class="c1"># set the scale of the plot</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yscale</span> <span class="o">==</span> <span class="s1">&#39;km&#39;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="mf">1000.</span>
            <span class="n">pf</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">yscale</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">pf</span> <span class="o">=</span> <span class="mf">1000.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="mf">1000.</span>
            <span class="n">pf</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c1"># set some figure properties to use the maiximum space</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.left&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.right&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.top&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span>

        <span class="c1"># station font dictionary</span>
        <span class="n">fdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_font_size</span><span class="p">,</span>
                 <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_font_weight</span><span class="p">,</span>
                 <span class="s1">&#39;rotation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_font_rotation</span><span class="p">,</span>
                 <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_font_color</span><span class="p">}</span>

        <span class="c1"># plot the model as a mesh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

        <span class="c1"># add a subplot to the figure with the specified aspect ratio</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_aspect</span><span class="p">)</span>

        <span class="c1"># plot the model as a pcolormesh so the extents are constrained to</span>
        <span class="c1"># the model coordinates</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_x</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">mesh_z</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span>
                      <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># make a colorbar for the resistivity</span>
        <span class="n">cbx</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">make_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb_shrink</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb_pad</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span>
                              <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                             <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Resistivity ($\Omega \cdot$m)&#39;</span><span class="p">,</span>
                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s1">&#39;10$^</span><span class="si">{0}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                     <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>

        <span class="c1"># set the offsets of the stations and plot the stations</span>
        <span class="c1"># need to figure out a way to set the marker at the surface in all</span>
        <span class="c1"># views.</span>
        <span class="k">for</span> <span class="n">offset</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_list</span><span class="p">):</span>
            <span class="c1"># plot the station marker</span>
            <span class="c1"># plots a V for the station cause when you use scatter the spacing</span>
            <span class="c1"># is variable if you change the limits of the y axis, this way it</span>
            <span class="c1"># always plots at the surface.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">offset</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">station_marker</span><span class="p">,</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;baseline&#39;</span><span class="p">,</span>
                    <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_color</span><span class="p">})</span>

            <span class="c1"># put station id onto station marker</span>
            <span class="c1"># if there is a station id index</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_id</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">offset</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span>
                        <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">station_font_pad</span> <span class="o">*</span> <span class="n">pf</span><span class="p">,</span>
                        <span class="n">name</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">station_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">station_id</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;baseline&#39;</span><span class="p">,</span>
                        <span class="n">fontdict</span><span class="o">=</span><span class="n">fdict</span><span class="p">)</span>
            <span class="c1"># otherwise put on the full station name found form data file</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">offset</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span>
                        <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">station_font_pad</span> <span class="o">*</span> <span class="n">pf</span><span class="p">,</span>
                        <span class="n">name</span><span class="p">,</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;baseline&#39;</span><span class="p">,</span>
                        <span class="n">fontdict</span><span class="o">=</span><span class="n">fdict</span><span class="p">)</span>

        <span class="c1"># set the initial limits of the plot to be square about the profile</span>
        <span class="c1"># line</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylimits</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span>
                        <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ypad</span> <span class="o">*</span> <span class="n">pf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylimits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">pf</span><span class="p">,</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylimits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ypad</span><span class="p">)</span> <span class="o">*</span> <span class="n">pf</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlimits</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xpad</span> <span class="o">*</span> <span class="n">pf</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">station_locations</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xpad</span> <span class="o">*</span> <span class="n">pf</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlimits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">pf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlimits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">pf</span><span class="p">)</span>

        <span class="c1"># set the axis properties</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xminorticks</span> <span class="o">*</span> <span class="n">pf</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yminorticks</span> <span class="o">*</span> <span class="n">pf</span><span class="p">))</span>

        <span class="c1"># set axes labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Horizontal Distance (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yscale</span><span class="p">),</span>
                      <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth (</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yscale</span><span class="p">),</span>
                      <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

        <span class="c1"># put a grid on if one is desired</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">lw</span><span class="o">=.</span><span class="mi">35</span><span class="p">)</span>

        <span class="c1"># set title as rms and roughness</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;on&#39;</span><span class="p">:</span>
                <span class="n">titlestr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span><span class="p">)),</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">: RMS=</span><span class="si">{1:.2f}</span><span class="s1">, Roughness=</span><span class="si">{2:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">titlestr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">misfit_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">roughness_value</span><span class="p">),</span>
                    <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                              <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">; RMS=</span><span class="si">{1:.2f}</span><span class="s1">, Roughness=</span><span class="si">{2:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">misfit_value</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">roughness_value</span><span class="p">),</span>
                    <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                              <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;RMS </span><span class="si">{0:.2f}</span><span class="s1">, Roughness=</span><span class="si">{1:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">misfit_value</span><span class="p">,</span>
                                                          <span class="bp">self</span><span class="o">.</span><span class="n">roughness_value</span><span class="p">)</span>

            <span class="c1"># plot forward model mesh</span>
        <span class="c1"># making an extended list seperated by None&#39;s speeds up the plotting</span>
        <span class="c1"># by as much as 99 percent, handy</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">femesh</span> <span class="o">==</span> <span class="s1">&#39;on&#39;</span><span class="p">:</span>
            <span class="n">row_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">row_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span> <span class="o">/</span> <span class="n">df</span><span class="p">:</span>
                <span class="n">row_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span> <span class="n">xx</span><span class="p">])</span>
                <span class="n">row_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">row_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_zy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">])</span>
                <span class="n">row_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="c1"># plot column lines (variables are a little bit of a misnomer)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">row_line_xlist</span><span class="p">,</span>
                    <span class="n">row_line_ylist</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                    <span class="n">lw</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>

            <span class="n">col_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">col_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">/</span> <span class="n">df</span><span class="p">:</span>
                <span class="n">col_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">])</span>
                <span class="n">col_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">col_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">yy</span><span class="p">,</span> <span class="n">yy</span><span class="p">])</span>
                <span class="n">col_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="c1"># plot row lines (variables are a little bit of a misnomer)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col_line_xlist</span><span class="p">,</span>
                    <span class="n">col_line_ylist</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                    <span class="n">lw</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">femesh_triangles</span> <span class="o">==</span> <span class="s1">&#39;on&#39;</span><span class="p">:</span>
            <span class="n">row_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">row_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span> <span class="o">/</span> <span class="n">df</span><span class="p">:</span>
                <span class="n">row_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span> <span class="n">xx</span><span class="p">])</span>
                <span class="n">row_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">row_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">])</span>
                <span class="n">row_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="c1"># plot columns</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">row_line_xlist</span><span class="p">,</span>
                    <span class="n">row_line_ylist</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                    <span class="n">lw</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>

            <span class="n">col_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">col_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span> <span class="o">/</span> <span class="n">df</span><span class="p">:</span>
                <span class="n">col_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">])</span>
                <span class="n">col_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">col_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">yy</span><span class="p">,</span> <span class="n">yy</span><span class="p">])</span>
                <span class="n">col_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="c1"># plot rows</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col_line_xlist</span><span class="p">,</span>
                    <span class="n">col_line_ylist</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                    <span class="n">lw</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>

            <span class="n">diag_line_xlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">diag_line_ylist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">xi</span><span class="p">,</span> <span class="n">xx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">yi</span><span class="p">,</span> <span class="n">yy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">):</span>
                    <span class="n">diag_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span><span class="p">[</span><span class="n">xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">])</span>
                    <span class="n">diag_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="n">diag_line_xlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span><span class="p">[</span><span class="n">xi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">])</span>
                    <span class="n">diag_line_xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

                    <span class="n">diag_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">yy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span><span class="p">[</span><span class="n">yi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">])</span>
                    <span class="n">diag_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="n">diag_line_ylist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span><span class="p">[</span><span class="n">yi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span> <span class="n">yy</span><span class="p">])</span>
                    <span class="n">diag_line_ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="c1"># plot diagonal lines.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">diag_line_xlist</span><span class="p">,</span>
                    <span class="n">diag_line_ylist</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                    <span class="n">lw</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># plot the regularization mesh</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">regmesh</span> <span class="o">==</span> <span class="s1">&#39;on&#39;</span><span class="p">:</span>
            <span class="n">line_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="p">)):</span>
                <span class="c1"># get the number of layers to combine</span>
                <span class="c1"># this index will be the first index in the vertical direction</span>
                <span class="n">ny1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="p">[:</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                <span class="c1"># the second index  in the vertical direction</span>
                <span class="n">ny2</span> <span class="o">=</span> <span class="n">ny1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># make the list of amalgamated columns an array for ease</span>
                <span class="n">lc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_cols</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="n">yline</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">],</span>
                                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span><span class="p">[</span><span class="o">-</span><span class="n">ny1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span><span class="p">[</span><span class="o">-</span><span class="n">ny1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">],</span>
                                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                                <span class="n">lw</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>

                <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yline</span><span class="p">)</span>

                <span class="c1"># loop over the number of amalgamated blocks</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_cols</span><span class="p">[</span><span class="n">ii</span><span class="p">])):</span>
                    <span class="c1"># get first in index in the horizontal direction</span>
                    <span class="n">nx1</span> <span class="o">=</span> <span class="n">lc</span><span class="p">[:</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                    <span class="c1"># get second index in horizontal direction</span>
                    <span class="n">nx2</span> <span class="o">=</span> <span class="n">nx1</span> <span class="o">+</span> <span class="n">lc</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ny1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">ny1</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">xline</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span><span class="p">[</span><span class="n">nx1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span><span class="p">[</span><span class="n">nx1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">],</span>
                                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span><span class="p">[</span><span class="o">-</span><span class="n">ny1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span><span class="p">[</span><span class="o">-</span><span class="n">ny2</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">],</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                                        <span class="n">lw</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
                        <span class="n">line_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xline</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>

        <span class="c1"># plot the mesh block numbers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshnum</span> <span class="o">==</span> <span class="s1">&#39;on&#39;</span><span class="p">:</span>
            <span class="n">kk</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span> <span class="o">/</span> <span class="n">df</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kk</span><span class="p">),</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshnum_font_size</span><span class="p">})</span>
                    <span class="n">kk</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># plot regularization block numbers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocknum</span> <span class="o">==</span> <span class="s1">&#39;on&#39;</span><span class="p">:</span>
            <span class="n">kk</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="p">)):</span>
                <span class="c1"># get the number of layers to combine</span>
                <span class="c1"># this index will be the first index in the vertical direction</span>
                <span class="n">ny1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="p">[:</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                <span class="c1"># the second index  in the vertical direction</span>
                <span class="n">ny2</span> <span class="o">=</span> <span class="n">ny1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># make the list of amalgamated columns an array for ease</span>
                <span class="n">lc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_cols</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="c1"># loop over the number of amalgamated blocks</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_cols</span><span class="p">[</span><span class="n">ii</span><span class="p">])):</span>
                    <span class="c1"># get first in index in the horizontal direction</span>
                    <span class="n">nx1</span> <span class="o">=</span> <span class="n">lc</span><span class="p">[:</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="c1"># get second index in horizontal direction</span>
                    <span class="n">nx2</span> <span class="o">=</span> <span class="n">nx1</span> <span class="o">+</span> <span class="n">lc</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ny1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">ny1</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="c1"># get center points of the blocks</span>
                        <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span><span class="p">[</span><span class="o">-</span><span class="n">ny1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span><span class="p">[</span><span class="o">-</span><span class="n">ny1</span><span class="p">]</span> <span class="o">-</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">plot_z</span><span class="p">[</span><span class="o">-</span><span class="n">ny2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="n">xx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span><span class="p">[</span><span class="n">nx1</span><span class="p">]</span> <span class="o">-</span> \
                            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span><span class="p">[</span><span class="n">nx1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_x</span><span class="p">[</span><span class="n">nx2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="c1"># put the number</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xx</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span> <span class="n">yy</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kk</span><span class="p">),</span>
                                <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_font_size</span><span class="p">},</span>
                                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                        <span class="n">kk</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># make attributes that can be manipulated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbax</span> <span class="o">=</span> <span class="n">cb</span></div>

<div class="viewcode-block" id="PlotModel.redraw_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotModel.redraw_plot">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        redraw plot if parameters were changed</span>

<span class="sd">        use this function if you updated some attributes and want to re-plot.</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # change the color and marker of the xy components</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(r&quot;/home/occam2d/Data.dat&quot;)</span>
<span class="sd">            &gt;&gt;&gt; p1 = ocd.plotAllResponses()</span>
<span class="sd">            &gt;&gt;&gt; #change line width</span>
<span class="sd">            &gt;&gt;&gt; p1.lw = 2</span>
<span class="sd">            &gt;&gt;&gt; p1.redraw_plot()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotModel.save_figure"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotModel.save_figure">[docs]</a>    <span class="k">def</span> <span class="nf">save_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_fn</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">,</span>
                    <span class="n">fig_dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">close_fig</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save_plot will save the figure to save_fn.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>

<span class="sd">            **save_fn** : string</span>
<span class="sd">                          full path to save figure to, can be input as</span>
<span class="sd">                          * directory path -&gt; the directory path to save to</span>
<span class="sd">                            in which the file will be saved as </span>
<span class="sd">                            save_fn/station_name_PhaseTensor.file_format</span>

<span class="sd">                          * full path -&gt; file will be save to the given </span>
<span class="sd">                            path.  If you use this option then the format</span>
<span class="sd">                            will be assumed to be provided by the path</span>

<span class="sd">            **file_format** : [ pdf | eps | jpg | png | svg ]</span>
<span class="sd">                              file type of saved figure pdf,svg,eps... </span>

<span class="sd">            **orientation** : [ landscape | portrait ]</span>
<span class="sd">                              orientation in which the file will be saved</span>
<span class="sd">                              *default* is portrait</span>

<span class="sd">            **fig_dpi** : int</span>
<span class="sd">                          The resolution in dots-per-inch the file will be</span>
<span class="sd">                          saved.  If None then the dpi will be that at </span>
<span class="sd">                          which the figure was made.  I don&#39;t think that </span>
<span class="sd">                          it can be larger than dpi of the figure.</span>

<span class="sd">            **close_plot** : [ y | n ]</span>
<span class="sd">                             * &#39;y&#39; will close the plot after saving.</span>
<span class="sd">                             * &#39;n&#39; will leave plot open</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # to save plot as jpg</span>
<span class="sd">            &gt;&gt;&gt; model_plot.save_figure(r&quot;/home/occam/figures&quot;, </span>
<span class="sd">                                       file_format=&#39;jpg&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">fig_dpi</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_dpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">file_format</span> <span class="o">=</span> <span class="n">save_fn</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">save_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="s1">&#39;OccamModel.&#39;</span> <span class="o">+</span>
                                   <span class="n">file_format</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">close_fig</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span> <span class="o">=</span> <span class="n">save_fn</span>
        <span class="nb">print</span> <span class="s1">&#39;Saved figure to: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span></div>

<div class="viewcode-block" id="PlotModel.update_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotModel.update_plot">[docs]</a>    <span class="k">def</span> <span class="nf">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update any parameters that where changed using the built-in draw from</span>
<span class="sd">        canvas.  </span>

<span class="sd">        Use this if you change an of the .fig or axes properties</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # to change the grid lines to only be on the major ticks</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; dfn = r&quot;/home/occam2d/Inv1/data.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(dfn)</span>
<span class="sd">            &gt;&gt;&gt; ps1 = ocd.plotAllResponses()</span>
<span class="sd">            &gt;&gt;&gt; [ax.grid(True, which=&#39;major&#39;) for ax in [ps1.axrte,ps1.axtep]]</span>
<span class="sd">            &gt;&gt;&gt; ps1.update_plot()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotModel.__str__"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotModel.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rewrite the string builtin to give a useful message</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;Plots the resistivity model found by Occam2D.&quot;</span><span class="p">)</span></div></div>


<span class="c1"># ==============================================================================</span>
<span class="c1"># plot L2 curve of iteration vs rms</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="PlotL2"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotL2">[docs]</a><span class="k">class</span> <span class="nc">PlotL2</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot L2 curve of iteration vs rms and rms vs roughness.</span>

<span class="sd">    Need to only input an .iter file, will read all similar .iter files</span>
<span class="sd">    to get the rms, iteration number and roughness of all similar .iter files.</span>

<span class="sd">    Arguments:</span>
<span class="sd">    ----------</span>
<span class="sd">        **iter_fn** : string</span>
<span class="sd">                      full path to an iteration file output by Occam2D.</span>

<span class="sd">    ======================= ===================================================</span>
<span class="sd">    Keywords/attributes     Description</span>
<span class="sd">    ======================= ===================================================</span>
<span class="sd">    ax1                     matplotlib.axes instance for rms vs iteration</span>
<span class="sd">    ax2                     matplotlib.axes instance for roughness vs rms</span>
<span class="sd">    fig                     matplotlib.figure instance</span>
<span class="sd">    fig_dpi                 resolution of figure in dots-per-inch</span>
<span class="sd">    fig_num                 number of figure instance</span>
<span class="sd">    fig_size                size of figure in inches (width, height)</span>
<span class="sd">    font_size               size of axes tick labels, axes labels is +2</span>
<span class="sd">    plot_yn                 [ &#39;y&#39; | &#39;n&#39;]</span>
<span class="sd">                            &#39;y&#39; --&gt; to plot on instantiation</span>
<span class="sd">                            &#39;n&#39; --&gt; to not plot on instantiation</span>
<span class="sd">    rms_arr                 structure np.array as described above</span>
<span class="sd">    rms_color               color of rms marker and line</span>
<span class="sd">    rms_lw                  line width of rms line</span>
<span class="sd">    rms_marker              marker for rms values</span>
<span class="sd">    rms_marker_size         size of marker for rms values</span>
<span class="sd">    rms_mean_color          color of mean line</span>
<span class="sd">    rms_median_color        color of median line</span>
<span class="sd">    rough_color             color of roughness line and marker</span>
<span class="sd">    rough_font_size         font size for iteration number inside roughness </span>
<span class="sd">                            marker</span>
<span class="sd">    rough_lw                line width for roughness line </span>
<span class="sd">    rough_marker            marker for roughness</span>
<span class="sd">    rough_marker_size       size of marker for roughness</span>
<span class="sd">    subplot_bottom          subplot spacing from bottom  </span>
<span class="sd">    subplot_left            subplot spacing from left  </span>
<span class="sd">    subplot_right           subplot spacing from right</span>
<span class="sd">    subplot_top             subplot spacing from top</span>
<span class="sd">    ======================= ===================================================</span>

<span class="sd">    =================== =======================================================</span>
<span class="sd">    Methods             Description</span>
<span class="sd">    =================== =======================================================</span>
<span class="sd">    plot                plots L2 curve.  </span>
<span class="sd">    redraw_plot         call redraw_plot to redraw the figures, </span>
<span class="sd">                        if one of the attributes has been changed</span>
<span class="sd">    save_figure         saves the matplotlib.figure instance to desired </span>
<span class="sd">                        location and format</span>
<span class="sd">    =================== ======================================================</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iter_fn</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">iter_fn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">iter_fn</span><span class="p">)[:</span><span class="o">-</span><span class="mi">7</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rough_arr</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span> <span class="o">=</span> <span class="o">.</span><span class="mi">98</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span> <span class="o">=</span> <span class="o">.</span><span class="mi">085</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span> <span class="o">=</span> <span class="o">.</span><span class="mi">91</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_num&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_size&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dpi&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;font_size&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rms_lw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rms_lw&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rms_marker</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rms_marker&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rms_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rms_color&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rms_marker_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rms_marker_size&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rms_median_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rms_median_color&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rms_mean_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rms_mean_color&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rough_lw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rough_lw&#39;</span><span class="p">,</span> <span class="o">.</span><span class="mi">75</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rough_marker</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rough_marker&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rough_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rough_color&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rough_marker_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rough_marker_size&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rough_font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rough_font_size&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_yn&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_iterfn_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get all iteration files for a given inversion</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_path</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_path</span><span class="p">)</span>
                             <span class="k">if</span> <span class="n">fn</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_basename</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span>
                             <span class="n">fn</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.iter&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get rms and roughness values from iteration files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_iterfn_list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_fn_list</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rough_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_fn_list</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">itfn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_fn_list</span><span class="p">):</span>
            <span class="n">m_object</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">itfn</span><span class="p">)</span>
            <span class="n">m_object</span><span class="o">.</span><span class="n">read_iter_file</span><span class="p">()</span>
            <span class="n">m_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m_object</span><span class="o">.</span><span class="n">iteration</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">m_object</span><span class="o">.</span><span class="n">misfit_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rough_arr</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">m_object</span><span class="o">.</span><span class="n">roughness_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rough_arr</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_index</span>

            <span class="c1"># sort by iteration number</span>
            <span class="c1">#        self.rms_arr = np.sort(self.rms_arr, axis=1)</span>
            <span class="c1">#        self.rough_arr = np.sort(self.rough_arr, axis=1)</span>

<div class="viewcode-block" id="PlotL2.plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotL2.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot L2 curve</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_get_values</span><span class="p">()</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">med_rms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">mean_rms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="c1"># set the dimesions of the figure</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.left&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.right&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.top&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span>

        <span class="c1"># make figure instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

        <span class="c1"># make a subplot for RMS vs Iteration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># plot the rms vs iteration</span>
        <span class="n">l1</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="s1">&#39;-k&#39;</span><span class="p">,</span>
                            <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span>
                            <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># plot the median of the RMS</span>
        <span class="n">m1</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">med_rms</span><span class="p">,</span> <span class="n">nr</span><span class="p">),</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_median_color</span><span class="p">,</span>
                            <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_lw</span> <span class="o">*</span> <span class="o">.</span><span class="mi">75</span><span class="p">)</span>

        <span class="c1"># plot the mean of the RMS</span>
        <span class="n">m2</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">mean_rms</span><span class="p">,</span> <span class="n">nr</span><span class="p">),</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_mean_color</span><span class="p">,</span>
                            <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_lw</span> <span class="o">*</span> <span class="o">.</span><span class="mi">75</span><span class="p">)</span>

        <span class="c1"># make subplot for RMS vs Roughness Plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rough_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">rough_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

        <span class="c1"># plot the rms vs roughness</span>
        <span class="n">l2</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rough_arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rough_color</span><span class="p">,</span>
                            <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rough_lw</span><span class="p">,</span>
                            <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rough_marker</span><span class="p">,</span>
                            <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rough_marker_size</span><span class="p">,</span>
                            <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

        <span class="c1"># plot the iteration number inside the roughness marker</span>
        <span class="k">for</span> <span class="n">rms</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">rough</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rms_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">rough_arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]):</span>
            <span class="c1"># need this because if the roughness is larger than this number</span>
            <span class="c1"># matplotlib puts the text out of bounds and a draw_text_image</span>
            <span class="c1"># error is raised and file cannot be saved, also the other</span>
            <span class="c1"># numbers are not put in.</span>
            <span class="k">if</span> <span class="n">rough</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="n">e8</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">rough</span><span class="p">,</span>
                              <span class="n">rms</span><span class="p">,</span>
                              <span class="s1">&#39;</span><span class="si">{0:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ii</span><span class="p">),</span>
                              <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                              <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                              <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rough_font_size</span><span class="p">,</span>
                                        <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rough_color</span><span class="p">})</span>

        <span class="c1"># make a legend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">],</span>
                        <span class="p">[</span><span class="s1">&#39;RMS&#39;</span><span class="p">,</span> <span class="s1">&#39;Roughness&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;Median_RMS=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">med_rms</span><span class="p">),</span>
                         <span class="s1">&#39;Mean_RMS=</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mean_rms</span><span class="p">)],</span>
                        <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span>
                        <span class="n">columnspacing</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
                        <span class="n">markerscale</span><span class="o">=.</span><span class="mi">75</span><span class="p">,</span>
                        <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">)</span>

        <span class="c1"># set the axis properties for RMS vs iteration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RMS&#39;</span><span class="p">,</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                      <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Iteration&#39;</span><span class="p">,</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                      <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rough_lw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Roughness&#39;</span><span class="p">,</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                      <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rough_color</span><span class="p">})</span>

        <span class="k">for</span> <span class="n">t2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
            <span class="n">t2</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rough_color</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotL2.redraw_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotL2.redraw_plot">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        redraw plot if parameters were changed</span>

<span class="sd">        use this function if you updated some attributes and want to re-plot.</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # change the color and marker of the xy components</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(r&quot;/home/occam2d/Data.dat&quot;)</span>
<span class="sd">            &gt;&gt;&gt; p1 = ocd.plotAllResponses()</span>
<span class="sd">            &gt;&gt;&gt; #change line width</span>
<span class="sd">            &gt;&gt;&gt; p1.lw = 2</span>
<span class="sd">            &gt;&gt;&gt; p1.redraw_plot()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotL2.save_figure"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotL2.save_figure">[docs]</a>    <span class="k">def</span> <span class="nf">save_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_fn</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">,</span>
                    <span class="n">fig_dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">close_fig</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save_plot will save the figure to save_fn.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>

<span class="sd">            **save_fn** : string</span>
<span class="sd">                          full path to save figure to, can be input as</span>
<span class="sd">                          * directory path -&gt; the directory path to save to</span>
<span class="sd">                            in which the file will be saved as </span>
<span class="sd">                            save_fn/station_name_PhaseTensor.file_format</span>

<span class="sd">                          * full path -&gt; file will be save to the given </span>
<span class="sd">                            path.  If you use this option then the format</span>
<span class="sd">                            will be assumed to be provided by the path</span>

<span class="sd">            **file_format** : [ pdf | eps | jpg | png | svg ]</span>
<span class="sd">                              file type of saved figure pdf,svg,eps... </span>

<span class="sd">            **orientation** : [ landscape | portrait ]</span>
<span class="sd">                              orientation in which the file will be saved</span>
<span class="sd">                              *default* is portrait</span>

<span class="sd">            **fig_dpi** : int</span>
<span class="sd">                          The resolution in dots-per-inch the file will be</span>
<span class="sd">                          saved.  If None then the dpi will be that at </span>
<span class="sd">                          which the figure was made.  I don&#39;t think that </span>
<span class="sd">                          it can be larger than dpi of the figure.</span>

<span class="sd">            **close_plot** : [ y | n ]</span>
<span class="sd">                             * &#39;y&#39; will close the plot after saving.</span>
<span class="sd">                             * &#39;n&#39; will leave plot open</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # to save plot as jpg</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; dfn = r&quot;/home/occam2d/Inv1/data.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(dfn)</span>
<span class="sd">            &gt;&gt;&gt; ps1 = ocd.plotPseudoSection()</span>
<span class="sd">            &gt;&gt;&gt; ps1.save_plot(r&#39;/home/MT/figures&#39;, file_format=&#39;jpg&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">fig_dpi</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_dpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">file_format</span> <span class="o">=</span> <span class="n">save_fn</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">save_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="s1">&#39;_L2.&#39;</span> <span class="o">+</span>
                                   <span class="n">file_format</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">close_fig</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span> <span class="o">=</span> <span class="n">save_fn</span>
        <span class="nb">print</span> <span class="s1">&#39;Saved figure to: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span></div>

<div class="viewcode-block" id="PlotL2.update_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotL2.update_plot">[docs]</a>    <span class="k">def</span> <span class="nf">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update any parameters that where changed using the built-in draw from</span>
<span class="sd">        canvas.  </span>

<span class="sd">        Use this if you change an of the .fig or axes properties</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # to change the grid lines to only be on the major ticks</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; dfn = r&quot;/home/occam2d/Inv1/data.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(dfn)</span>
<span class="sd">            &gt;&gt;&gt; ps1 = ocd.plotAllResponses()</span>
<span class="sd">            &gt;&gt;&gt; [ax.grid(True, which=&#39;major&#39;) for ax in [ps1.axrte,ps1.axtep]]</span>
<span class="sd">            &gt;&gt;&gt; ps1.update_plot()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotL2.__str__"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotL2.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rewrite the string builtin to give a useful message</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;Plots RMS vs Iteration computed by Occam2D&quot;</span><span class="p">)</span></div></div>


<span class="c1"># ==============================================================================</span>
<span class="c1"># plot pseudo section of data and model response</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="PlotPseudoSection"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotPseudoSection">[docs]</a><span class="k">class</span> <span class="nc">PlotPseudoSection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plot a pseudo section of the data and response if given</span>


<span class="sd">    Arguments:</span>
<span class="sd">    -------------</span>
<span class="sd">        **data_fn** : string</span>
<span class="sd">                      full path to data file.</span>

<span class="sd">        **resp_fn** : string</span>
<span class="sd">                      full path to response file.</span>

<span class="sd">    ==================== ======================================================</span>
<span class="sd">    key words            description</span>
<span class="sd">    ==================== ======================================================</span>
<span class="sd">    axmpte               matplotlib.axes instance for TE model phase</span>
<span class="sd">    axmptm               matplotlib.axes instance for TM model phase</span>
<span class="sd">    axmrte               matplotlib.axes instance for TE model app. res </span>
<span class="sd">    axmrtm               matplotlib.axes instance for TM model app. res </span>
<span class="sd">    axpte                matplotlib.axes instance for TE data phase </span>
<span class="sd">    axptm                matplotlib.axes instance for TM data phase</span>
<span class="sd">    axrte                matplotlib.axes instance for TE data app. res.</span>
<span class="sd">    axrtm                matplotlib.axes instance for TM data app. res.</span>
<span class="sd">    cb_pad               padding between colorbar and axes</span>
<span class="sd">    cb_shrink            percentage to shrink the colorbar to</span>
<span class="sd">    fig                  matplotlib.figure instance</span>
<span class="sd">    fig_dpi              resolution of figure in dots per inch</span>
<span class="sd">    fig_num              number of figure instance</span>
<span class="sd">    fig_size             size of figure in inches (width, height)</span>
<span class="sd">    font_size            size of font in points</span>
<span class="sd">    label_list            list to label plots</span>
<span class="sd">    ml                   factor to label stations if 2 every other station</span>
<span class="sd">                         is labeled on the x-axis</span>
<span class="sd">    period               np.array of periods to plot</span>
<span class="sd">    phase_cmap           color map name of phase</span>
<span class="sd">    phase_limits_te      limits for te phase in degrees (min, max)</span>
<span class="sd">    phase_limits_tm      limits for tm phase in degrees (min, max)            </span>
<span class="sd">    plot_resp            [ &#39;y&#39; | &#39;n&#39; ] to plot response</span>
<span class="sd">    plot_tipper          [ &#39;y&#39; | &#39;n&#39; ] to plot tipper</span>
<span class="sd">    plot_yn              [ &#39;y&#39; | &#39;n&#39; ] &#39;y&#39; to plot on instantiation</span>
<span class="sd">    res_cmap             color map name for resistivity</span>
<span class="sd">    res_limits_te        limits for te resistivity in log scale (min, max)</span>
<span class="sd">    res_limits_tm        limits for tm resistivity in log scale (min, max)</span>
<span class="sd">    rp_list               list of dictionaries as made from read2Dresp</span>
<span class="sd">    station_id           index to get station name (min, max)</span>
<span class="sd">    station_list          station list got from rp_list</span>
<span class="sd">    subplot_bottom       subplot spacing from bottom (relative coordinates) </span>
<span class="sd">    subplot_hspace       vertical spacing between subplots</span>
<span class="sd">    subplot_left         subplot spacing from left  </span>
<span class="sd">    subplot_right        subplot spacing from right</span>
<span class="sd">    subplot_top          subplot spacing from top</span>
<span class="sd">    subplot_wspace       horizontal spacing between subplots</span>
<span class="sd">    ==================== ======================================================</span>

<span class="sd">    =================== =======================================================</span>
<span class="sd">    Methods             Description</span>
<span class="sd">    =================== =======================================================</span>
<span class="sd">    plot                plots a pseudo-section of apparent resistiviy and phase</span>
<span class="sd">                        of data and model if given.  called on instantiation </span>
<span class="sd">                        if plot_yn is &#39;y&#39;.</span>
<span class="sd">    redraw_plot         call redraw_plot to redraw the figures, </span>
<span class="sd">                        if one of the attributes has been changed</span>
<span class="sd">    save_figure         saves the matplotlib.figure instance to desired </span>
<span class="sd">                        location and format</span>
<span class="sd">    =================== =======================================================</span>

<span class="sd">   :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">        &gt;&gt;&gt; r_fn = r&quot;/home/Occam2D/Line1/Inv1/Test_15.resp&quot;</span>
<span class="sd">        &gt;&gt;&gt; d_fn = r&quot;/home/Occam2D/Line1/Inv1/DataRW.dat&quot;</span>
<span class="sd">        &gt;&gt;&gt; ps_plot = occam2d.PlotPseudoSection(d_fn, r_fn) </span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span><span class="p">,</span> <span class="n">resp_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">data_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="o">=</span> <span class="n">resp_fn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_resp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_resp&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_resp</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">r&#39;$\rho_{TE-Data}$&#39;</span><span class="p">,</span> <span class="s1">r&#39;$\rho_{TE-Model}$&#39;</span><span class="p">,</span>
                           <span class="s1">r&#39;$\rho_{TM-Data}$&#39;</span><span class="p">,</span> <span class="s1">r&#39;$\rho_{TM-Model}$&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;$\phi_{TE-Data}$&#39;</span><span class="p">,</span> <span class="s1">&#39;$\phi_{TE-Model}$&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;$\phi_{TM-Data}$&#39;</span><span class="p">,</span> <span class="s1">&#39;$\phi_{TM-Model}$&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;$\Re e\{T_</span><span class="si">{Data}</span><span class="s1">\}$&#39;</span><span class="p">,</span> <span class="s1">&#39;$\Re e\{T_</span><span class="si">{Model}</span><span class="s1">\}$&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;$\Im m\{T_</span><span class="si">{Data}</span><span class="s1">\}$&#39;</span><span class="p">,</span> <span class="s1">&#39;$\Im m\{T_</span><span class="si">{Model}</span><span class="s1">\}$&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;phase_limits_te&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">95</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_tm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;phase_limits_tm&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">95</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res_limits_te&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res_limits_tm&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tip_limits_re&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_im</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tip_limits_im&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phase_cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;phase_cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;jet&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res_cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;jet_r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip_cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res_cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;Spectral&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ml</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ml&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_num&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_size&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dpi&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">025</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span> <span class="o">=</span> <span class="o">.</span><span class="mi">95</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span> <span class="o">=</span> <span class="o">.</span><span class="mi">085</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span> <span class="o">=</span> <span class="o">.</span><span class="mi">97</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;font_size&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_type&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_num</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_num&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_tipper</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_tipper&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_yn&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb_shrink</span> <span class="o">=</span> <span class="o">.</span><span class="mi">7</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb_pad</span> <span class="o">=</span> <span class="o">.</span><span class="mi">015</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axrte</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axrtm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axpte</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axptm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axmrte</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axmrtm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axmpte</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axmptm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axtpr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axtpi</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axmtpr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axmtpi</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">te_res_arr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tm_res_arr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">te_phase_arr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tm_phase_arr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip_real_arr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip_imag_arr</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<div class="viewcode-block" id="PlotPseudoSection.plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotPseudoSection.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot pseudo section of data and response if given</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_resp</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">data_obj</span> <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
        <span class="n">data_obj</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">resp_obj</span> <span class="o">=</span> <span class="n">Response</span><span class="p">()</span>
            <span class="n">resp_obj</span><span class="o">.</span><span class="n">read_response_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">)</span>

        <span class="n">ns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_obj</span><span class="o">.</span><span class="n">station_list</span><span class="p">)</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_obj</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>
        <span class="n">ylimits</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_obj</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>

        <span class="c1"># make a grid for pcolormesh so you can have a log scale</span>
        <span class="c1"># get things into arrays for plotting</span>
        <span class="n">offset_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ns</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">te_res_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">))</span>
        <span class="n">tm_res_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">))</span>
        <span class="n">te_phase_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">))</span>
        <span class="n">tm_phase_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">))</span>
        <span class="n">tip_real_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">))</span>
        <span class="n">tip_imag_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">nr</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">d_dict</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_obj</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
            <span class="n">offset_list</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_dict</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">]</span>
            <span class="n">te_res_arr</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_dict</span><span class="p">[</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tm_res_arr</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_dict</span><span class="p">[</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">te_phase_arr</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_dict</span><span class="p">[</span><span class="s1">&#39;te_phase&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tm_phase_arr</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_dict</span><span class="p">[</span><span class="s1">&#39;tm_phase&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tip_real_arr</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_dict</span><span class="p">[</span><span class="s1">&#39;re_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tip_imag_arr</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_dict</span><span class="p">[</span><span class="s1">&#39;im_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># read in response data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_resp</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resp_obj</span><span class="o">.</span><span class="n">resp</span><span class="p">):</span>
                <span class="n">te_res_arr</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_dict</span><span class="p">[</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">tm_res_arr</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_dict</span><span class="p">[</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">te_phase_arr</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_dict</span><span class="p">[</span><span class="s1">&#39;te_phase&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">tm_phase_arr</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_dict</span><span class="p">[</span><span class="s1">&#39;tm_phase&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">tip_real_arr</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_dict</span><span class="p">[</span><span class="s1">&#39;re_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">tip_imag_arr</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_dict</span><span class="p">[</span><span class="s1">&#39;im_tip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># need to make any zeros 1 for taking log10</span>
        <span class="n">te_res_arr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">te_res_arr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">tm_res_arr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tm_res_arr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">te_res_arr</span> <span class="o">=</span> <span class="n">te_res_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tm_res_arr</span> <span class="o">=</span> <span class="n">tm_res_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">te_phase_arr</span> <span class="o">=</span> <span class="n">te_phase_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tm_phase_arr</span> <span class="o">=</span> <span class="n">tm_phase_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip_real_arr</span> <span class="o">=</span> <span class="n">tip_real_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip_imag_arr</span> <span class="o">=</span> <span class="n">tip_imag_arr</span>

        <span class="c1"># need to extend the last grid cell because meshgrid expects n+1 cells</span>
        <span class="n">offset_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">offset_list</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.15</span>
        <span class="c1"># make a meshgrid for plotting</span>
        <span class="c1"># flip frequency so bottom corner is long period</span>
        <span class="n">dgrid</span><span class="p">,</span> <span class="n">fgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">offset_list</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">period</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># make list for station labels</span>
        <span class="n">sindex_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sindex_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_id</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">slabel</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_obj</span><span class="o">.</span><span class="n">station_list</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">sindex_1</span><span class="p">:</span><span class="n">sindex_2</span><span class="p">]</span>
                  <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml</span><span class="p">)]</span>

        <span class="n">xloc</span> <span class="o">=</span> <span class="n">offset_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">offset_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">offset_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">5</span>
        <span class="n">yloc</span> <span class="o">=</span> <span class="mf">1.10</span> <span class="o">*</span> <span class="n">data_obj</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.top&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.right&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.left&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span>

        <span class="n">log_labels_te</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10$^</span><span class="si">{0}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                             <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">log_labels_tm</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;10$^</span><span class="si">{0}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                             <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_resp</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tipper</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                <span class="n">gs1</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                                        <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span><span class="p">,</span>
                                        <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span><span class="p">,</span>
                                        <span class="n">wspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span><span class="p">)</span>
                <span class="n">gs4</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpecFromSubplotSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                                                       <span class="n">hspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span><span class="p">,</span>
                                                       <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                       <span class="n">subplot_spec</span><span class="o">=</span><span class="n">gs1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gs1</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                                        <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span><span class="p">,</span>
                                        <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span><span class="p">,</span>
                                        <span class="n">wspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span><span class="p">)</span>
            <span class="n">gs2</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpecFromSubplotSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                                                   <span class="n">hspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span><span class="p">,</span>
                                                   <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                   <span class="n">subplot_spec</span><span class="o">=</span><span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">gs3</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpecFromSubplotSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                                                   <span class="n">hspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span><span class="p">,</span>
                                                   <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                   <span class="n">subplot_spec</span><span class="o">=</span><span class="n">gs1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># plot TE resistivity data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axrte</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">gs2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axrte</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axrte</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                  <span class="n">fgrid</span><span class="p">,</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">te_res_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])),</span>
                                  <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span><span class="p">,</span>
                                  <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># plot TE resistivity model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axmrte</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">gs2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axmrte</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axmrte</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                   <span class="n">fgrid</span><span class="p">,</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">te_res_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">])),</span>
                                   <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span><span class="p">,</span>
                                   <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># plot TM resistivity data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axrtm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">gs3</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axrtm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axrtm</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                  <span class="n">fgrid</span><span class="p">,</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tm_res_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])),</span>
                                  <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span><span class="p">,</span>
                                  <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># plot TM resistivity model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axmrtm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">gs3</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axmrtm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axmrtm</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                   <span class="n">fgrid</span><span class="p">,</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tm_res_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">])),</span>
                                   <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span><span class="p">,</span>
                                   <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># plot TE phase data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axpte</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">gs2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axpte</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axpte</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                  <span class="n">fgrid</span><span class="p">,</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">te_phase_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]),</span>
                                  <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_cmap</span><span class="p">,</span>
                                  <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># plot TE phase model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axmpte</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">gs2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axmpte</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axmpte</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                   <span class="n">fgrid</span><span class="p">,</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">te_phase_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]),</span>
                                   <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_cmap</span><span class="p">,</span>
                                   <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># plot TM phase data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axptm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">gs3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axptm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axptm</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                  <span class="n">fgrid</span><span class="p">,</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">tm_phase_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]),</span>
                                  <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_cmap</span><span class="p">,</span>
                                  <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># plot TM phase model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axmptm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">gs3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axmptm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axmptm</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                   <span class="n">fgrid</span><span class="p">,</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">tm_phase_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]),</span>
                                   <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_cmap</span><span class="p">,</span>
                                   <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">ax_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">axrte</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axmrte</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axrtm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axmrtm</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">axpte</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axmpte</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axptm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axmptm</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tipper</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                <span class="c1"># plot real tipper  data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axtpr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">gs4</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axtpr</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axtpr</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                      <span class="n">fgrid</span><span class="p">,</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">tip_real_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]),</span>
                                      <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_cmap</span><span class="p">,</span>
                                      <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                      <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1"># plot real tipper  model</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axmtpr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">gs4</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axmtpr</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axmtpr</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                       <span class="n">fgrid</span><span class="p">,</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">tip_real_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]),</span>
                                       <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_cmap</span><span class="p">,</span>
                                       <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                       <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="c1"># plot imag tipper  data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axtpi</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">gs4</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axtpi</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axtpi</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                      <span class="n">fgrid</span><span class="p">,</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">tip_imag_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]),</span>
                                      <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_cmap</span><span class="p">,</span>
                                      <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                      <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1"># plot imag tipper  model</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axmtpi</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">gs4</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axmtpi</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axmtpi</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                       <span class="n">fgrid</span><span class="p">,</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">tip_imag_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]),</span>
                                       <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_cmap</span><span class="p">,</span>
                                       <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                       <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="n">ax_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axtpr</span><span class="p">)</span>
                <span class="n">ax_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axmtpr</span><span class="p">)</span>
                <span class="n">ax_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axtpi</span><span class="p">)</span>
                <span class="n">ax_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axmtpi</span><span class="p">)</span>

            <span class="c1"># make everthing look tidy</span>
            <span class="k">for</span> <span class="n">xx</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax_list</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">()</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylimits</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">offset_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml</span><span class="p">)])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">offset_list</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">offset_list</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">offset_list</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">cbx</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">make_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span>
                                        <span class="n">shrink</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb_shrink</span><span class="p">,</span>
                                        <span class="n">pad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb_pad</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">or</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">or</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">xx</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span><span class="p">,</span>
                                              <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                             <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                               <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">log_labels_te</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span><span class="p">,</span>
                                              <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                             <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;App. Res. ($\Omega \cdot$m)&#39;</span><span class="p">,</span>
                                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                               <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Resistivity ($\Omega \cdot$m)&#39;</span><span class="p">,</span>
                                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                               <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                               <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">log_labels_tm</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># color bar TE phase</span>
                    <span class="k">if</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_cmap</span><span class="p">,</span>
                                              <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                             <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="c1"># color bar TM phase</span>
                    <span class="k">if</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                        <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_cmap</span><span class="p">,</span>
                                              <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                             <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                               <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
                    <span class="c1"># color bar tipper Imag</span>
                    <span class="k">if</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                        <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_cmap</span><span class="p">,</span>
                                              <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                             <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Re</span><span class="si">{T}</span><span class="s1">&#39;</span><span class="p">,</span>
                                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                               <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
                    <span class="k">if</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                        <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_cmap</span><span class="p">,</span>
                                              <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_im</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                             <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_im</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Im</span><span class="si">{T}</span><span class="s1">&#39;</span><span class="p">,</span>
                                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                               <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xloc</span><span class="p">,</span> <span class="n">yloc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_list</span><span class="p">[</span><span class="n">xx</span><span class="p">],</span>
                        <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">},</span>
                        <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">},</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Period (s)&#39;</span><span class="p">,</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                            <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
                <span class="k">if</span> <span class="n">xx</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Station&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                                       <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tipper</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                <span class="n">gs1</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
                                        <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span><span class="p">,</span>
                                        <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span><span class="p">,</span>
                                        <span class="n">hspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span><span class="p">,</span>
                                        <span class="n">wspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">gs1</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                                        <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span><span class="p">,</span>
                                        <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span><span class="p">,</span>
                                        <span class="n">hspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span><span class="p">,</span>
                                        <span class="n">wspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span><span class="p">)</span>

            <span class="c1"># plot TE resistivity data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axrte</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axrte</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                  <span class="n">fgrid</span><span class="p">,</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">te_res_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])),</span>
                                  <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span><span class="p">,</span>
                                  <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># plot TM resistivity data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axrtm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axrtm</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                  <span class="n">fgrid</span><span class="p">,</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tm_res_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])),</span>
                                  <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span><span class="p">,</span>
                                  <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># plot TE phase data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axpte</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axpte</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                  <span class="n">fgrid</span><span class="p">,</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">te_phase_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]),</span>
                                  <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_cmap</span><span class="p">,</span>
                                  <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># plot TM phase data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axptm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axptm</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                  <span class="n">fgrid</span><span class="p">,</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">tm_phase_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]),</span>
                                  <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_cmap</span><span class="p">,</span>
                                  <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">axrte</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axrtm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axpte</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axptm</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tipper</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                <span class="c1"># plot real tipper  data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axtpr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axtpr</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axtpr</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                      <span class="n">fgrid</span><span class="p">,</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">tip_real_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]),</span>
                                      <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_cmap</span><span class="p">,</span>
                                      <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                      <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1"># plot real tipper  data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axtpi</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">gs1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axtpi</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axtpi</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                      <span class="n">fgrid</span><span class="p">,</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">tip_imag_arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]),</span>
                                      <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_cmap</span><span class="p">,</span>
                                      <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                      <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">ax_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axtpr</span><span class="p">)</span>
                <span class="n">ax_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axtpi</span><span class="p">)</span>

            <span class="c1"># make everything look tidy</span>
            <span class="k">for</span> <span class="n">xx</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax_list</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">()</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylimits</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">offset_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml</span><span class="p">)])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">offset_list</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">offset_list</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">offset_list</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                <span class="n">cbx</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">make_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span>
                                    <span class="n">shrink</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb_shrink</span><span class="p">,</span>
                                    <span class="n">pad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb_pad</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span><span class="p">,</span>
                                          <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                         <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">log_labels_te</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                    <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span><span class="p">,</span>
                                          <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                         <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;App. Res. ($\Omega \cdot$m)&#39;</span><span class="p">,</span>
                                 <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                           <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">log_labels_tm</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_cmap</span><span class="p">,</span>
                                          <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                         <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_cmap</span><span class="p">,</span>
                                          <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                         <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                                 <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                           <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>

                <span class="c1"># real tipper</span>
                <span class="k">elif</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_cmap</span><span class="p">,</span>
                                          <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                         <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Re</span><span class="si">{T}</span><span class="s1">&#39;</span><span class="p">,</span>
                                 <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                           <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
                    <span class="c1"># imag tipper</span>
                <span class="k">elif</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_cmap</span><span class="p">,</span>
                                          <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_im</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                         <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_im</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Im</span><span class="si">{T}</span><span class="s1">&#39;</span><span class="p">,</span>
                                 <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                           <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xloc</span><span class="p">,</span> <span class="n">yloc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_list</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">xx</span><span class="p">],</span>
                        <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">},</span>
                        <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">},</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Period (s)&#39;</span><span class="p">,</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                            <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
                <span class="k">if</span> <span class="n">xx</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Station&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                                       <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotPseudoSection.redraw_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotPseudoSection.redraw_plot">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        redraw plot if parameters were changed</span>

<span class="sd">        use this function if you updated some attributes and want to re-plot.</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # change the color and marker of the xy components</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(r&quot;/home/occam2d/Data.dat&quot;)</span>
<span class="sd">            &gt;&gt;&gt; p1 = ocd.plotPseudoSection()</span>
<span class="sd">            &gt;&gt;&gt; #change color of te markers to a gray-blue</span>
<span class="sd">            &gt;&gt;&gt; p1.res_cmap = &#39;seismic_r&#39;</span>
<span class="sd">            &gt;&gt;&gt; p1.redraw_plot()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotPseudoSection.save_figure"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotPseudoSection.save_figure">[docs]</a>    <span class="k">def</span> <span class="nf">save_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_fn</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">,</span>
                    <span class="n">fig_dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">close_plot</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save_plot will save the figure to save_fn.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>

<span class="sd">            **save_fn** : string</span>
<span class="sd">                          full path to save figure to, can be input as</span>
<span class="sd">                          * directory path -&gt; the directory path to save to</span>
<span class="sd">                            in which the file will be saved as </span>
<span class="sd">                            save_fn/station_name_PhaseTensor.file_format</span>

<span class="sd">                          * full path -&gt; file will be save to the given </span>
<span class="sd">                            path.  If you use this option then the format</span>
<span class="sd">                            will be assumed to be provided by the path</span>

<span class="sd">            **file_format** : [ pdf | eps | jpg | png | svg ]</span>
<span class="sd">                              file type of saved figure pdf,svg,eps... </span>

<span class="sd">            **orientation** : [ landscape | portrait ]</span>
<span class="sd">                              orientation in which the file will be saved</span>
<span class="sd">                              *default* is portrait</span>

<span class="sd">            **fig_dpi** : int</span>
<span class="sd">                          The resolution in dots-per-inch the file will be</span>
<span class="sd">                          saved.  If None then the dpi will be that at </span>
<span class="sd">                          which the figure was made.  I don&#39;t think that </span>
<span class="sd">                          it can be larger than dpi of the figure.</span>

<span class="sd">            **close_plot** : [ y | n ]</span>
<span class="sd">                             * &#39;y&#39; will close the plot after saving.</span>
<span class="sd">                             * &#39;n&#39; will leave plot open</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # to save plot as jpg</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; dfn = r&quot;/home/occam2d/Inv1/data.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(dfn)</span>
<span class="sd">            &gt;&gt;&gt; ps1 = ocd.plotPseudoSection()</span>
<span class="sd">            &gt;&gt;&gt; ps1.save_plot(r&#39;/home/MT/figures&#39;, file_format=&#39;jpg&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">fig_dpi</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_dpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">file_format</span> <span class="o">=</span> <span class="n">save_fn</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">save_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="s1">&#39;OccamPseudoSection.&#39;</span> <span class="o">+</span>
                                   <span class="n">file_format</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">close_plot</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span> <span class="o">=</span> <span class="n">save_fn</span>
        <span class="nb">print</span> <span class="s1">&#39;Saved figure to: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span></div>

<div class="viewcode-block" id="PlotPseudoSection.update_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotPseudoSection.update_plot">[docs]</a>    <span class="k">def</span> <span class="nf">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update any parameters that where changed using the built-in draw from</span>
<span class="sd">        canvas.  </span>

<span class="sd">        Use this if you change an of the .fig or axes properties</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # to change the grid lines to only be on the major ticks</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; dfn = r&quot;/home/occam2d/Inv1/data.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(dfn)</span>
<span class="sd">            &gt;&gt;&gt; ps1 = ocd.plotPseudoSection()</span>
<span class="sd">            &gt;&gt;&gt; [ax.grid(True, which=&#39;major&#39;) for ax in [ps1.axrte,ps1.axtep]]</span>
<span class="sd">            &gt;&gt;&gt; ps1.update_plot()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotPseudoSection.__str__"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotPseudoSection.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rewrite the string builtin to give a useful message</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;Plots a pseudo section of TE and TM modes for data and &quot;</span>
                <span class="s2">&quot;response if given.&quot;</span><span class="p">)</span></div></div>

        <span class="c1"># ==============================================================================</span>


<span class="c1"># plot misfits as a pseudo-section</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="PlotMisfitPseudoSection"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotMisfitPseudoSection">[docs]</a><span class="k">class</span> <span class="nc">PlotMisfitPseudoSection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plot a pseudo section of the data and response if given</span>


<span class="sd">    Arguments:</span>
<span class="sd">    -------------</span>
<span class="sd">        **rp_list** : list of dictionaries for each station with keywords:</span>

<span class="sd">                * *station* : string</span>
<span class="sd">                             station name</span>

<span class="sd">                * *offset* : float</span>
<span class="sd">                             relative offset</span>

<span class="sd">                * *resxy* : np.array(nf,4)</span>
<span class="sd">                            TE resistivity and error as row 0 and 1 respectively</span>

<span class="sd">                * *resyx* : np.array(fn,4)</span>
<span class="sd">                            TM resistivity and error as row 0 and 1 respectively</span>

<span class="sd">                * *phasexy* : np.array(nf,4)</span>
<span class="sd">                              TE phase and error as row 0 and 1 respectively</span>

<span class="sd">                * *phaseyx* : np.array(nf,4)</span>
<span class="sd">                              Tm phase and error as row 0 and 1 respectively</span>

<span class="sd">                * *realtip* : np.array(nf,4)</span>
<span class="sd">                              Real Tipper and error as row 0 and 1 respectively</span>

<span class="sd">                * *imagtip* : np.array(nf,4)</span>
<span class="sd">                              Imaginary Tipper and error as row 0 and 1 </span>
<span class="sd">                              respectively</span>

<span class="sd">                Note: that the resistivity will be in log10 space.  Also, there</span>
<span class="sd">                are 2 extra rows in the data arrays, this is to put the </span>
<span class="sd">                response from the inversion.  </span>

<span class="sd">        **period** : np.array of periods to plot that correspond to the index</span>
<span class="sd">                     values of each rp_list entry ie. resxy.</span>

<span class="sd">    ==================== ==================================================</span>
<span class="sd">    key words            description</span>
<span class="sd">    ==================== ==================================================</span>
<span class="sd">    axmpte               matplotlib.axes instance for TE model phase</span>
<span class="sd">    axmptm               matplotlib.axes instance for TM model phase</span>
<span class="sd">    axmrte               matplotlib.axes instance for TE model app. res </span>
<span class="sd">    axmrtm               matplotlib.axes instance for TM model app. res </span>
<span class="sd">    axpte                matplotlib.axes instance for TE data phase </span>
<span class="sd">    axptm                matplotlib.axes instance for TM data phase</span>
<span class="sd">    axrte                matplotlib.axes instance for TE data app. res.</span>
<span class="sd">    axrtm                matplotlib.axes instance for TM data app. res.</span>
<span class="sd">    cb_pad               padding between colorbar and axes</span>
<span class="sd">    cb_shrink            percentage to shrink the colorbar to</span>
<span class="sd">    fig                  matplotlib.figure instance</span>
<span class="sd">    fig_dpi              resolution of figure in dots per inch</span>
<span class="sd">    fig_num              number of figure instance</span>
<span class="sd">    fig_size             size of figure in inches (width, height)</span>
<span class="sd">    font_size            size of font in points</span>
<span class="sd">    label_list            list to label plots</span>
<span class="sd">    ml                   factor to label stations if 2 every other station</span>
<span class="sd">                         is labeled on the x-axis</span>
<span class="sd">    period               np.array of periods to plot</span>
<span class="sd">    phase_cmap           color map name of phase</span>
<span class="sd">    phase_limits_te      limits for te phase in degrees (min, max)</span>
<span class="sd">    phase_limits_tm      limits for tm phase in degrees (min, max)            </span>
<span class="sd">    plot_resp            [ &#39;y&#39; | &#39;n&#39; ] to plot response</span>
<span class="sd">    plot_yn              [ &#39;y&#39; | &#39;n&#39; ] &#39;y&#39; to plot on instantiation</span>

<span class="sd">    res_cmap             color map name for resistivity</span>
<span class="sd">    res_limits_te        limits for te resistivity in log scale (min, max)</span>
<span class="sd">    res_limits_tm        limits for tm resistivity in log scale (min, max)</span>
<span class="sd">    rp_list               list of dictionaries as made from read2Dresp</span>
<span class="sd">    station_id           index to get station name (min, max)</span>
<span class="sd">    station_list          station list got from rp_list</span>
<span class="sd">    subplot_bottom       subplot spacing from bottom (relative coordinates) </span>
<span class="sd">    subplot_hspace       vertical spacing between subplots</span>
<span class="sd">    subplot_left         subplot spacing from left  </span>
<span class="sd">    subplot_right        subplot spacing from right</span>
<span class="sd">    subplot_top          subplot spacing from top</span>
<span class="sd">    subplot_wspace       horizontal spacing between subplots</span>
<span class="sd">    ==================== ==================================================</span>

<span class="sd">    =================== =======================================================</span>
<span class="sd">    Methods             Description</span>
<span class="sd">    =================== =======================================================</span>
<span class="sd">    plot                plots a pseudo-section of apparent resistiviy and phase</span>
<span class="sd">                        of data and model if given.  called on instantiation </span>
<span class="sd">                        if plot_yn is &#39;y&#39;.</span>
<span class="sd">    redraw_plot         call redraw_plot to redraw the figures, </span>
<span class="sd">                        if one of the attributes has been changed</span>
<span class="sd">    save_figure         saves the matplotlib.figure instance to desired </span>
<span class="sd">                        location and format</span>
<span class="sd">    =================== =======================================================</span>

<span class="sd">   :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">        &gt;&gt;&gt; ocd = occam2d.Occam2DData()</span>
<span class="sd">        &gt;&gt;&gt; rfile = r&quot;/home/Occam2D/Line1/Inv1/Test_15.resp&quot;</span>
<span class="sd">        &gt;&gt;&gt; ocd.data_fn = r&quot;/home/Occam2D/Line1/Inv1/DataRW.dat&quot;</span>
<span class="sd">        &gt;&gt;&gt; ps1 = ocd.plot2PseudoSection(resp_fn=rfile) </span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span><span class="p">,</span> <span class="n">resp_fn</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span> <span class="n">data_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="o">=</span> <span class="n">resp_fn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">r&#39;$\rho_</span><span class="si">{TE}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">r&#39;$\rho_</span><span class="si">{TM}</span><span class="s1">$&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;$\phi_</span><span class="si">{TE}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;$\phi_</span><span class="si">{TM}</span><span class="s1">$&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;$\Re e\{T\}$&#39;</span><span class="p">,</span> <span class="s1">&#39;$\Im m\{T\}$&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;phase_limits_te&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_tm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;phase_limits_tm&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res_limits_te&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res_limits_tm&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tip_limits_re&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-.</span><span class="mi">2</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_im</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tip_limits_im&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-.</span><span class="mi">2</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phase_cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;phase_cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;BrBG&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res_cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;BrBG_r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tip_cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tip_cmap&#39;</span><span class="p">,</span> <span class="s1">&#39;PuOr&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_tipper</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_tipper&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ml</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ml&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_num&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig_size&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dpi&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">0025</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span> <span class="o">=</span> <span class="o">.</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span> <span class="o">=</span> <span class="o">.</span><span class="mi">95</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span> <span class="o">=</span> <span class="o">.</span><span class="mi">085</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span> <span class="o">=</span> <span class="o">.</span><span class="mi">97</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span> <span class="o">=</span> <span class="o">.</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;font_size&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;plot_yn&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cb_shrink</span> <span class="o">=</span> <span class="o">.</span><span class="mi">7</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb_pad</span> <span class="o">=</span> <span class="o">.</span><span class="mi">015</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axrte</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axrtm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axpte</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axptm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axtpr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axtpi</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_te_res</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_te_phase</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_tm_res</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_tm_phase</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_tip_real</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_tip_imag</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_obj</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_yn</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<div class="viewcode-block" id="PlotMisfitPseudoSection.get_misfit"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotMisfitPseudoSection.get_misfit">[docs]</a>    <span class="k">def</span> <span class="nf">get_misfit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        compute misfit of MT response found from the model and the data.</span>

<span class="sd">        Need to normalize correctly</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_obj</span> <span class="o">=</span> <span class="n">Data</span><span class="p">()</span>
        <span class="n">data_obj</span><span class="o">.</span><span class="n">read_data_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_obj</span> <span class="o">=</span> <span class="n">data_obj</span>

        <span class="n">resp_obj</span> <span class="o">=</span> <span class="n">Response</span><span class="p">()</span>
        <span class="n">resp_obj</span><span class="o">.</span><span class="n">read_response_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">)</span>

        <span class="n">n_stations</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_obj</span><span class="o">.</span><span class="n">station_list</span><span class="p">)</span>
        <span class="n">n_periods</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_obj</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_te_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_periods</span><span class="p">,</span> <span class="n">n_stations</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_te_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_periods</span><span class="p">,</span> <span class="n">n_stations</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_tm_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_periods</span><span class="p">,</span> <span class="n">n_stations</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_tm_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_periods</span><span class="p">,</span> <span class="n">n_stations</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_tip_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_periods</span><span class="p">,</span> <span class="n">n_stations</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_tip_imag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_periods</span><span class="p">,</span> <span class="n">n_stations</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">rr</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_stations</span><span class="p">),</span> <span class="n">resp_obj</span><span class="o">.</span><span class="n">resp</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">misfit_te_res</span><span class="p">[:,</span> <span class="n">rr</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_dict</span><span class="p">[</span><span class="s1">&#39;te_res&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">misfit_tm_res</span><span class="p">[:,</span> <span class="n">rr</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_dict</span><span class="p">[</span><span class="s1">&#39;tm_res&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">misfit_te_phase</span><span class="p">[:,</span> <span class="n">rr</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_dict</span><span class="p">[</span><span class="s1">&#39;te_phase&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">misfit_tm_phase</span><span class="p">[:,</span> <span class="n">rr</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_dict</span><span class="p">[</span><span class="s1">&#39;tm_phase&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">misfit_tip_real</span><span class="p">[:,</span> <span class="n">rr</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_dict</span><span class="p">[</span><span class="s1">&#39;re_tip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">misfit_tip_imag</span><span class="p">[:,</span> <span class="n">rr</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_dict</span><span class="p">[</span><span class="s1">&#39;im_tip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_te_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">misfit_te_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_te_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">misfit_te_phase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_tm_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">misfit_tm_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_tm_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">misfit_tm_phase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_tip_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">misfit_tip_real</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misfit_tip_imag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">misfit_tip_imag</span><span class="p">)</span></div>

<div class="viewcode-block" id="PlotMisfitPseudoSection.plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotMisfitPseudoSection.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot pseudo section of data and response if given</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_misfit</span><span class="p">()</span>

        <span class="n">ylimits</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_obj</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_obj</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>

        <span class="n">offset_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_obj</span><span class="o">.</span><span class="n">station_locations</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_data_obj</span><span class="o">.</span><span class="n">station_locations</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.15</span><span class="p">)</span>

        <span class="c1"># make a meshgrid for plotting</span>
        <span class="c1"># flip frequency so bottom corner is long period</span>
        <span class="n">dgrid</span><span class="p">,</span> <span class="n">fgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">offset_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_obj</span><span class="o">.</span><span class="n">period</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># make list for station labels</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_obj</span><span class="o">.</span><span class="n">station_list</span><span class="p">)</span>
        <span class="n">sindex_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sindex_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_id</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">slabel</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_obj</span><span class="o">.</span><span class="n">station_list</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">sindex_1</span><span class="p">:</span><span class="n">sindex_2</span><span class="p">]</span>
                  <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml</span><span class="p">)]</span>

        <span class="n">xloc</span> <span class="o">=</span> <span class="n">offset_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">offset_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">offset_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">5</span>
        <span class="n">yloc</span> <span class="o">=</span> <span class="mf">1.10</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_obj</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_bottom</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.top&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_top</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.right&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_right</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.left&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_left</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.hspace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_hspace</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.subplot.wspace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_wspace</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tipper</span> <span class="o">!=</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axrte</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axrtm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axrte</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axpte</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axrte</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axptm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axrte</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axrte</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axrtm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axrte</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axpte</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axrte</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axptm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axrte</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axtpr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axrte</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axtpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axrte</span><span class="p">)</span>

        <span class="c1"># --&gt; TE Resistivity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axrte</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                              <span class="n">fgrid</span><span class="p">,</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">misfit_te_res</span><span class="p">),</span>
                              <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span><span class="p">,</span>
                              <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># --&gt; TM Resistivity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axrtm</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                              <span class="n">fgrid</span><span class="p">,</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">misfit_tm_res</span><span class="p">),</span>
                              <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span><span class="p">,</span>
                              <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># --&gt; TE Phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axpte</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                              <span class="n">fgrid</span><span class="p">,</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">misfit_te_phase</span><span class="p">),</span>
                              <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_cmap</span><span class="p">,</span>
                              <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># --&gt; TM Phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axptm</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                              <span class="n">fgrid</span><span class="p">,</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">misfit_tm_phase</span><span class="p">),</span>
                              <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_cmap</span><span class="p">,</span>
                              <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                              <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">ax_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">axrte</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axrtm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axpte</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axptm</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_tipper</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axtpr</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                  <span class="n">fgrid</span><span class="p">,</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">misfit_tip_real</span><span class="p">),</span>
                                  <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_cmap</span><span class="p">,</span>
                                  <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axtpi</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span>
                                  <span class="n">fgrid</span><span class="p">,</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">misfit_tip_imag</span><span class="p">),</span>
                                  <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_cmap</span><span class="p">,</span>
                                  <span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_im</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_im</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">ax_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axtpr</span><span class="p">)</span>
            <span class="n">ax_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axtpi</span><span class="p">)</span>
            <span class="c1"># make everthing look tidy</span>
        <span class="k">for</span> <span class="n">xx</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax_list</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylimits</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">offset_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml</span><span class="p">)])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">offset_list</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">offset_list</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">offset_list</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">cbx</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">make_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span>
                                <span class="n">shrink</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb_shrink</span><span class="p">,</span>
                                <span class="n">pad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cb_pad</span><span class="p">)</span>

            <span class="c1"># te res</span>
            <span class="k">if</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span><span class="p">,</span>
                                      <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="c1"># tm res</span>
            <span class="k">elif</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_cmap</span><span class="p">,</span>
                                      <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">res_limits_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Log$_</span><span class="si">{10}</span><span class="s1">$ App. Res. ($\Omega \cdot$m)&#39;</span><span class="p">,</span>
                             <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                       <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
            <span class="c1"># te phase</span>
            <span class="k">elif</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_cmap</span><span class="p">,</span>
                                      <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_te</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="c1"># tm phase</span>
            <span class="k">elif</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_cmap</span><span class="p">,</span>
                                      <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_tm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_limits_tm</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                             <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                       <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

            <span class="c1"># real tipper</span>
            <span class="k">elif</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_cmap</span><span class="p">,</span>
                                      <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_re</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Re</span><span class="si">{Tip}</span><span class="s1">&#39;</span><span class="p">,</span>
                             <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                       <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
                <span class="c1"># imag tipper</span>
            <span class="k">elif</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">cb</span> <span class="o">=</span> <span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_cmap</span><span class="p">,</span>
                                      <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_im</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tip_limits_im</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Im</span><span class="si">{Tip}</span><span class="s1">&#39;</span><span class="p">,</span>
                             <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                       <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

            <span class="c1"># make label for plot</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xloc</span><span class="p">,</span> <span class="n">yloc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_list</span><span class="p">[</span><span class="n">xx</span><span class="p">],</span>
                    <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">},</span>
                    <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">},</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">xx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Period (s)&#39;</span><span class="p">,</span>
                              <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                        <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">xx</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Station&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                                                   <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">})</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotMisfitPseudoSection.redraw_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotMisfitPseudoSection.redraw_plot">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        redraw plot if parameters were changed</span>

<span class="sd">        use this function if you updated some attributes and want to re-plot.</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # change the color and marker of the xy components</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(r&quot;/home/occam2d/Data.dat&quot;)</span>
<span class="sd">            &gt;&gt;&gt; p1 = ocd.plotPseudoSection()</span>
<span class="sd">            &gt;&gt;&gt; #change color of te markers to a gray-blue</span>
<span class="sd">            &gt;&gt;&gt; p1.res_cmap = &#39;seismic_r&#39;</span>
<span class="sd">            &gt;&gt;&gt; p1.redraw_plot()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotMisfitPseudoSection.save_figure"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotMisfitPseudoSection.save_figure">[docs]</a>    <span class="k">def</span> <span class="nf">save_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_fn</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">,</span>
                    <span class="n">fig_dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">close_plot</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save_plot will save the figure to save_fn.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        -----------</span>

<span class="sd">            **save_fn** : string</span>
<span class="sd">                          full path to save figure to, can be input as</span>
<span class="sd">                          * directory path -&gt; the directory path to save to</span>
<span class="sd">                            in which the file will be saved as </span>
<span class="sd">                            save_fn/station_name_PhaseTensor.file_format</span>

<span class="sd">                          * full path -&gt; file will be save to the given </span>
<span class="sd">                            path.  If you use this option then the format</span>
<span class="sd">                            will be assumed to be provided by the path</span>

<span class="sd">            **file_format** : [ pdf | eps | jpg | png | svg ]</span>
<span class="sd">                              file type of saved figure pdf,svg,eps... </span>

<span class="sd">            **orientation** : [ landscape | portrait ]</span>
<span class="sd">                              orientation in which the file will be saved</span>
<span class="sd">                              *default* is portrait</span>

<span class="sd">            **fig_dpi** : int</span>
<span class="sd">                          The resolution in dots-per-inch the file will be</span>
<span class="sd">                          saved.  If None then the dpi will be that at </span>
<span class="sd">                          which the figure was made.  I don&#39;t think that </span>
<span class="sd">                          it can be larger than dpi of the figure.</span>

<span class="sd">            **close_plot** : [ y | n ]</span>
<span class="sd">                             * &#39;y&#39; will close the plot after saving.</span>
<span class="sd">                             * &#39;n&#39; will leave plot open</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # to save plot as jpg</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; dfn = r&quot;/home/occam2d/Inv1/data.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(dfn)</span>
<span class="sd">            &gt;&gt;&gt; ps1 = ocd.plotPseudoSection()</span>
<span class="sd">            &gt;&gt;&gt; ps1.save_plot(r&#39;/home/MT/figures&#39;, file_format=&#39;jpg&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">fig_dpi</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig_dpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">file_format</span> <span class="o">=</span> <span class="n">save_fn</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">save_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="s1">&#39;OccamMisfitPseudoSection.&#39;</span> <span class="o">+</span>
                                   <span class="n">file_format</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fn</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">fig_dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">close_plot</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span> <span class="o">=</span> <span class="n">save_fn</span>
        <span class="nb">print</span> <span class="s1">&#39;Saved figure to: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_fn</span></div>

<div class="viewcode-block" id="PlotMisfitPseudoSection.update_plot"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotMisfitPseudoSection.update_plot">[docs]</a>    <span class="k">def</span> <span class="nf">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update any parameters that where changed using the built-in draw from</span>
<span class="sd">        canvas.  </span>

<span class="sd">        Use this if you change an of the .fig or axes properties</span>

<span class="sd">        :Example: ::</span>

<span class="sd">            &gt;&gt;&gt; # to change the grid lines to only be on the major ticks</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.modeling.occam2d as occam2d</span>
<span class="sd">            &gt;&gt;&gt; dfn = r&quot;/home/occam2d/Inv1/data.dat&quot;</span>
<span class="sd">            &gt;&gt;&gt; ocd = occam2d.Occam2DData(dfn)</span>
<span class="sd">            &gt;&gt;&gt; ps1 = ocd.plotPseudoSection()</span>
<span class="sd">            &gt;&gt;&gt; [ax.grid(True, which=&#39;major&#39;) for ax in [ps1.axrte,ps1.axtep]]</span>
<span class="sd">            &gt;&gt;&gt; ps1.update_plot()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotMisfitPseudoSection.__str__"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.PlotMisfitPseudoSection.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rewrite the string builtin to give a useful message</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;Plots a pseudo section of TE and TM modes for data and &quot;</span>
                <span class="s2">&quot;response if given.&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="OccamPointPicker"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.OccamPointPicker">[docs]</a><span class="k">class</span> <span class="nc">OccamPointPicker</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class helps the user interactively pick points to mask and add </span>
<span class="sd">    error bars. </span>

<span class="sd">    Useage:</span>
<span class="sd">    -------</span>
<span class="sd">    To mask just a single point right click over the point and a gray point </span>
<span class="sd">    will appear indicating it has been masked</span>

<span class="sd">    To mask both the apparent resistivity and phase left click over the point.</span>
<span class="sd">    Gray points will appear over both the apparent resistivity and phase.  </span>
<span class="sd">    Sometimes the points don&#39;t exactly matchup, haven&#39;t quite worked that bug</span>
<span class="sd">    out yet, but not to worry it picks out the correct points</span>

<span class="sd">    To add error bars to a point click the middle or scroll bar button.  This</span>
<span class="sd">    only adds error bars to the point and does not reduce them so start out</span>
<span class="sd">    with reasonable errorbars.  You can change the increment that the error</span>
<span class="sd">    bars are increased with res_err_inc and phase_err_inc.</span>

<span class="sd">    .. note:: There is a bug when only plotting TE or TM that you cannot mask</span>
<span class="sd">              points in the phase.  I&#39;m not sure where it comes from, but</span>
<span class="sd">              works with all modes.  So my suggestion is to make a data file </span>
<span class="sd">              with all modes, mask data points and then rewrite that data file</span>
<span class="sd">              if you want to use just one of the modes.  That&#39;s the work </span>
<span class="sd">              around for the moment.</span>



<span class="sd">    Arguments:</span>
<span class="sd">    ----------</span>
<span class="sd">        **ax_list** : list of the resistivity and phase axis that have been </span>
<span class="sd">                    plotted as [axr_te,axr_tm,axp_te,axp_tm]</span>

<span class="sd">        **line_list** : list of lines used to plot the responses, not the error </span>
<span class="sd">                      bars as [res_te,res_tm,phase_te,phase_tm]</span>

<span class="sd">        **err_list** : list of the errorcaps and errorbar lines as </span>
<span class="sd">                   [[cap1,cap2,bar],...]</span>

<span class="sd">        **res_err_inc** : increment to increase the errorbars for resistivity.</span>
<span class="sd">                        put .20 for 20 percent change. *Default* is .05</span>

<span class="sd">        **phase_err_inc** : increment to increase the errorbars for the phase</span>
<span class="sd">                          put .10 for 10 percent change. *Defualt* is .02 </span>

<span class="sd">        **marker** : marker type for masked points.  See matplotlib.pyplot.plot</span>
<span class="sd">                    for options of markers.  *Default* is h for hexagon.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    -----------</span>

<span class="sd">        **ax_list** : axes list used to plot the data</span>

<span class="sd">        **line_list** : line list used to plot the data</span>

<span class="sd">        **err_list** : error list used to plot the data</span>

<span class="sd">        **data** : list of data points that were not masked for each plot.</span>

<span class="sd">        **fdict** : dictionary of frequency arrays for each plot and data set.</span>

<span class="sd">        **fndict** : dictionary of figure numbers to corresponed with data.</span>

<span class="sd">        **cid_list** : list of event ids.</span>

<span class="sd">        **res_err_inc** : increment to increase resistivity error bars</span>

<span class="sd">        **phase_inc** : increment to increase phase error bars</span>

<span class="sd">        **marker** : marker of masked points</span>

<span class="sd">        **fig_num** : figure numbers</span>

<span class="sd">        **data_list** : list of lines to write into the occam2d data file.</span>

<span class="sd">    :Example: ::</span>

<span class="sd">        &gt;&gt;&gt; ocd = occam2d.Occam2DData()</span>
<span class="sd">        &gt;&gt;&gt; ocd.data_fn = r&quot;/home/Occam2D/Line1/Inv1/Data.dat&quot;</span>
<span class="sd">        &gt;&gt;&gt; ocd.plotMaskPoints()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">,</span> <span class="n">line_list</span><span class="p">,</span> <span class="n">err_list</span><span class="p">,</span>
                 <span class="n">res_err_inc</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span> <span class="n">phase_err_inc</span><span class="o">=.</span><span class="mi">02</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">):</span>

        <span class="c1"># give the class some attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_list</span> <span class="o">=</span> <span class="n">ax_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_list</span> <span class="o">=</span> <span class="n">line_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">err_list</span> <span class="o">=</span> <span class="n">err_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fdict</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fndict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># see if just one figure is plotted or multiple figures are plotted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">line_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cidlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax_num</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax_list</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>

            <span class="c1"># get data from lines and make a dictionary of frequency points for</span>
            <span class="c1"># easy indexing</span>
            <span class="c1"># line_find = False</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line_list</span><span class="p">[</span><span class="n">nn</span><span class="p">]):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="s1">&#39;</span><span class="si">{0:.5g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kk</span><span class="p">),</span> <span class="n">ff</span><span class="p">)</span>
                                                <span class="k">for</span> <span class="n">ff</span><span class="p">,</span> <span class="n">kk</span> <span class="ow">in</span>
                                                <span class="nb">enumerate</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">])]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fndict</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">number</span><span class="p">)]</span> <span class="o">=</span> <span class="n">nn</span>

                    <span class="c1"># set some events</span>
                    <span class="c1"># if line_find == False:</span>
                    <span class="n">cid1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;pick_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                    <span class="n">cid2</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;axes_enter_event&#39;</span><span class="p">,</span>
                                                          <span class="bp">self</span><span class="o">.</span><span class="n">inAxes</span><span class="p">)</span>
                    <span class="n">cid3</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span>
                                                          <span class="bp">self</span><span class="o">.</span><span class="n">on_close</span><span class="p">)</span>
                    <span class="n">cid4</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;figure_enter_event&#39;</span><span class="p">,</span>
                                                          <span class="bp">self</span><span class="o">.</span><span class="n">inFigure</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cidlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">cid1</span><span class="p">,</span> <span class="n">cid2</span><span class="p">,</span> <span class="n">cid3</span><span class="p">,</span> <span class="n">cid4</span><span class="p">])</span>

                    <span class="c1"># set the figure number</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">number</span>

                    <span class="c1"># line_find = True</span>

                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>

            <span class="c1"># read in the error in a useful way so that it can be translated to</span>
            <span class="c1"># the data file.  Make the error into an array</span>
            <span class="k">for</span> <span class="n">ee</span><span class="p">,</span> <span class="n">err</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">err_list</span><span class="p">[</span><span class="n">nn</span><span class="p">]):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">errpath</span> <span class="o">=</span> <span class="n">err</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_paths</span><span class="p">()</span>
                    <span class="n">errarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="p">[</span><span class="n">nn</span><span class="p">][</span><span class="n">ee</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                    <span class="k">for</span> <span class="n">ff</span><span class="p">,</span> <span class="n">epath</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">errpath</span><span class="p">):</span>
                        <span class="n">errv</span> <span class="o">=</span> <span class="n">epath</span><span class="o">.</span><span class="n">vertices</span>
                        <span class="n">errarr</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">errv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">nn</span><span class="p">][</span><span class="n">ee</span><span class="p">][</span><span class="n">ff</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">errarr</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>

        <span class="c1"># set the error bar increment values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_err_inc</span> <span class="o">=</span> <span class="n">res_err_inc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_err_inc</span> <span class="o">=</span> <span class="n">phase_err_inc</span>

        <span class="c1"># set the marker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marker</span> <span class="o">=</span> <span class="n">marker</span>

        <span class="c1"># make a list of occam2d lines to write later</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="OccamPointPicker.__call__"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.OccamPointPicker.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When the function is called the mouse events will be recorder for </span>
<span class="sd">        picking points to mask or change error bars.  The axes is redrawn with</span>
<span class="sd">        a gray marker to indicate a masked point and/or increased size in </span>
<span class="sd">        errorbars.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ----------</span>
<span class="sd">            **event** : type mouse_click_event</span>

<span class="sd">        Useage:</span>
<span class="sd">        -------</span>

<span class="sd">            **Left mouse button** will mask both resistivity and phase point</span>

<span class="sd">            **Right mouse button** will mask just the point selected</span>

<span class="sd">            **Middle mouse button** will increase the error bars</span>

<span class="sd">            **q** will close the figure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="n">event</span>
        <span class="c1"># make a new point that is an PickEvent type</span>
        <span class="n">npoint</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">artist</span>
        <span class="c1"># if the right button is clicked mask the point</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">mouseevent</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># get the point that was clicked on</span>
            <span class="n">ii</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ind</span>
            <span class="n">xd</span> <span class="o">=</span> <span class="n">npoint</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">yd</span> <span class="o">=</span> <span class="n">npoint</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()[</span><span class="n">ii</span><span class="p">]</span>

            <span class="c1"># set the x index from the frequency dictionary</span>
            <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_num</span><span class="p">][</span><span class="s1">&#39;</span><span class="si">{0:.5g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xd</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>

            <span class="c1"># change the data to be a zero</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_num</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># reset the point to be a gray x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xd</span><span class="p">,</span> <span class="n">yd</span><span class="p">,</span>
                         <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">),</span>
                         <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="p">,</span>
                         <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

            <span class="c1"># redraw the canvas</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="c1"># if the left button is clicked change both resistivity and phase</span>
        <span class="c1"># points</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">mouseevent</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># get the point that was clicked on</span>
            <span class="n">ii</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ind</span>
            <span class="n">xd</span> <span class="o">=</span> <span class="n">npoint</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">yd</span> <span class="o">=</span> <span class="n">npoint</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()[</span><span class="n">ii</span><span class="p">]</span>

            <span class="c1"># set the x index from the frequency dictionary</span>
            <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_num</span><span class="p">][</span><span class="s1">&#39;</span><span class="si">{0:.5g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xd</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>

            <span class="c1"># set the data point to zero</span>
            <span class="nb">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_num</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_num</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># reset the point to be a gray x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xd</span><span class="p">,</span> <span class="n">yd</span><span class="p">,</span>
                         <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">),</span>
                         <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="p">,</span>
                         <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

            <span class="c1"># check to make sure there is a corresponding res/phase point</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">kk</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_num</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span>
                <span class="nb">print</span> <span class="n">kk</span>
                <span class="c1"># get the corresponding y-value</span>
                <span class="n">yd2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="n">kk</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span>

                <span class="c1"># set that data point to 0 as well</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="n">kk</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># make that data point a gray x</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="n">kk</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xd</span><span class="p">,</span> <span class="n">yd2</span><span class="p">,</span>
                                                    <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
                                                    <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">),</span>
                                                    <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="p">,</span>
                                                    <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
                <span class="c1"># redraw the canvas</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">&#39;Axis does not contain res/phase point&#39;</span>

        <span class="c1"># if click the scroll button or middle button change increase the</span>
        <span class="c1"># errorbars by the given amount</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">mouseevent</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ii</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ind</span>
            <span class="n">xd</span> <span class="o">=</span> <span class="n">npoint</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">yd</span> <span class="o">=</span> <span class="n">npoint</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">jj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax_num</span>

            <span class="c1"># get x index</span>
            <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="n">jj</span><span class="p">][</span><span class="s1">&#39;</span><span class="si">{0:.5g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xd</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>

            <span class="c1"># make error bar array</span>
            <span class="n">eb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">err_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="n">jj</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_paths</span><span class="p">()[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span>

            <span class="c1"># make ecap array</span>
            <span class="n">ecapl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">err_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="n">jj</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span>
            <span class="n">ecapu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">err_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="n">jj</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span>

            <span class="c1"># change apparent resistivity error</span>
            <span class="k">if</span> <span class="n">jj</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">jj</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">nebu</span> <span class="o">=</span> <span class="n">eb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_err_inc</span> <span class="o">*</span> <span class="n">eb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">nebl</span> <span class="o">=</span> <span class="n">eb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_err_inc</span> <span class="o">*</span> <span class="n">eb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">ecapl</span> <span class="o">=</span> <span class="n">ecapl</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_err_inc</span> <span class="o">*</span> <span class="n">ecapl</span>
                <span class="n">ecapu</span> <span class="o">=</span> <span class="n">ecapu</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_err_inc</span> <span class="o">*</span> <span class="n">ecapu</span>

            <span class="c1"># change phase error</span>
            <span class="k">elif</span> <span class="n">jj</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">jj</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">nebu</span> <span class="o">=</span> <span class="n">eb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">eb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_err_inc</span>
                <span class="n">nebl</span> <span class="o">=</span> <span class="n">eb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">eb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_err_inc</span>
                <span class="n">ecapl</span> <span class="o">=</span> <span class="n">ecapl</span> <span class="o">-</span> <span class="n">ecapl</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_err_inc</span>
                <span class="n">ecapu</span> <span class="o">=</span> <span class="n">ecapu</span> <span class="o">+</span> <span class="n">ecapu</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_err_inc</span>

            <span class="c1"># put the new error into the error array</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="n">jj</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nebu</span> <span class="o">-</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="n">jj</span><span class="p">][</span><span class="n">ll</span><span class="p">])</span>

            <span class="c1"># set the new error bar values</span>
            <span class="n">eb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">nebu</span>
            <span class="n">eb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">nebl</span>

            <span class="c1"># reset the error bars and caps</span>
            <span class="n">ncapl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">err_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="n">jj</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
            <span class="n">ncapu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">err_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="n">jj</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
            <span class="n">ncapl</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecapl</span>
            <span class="n">ncapu</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecapu</span>

            <span class="c1"># set the values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">err_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="n">jj</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">ncapl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">err_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="n">jj</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">ncapu</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">err_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="n">jj</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_paths</span><span class="p">()[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">eb</span>

            <span class="c1"># redraw the canvas</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

    <span class="c1"># get the axis number that the mouse is in and change to that axis</span>
<div class="viewcode-block" id="OccamPointPicker.inAxes"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.OccamPointPicker.inAxes">[docs]</a>    <span class="k">def</span> <span class="nf">inAxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        gets the axes that the mouse is currently in.</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ---------</span>
<span class="sd">            **event**: is a type axes_enter_event</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>

<span class="sd">            **OccamPointPicker.jj** : index of resistivity axes for ax_list</span>

<span class="sd">            **OccamPointPicker.kk** : index of phase axes for ax_list</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">event2</span> <span class="o">=</span> <span class="n">event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span>
        <span class="k">for</span> <span class="n">jj</span><span class="p">,</span> <span class="n">axj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ll</span><span class="p">,</span> <span class="n">axl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axj</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">==</span> <span class="n">axl</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ax_num</span> <span class="o">=</span> <span class="n">ll</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_num</span><span class="p">]</span></div>

    <span class="c1"># get the figure number that the mouse is in</span>
<div class="viewcode-block" id="OccamPointPicker.inFigure"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.OccamPointPicker.inFigure">[docs]</a>    <span class="k">def</span> <span class="nf">inFigure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        gets the figure number that the mouse is in</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ----------</span>
<span class="sd">            **event** : figure_enter_event</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">            **OccamPointPicker.fig_num** : figure number that corresponds to the</span>
<span class="sd">                                          index in the ax_list, datalist, errorlist</span>
<span class="sd">                                          and line_list.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event3</span> <span class="o">=</span> <span class="n">event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fndict</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">number</span><span class="p">)]</span></div>

    <span class="c1"># type the q key to quit the figure and disconnect event handling</span>
<div class="viewcode-block" id="OccamPointPicker.on_close"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.OccamPointPicker.on_close">[docs]</a>    <span class="k">def</span> <span class="nf">on_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        close the figure with a &#39;q&#39; key event and disconnect the event ids</span>

<span class="sd">        Arguments:</span>
<span class="sd">        ----------</span>
<span class="sd">            **event** : key_press_event</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">            print statement saying the figure is closed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event3</span> <span class="o">=</span> <span class="n">event</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">event3</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cidlist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span><span class="p">]:</span>
                <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
            <span class="nb">print</span> <span class="s1">&#39;Closed figure &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig_num</span></div></div>


<div class="viewcode-block" id="Run"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Run">[docs]</a><span class="k">class</span> <span class="nc">Run</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run Occam2D by system call.</span>

<span class="sd">    Future plan: implement Occam in Python and call it from here directly.</span>
<span class="sd">    &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Mask"><a class="viewcode-back" href="../../../modeling.html#mtpy.modeling.occam2d_rewrite.Mask">[docs]</a><span class="k">class</span> <span class="nc">Mask</span><span class="p">(</span><span class="n">Data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Allow masking of points from data file (effectively commenting them out, </span>
<span class="sd">    so the process is reversable). Inheriting from Data class.</span>
<span class="sd">    &quot;&quot;&quot;</span></div>


<span class="k">class</span> <span class="nc">OccamInputError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="c1"># ======================================</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> please provide path to edi files</span><span class="se">\n</span><span class="s2"> USAGE:  </span><span class="si">%s</span><span class="s2"> path2edifiles&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">edi_dir</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">#stations = [&#39;151{0:02}A&#39;.format(s) for s in xrange(24, 31)]</span>
    <span class="c1">#print (stations)</span>
    <span class="c1">#pr = Profile(edi_path=edi_dir, station_list=stations)</span>
    <span class="c1"># OR pr = Profile(edi_path=edi_dir,</span>
    <span class="c1"># station_list=[&#39;16125A&#39;,&#39;16124A&#39;,&#39;16123A&#39;,&#39;16127A&#39;,&#39;16126A&#39;, &#39;16122A&#39;])</span>

    <span class="n">pr</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">(</span><span class="n">edi_path</span><span class="o">=</span><span class="n">edi_dir</span><span class="p">)</span>

    <span class="c1"># pr.geoelectric_strike = 45</span>

    <span class="n">pr</span><span class="o">.</span><span class="n">generate_profile</span><span class="p">()</span>

    <span class="nb">print</span> <span class="p">(</span><span class="n">pr</span><span class="o">.</span><span class="n">profile_angle</span><span class="p">)</span>

    <span class="c1"># set station labels to only be from 1st to 4th index of station name</span>
    <span class="n">pr</span><span class="o">.</span><span class="n">plot_profile</span><span class="p">(</span><span class="n">station_id</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../master_index.html">MTpy 0.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, J. Peacock, L. Krieger.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.6.
    </div>
  </body>
</html>