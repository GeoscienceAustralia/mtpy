<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>mtpy.core.edi &#8212; MTpy 0.2 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="MTpy 0.2 documentation" href="../../../master_index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../master_index.html">MTpy 0.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for mtpy.core.edi</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">===========</span>
<span class="sd">EDI Class</span>
<span class="sd">===========</span>

<span class="sd">The Edi class can read and write an .edi file, the &#39;standard format&#39; of</span>
<span class="sd">magnetotellurics.  Each section of the .edi file is given its own class,</span>
<span class="sd">so the elements of each section are attributes for easy access.</span>


<span class="sd">Created on Tue Dec 22 16:03:31 2015</span>

<span class="sd">@author: jpeacock</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">mtpy.core.z</span> <span class="k">as</span> <span class="nn">MTz</span>
<span class="kn">import</span> <span class="nn">mtpy.utils.exceptions</span> <span class="k">as</span> <span class="nn">MTex</span>
<span class="kn">import</span> <span class="nn">mtpy.utils.filehandling</span> <span class="k">as</span> <span class="nn">MTfh</span>
<span class="kn">import</span> <span class="nn">mtpy.utils.format</span> <span class="k">as</span> <span class="nn">MTft</span>
<span class="kn">from</span> <span class="nn">mtpy.utils.mtpylog</span> <span class="k">import</span> <span class="n">MtPyLog</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">scipy.stats.distributions</span> <span class="k">as</span> <span class="nn">ssd</span>

    <span class="n">ssd_test</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s1">&#39;Need scipy.stats.distributions to compute spectra errors&#39;</span>
    <span class="nb">print</span> <span class="s1">&#39;Could not find scipy.stats.distributions, check distribution&#39;</span>
    <span class="n">ssd_test</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">tab</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="mi">4</span>

<span class="c1"># get a logger object for this module, using the utility class MtPyLog to</span>
<span class="c1"># config the logger</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">MtPyLog</span><span class="p">()</span><span class="o">.</span><span class="n">get_mtpy_logger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="Edi"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.Edi">[docs]</a><span class="k">class</span> <span class="nc">Edi</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is for .edi files, mainly reading and writing.  Has been tested</span>
<span class="sd">    on Winglink and Phoenix output .edi&#39;s, which are meant to follow the</span>
<span class="sd">    archaic EDI format put forward by SEG. Can read impedance, Tipper and/or</span>
<span class="sd">    spectra data.</span>

<span class="sd">    The Edi class contains a class for each major section of the .edi file.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------------</span>

<span class="sd">        **edi_fn** : string</span>
<span class="sd">                     full path to .edi file to be read in.</span>
<span class="sd">                     *default* is None. If an .edi file is input, it is</span>
<span class="sd">                     automatically read in and attributes of Edi are filled</span>


<span class="sd">    Methods</span>
<span class="sd">    ---------------</span>
<span class="sd">    ===================== =====================================================</span>
<span class="sd">    Methods               Description</span>
<span class="sd">    ===================== =====================================================</span>
<span class="sd">    read_edi_file         Reads in an edi file and populates the associated</span>
<span class="sd">                          classes and attributes.</span>
<span class="sd">    write_edi_file        Writes an .edi file following the EDI format given</span>
<span class="sd">                          the apporpriate attributes are filled.  Writes out</span>
<span class="sd">                          in impedance and Tipper format.</span>
<span class="sd">    _read_data            Reads in the impedance and Tipper blocks, if the</span>
<span class="sd">                          .edi file is in &#39;spectra&#39; format, read_data converts</span>
<span class="sd">                          the data to impedance and Tipper.</span>
<span class="sd">    _read_mt              Reads impedance and tipper data from the appropriate</span>
<span class="sd">                          blocks of the .edi file.</span>
<span class="sd">    _read_spectra         Reads in spectra data and converts it to impedance</span>
<span class="sd">                          and Tipper data.</span>
<span class="sd">    ===================== =====================================================</span>

<span class="sd">    Attributes</span>
<span class="sd">    ---------------</span>

<span class="sd">    ===================== ========================================== ==========</span>
<span class="sd">    Attributes            Description                                default</span>
<span class="sd">    ===================== ========================================== ==========</span>
<span class="sd">    Data_sect             DataSection class, contains basic</span>
<span class="sd">                          information on the data collected and in</span>
<span class="sd">                          whether the data is in impedance or</span>
<span class="sd">                          spectra.</span>
<span class="sd">    Define_measurement    DefineMeasurement class, contains</span>
<span class="sd">                          information on how the data was</span>
<span class="sd">                          collected.</span>
<span class="sd">    edi_fn                full path to edi file read in              None</span>
<span class="sd">    Header                Header class, contains metadata on</span>
<span class="sd">                          where, when, and who collected the data</span>
<span class="sd">    Info                  Information class, contains information</span>
<span class="sd">                          on how the data was processed and how the</span>
<span class="sd">                          transfer functions where estimated.</span>
<span class="sd">    Tipper                mtpy.core.z.Tipper class, contains the</span>
<span class="sd">                          tipper data</span>
<span class="sd">    Z                     mtpy.core.z.Z class, contains the</span>
<span class="sd">                          impedance data</span>
<span class="sd">    _block_len            number of data in one line.                6</span>
<span class="sd">    _data_header_str      header string for each of the data         &#39;!****{0}****!&#39;</span>
<span class="sd">                          section</span>
<span class="sd">    _num_format           string format of data.                     &#39; 15.6e&#39;</span>
<span class="sd">    _t_labels             labels for tipper blocks</span>
<span class="sd">    _z_labels             labels for impedance blocks</span>
<span class="sd">    ===================== ========================================== ==========</span>

<span class="sd">    Examples</span>
<span class="sd">    ---------------------</span>
<span class="sd">    :Change Latitude: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.core.edi as mtedi</span>
<span class="sd">        &gt;&gt;&gt; edi_obj = mtedi.Edi(edi_fn=r&quot;/home/mt/mt01.edi&quot;)</span>
<span class="sd">        &gt;&gt;&gt; # change the latitude</span>
<span class="sd">        &gt;&gt;&gt; edi_obj.header.lat = 45.7869</span>
<span class="sd">        &gt;&gt;&gt; new_edi_fn = edi_obj.write_edi_file()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="o">=</span> <span class="n">edi_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_edi_lines</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="n">Header</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Info</span> <span class="o">=</span> <span class="n">Information</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Define_measurement</span> <span class="o">=</span> <span class="n">DefineMeasurement</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Data_sect</span> <span class="o">=</span> <span class="n">DataSection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">MTz</span><span class="o">.</span><span class="n">Z</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span> <span class="o">=</span> <span class="n">MTz</span><span class="o">.</span><span class="n">Tipper</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_z_labels</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;zxxr&#39;</span><span class="p">,</span> <span class="s1">&#39;zxxi&#39;</span><span class="p">,</span> <span class="s1">&#39;zxx.var&#39;</span><span class="p">],</span>
                          <span class="p">[</span><span class="s1">&#39;zxyr&#39;</span><span class="p">,</span> <span class="s1">&#39;zxyi&#39;</span><span class="p">,</span> <span class="s1">&#39;zxy.var&#39;</span><span class="p">],</span>
                          <span class="p">[</span><span class="s1">&#39;zyxr&#39;</span><span class="p">,</span> <span class="s1">&#39;zyxi&#39;</span><span class="p">,</span> <span class="s1">&#39;zyx.var&#39;</span><span class="p">],</span>
                          <span class="p">[</span><span class="s1">&#39;zyyr&#39;</span><span class="p">,</span> <span class="s1">&#39;zyyi&#39;</span><span class="p">,</span> <span class="s1">&#39;zyy.var&#39;</span><span class="p">]]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_t_labels</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;txr.exp&#39;</span><span class="p">,</span> <span class="s1">&#39;txi.exp&#39;</span><span class="p">,</span> <span class="s1">&#39;txvar.exp&#39;</span><span class="p">],</span>
                          <span class="p">[</span><span class="s1">&#39;tyr.exp&#39;</span><span class="p">,</span> <span class="s1">&#39;tyi.exp&#39;</span><span class="p">,</span> <span class="s1">&#39;tyvar.exp&#39;</span><span class="p">]]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data_header_str</span> <span class="o">=</span> <span class="s1">&#39;!****</span><span class="si">{0}</span><span class="s1">****!</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_num_format</span> <span class="o">=</span> <span class="s1">&#39; 15.6e&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_block_len</span> <span class="o">=</span> <span class="mi">6</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_edi_file</span><span class="p">()</span>

<div class="viewcode-block" id="Edi.read_edi_file"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.Edi.read_edi_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_edi_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in an edi file and fill attributes of each section&#39;s classes.</span>
<span class="sd">        Including:</span>
<span class="sd">            * Header</span>
<span class="sd">            * Info</span>
<span class="sd">            * Define_measurement</span>
<span class="sd">            * Data_sect</span>
<span class="sd">            * Z</span>
<span class="sd">            * Tipper</span>

<span class="sd">            .. note:: Automatically detects if data is in spectra format.  All</span>
<span class="sd">                  data read in is converted to impedance and Tipper.</span>

<span class="sd">        Arguments</span>
<span class="sd">        -------------</span>

<span class="sd">            **edi_fn** : string</span>
<span class="sd">                         full path to .edi file to be read in</span>
<span class="sd">                         *default* is None</span>



<span class="sd">        Examples</span>
<span class="sd">        -------------</span>

<span class="sd">        :Read edi: ::</span>

<span class="sd">            &gt;&gt;&gt; import mtpy.core.Edi as mtedi</span>
<span class="sd">            &gt;&gt;&gt; edi_obj = mtedi.Edi()</span>
<span class="sd">            &gt;&gt;&gt; edi_obj.read_edi_file(edi_fn=r&quot;/home/mt/mt01.edi&quot;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reading the edi file </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="o">=</span> <span class="n">edi_fn</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MTex</span><span class="o">.</span><span class="n">MTpyError_EDI</span><span class="p">(</span><span class="s2">&quot;No edi file input, check edi_fn&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MTex</span><span class="o">.</span><span class="n">MTpyError_EDI</span><span class="p">(</span>
                    <span class="s2">&quot;Could not find </span><span class="si">{0}</span><span class="s2">, check path&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span><span class="p">))</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_edi_lines</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">edi_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edi_lines</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Info</span> <span class="o">=</span> <span class="n">Information</span><span class="p">(</span><span class="n">edi_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edi_lines</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Define_measurement</span> <span class="o">=</span> <span class="n">DefineMeasurement</span><span class="p">(</span><span class="n">edi_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edi_lines</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Data_sect</span> <span class="o">=</span> <span class="n">DataSection</span><span class="p">(</span><span class="n">edi_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_edi_lines</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_read_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">lat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Define_measurement</span><span class="o">.</span><span class="n">reflat</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Got latitude from reflat for </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">dataid</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">lon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Define_measurement</span><span class="o">.</span><span class="n">reflon</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Got longitude from reflon for </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">dataid</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">elev</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Define_measurement</span><span class="o">.</span><span class="n">refelev</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Got elevation from refelev for </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">dataid</span><span class="p">))</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Read in edi file for station </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">dataid</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read either impedance or spectra data depending on what the type is</span>
<span class="sd">        in the data section.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MTex</span><span class="o">.</span><span class="n">MTpyError_EDI</span><span class="p">(</span><span class="s1">&#39;No edi file input, check edi_fn&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MTex</span><span class="o">.</span><span class="n">MTpyError_EDI</span><span class="p">(</span><span class="s1">&#39;No edi file input, check edi_fn&#39;</span><span class="p">)</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edi_lines</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Data_sect</span><span class="o">.</span><span class="n">line_num</span><span class="p">:]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Data_sect</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;spectra&#39;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Converting Spectra to Impedance and Tipper&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Check to make sure input channel list is correct if&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39; the data looks incorrect.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_spectra</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Data_sect</span><span class="o">.</span><span class="n">data_type</span> <span class="o">==</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_mt</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_mt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_lines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read in impedance and tipper data if its there</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">flip</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">data_find</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data_lines</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s1">&#39;!&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">line_list</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">line_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;z&#39;</span> <span class="ow">or</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span>
                    <span class="n">data_find</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">data_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data_find</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">elif</span> <span class="n">data_find</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s1">&#39;!&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">d_lines</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">d_lines</span><span class="p">):</span>
                    <span class="c1"># check for empty values and set them to 0, check for any</span>
                    <span class="c1"># other characters sometimes there are ****** for a null</span>
                    <span class="c1"># component</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">d_lines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">d_lines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0e32</span><span class="p">:</span>
                            <span class="n">d_lines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">d_lines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">data_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d_lines</span>

        <span class="c1"># fill useful arrays</span>
        <span class="n">freq_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">z_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">freq_arr</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
        <span class="n">z_err_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">freq_arr</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

        <span class="c1"># fill impedance tensor</span>
        <span class="n">z_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;zxxr&#39;</span><span class="p">])</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;zxxi&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>
        <span class="n">z_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;zxyr&#39;</span><span class="p">])</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;zxyi&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>
        <span class="n">z_arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;zyxr&#39;</span><span class="p">])</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;zyxi&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>
        <span class="n">z_arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;zyyr&#39;</span><span class="p">])</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;zyyi&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>

        <span class="n">z_err_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;zxx.var&#39;</span><span class="p">])</span>
        <span class="n">z_err_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;zxy.var&#39;</span><span class="p">])</span>
        <span class="n">z_err_arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;zyx.var&#39;</span><span class="p">])</span>
        <span class="n">z_err_arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;zyy.var&#39;</span><span class="p">])</span>

        <span class="c1"># check for order of frequency, we want high to low</span>
        <span class="k">if</span> <span class="n">freq_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">freq_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Ordered arrays to be arranged from high to low frequency&#39;</span><span class="p">)</span>
            <span class="n">freq_arr</span> <span class="o">=</span> <span class="n">freq_arr</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">z_arr</span> <span class="o">=</span> <span class="n">z_arr</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">z_err_arr</span> <span class="o">=</span> <span class="n">z_err_arr</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">flip</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># set the attributes as private variables to avoid redundant estimation</span>
        <span class="c1"># of res and phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">_freq</span> <span class="o">=</span> <span class="n">freq_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="n">z_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">_z_err</span> <span class="o">=</span> <span class="n">z_err_arr</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;zrot&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">freq_arr</span><span class="p">)</span>

        <span class="c1"># compute resistivity and phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">_compute_res_phase</span><span class="p">()</span>

        <span class="c1"># fill tipper data if there it exists</span>
        <span class="n">tipper_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">freq_arr</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
        <span class="n">tipper_err_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">freq_arr</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;trot&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;zrot&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">freq_arr</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;txr.exp&#39;</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">tipper_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;txr.exp&#39;</span><span class="p">])</span> <span class="o">+</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;txi.exp&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>
            <span class="n">tipper_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;tyr.exp&#39;</span><span class="p">])</span> <span class="o">+</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;tyi.exp&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>

            <span class="n">tipper_err_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;txvar.exp&#39;</span><span class="p">])</span>
            <span class="n">tipper_err_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;tyvar.exp&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">flip</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">tipper_arr</span> <span class="o">=</span> <span class="n">tipper_arr</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">tipper_err_arr</span> <span class="o">=</span> <span class="n">tipper_err_arr</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Could not find any Tipper data.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">_freq</span> <span class="o">=</span> <span class="n">freq_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">_tipper</span> <span class="o">=</span> <span class="n">tipper_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">_tipper_err</span> <span class="o">=</span> <span class="n">tipper_err_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">_compute_amp_phase</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">_compute_mag_direction</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_read_spectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_lines</span><span class="p">,</span>
                      <span class="n">comp_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hx&#39;</span><span class="p">,</span> <span class="s1">&#39;hy&#39;</span><span class="p">,</span> <span class="s1">&#39;hz&#39;</span><span class="p">,</span> <span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;ey&#39;</span><span class="p">,</span> <span class="s1">&#39;rhx&#39;</span><span class="p">,</span> <span class="s1">&#39;rhy&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read in spectra data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">avgt_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">data_find</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data_lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&gt;spectra&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">line_list</span> <span class="o">=</span> <span class="n">_validate_str_with_equals</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">data_find</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># frequency will be the key</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="nb">float</span><span class="p">([</span><span class="n">ss</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">line_list</span>
                                 <span class="k">if</span> <span class="n">ss</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;freq&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">data_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">avgt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">([</span><span class="n">ss</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">line_list</span>
                                  <span class="k">if</span> <span class="n">ss</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;avgt&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">avgt_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">avgt</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;did not find frequency key&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">data_find</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> \
                    <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">data_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span> <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>

            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&gt;spectra&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">data_find</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># get an object that contains the indices for each component</span>
        <span class="n">cc</span> <span class="o">=</span> <span class="n">index_locator</span><span class="p">(</span><span class="n">comp_list</span><span class="p">)</span>

        <span class="n">freq_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="n">z_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
        <span class="n">t_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>

        <span class="n">z_err_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">z_arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">t_err_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freq_arr</span><span class="p">):</span>
            <span class="n">spectra_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]),</span>
                                     <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comp_list</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp_list</span><span class="p">)))</span>

            <span class="c1"># compute cross powers</span>
            <span class="n">s_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">spectra_arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">s_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">ii</span> <span class="o">==</span> <span class="n">jj</span><span class="p">:</span>
                        <span class="n">s_arr</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">spectra_arr</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># minus sign for complex conjugation</span>
                        <span class="c1"># original spectra data are of form &lt;A,B*&gt;, but we need</span>
                        <span class="c1"># the order &lt;B,A*&gt;...</span>
                        <span class="c1"># this is achieved by complex conjugation of the</span>
                        <span class="c1"># original entries</span>
                        <span class="n">s_arr</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">(</span><span class="n">spectra_arr</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span> <span class="n">ii</span><span class="p">],</span>
                                                   <span class="o">-</span><span class="n">spectra_arr</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">])</span>
                        <span class="c1"># keep complex conjugated entries in the lower</span>
                        <span class="c1"># triangular matrix:</span>
                        <span class="n">s_arr</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">(</span><span class="n">spectra_arr</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span> <span class="n">ii</span><span class="p">],</span>
                                                   <span class="n">spectra_arr</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">])</span>

            <span class="c1"># use formulas from Bahr/Simpson to convert the Spectra into Z</span>
            <span class="c1"># the entries of S are sorted like</span>
            <span class="c1"># &lt;X,X*&gt;  &lt;X,Y*&gt;  &lt;X,Z*&gt;  &lt;X,En*&gt;  &lt;X,Ee*&gt;  &lt;X,Rx*&gt;  &lt;X,Ry*&gt;</span>
            <span class="c1">#         &lt;Y,Y*&gt;  &lt;Y,Z*&gt;  &lt;Y,En*&gt;  &lt;Y,Ee*&gt;  &lt;Y,Rx*&gt;  &lt;Y,Ry*&gt;</span>
            <span class="c1"># .....</span>

            <span class="n">z_arr</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ex</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhx</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhy</span><span class="p">]</span> <span class="o">-</span> \
                <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ex</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhy</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhx</span><span class="p">]</span>
            <span class="n">z_arr</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ex</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhy</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhx</span><span class="p">]</span> <span class="o">-</span> \
                <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ex</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhx</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhy</span><span class="p">]</span>
            <span class="n">z_arr</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ey</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhx</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhy</span><span class="p">]</span> <span class="o">-</span> \
                <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ey</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhy</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhx</span><span class="p">]</span>
            <span class="n">z_arr</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ey</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhy</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhx</span><span class="p">]</span> <span class="o">-</span> \
                <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ey</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhx</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhy</span><span class="p">]</span>

            <span class="n">z_arr</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">/=</span> <span class="p">(</span><span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhx</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhy</span><span class="p">]</span> <span class="o">-</span>
                          <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhy</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhx</span><span class="p">])</span>

            <span class="c1"># compute error only if scipy package exists</span>
            <span class="k">if</span> <span class="n">ssd_test</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># 68% Quantil of the Fisher distribution:</span>
                <span class="n">z_det</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">]</span> <span class="o">-</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

                <span class="n">sigma_quantil</span> <span class="o">=</span> <span class="n">ssd</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.68</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">avgt_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span>

                <span class="c1"># 1) Ex</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ex</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">]</span> <span class="o">-</span> \
                    <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ex</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">]</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ex</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">]</span> <span class="o">-</span> \
                    <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ex</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">]</span>
                <span class="n">a</span> <span class="o">/=</span> <span class="n">z_det</span>
                <span class="n">b</span> <span class="o">/=</span> <span class="n">z_det</span>

                <span class="n">psi_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ex</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">ex</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span>
                                      <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">ex</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">ex</span><span class="p">]))</span>
                <span class="n">epsilon_squared</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">psi_squared</span>

                <span class="n">scaling</span> <span class="o">=</span> <span class="n">sigma_quantil</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="n">avgt_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="mf">4.</span><span class="p">)</span> <span class="o">*</span> \
                    <span class="n">epsilon_squared</span> <span class="o">/</span> <span class="n">z_det</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ex</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">ex</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
                <span class="n">z_err_arr</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                    <span class="n">scaling</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
                <span class="n">z_err_arr</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                    <span class="n">scaling</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>

                <span class="c1"># 2) EY</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ey</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">]</span> <span class="o">-</span> \
                    <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ey</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">]</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ey</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">]</span> <span class="o">-</span> \
                    <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ey</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">]</span>
                <span class="n">a</span> <span class="o">/=</span> <span class="n">z_det</span>
                <span class="n">b</span> <span class="o">/=</span> <span class="n">z_det</span>

                <span class="n">psi_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ey</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">ey</span><span class="p">])</span> <span class="o">*</span>
                                      <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">ey</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">ey</span><span class="p">]))</span>
                <span class="n">epsilon_squared</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">psi_squared</span>

                <span class="n">scaling</span> <span class="o">=</span> <span class="n">sigma_quantil</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="n">avgt_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="mf">4.</span><span class="p">)</span> <span class="o">*</span> \
                    <span class="n">epsilon_squared</span> <span class="o">/</span> <span class="n">z_det</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">ey</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">ey</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
                <span class="n">z_err_arr</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                    <span class="n">scaling</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
                <span class="n">z_err_arr</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                    <span class="n">scaling</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>

            <span class="c1"># if HZ information is present:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">comp_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">t_arr</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hz</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhx</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhy</span><span class="p">]</span> <span class="o">-</span> \
                    <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hz</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhy</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhx</span><span class="p">]</span>
                <span class="n">t_arr</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hz</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhy</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhx</span><span class="p">]</span> <span class="o">-</span> \
                    <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hz</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhx</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhy</span><span class="p">]</span>

                <span class="n">t_arr</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">/=</span> <span class="p">(</span><span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhx</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhy</span><span class="p">]</span> <span class="o">-</span>
                              <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhy</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">rhx</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">ssd_test</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hz</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">]</span> <span class="o">-</span> \
                        <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hz</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">]</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hz</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">]</span> <span class="o">-</span> \
                        <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hz</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">]</span>
                    <span class="n">a</span> <span class="o">/=</span> <span class="n">z_det</span>
                    <span class="n">b</span> <span class="o">/=</span> <span class="n">z_det</span>

                    <span class="n">psi_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hz</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hz</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span>
                                          <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hz</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hz</span><span class="p">]))</span>
                    <span class="n">epsilon_squared</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">psi_squared</span>

                    <span class="n">scaling</span> <span class="o">=</span> <span class="n">sigma_quantil</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="n">avgt_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="mf">4.</span><span class="p">)</span> <span class="o">*</span> \
                        <span class="n">epsilon_squared</span> <span class="o">/</span> <span class="n">z_det</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hz</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hz</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
                    <span class="n">t_err_arr</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                        <span class="n">scaling</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hy</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
                    <span class="n">t_err_arr</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                        <span class="n">scaling</span> <span class="o">*</span> <span class="n">s_arr</span><span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">hx</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>

        <span class="c1"># check for nans</span>
        <span class="n">z_err_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">z_err_arr</span><span class="p">)</span>
        <span class="n">t_err_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">t_err_arr</span><span class="p">)</span>

        <span class="n">z_err_arr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">z_err_arr</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">t_err_arr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t_err_arr</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c1"># be sure to fill attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">z_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">z_err</span> <span class="o">=</span> <span class="n">z_err_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">freq_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">freq_arr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">_compute_res_phase</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">tipper</span> <span class="o">=</span> <span class="n">t_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">tipper_err</span> <span class="o">=</span> <span class="n">t_err_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">freq_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">freq_arr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">_compute_amp_phase</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">_compute_mag_direction</span><span class="p">()</span>

<div class="viewcode-block" id="Edi.write_edi_file"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.Edi.write_edi_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_edi_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_edi_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a new edi file from either an existing .edi file or from data</span>
<span class="sd">        input by the user into the attributes of Edi.</span>

<span class="sd">        Arguments</span>
<span class="sd">        -----------</span>

<span class="sd">            **new_edi_fn** : string</span>
<span class="sd">                             full path to new edi file.</span>
<span class="sd">                             *default* is None, which will write to the same</span>
<span class="sd">                             file as the input .edi with as:</span>
<span class="sd">                             r&quot;/home/mt/mt01_1.edi&quot;</span>

<span class="sd">        Examples</span>
<span class="sd">        -----------</span>

<span class="sd">        :Write EDI file: ::</span>

<span class="sd">            &gt;&gt;&gt; import mtpy.core.edi as mtedi</span>
<span class="sd">            &gt;&gt;&gt; edi_obj = mtedi.Edi(edi_fn=r&quot;/home/mt/mt01/edi&quot;)</span>
<span class="sd">            &gt;&gt;&gt; edi_obj.Header.dataid = &#39;mt01_rr&#39;</span>
<span class="sd">            &gt;&gt;&gt; edi_obj.write_edi_file()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">new_edi_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_edi_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_edi_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                                          <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">.edi&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">dataid</span><span class="p">))</span>
        <span class="n">new_edi_fn</span> <span class="o">=</span> <span class="n">MTfh</span><span class="o">.</span><span class="n">make_unique_filename</span><span class="p">(</span><span class="n">new_edi_fn</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">dataid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_edi_file</span><span class="p">()</span>

        <span class="c1"># write lines</span>
        <span class="n">header_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">write_header</span><span class="p">()</span>
        <span class="n">info_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="o">.</span><span class="n">write_info</span><span class="p">()</span>
        <span class="n">define_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Define_measurement</span><span class="o">.</span><span class="n">write_define_measurement</span><span class="p">()</span>
        <span class="n">dsect_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Data_sect</span><span class="o">.</span><span class="n">write_data_sect</span><span class="p">()</span>

        <span class="c1"># write out frequencies</span>
        <span class="n">freq_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_header_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;frequencies&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())]</span>
        <span class="n">freq_lines</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_data_block</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">)</span>

        <span class="c1"># write out rotation angles</span>
        <span class="n">zrot_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_header_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s1">&#39;impedance rotation angles&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())]</span>
        <span class="n">zrot_lines</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_data_block</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">,</span> <span class="s1">&#39;zrot&#39;</span><span class="p">)</span>

        <span class="c1"># write out data only impedance and tipper</span>
        <span class="n">z_data_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_header_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;impedances&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">z_lines_real</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_data_block</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">z</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">_z_labels</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="o">+</span> <span class="n">jj</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">z_lines_imag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_data_block</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">z</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">_z_labels</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="o">+</span> <span class="n">jj</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">z_lines_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_data_block</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">z_err</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">],</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">_z_labels</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ii</span> <span class="o">+</span> <span class="n">jj</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>

                <span class="n">z_data_lines</span> <span class="o">+=</span> <span class="n">z_lines_real</span>
                <span class="n">z_data_lines</span> <span class="o">+=</span> <span class="n">z_lines_imag</span>
                <span class="n">z_data_lines</span> <span class="o">+=</span> <span class="n">z_lines_var</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">tipper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">tipper</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">trot_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
            <span class="n">t_data_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># write out rotation angles</span>
                <span class="n">trot_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_header_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="s1">&#39;tipper rotation angles&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                    <span class="n">trot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">trot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotation_angle</span>
                <span class="n">trot_lines</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_data_block</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">trot</span><span class="p">),</span> <span class="s1">&#39;trot&#39;</span><span class="p">)</span>

                <span class="c1"># write out tipper lines</span>
                <span class="n">t_data_lines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_header_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;tipper&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())]</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">t_lines_real</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_data_block</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                          <span class="bp">self</span><span class="o">.</span><span class="n">_t_labels</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">t_lines_imag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_data_block</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                          <span class="bp">self</span><span class="o">.</span><span class="n">_t_labels</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">t_lines_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_data_block</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">tipper_err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">],</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">_t_labels</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>

                    <span class="n">t_data_lines</span> <span class="o">+=</span> <span class="n">t_lines_real</span>
                    <span class="n">t_data_lines</span> <span class="o">+=</span> <span class="n">t_lines_imag</span>
                    <span class="n">t_data_lines</span> <span class="o">+=</span> <span class="n">t_lines_var</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">trot_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
                <span class="n">t_data_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>

        <span class="n">edi_lines</span> <span class="o">=</span> <span class="n">header_lines</span> <span class="o">+</span> \
            <span class="n">info_lines</span> <span class="o">+</span> \
            <span class="n">define_lines</span> <span class="o">+</span> \
            <span class="n">dsect_lines</span> <span class="o">+</span> \
            <span class="n">freq_lines</span> <span class="o">+</span> \
            <span class="n">zrot_lines</span> <span class="o">+</span> \
            <span class="n">z_data_lines</span> <span class="o">+</span> \
            <span class="n">trot_lines</span> <span class="o">+</span> \
            <span class="n">t_data_lines</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;&gt;END&#39;</span><span class="p">]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_edi_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edi_lines</span><span class="p">))</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_edi_fn</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">new_edi_fn</span></div>

    <span class="k">def</span> <span class="nf">_write_data_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_comp_arr</span><span class="p">,</span> <span class="n">data_key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write a data block</span>

<span class="sd">        return a list of strings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> \
                <span class="n">data_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zrot&#39;</span><span class="p">,</span> <span class="s1">&#39;trot&#39;</span><span class="p">]:</span>
            <span class="n">block_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&gt;</span><span class="si">{0}</span><span class="s1"> ROT=ZROT // </span><span class="si">{1:.0f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_key</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                                                               <span class="n">data_comp_arr</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">data_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> \
                <span class="n">data_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zrot&#39;</span><span class="p">,</span> <span class="s1">&#39;trot&#39;</span><span class="p">]:</span>
            <span class="n">block_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&gt;</span><span class="si">{0}</span><span class="s1"> ROT=TROT // </span><span class="si">{1:.0f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_key</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                                                               <span class="n">data_comp_arr</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">data_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span>
            <span class="n">block_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&gt;</span><span class="si">{0}</span><span class="s1"> // </span><span class="si">{1:.0f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_key</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                                                      <span class="n">data_comp_arr</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

        <span class="k">elif</span> <span class="n">data_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zrot&#39;</span><span class="p">,</span> <span class="s1">&#39;trot&#39;</span><span class="p">]:</span>
            <span class="n">block_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&gt;</span><span class="si">{0}</span><span class="s1"> // </span><span class="si">{1:.0f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_key</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                                                      <span class="n">data_comp_arr</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MTex</span><span class="o">.</span><span class="n">MTpyError_EDI</span><span class="p">(</span>
                <span class="s1">&#39;Cannot write block for </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_key</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">d_index</span><span class="p">,</span> <span class="n">d_comp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_comp_arr</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d_comp</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">data_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zrot&#39;</span><span class="p">,</span> <span class="s1">&#39;trot&#39;</span><span class="p">]:</span>
                <span class="n">d_comp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">empty</span><span class="p">)</span>
            <span class="c1"># write the string in the specified format</span>
            <span class="n">num_str</span> <span class="o">=</span> <span class="s1">&#39;{0:</span><span class="si">{1}</span><span class="s1">}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d_comp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_format</span><span class="p">)</span>

            <span class="c1"># check to see if a new line is needed</span>
            <span class="k">if</span> <span class="n">d_index</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_len</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">num_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="c1"># at the end of the block add a return</span>
            <span class="k">if</span> <span class="n">d_index</span> <span class="o">==</span> <span class="n">data_comp_arr</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="n">num_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="n">block_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num_str</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">block_lines</span>

    <span class="c1"># -----------------------------------------------------------------------</span>
    <span class="c1"># set a few important properties</span>
    <span class="c1"># --&gt; Latitude</span>
    <span class="k">def</span> <span class="nf">_get_lat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get latitude</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">lat</span>

    <span class="k">def</span> <span class="nf">_set_lat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_lat</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set latitude and make sure it is converted to a float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">MTft</span><span class="o">.</span><span class="n">_assert_position_format</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="n">input_lat</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Converted input latitude to decimal degrees: </span><span class="si">{0: .6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">lat</span><span class="p">))</span>

    <span class="n">lat</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">_get_lat</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">_set_lat</span><span class="p">,</span>
                   <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Latitude in decimal degrees&#39;</span><span class="p">)</span>

    <span class="c1"># --&gt; Longitude</span>
    <span class="k">def</span> <span class="nf">_get_lon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">lon</span>

    <span class="k">def</span> <span class="nf">_set_lon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_lon</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">MTft</span><span class="o">.</span><span class="n">_assert_position_format</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">input_lon</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Converted input longitude to decimal degrees: </span><span class="si">{0: .6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">lon</span><span class="p">))</span>

    <span class="n">lon</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">_get_lon</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">_set_lon</span><span class="p">,</span>
                   <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Longitude in decimal degrees&#39;</span><span class="p">)</span>

    <span class="c1"># --&gt; Elevation</span>
    <span class="k">def</span> <span class="nf">_get_elev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">elev</span>

    <span class="k">def</span> <span class="nf">_set_elev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_elev</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span> <span class="n">MTft</span><span class="o">.</span><span class="n">_assert_position_format</span><span class="p">(</span><span class="s1">&#39;elev&#39;</span><span class="p">,</span> <span class="n">input_elev</span><span class="p">)</span>

    <span class="n">elev</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">_get_elev</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">_set_elev</span><span class="p">,</span>
                    <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Elevation in meters&#39;</span><span class="p">)</span>

    <span class="c1"># --&gt; station</span>
    <span class="k">def</span> <span class="nf">_get_station</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">dataid</span>

    <span class="k">def</span> <span class="nf">_set_station</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_station</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_station</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">new_station</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_station</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">dataid</span> <span class="o">=</span> <span class="n">new_station</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Data_sect</span><span class="o">.</span><span class="n">sectid</span> <span class="o">=</span> <span class="n">new_station</span>

    <span class="n">station</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">_get_station</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">_set_station</span><span class="p">,</span>
                       <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;station name&quot;</span><span class="p">)</span></div>


<span class="c1"># ==============================================================================</span>
<span class="c1"># Index finder</span>
<span class="c1"># ==============================================================================</span>
<span class="k">class</span> <span class="nc">index_locator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component_list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">component_list</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">ii</span><span class="p">)</span>


<span class="c1"># ==============================================================================</span>
<span class="c1">#  Header object</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Header"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.Header">[docs]</a><span class="k">class</span> <span class="nc">Header</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Header class contains all the information in the header section of the .edi</span>
<span class="sd">    file. A typical header block looks like::</span>

<span class="sd">        &gt;HEAD</span>

<span class="sd">            ACQBY=None</span>
<span class="sd">            ACQDATE=None</span>
<span class="sd">            DATAID=par28ew</span>
<span class="sd">            ELEV=0.000</span>
<span class="sd">            EMPTY=1e+32</span>
<span class="sd">            FILEBY=WG3DForward</span>
<span class="sd">            FILEDATE=2016/04/11 19:37:37 UTC</span>
<span class="sd">            LAT=-30:12:49</span>
<span class="sd">            LOC=None</span>
<span class="sd">            LON=139:47:50</span>
<span class="sd">            PROGDATE=2002-04-22</span>
<span class="sd">            PROGVERS=WINGLINK EDI 1.0.22</span>

<span class="sd">    Arguments</span>
<span class="sd">    -------------</span>

<span class="sd">        **edi_fn** : string</span>
<span class="sd">                     full path to .edi file to be read in.</span>
<span class="sd">                     *default* is None. If an .edi file is input, it is</span>
<span class="sd">                     automatically read in and attributes of Header are filled</span>

<span class="sd">    Attributes</span>
<span class="sd">    -------------</span>

<span class="sd">    Many of the attributes are needed in the .edi file.  They are marked with</span>
<span class="sd">    a yes for &#39;In .edi&#39;</span>

<span class="sd">    ============== ======================================= ======== ===========</span>
<span class="sd">    Attributes     Description                             Default  In .edi</span>
<span class="sd">    ============== ======================================= ======== ===========</span>
<span class="sd">    acqby          Acquired by                             None     yes</span>
<span class="sd">    acqdate        Acquired date (YYYY-MM-DD)              None     yes</span>
<span class="sd">    dataid         Station name, should be a string        None     yes</span>
<span class="sd">    edi_fn         Full path to .edi file                  None     no</span>
<span class="sd">    elev           Elevation of station (m)                None     yes</span>
<span class="sd">    empty          Value for missing data                  1e32     yes</span>
<span class="sd">    fileby         File written by                         None     yes</span>
<span class="sd">    filedate       Date the file is written (YYYY-MM-DD)   None     yes</span>
<span class="sd">    header_list    List of header lines                    None     no</span>
<span class="sd">    lat            Latitude of station [1]_                None     yes</span>
<span class="sd">    loc            Location name where station was         None     yes</span>
<span class="sd">                   collected</span>
<span class="sd">    lon            Longitude of station [1]_               None     yes</span>
<span class="sd">    phoenix_edi    [ True | False ] if phoenix .edi format False    no</span>
<span class="sd">    progdate       Date of program version to write .edi   None     yes</span>
<span class="sd">    progvers       Version of program writing .edi         None     yes</span>
<span class="sd">    stdvers        Standard version                        None     yes</span>
<span class="sd">    units          Units of distance                       m        yes</span>
<span class="sd">    _header_keys   list of metadata input into .edi        [2]_</span>
<span class="sd">                   header block.                                    no</span>
<span class="sd">    ============== ======================================= ======== ===========</span>

<span class="sd">    .. rubric:: footnotes</span>
<span class="sd">    .. [1] Internally everything is converted to decimal degrees.  Output is</span>
<span class="sd">          written as HH:MM:SS.ss so Winglink can read them in.</span>
<span class="sd">    .. [2] If you want to change what metadata is written into the .edi file</span>
<span class="sd">           change the items in _header_keys.  Default attributes are:</span>
<span class="sd">               * acqby</span>
<span class="sd">               * acqdate</span>
<span class="sd">               * dataid</span>
<span class="sd">               * elev</span>
<span class="sd">               * fileby</span>
<span class="sd">               * lat</span>
<span class="sd">               * loc</span>
<span class="sd">               * lon</span>
<span class="sd">               * filedate</span>
<span class="sd">               * empty</span>
<span class="sd">               * progdate</span>
<span class="sd">               * progvers</span>

<span class="sd">    Methods</span>
<span class="sd">    -------------</span>

<span class="sd">    ====================== ====================================================</span>
<span class="sd">    Methods                Description</span>
<span class="sd">    ====================== ====================================================</span>
<span class="sd">    get_header_list        get header lines from edi file</span>
<span class="sd">    read_header            read in header information from header_lines</span>
<span class="sd">    write_header           write header lines, returns a list of lines to write</span>
<span class="sd">    ====================== ====================================================</span>


<span class="sd">    Examples</span>
<span class="sd">    --------------</span>

<span class="sd">    :Read Header: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.core.edi as mtedi</span>
<span class="sd">        &gt;&gt;&gt; header_obj = mtedi.Header(edi_fn=r&quot;/home/mt/mt01.edi&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="o">=</span> <span class="n">edi_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acqby</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileby</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acqdate</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filedate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
            <span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1"> %H:%M:%S UTC&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">empty</span> <span class="o">=</span> <span class="mi">1</span><span class="n">E32</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progvers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progdate</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phoenix_edi</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">header_list</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_header_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;acqby&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;acqdate&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;dataid&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;elev&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;fileby&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;lat&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;loc&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;lon&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;filedate&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;empty&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;progdate&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;progvers&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_header</span><span class="p">()</span>

<div class="viewcode-block" id="Header.get_header_list"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.Header.get_header_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_header_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the header information from the .edi file in the form of a list,</span>
<span class="sd">        where each item is a line in the header section.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;No edi file to read.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">header_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">head_find</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># read in file line by line</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;Could not find </span><span class="si">{0}</span><span class="s1">, check path&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="c1"># read in list line by line and then truncate</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span><span class="p">):</span>
            <span class="c1"># check for header label</span>
            <span class="k">if</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s1">&#39;head&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">head_find</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># if the header line has been found then the next &gt;</span>
            <span class="c1"># should be the next section so stop</span>
            <span class="k">elif</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">head_find</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="c1"># get the header information into a list</span>
            <span class="k">elif</span> <span class="n">head_find</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># skip any blank lines</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">h_list</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">h_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="n">h_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">h_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">=</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span></div>

<div class="viewcode-block" id="Header.read_header"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.Header.read_header">[docs]</a>    <span class="k">def</span> <span class="nf">read_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read a header information from either edi file or a list of lines</span>
<span class="sd">        containing header information.</span>

<span class="sd">        Arguments</span>
<span class="sd">        -----------</span>

<span class="sd">            **header_list** : list</span>
<span class="sd">                              should be read from an .edi file or input as</span>
<span class="sd">                              [&#39;key_01=value_01&#39;, &#39;key_02=value_02&#39;]</span>

<span class="sd">        Examples</span>
<span class="sd">        ----------</span>

<span class="sd">        :Input header_list: ::</span>

<span class="sd">            &gt;&gt;&gt; h_list = [&#39;lat=36.7898&#39;, &#39;lon=120.73532&#39;, &#39;elev=120.0&#39;, ...</span>
<span class="sd">            &gt;&gt;&gt;           &#39;dataid=mt01&#39;]</span>
<span class="sd">            &gt;&gt;&gt; import mtpy.core.edi as mtedi</span>
<span class="sd">            &gt;&gt;&gt; header = mtedi.Header()</span>
<span class="sd">            &gt;&gt;&gt; header.read_header(h_list)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">header_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_header_list</span><span class="p">(</span><span class="n">header_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Nothing to read. header_list and edi_fn are None&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_header_list</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">h_line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_list</span><span class="p">:</span>
            <span class="n">h_list</span> <span class="o">=</span> <span class="n">h_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">h_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">h_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="s1">&#39;latitude&#39;</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;lat&#39;</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">MTft</span><span class="o">.</span><span class="n">_assert_position_format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;lon&#39;</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">MTft</span><span class="o">.</span><span class="n">_assert_position_format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="s1">&#39;elevation&#39;</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;elev&#39;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;No elevation data&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;loc&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;prospect&#39;</span><span class="p">]:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;loc&#39;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">, </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="c1"># test if its a phoenix formated .edi file</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;progvers&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;mt-editor&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phoenix_edi</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;fileby&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;mtpy&#39;</span>

            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Header.write_header"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.Header.write_header">[docs]</a>    <span class="k">def</span> <span class="nf">write_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write header information to a list of lines.</span>

<span class="sd">        Arguments</span>
<span class="sd">        -------------</span>

<span class="sd">            **header_list** : list</span>
<span class="sd">                              should be read from an .edi file or input as</span>
<span class="sd">                              [&#39;key_01=value_01&#39;, &#39;key_02=value_02&#39;]</span>

<span class="sd">        Returns</span>
<span class="sd">        ---------------</span>

<span class="sd">            **header_lines** : list</span>
<span class="sd">                               list of lines containing header information</span>
<span class="sd">                               will be of the form</span>
<span class="sd">                               [&#39;&gt;HEAD\n&#39;,</span>
<span class="sd">                                &#39;    key_01=value_01\n&#39;]</span>
<span class="sd">                                if None is input then reads from input .edi</span>
<span class="sd">                                file or uses attribute information to write</span>
<span class="sd">                                metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">header_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_header</span><span class="p">(</span><span class="n">header_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_header_list</span><span class="p">()</span>

        <span class="n">header_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&gt;HEAD</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_header_keys</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;progdate&#39;</span><span class="p">,</span> <span class="s1">&#39;progvers&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;mtpy&#39;</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">]:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">MTft</span><span class="o">.</span><span class="n">convert_dms_tuple2string</span><span class="p">(</span>
                    <span class="n">MTft</span><span class="o">.</span><span class="n">convert_degrees2dms_tuple</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;elev&#39;</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;0.000&#39;</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;filedate&#39;</span><span class="p">]:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
                    <span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1"> %H:%M:%S UTC&#39;</span><span class="p">)</span>

            <span class="n">header_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}{1}</span><span class="s1">=</span><span class="si">{2}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">value</span><span class="p">))</span>
        <span class="n">header_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">header_lines</span></div>

    <span class="k">def</span> <span class="nf">_validate_header_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        make sure the input header list is valid</span>

<span class="sd">        returns a validated header list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">header_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;No header information to read&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">new_header_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">h_line</span> <span class="ow">in</span> <span class="n">header_list</span><span class="p">:</span>
            <span class="n">h_line</span> <span class="o">=</span> <span class="n">h_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">h_line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">h_list</span> <span class="o">=</span> <span class="n">h_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">h_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">h_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">h_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">new_header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">=</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">new_header_list</span></div>


<span class="c1"># ==============================================================================</span>
<span class="c1"># Info object</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="Information"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.Information">[docs]</a><span class="k">class</span> <span class="nc">Information</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Contain, read, and write info section of .edi file</span>

<span class="sd">    not much to really do here, but just keep it in the same format that it is</span>
<span class="sd">    read in as, except if it is in phoenix format then split the two paragraphs</span>
<span class="sd">    up so they are sequential.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edi_lines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="o">=</span> <span class="n">edi_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="o">=</span> <span class="n">edi_lines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_list</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_info</span><span class="p">()</span>

<div class="viewcode-block" id="Information.get_info_list"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.Information.get_info_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_info_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get a list of lines from the info section</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;no edi file input, check edi_fn attribute&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">info_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">info_find</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">phoenix_file</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">phoenix_list_02</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;Could not find </span><span class="si">{0}</span><span class="s1">, check path&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span><span class="p">))</span>
                <span class="k">return</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s1">&#39;info&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">info_find</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">info_find</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">info_find</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;run information&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">phoenix_file</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">phoenix_file</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">info_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">37</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="n">phoenix_list_02</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">38</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">info_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">info_list</span> <span class="o">+=</span> <span class="n">phoenix_list_02</span>
        <span class="c1"># validate the information list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_info_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="Information.read_info"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.Information.read_info">[docs]</a>    <span class="k">def</span> <span class="nf">read_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read information section of the .edi file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">info_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_info_list</span><span class="p">(</span><span class="n">info_list</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_info_list</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Could not read information&quot;</span><span class="p">)</span>
            <span class="k">return</span></div>

<div class="viewcode-block" id="Information.write_info"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.Information.write_info">[docs]</a>    <span class="k">def</span> <span class="nf">write_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write out information</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">info_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_info_list</span><span class="p">(</span><span class="n">info_list</span><span class="p">)</span>

        <span class="n">info_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&gt;INFO</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_list</span><span class="p">:</span>
            <span class="n">info_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">info_lines</span></div>

    <span class="k">def</span> <span class="nf">_validate_info_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check to make sure the info list input is valid, really just checking</span>
<span class="sd">        for Phoenix format where they put two columns in the file and remove</span>
<span class="sd">        any blank lines and the &gt;info line</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">new_info_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">info_list</span><span class="p">:</span>
            <span class="c1"># get rid of empty lines</span>
            <span class="n">lt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_info_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">new_info_list</span></div>


<span class="c1"># ==============================================================================</span>
<span class="c1">#  Define measurement class</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="DefineMeasurement"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.DefineMeasurement">[docs]</a><span class="k">class</span> <span class="nc">DefineMeasurement</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    DefineMeasurement class holds information about the measurement.  This</span>
<span class="sd">    includes how each channel was setup.  The main block contains information</span>
<span class="sd">    on the reference location for the station.  This is a bit of an archaic</span>
<span class="sd">    part and was meant for a multiple station .edi file.  This section is also</span>
<span class="sd">    important if you did any forward modeling with Winglink cause it only gives</span>
<span class="sd">    the station location in this section.  The other parts are how each channel</span>
<span class="sd">    was collected.  An example define measurement section looks like::</span>

<span class="sd">        &gt;=DEFINEMEAS</span>

<span class="sd">            MAXCHAN=7</span>
<span class="sd">            MAXRUN=999</span>
<span class="sd">            MAXMEAS=9999</span>
<span class="sd">            UNITS=M</span>
<span class="sd">            REFTYPE=CART</span>
<span class="sd">            REFLAT=-30:12:49.4693</span>
<span class="sd">            REFLONG=139:47:50.87</span>
<span class="sd">            REFELEV=0</span>

<span class="sd">        &gt;HMEAS ID=1001.001 CHTYPE=HX X=0.0 Y=0.0 Z=0.0 AZM=0.0</span>
<span class="sd">        &gt;HMEAS ID=1002.001 CHTYPE=HY X=0.0 Y=0.0 Z=0.0 AZM=90.0</span>
<span class="sd">        &gt;HMEAS ID=1003.001 CHTYPE=HZ X=0.0 Y=0.0 Z=0.0 AZM=0.0</span>
<span class="sd">        &gt;EMEAS ID=1004.001 CHTYPE=EX X=0.0 Y=0.0 Z=0.0 X2=0.0 Y2=0.0</span>
<span class="sd">        &gt;EMEAS ID=1005.001 CHTYPE=EY X=0.0 Y=0.0 Z=0.0 X2=0.0 Y2=0.0</span>
<span class="sd">        &gt;HMEAS ID=1006.001 CHTYPE=HX X=0.0 Y=0.0 Z=0.0 AZM=0.0</span>
<span class="sd">        &gt;HMEAS ID=1007.001 CHTYPE=HY X=0.0 Y=0.0 Z=0.0 AZM=90.0</span>

<span class="sd">    Arguments</span>
<span class="sd">    -------------</span>

<span class="sd">        **edi_fn** : string</span>
<span class="sd">                     full path to .edi file to read in.</span>

<span class="sd">    Attributes</span>
<span class="sd">    -------------</span>

<span class="sd">    ================= ==================================== ======== ===========</span>
<span class="sd">    Attributes        Description                          Default  In .edi</span>
<span class="sd">    ================= ==================================== ======== ===========</span>
<span class="sd">    edi_fn            Full path to edi file read in        None     no</span>
<span class="sd">    maxchan           Maximum number of channels measured  None     yes</span>
<span class="sd">    maxmeas           Maximum number of measurements       9999     yes</span>
<span class="sd">    maxrun            Maximum number of measurement runs   999      yes</span>
<span class="sd">    meas_####         HMeasurement or EMEasurment object   None     yes</span>
<span class="sd">                      defining the measurement made [1]_</span>
<span class="sd">    refelev           Reference elevation (m)              None     yes</span>
<span class="sd">    reflat            Reference latitude [2]_              None     yes</span>
<span class="sd">    refloc            Reference location                   None     yes</span>
<span class="sd">    reflon            Reference longituted [2]_            None     yes</span>
<span class="sd">    reftype           Reference coordinate system          &#39;cart&#39;   yes</span>
<span class="sd">    units             Units of length                      m        yes</span>
<span class="sd">    _define_meas_keys Keys to include in define_measurment [3]_     no</span>
<span class="sd">                      section.</span>
<span class="sd">    ================= ==================================== ======== ===========</span>

<span class="sd">    .. rubric:: footnotes</span>
<span class="sd">    .. [1] Each channel with have its own define measurement and depending on</span>
<span class="sd">           whether it is an E or H channel the metadata will be different.</span>
<span class="sd">           the #### correspond to the channel number.</span>
<span class="sd">    .. [2] Internally everything is converted to decimal degrees.  Output is</span>
<span class="sd">          written as HH:MM:SS.ss so Winglink can read them in.</span>
<span class="sd">    .. [3] If you want to change what metadata is written into the .edi file</span>
<span class="sd">           change the items in _header_keys.  Default attributes are:</span>
<span class="sd">               * maxchan</span>
<span class="sd">               * maxrun</span>
<span class="sd">               * maxmeas</span>
<span class="sd">               * reflat</span>
<span class="sd">               * reflon</span>
<span class="sd">               * refelev</span>
<span class="sd">               * reftype</span>
<span class="sd">               * units</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edi_lines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="o">=</span> <span class="n">edi_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="o">=</span> <span class="n">edi_lines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_list</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">maxchan</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxmeas</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxrun</span> <span class="o">=</span> <span class="mi">999</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refelev</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reflat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reflon</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reftype</span> <span class="o">=</span> <span class="s1">&#39;cartesian&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_define_meas_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;maxchan&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;maxrun&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;maxmeas&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;reflat&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;reflon&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;refelev&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;reftype&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;units&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_define_measurement</span><span class="p">()</span>

<div class="viewcode-block" id="DefineMeasurement.get_measurement_lists"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.DefineMeasurement.get_measurement_lists">[docs]</a>    <span class="k">def</span> <span class="nf">get_measurement_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get measurement list including measurement setup</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;No edi file input, check edi_fn attribute&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">meas_find</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;Could not find </span><span class="si">{0}</span><span class="s1">, check path&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span><span class="p">))</span>
                <span class="k">return</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;&gt;=&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s1">&#39;definemeas&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">meas_find</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="s1">&#39;&gt;=&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">meas_find</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">elif</span> <span class="n">meas_find</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

            <span class="c1"># look for the &gt;XMEAS parts</span>
            <span class="k">elif</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">meas_find</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line_list</span> <span class="o">=</span> <span class="n">_validate_str_with_equals</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="n">m_dict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">:</span>
                        <span class="n">ll_list</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="n">ll_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">ll_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">m_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measurement_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="DefineMeasurement.read_define_measurement"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.DefineMeasurement.read_define_measurement">[docs]</a>    <span class="k">def</span> <span class="nf">read_define_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurement_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read the define measurment section of the edi file</span>

<span class="sd">        should be a list with lines for:</span>
<span class="sd">            - maxchan</span>
<span class="sd">            - maxmeas</span>
<span class="sd">            - maxrun</span>
<span class="sd">            - refelev</span>
<span class="sd">            - reflat</span>
<span class="sd">            - reflon</span>
<span class="sd">            - reftype</span>
<span class="sd">            - units</span>
<span class="sd">            - dictionaries for &gt;XMEAS with keys:</span>
<span class="sd">                - id</span>
<span class="sd">                - chtype</span>
<span class="sd">                - x</span>
<span class="sd">                - y</span>
<span class="sd">                - axm</span>
<span class="sd">                -acqchn</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">measurement_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurement_list</span> <span class="o">=</span> <span class="n">measurement_list</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_measurement_lists</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Nothing to read, check edi_fn or measurement_list attributes&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">line_list</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">line_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">line_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="s1">&#39;reflatitude&#39;</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;reflat&#39;</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">MTft</span><span class="o">.</span><span class="n">_assert_position_format</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="s1">&#39;reflongitude&#39;</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;reflon&#39;</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">MTft</span><span class="o">.</span><span class="n">_assert_position_format</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="s1">&#39;refelevation&#39;</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;refelev&#39;</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">MTft</span><span class="o">.</span><span class="n">_assert_position_format</span><span class="p">(</span><span class="s1">&#39;elev&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="s1">&#39;maxchannels&#39;</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;maxchan&#39;</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="s1">&#39;maxmeasurements&#39;</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;maxmeas&#39;</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="s1">&#39;maxruns&#39;</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;maxrun&#39;</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;meas_</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;chtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">HMeasurement</span><span class="p">(</span><span class="o">**</span><span class="n">line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">key</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">EMeasurement</span><span class="p">(</span><span class="o">**</span><span class="n">line</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="DefineMeasurement.write_define_measurement"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.DefineMeasurement.write_define_measurement">[docs]</a>    <span class="k">def</span> <span class="nf">write_define_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurement_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write the define measurement block as a list of strings</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">measurement_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_define_measurement</span><span class="p">(</span><span class="n">measurement_list</span><span class="o">=</span><span class="n">measurement_list</span><span class="p">)</span>

        <span class="n">measurement_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt;=DEFINEMEAS</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_meas_keys</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;reflat&#39;</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;reflon&#39;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">MTft</span><span class="o">.</span><span class="n">convert_dms_tuple2string</span><span class="p">(</span>
                    <span class="n">MTft</span><span class="o">.</span><span class="n">convert_degrees2dms_tuple</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;refelev&#39;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="n">measurement_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}{1}</span><span class="s1">=</span><span class="si">{2}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span>
                                                           <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                                                           <span class="n">value</span><span class="p">))</span>
        <span class="n">measurement_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># need to write the &gt;XMEAS type, but sort by channel number</span>
        <span class="n">m_key_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">kk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                      <span class="k">if</span> <span class="n">kk</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;meas_&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m_key_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;No XMEAS information.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># need to sort the dictionary by chanel id</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">m_key_list</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">m_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">chtype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">head</span> <span class="o">=</span> <span class="s1">&#39;hmeas&#39;</span>
                <span class="k">elif</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">chtype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">head</span> <span class="o">=</span> <span class="s1">&#39;emeas&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">head</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="n">m_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&gt;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">head</span><span class="o">.</span><span class="n">upper</span><span class="p">())]</span>
                <span class="k">for</span> <span class="n">mkey</span><span class="p">,</span> <span class="n">mfmt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">_kw_list</span><span class="p">,</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">_fmt_list</span><span class="p">):</span>
                    <span class="n">m_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">{0}</span><span class="s1">={1:</span><span class="si">{2}</span><span class="s1">}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mkey</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                                                        <span class="nb">getattr</span><span class="p">(</span><span class="n">m_obj</span><span class="p">,</span> <span class="n">mkey</span><span class="p">),</span>
                                                        <span class="n">mfmt</span><span class="p">))</span>
                <span class="n">m_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">measurement_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m_list</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">measurement_lines</span></div>

<div class="viewcode-block" id="DefineMeasurement.get_measurement_dict"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.DefineMeasurement.get_measurement_dict">[docs]</a>    <span class="k">def</span> <span class="nf">get_measurement_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get a dictionary for the xmeas parts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">meas_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;meas_&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">meas_attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                <span class="n">meas_key</span> <span class="o">=</span> <span class="n">meas_attr</span><span class="o">.</span><span class="n">chtype</span>
                <span class="n">meas_dict</span><span class="p">[</span><span class="n">meas_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">meas_attr</span>

        <span class="k">return</span> <span class="n">meas_dict</span></div></div>


<span class="c1"># ==============================================================================</span>
<span class="c1"># magnetic measurements</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="HMeasurement"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.HMeasurement">[docs]</a><span class="k">class</span> <span class="nc">HMeasurement</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    HMeasurement contains metadata for a magnetic field measurement</span>

<span class="sd">    Attributes</span>
<span class="sd">    ------------</span>

<span class="sd">    ====================== ====================================================</span>
<span class="sd">    Attributes             Description</span>
<span class="sd">    ====================== ====================================================</span>
<span class="sd">    id                     Channel number</span>
<span class="sd">    chtype                 [ HX | HY | HZ | RHX | RHY ]</span>
<span class="sd">    x                      x (m) north from reference point (station)</span>
<span class="sd">    y                      y (m) east from reference point (station)</span>
<span class="sd">    azm                    angle of sensor relative to north = 0</span>
<span class="sd">    acqchan                name of the channel acquired usually same as chtype</span>
<span class="sd">    ====================== ====================================================</span>

<span class="sd">    Example</span>
<span class="sd">    ------------</span>

<span class="sd">    :Fill Metadata: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.core.edi as mtedi</span>
<span class="sd">        &gt;&gt;&gt; h_dict = {&#39;id&#39;: &#39;1&#39;, &#39;chtype&#39;:&#39;hx&#39;, &#39;x&#39;:0, &#39;y&#39;:0, &#39;azm&#39;:0}</span>
<span class="sd">        &gt;&gt;&gt; h_dict[&#39;acqchn&#39;] = &#39;hx&#39;</span>
<span class="sd">        &gt;&gt;&gt; hmeas = mtedi.HMeasurement(**h_dict)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_kw_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;chtype&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;azm&#39;</span><span class="p">,</span> <span class="s1">&#39;acqchan&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;4.4g&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;3&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;4.1f&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;4.1f&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;4.1f&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;4&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kw_list</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span></div>


<span class="c1"># ==============================================================================</span>
<span class="c1"># electric measurements</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="EMeasurement"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.EMeasurement">[docs]</a><span class="k">class</span> <span class="nc">EMeasurement</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    EMeasurement contains metadata for an electric field measurement</span>

<span class="sd">    Attributes</span>
<span class="sd">    ------------</span>

<span class="sd">    ====================== ====================================================</span>
<span class="sd">    Attributes             Description</span>
<span class="sd">    ====================== ====================================================</span>
<span class="sd">    id                     Channel number</span>
<span class="sd">    chtype                 [ EX | EY ]</span>
<span class="sd">    x                      x (m) north from reference point (station) of one</span>
<span class="sd">                           electrode of the dipole</span>
<span class="sd">    y                      y (m) east from reference point (station) of one</span>
<span class="sd">                           electrode of the dipole</span>
<span class="sd">    x2                     x (m) north from reference point (station) of the</span>
<span class="sd">                           other electrode of the dipole</span>
<span class="sd">    y2                     y (m) north from reference point (station) of the</span>
<span class="sd">                           other electrode of the dipole</span>
<span class="sd">    acqchan                name of the channel acquired usually same as chtype</span>
<span class="sd">    ====================== ====================================================</span>

<span class="sd">    Example</span>
<span class="sd">    ------------</span>

<span class="sd">    :Fill Metadata: ::</span>

<span class="sd">        &gt;&gt;&gt; import mtpy.core.edi as mtedi</span>
<span class="sd">        &gt;&gt;&gt; e_dict = {&#39;id&#39;: &#39;1&#39;, &#39;chtype&#39;:&#39;ex&#39;, &#39;x&#39;:0, &#39;y&#39;:0, &#39;x2&#39;:50, &#39;y2&#39;:50}</span>
<span class="sd">        &gt;&gt;&gt; e_dict[&#39;acqchn&#39;] = &#39;ex&#39;</span>
<span class="sd">        &gt;&gt;&gt; emeas = mtedi.EMeasurement(**e_dict)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_kw_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;chtype&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;x2&#39;</span><span class="p">,</span> <span class="s1">&#39;y2&#39;</span><span class="p">,</span> <span class="s1">&#39;acqchan&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fmt_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;4.4g&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;3&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;4.1f&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;4.1f&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;4.1f&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;4.1f&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;&lt;4&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kw_list</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span></div>


<span class="c1"># ==============================================================================</span>
<span class="c1"># data section</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="DataSection"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.DataSection">[docs]</a><span class="k">class</span> <span class="nc">DataSection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    DataSection contains the small metadata block that describes which channel</span>
<span class="sd">    is which.  A typical block looks like::</span>

<span class="sd">        &gt;=MTSECT</span>

<span class="sd">            ex=1004.001</span>
<span class="sd">            ey=1005.001</span>
<span class="sd">            hx=1001.001</span>
<span class="sd">            hy=1002.001</span>
<span class="sd">            hz=1003.001</span>
<span class="sd">            nfreq=14</span>
<span class="sd">            sectid=par28ew</span>
<span class="sd">            nchan=None</span>
<span class="sd">            maxblks=None</span>

<span class="sd">    Arguments</span>
<span class="sd">    -------------</span>
<span class="sd">        **edi_fn** : string</span>
<span class="sd">                     full path to .edi file to read in.</span>

<span class="sd">    Attributes</span>
<span class="sd">    -------------</span>

<span class="sd">    ================= ==================================== ======== ===========</span>
<span class="sd">    Attributes        Description                          Default  In .edi</span>
<span class="sd">    ================= ==================================== ======== ===========</span>
<span class="sd">    ex                ex channel id number                 None     yes</span>
<span class="sd">    ey                ey channel id number                 None     yes</span>
<span class="sd">    hx                hx channel id number                 None     yes</span>
<span class="sd">    hy                hy channel id number                 None     yes</span>
<span class="sd">    hz                hz channel id number                 None     yes</span>
<span class="sd">    nfreq             number of frequencies                None     yes</span>
<span class="sd">    sectid            section id, should be the same</span>
<span class="sd">                      as the station name -&gt; Header.dataid None     yes</span>
<span class="sd">    maxblks           maximum number of data blocks        None     yes</span>
<span class="sd">    nchan             number of channels                   None     yes</span>
<span class="sd">    _kw_list          list of key words to put in metadata [1]_     no</span>
<span class="sd">    ================= ==================================== ======== ===========</span>

<span class="sd">    .. rubric:: Footnotes</span>
<span class="sd">    .. [1] Changes these values to change what is written to edi file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edi_lines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="o">=</span> <span class="n">edi_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="o">=</span> <span class="n">edi_lines</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_sect_list</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_kw_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nfreq&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;sectid&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;nchan&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;maxblks&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;ex&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;ey&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;hx&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;hy&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;hz&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kw_list</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_data_sect</span><span class="p">()</span>

<div class="viewcode-block" id="DataSection.get_data_sect"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.DataSection.get_data_sect">[docs]</a>    <span class="k">def</span> <span class="nf">get_data_sect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read in the data of the file, will detect if reading spectra or</span>
<span class="sd">        impedance.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MTex</span><span class="o">.</span><span class="n">MTpyError_EDI</span><span class="p">(</span><span class="s1">&#39;No edi file to read. Check edi_fn&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_sect_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data_sect_find</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MTex</span><span class="o">.</span><span class="n">MTpyError_EDI</span><span class="p">(</span>
                    <span class="s1">&#39;Could not find </span><span class="si">{0}</span><span class="s1">. Check path&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;&gt;=&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s1">&#39;sect&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">data_sect_find</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">line_num</span> <span class="o">=</span> <span class="n">ii</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;spect&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="s1">&#39;spectra&#39;</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;mt&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">data_sect_find</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">line_num</span> <span class="o">=</span> <span class="n">ii</span>
                <span class="k">break</span>

            <span class="k">elif</span> <span class="n">data_sect_find</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_sect_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>

<div class="viewcode-block" id="DataSection.read_data_sect"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.DataSection.read_data_sect">[docs]</a>    <span class="k">def</span> <span class="nf">read_data_sect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_sect_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read data section</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">data_sect_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_sect_list</span> <span class="o">=</span> <span class="n">data_sect_list</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_lines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_data_sect</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">d_line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_sect_list</span><span class="p">:</span>
            <span class="n">d_list</span> <span class="o">=</span> <span class="n">d_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">d_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">d_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">d_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataSection.write_data_sect"><a class="viewcode-back" href="../../../core.html#mtpy.core.edi.DataSection.write_data_sect">[docs]</a>    <span class="k">def</span> <span class="nf">write_data_sect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_sect_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write a data section</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">data_sect_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_data_sect</span><span class="p">(</span><span class="n">data_sect_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Writing out data a impedances&#39;</span><span class="p">)</span>

        <span class="n">data_sect_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&gt;=mtsect</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kw_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]:</span>
            <span class="n">data_sect_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}{1}</span><span class="s1">=</span><span class="si">{2}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span>
                                                         <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                                                         <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)))</span>

        <span class="c1"># need to sort the list so it is descending order by channel number</span>
        <span class="n">ch_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
                   <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kw_list</span><span class="p">[</span><span class="mi">4</span><span class="p">:]]</span>
        <span class="n">ch_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ch_list</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">ch_list</span><span class="p">:</span>
            <span class="n">data_sect_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}{1}</span><span class="s1">=</span><span class="si">{2}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span>
                                                         <span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                         <span class="n">ch</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">data_sect_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_sect_lines</span></div></div>


<span class="k">def</span> <span class="nf">_validate_str_with_equals</span><span class="p">(</span><span class="n">input_string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    make sure an input string is of the format {0}={1} {2}={3} {4}={5} ...</span>
<span class="sd">    Some software programs put spaces after the equals sign and that&#39;s not</span>
<span class="sd">    cool.  So we make the string into a readable format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input_string</span> <span class="o">=</span> <span class="n">input_string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="c1"># remove the first &gt;XXXXX</span>
    <span class="k">if</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">in</span> <span class="n">input_string</span><span class="p">:</span>
        <span class="n">input_string</span> <span class="o">=</span> <span class="n">input_string</span><span class="p">[</span><span class="n">input_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">):]</span>

    <span class="c1"># check if there is a // at the end of the line</span>
    <span class="k">if</span> <span class="n">input_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;//&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">input_string</span> <span class="o">=</span> <span class="n">input_string</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">input_string</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;//&#39;</span><span class="p">)]</span>

    <span class="c1"># split the line by =</span>
    <span class="n">l_list</span> <span class="o">=</span> <span class="n">input_string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>

    <span class="c1"># split the remaining strings</span>
    <span class="n">str_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">l_list</span><span class="p">:</span>
        <span class="n">s_list</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">l_str</span> <span class="ow">in</span> <span class="n">s_list</span><span class="p">:</span>
            <span class="n">str_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l_str</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="c1"># probably not a good return</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_list</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;The number of entries in </span><span class="si">{0}</span><span class="s1"> is not even&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">str_list</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">str_list</span>

    <span class="n">line_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">=</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">str_list</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">str_list</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span>
                 <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_list</span><span class="p">),</span> <span class="mi">2</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">line_list</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../master_index.html">MTpy 0.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, J. Peacock, L. Krieger.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.6.
    </div>
  </body>
</html>